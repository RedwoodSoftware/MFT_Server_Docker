/* Copyright Â© 2009-2024. Redwood Software Inc. All rights reserved. */
jscape.settings=jscape.settings||{};jscape.ServiceConfiguration=Class.extend({initialize:function(a){this.protocol=a||undefined;},clone:function(){return $.extend(new jscape.ServiceConfiguration(),this);}});jscape.ServiceConfiguration.fromJSON=function(data){if(data){if(data.hasOwnProperty("fileOverwritingPolicy")){data.fileOverwritingPolicy=jscape.ServiceConfiguration.FileOverwritingPolicy.valueOf(data.fileOverwritingPolicy);}
return $.extend(new jscape.ServiceConfiguration(),data);}
return null;};jscape.ServiceConfiguration.FileOverwritingPolicy={PROHIBIT:"PROHIBIT",OVERWRITE:"OVERWRITE",GENERATE_UNIQUE_NAME:"GENERATE_UNIQUE_NAME",valueOf:function(value){for(var key in this){if(typeof this[key]==="string"&&this[key].toLowerCase()==(value+"").toLowerCase()){return this[key];}}return null;}};jscape.ServiceConfiguration.aftp=function(timeout,dataTimeout,backlog,tcpNoDelay,maxLossListSize,ciphers){return $.extend(new jscape.ServiceConfiguration(jscape.TransportService.Protocol.AFTP),{timeout:parseInt(timeout)||0,dataTimeout:parseInt(dataTimeout)||0,backlog:parseInt(backlog)||5,tcpNoDelayEnabled:!!tcpNoDelay,maxLossListSize:parseInt(maxLossListSize)||10,cipherSuites:ciphers||undefined});};jscape.ServiceConfiguration.ftp=function(timeout,dataTimeout,banner,passiveIp,portRange,backlog,sendBuffer,receiveBuffer,transferMode,dataConnectionMode,ciphers,shutdownCommandSsl,shutdownDataSsl,commandClientCertificate,dataClientCertificate,forceDataEncryption,blockPasv,blockBounce,tcpNoDelay,networkCharset,fileCharset){return $.extend(new jscape.ServiceConfiguration(jscape.TransportService.Protocol.FTP),{timeout:parseInt(timeout)||0,dataTimeout:parseInt(dataTimeout)||0,welcomeMessage:banner||"",passiveIp:passiveIp||"",portRange:portRange||null,backlog:parseInt(backlog)||5,sendBufferSize:parseInt(sendBuffer)||null,receiveBufferSize:parseInt(receiveBuffer)||null,defaultTransferMode:transferMode=="IMAGE"?transferMode:"ASCII",dataConnectionMode:dataConnectionMode||"ALL",cipherSuites:ciphers||undefined,shutdownSsl:!!shutdownCommandSsl,shutdownDataSsl:!!shutdownDataSsl,commandRequireClientCertificate:!!commandClientCertificate,dataRequireClientCertificate:!!dataClientCertificate,forceDataEncryption:!!forceDataEncryption,blockPasvAttack:!!blockPasv,blockBounceAttack:!!blockBounce,tcpNoDelayEnabled:!!tcpNoDelay,networkCharset:networkCharset,fileCharset:fileCharset});};jscape.ServiceConfiguration.sftp=function(timeout,version,startupBanner,authBanner,sendBuffer,receiveBuffer,backlog,tcpNoDelay,disableExpandedLongName,sshKexes,sshHostKeys,sshCiphers,sshMacs,sshCompressions){return $.extend(new jscape.ServiceConfiguration(jscape.TransportService.Protocol.SFTP),{timeout:parseInt(timeout)||0,softwareVersion:version||"JSCAPE",startupBanner:startupBanner||"",authBanner:authBanner||"",sendBufferSize:parseInt(sendBuffer)||null,receiveBufferSize:parseInt(receiveBuffer)||null,backlog:parseInt(backlog)||5,tcpNoDelayEnabled:!!tcpNoDelay,disableRealPathExpandedLongName:!!disableExpandedLongName,supportedKexes:sshKexes,supportedKeys:sshHostKeys,supportedCiphers:sshCiphers,supportedMacs:sshMacs,supportedCompressions:sshCompressions});};jscape.settings.GlobalServicesModule=jscape.settings.SettingsModule.extend({onCreate:function(_a,_b,app){var args=$.makeArray(arguments);this._super.apply(this,args);var submodules=[];this.servicesController=new jscape.settings.GlobalServicesController();submodules.push(app.register("global-services-list",new jscape.settings.SettingsSubmodule(this.servicesController)));submodules.push(app.register("global-services-ftp",new jscape.settings.SettingsSubmodule(new jscape.settings.FtpConfigurationController())));submodules.push(app.register("global-services-sftp",new jscape.settings.SettingsSubmodule(new jscape.settings.SftpConfigurationController())));submodules.push(app.register("global-services-aftp",new jscape.settings.SettingsSubmodule(new jscape.settings.AftpConfigurationController())));$.each(submodules,function(){this.onCreate.apply(this,args);});},onStart:function(){this.servicesController.start();},onPause:function(){if(this.servicesController.hasChanged()){this._confirmAndApply(this.servicesController);}},onResume:function(){}});jscape.settings.GlobalServicesController=jscape.ui.DatagridController.extend({view:null,initialize:function(){this.addController=new jscape.settings.AddGlobalServiceController();this.editController=new jscape.settings.EditGlobalServiceController();this.deleteController=new jscape.settings.DeleteGlobalServiceController();this.startController=new jscape.settings.StartGlobalServiceController();this.stopController=new jscape.settings.StopGlobalServiceController();},start:function(){if(this.view==null){this.view=new jscape.settings.GlobalServicesView();}
this.view.show(this);},resume:function(){this.view.refresh();},hasChanged:function(){return false;},onLoadData:function(){return jscape.API.getGlobalServiceSummaries();},onAddService:function(){return this.addController.start().done($.proxy(this._serviceAdded,this));},onEditService:function(service){return this.editController.start(service.protocol,service.id,service.isStarted()).done($.proxy(this._serviceEdited,this));},onDeleteService:function(services){return this.deleteController.start(services).done($.proxy(this._serviceDeleted,this,services));},onStartService:function(services){return this.startController.start(services).always($.proxy(this._serviceStateChanged,this));},onStopService:function(service){return this.stopController.start(service).always($.proxy(this._serviceStateChanged,this,service));},_serviceAdded:function(service){this._recordAdded(service);},_serviceEdited:function(service){this._recordEdited(service);},_serviceDeleted:function(service){this._recordDeleted(service);},_serviceStateChanged:function(service){this._reloadAndSelect(service);}});jscape.settings.GlobalServicesView=jscape.ui.DatagridView.extend({selection:null,initialize:function(){var initializing=true;this.fieldset=$("#global-services-fields").layout({fit:true,doSize:false,border:false});this.data=$("table[role=grid][aria-label=services]",this.fieldset);this.data.datagrid({fit:true,fitColumns:true,remoteSort:false,singleSelect:true,idField:"id",sortName:"protocol",columns:[[{field:"protocol",title:$("thead th:nth-child(1)",this.data).text(),sortable:true,width:"12%",formatter:$.proxy(function(_,row){return this._formatProtocol(row);},this)},{field:"host",title:$("thead th:nth-child(2)",this.data).text(),sortable:false,width:"17%",formatter:$.proxy(function(_,row){return this._formatHost(row);},this)},{field:"port",title:$("thead th:nth-child(3)",this.data).text(),sortable:false,width:"7%",align:"right",formatter:$.proxy(function(_,row){return this._formatPort(row);},this)},{field:"keyAlias",title:$("thead th:nth-child(4)",this.data).text(),sortable:false,width:"15%"},{field:"details",title:$("thead th:nth-child(5)",this.data).text(),sortable:false,width:"35%",formatter:$.proxy(function(_,row){return this._formatDetails(row);},this)},{field:"status",title:$("thead th:nth-child(6)",this.data).text(),sortable:false,width:"14%",align:"left",formatter:$.proxy(function(_,row){return this._formatStatus(row);},this),styler:$.proxy(function(_,row){return this._styleStatus(row);},this)}]],onSelect:$.proxy(this._adjustButtonsState,this),onUnselect:$.proxy(this._adjustButtonsState,this),onUnselectAll:$.proxy(this._adjustButtonsState,this),onDblClickRow:$.proxy(function(){this.editButton.click();},this),onRowContextMenu:$.proxy(this._onRow$ContextMenu,this),loader:$.proxy(this._onLoad$Data,this),onBeforeLoad:function(){return!initializing;},onLoadSuccess:$.proxy(this._adjustButtonsState,this)});this.addButton=$("a[role=button][name=add]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$AddButton,this)});this.editButton=$("a[role=button][name=edit]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$EditButton,this)});this.deleteButton=$("a[role=button][name=delete]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$DeleteButton,this)});this.refreshButton=$("a[role=button][name=refresh]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$RefreshButton,this)}).hide();this.startButton=$("a[role=button][name=start]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$StartButton,this)});this.stopButton=$("a[role=button][name=stop]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$StopButton,this)});this.fieldset.layout("panel","south").panel("resize",{height:"auto"});initializing=false;},show:function(listener){this.listener=listener||jscape.settings.GlobalServicesView.LISTENER;this.fieldset.layout("resize");this._adjustButtonsState();},_formatProtocol:function(service){return window.R.string[("APPLICATION_PROTOCOL_"+service.protocol).toUpperCase()]+(service.type?" "+service.type:"");},_formatHost:function(service){switch(service.protocol){case jscape.TransportService.Protocol.HTTP:case jscape.TransportService.Protocol.WEBDAV:case jscape.TransportService.Protocol.AS2:var disabledString=window.R.string.GLOBAL_SERVICES_TEMPLATE_DISABLED;return window.R.string.GLOBAL_SERVICES_TEMPLATE_HTTP_DETAILS.supplant({0:service.plainAddress?this._hostOf(service.plainAddress):disabledString,1:service.secureAddress?this._hostOf(service.secureAddress):disabledString});case jscape.TransportService.Protocol.AGENT:return this._hostOf(service.address);default:return this._hostOf(service.plainAddress)||this._hostOf(service.secureAddress);}},_formatPort:function(service){switch(service.protocol){case jscape.TransportService.Protocol.HTTP:case jscape.TransportService.Protocol.WEBDAV:case jscape.TransportService.Protocol.AS2:var disabledString=window.R.string.GLOBAL_SERVICES_TEMPLATE_DISABLED;return window.R.string.SERVICES_TEMPLATE_HTTP_DETAILS.supplant({0:service.plainAddress?this._portOf(service.plainAddress):disabledString,1:service.secureAddress?this._portOf(service.secureAddress):disabledString});case jscape.TransportService.Protocol.AGENT:return this._portOf(service.address);default:return this._portOf(service.plainAddress)||this._hostOf(service.secureAddress);}},_formatDetails:function(service){switch(service.protocol){case jscape.TransportService.Protocol.SFTP:return window.R.string.GLOBAL_SERVICES_TEMPLATE_SFTP_DETAILS.supplant({0:service.authenticationType});default:return"";}},_formatStatus:function(service){switch(service.status){case jscape.TransportServiceSummary.Status.STARTED:return window.R.string.GLOBAL_SERVICES_STATE_STARTED;case jscape.TransportServiceSummary.Status.STOPPED:return window.R.string.GLOBAL_SERVICES_STATE_STOPPED;case jscape.TransportServiceSummary.Status.ERROR:var message=String(service.errorMessage).escapeXml();return service.isBindingError()?window.R.string.GLOBAL_SERVICES_ERROR_BAD_ADDRESS||message:window.R.string.GLOBAL_SERVICES_STATE_ERROR.supplant({0:message});default:return"";}},_styleStatus:function(service){switch(service.status){case jscape.TransportServiceSummary.Status.STARTED:return"color:green;font-weight:normal";case jscape.TransportServiceSummary.Status.ERROR:return"color:red;font-weight:bold";default:return"color:black;font-weight:normal";}},_hostOf:function(address){return address?(""+address.host).escapeXml():"";},_portOf:function(address){return address?(""+address.port).escapeXml():"";},_onLoad$Data:function(params,success,error){this.listener.onLoadData(params).then(success,error);},_onClick$AddButton:function(){this.listener.onAddService();},_onClick$EditButton:function(){this.editButton.linkbutton("disable");this.listener.onEditService(this.selection[0]).always($.proxy(this._adjustButtonsState,this));},_onClick$DeleteButton:function(){this.deleteButton.linkbutton("disable");this.listener.onDeleteService(this.selection).always($.proxy(this._adjustButtonsState,this));},_onClick$RefreshButton:function(){this.refresh();},_onClick$StartButton:function(){this.startButton.linkbutton("disable");this.listener.onStartService(this.selection).always($.proxy(this._adjustButtonsState,this));},_onClick$StopButton:function(){this.stopButton.linkbutton("disable");this.listener.onStopService(this.selection[0]).always($.proxy(this._adjustButtonsState,this));},_showContextMenu:function(e){this._super(e,[this.addButton,this.editButton,this.deleteButton,"-",this.refreshButton,"-",this.startButton,this.stopButton]);},_adjustButtonsState:function(){this.selection=this.data.datagrid("getSelections");var singleSelection=this.selection.length==1;this.editButton.linkbutton(singleSelection?"enable":"disable");this.deleteButton.linkbutton(this.selection.length!=0?"enable":"disable");this.startButton.linkbutton(singleSelection&&this.selection[0].isStopped()?"enable":"disable");this.stopButton.linkbutton(singleSelection&&this.selection[0].isStarted()?"enable":"disable");}});jscape.settings.GlobalServicesView.LISTENER={onLoadData:$.noop,onAddService:$.noop,onDeleteService:$.noop,onStartService:$.noop,onStopService:$.noop};jscape.settings.AddGlobalServiceController=Class.extend({deferred:null,initialize:function(){this.controllerMap={AFTP:jscape.settings.AftpServiceController,FTP:jscape.settings.FtpServiceController,SFTP:jscape.settings.SftpServiceController};},start:function(){this.deferred=$.Deferred();this._selectProtocol().then($.proxy(function(protocol){var theClass=this.controllerMap[protocol.toUpperCase()];var controller=new theClass();return controller.start(this);},this)).done($.proxy(function(descriptor){this.deferred.resolve(descriptor);this.deferred=null;},this)).fail($.proxy(function(){this.deferred.reject();this.deferred=null;},this));return this.deferred.promise();},onChange:function(descriptor,startRequired){return jscape.API.addGlobalService(descriptor).done(function(service){if(!!startRequired&&service){jscape.API.startGlobalService(service.protocol,service.id);}});},_selectProtocol:function(){var deferred=$.Deferred();new jscape.settings.AddGlobalServiceProtocolDialog().show({onSubmit:function(d){return deferred.resolve(d.getProtocol());},onCancel:function(d){d.destroy();deferred.reject();deferred=null;}});return deferred.promise();}});jscape.settings.AddGlobalServiceProtocolDialog=jscape.ui.DefaultDialog.extend({initialize:function(){this._super($("#d-service-add-protocol"),{minWidth:450,width:"30%",maxWidth:550,minHeight:230,resizable:false});this.protocol=$("select[name=protocol]",this.dialog);this.protocol.combobox({required:true,editable:false,formatter:$.proxy(this._formatProtocol,this),onLoadSuccess:$.proxy(this._onLoad$Success,this),width:150,panelHeight:"auto",panelMaxHeight:"40%"});},getProtocol:function(){return this.protocol.combobox("getValue");},show:function(listener){this._super(listener);this.protocol.combobox("textbox").focus();this._onForm$Change();},_formatProtocol:function(row){var text=row[this.protocol.combobox("options").textField];return!!row.disabled&&row.title?'<span aria-label="{tip}">{text}</span>'.supplant({tip:(row.title||"").escapeXml(),text:text}):text;},_onLoad$Success:function(){this._createTooltips(this.protocol.combobox("panel").find(".combobox-item"),function(el){return $(el).find("span[aria-label]").attr("aria-label")||"";});}});jscape.settings.EditGlobalServiceController=Class.extend({initialize:function(){this.controllerMap={AFTP:jscape.settings.AftpServiceController,FTP:jscape.settings.FtpServiceController,SFTP:jscape.settings.SftpServiceController};},start:function(protocol,id,startRequired){this.protocol=protocol;this.id=id;this.startRequired=startRequired;this.deferred=$.Deferred();jscape.API.getGlobalServiceDescriptor(protocol,id).then($.proxy(function(descriptor){var theClass=this.controllerMap[this.protocol.toUpperCase()];var controller=new theClass();return controller.start(this,descriptor);},this)).done($.proxy(function(descriptor){this.deferred.resolve(descriptor);this.deferred=null;},this)).fail($.proxy(function(){this.deferred.reject();this.deferred=null;},this));return this.deferred.promise();},onChange:function(descriptor){var startRequired=this.startRequired;return jscape.API.updateGlobalService(this.protocol,this.id,descriptor).done(function(service){if(!!startRequired&&service){jscape.API.startGlobalService(service.protocol,service.id);}});}});jscape.settings.DeleteGlobalServiceController=Class.extend({deferred:null,start:function(services){this.deferred=$.Deferred();this._confirmDelete(services).then(function(){return $.when.apply(jQuery,$.map(services,function(s){return jscape.API.deleteGlobalService(s.protocol,s.id);}));}).done(this.deferred.resolve,this.deferred,services).fail(this.deferred.reject,this.deferred).always($.proxy(function(){this.deferred=null;},this));return this.deferred.promise();},_confirmDelete:function(services){var promise=jscape.ConfirmDialog.confirm(window.R.string.GLOBAL_SERVICES_CONFIRM_DELETE_TITLE,window.R.string.GLOBAL_SERVICES_CONFIRM_DELETE_MESSAGE);var w=$("body").children("div.messager-window");w&&w.length&&w.find(".messager-icon").removeClass("messager-question").addClass("messager-warning");return promise;}});jscape.settings.StartGlobalServiceController=Class.extend({start:function(services){return $.when.apply(jQuery,$.map(services,function(s){return jscape.API.startGlobalService(s.protocol,s.id);}));}});jscape.settings.StopGlobalServiceController=Class.extend({deferred:null,start:function(service){this.deferred=$.Deferred();this._confirmStop(service).then(function(){return jscape.API.stopGlobalService(service.protocol,service.id);}).done(this.deferred.resolve,this.deferred,service).fail(this.deferred.reject,this.deferred).always($.proxy(function(){this.deferred=null;},this));return this.deferred.promise();},_confirmStop:function(service){var promise=jscape.ConfirmDialog.confirm(window.R.string.GLOBAL_SERVICES_CONFIRM_STOP_TITLE,window.R.string.GLOBAL_SERVICES_CONFIRM_STOP_MESSAGE.supplant({0:String(service.protocol).escapeXml()}));var w=$("body").children("div.messager-window");w&&w.length&&w.find(".messager-icon").removeClass("messager-question").addClass("messager-warning");return promise;}});jscape.settings.DefaultGlobalServiceController=Class.extend({start:function(listener,descriptor){this.listener=listener;this.deferred=$.Deferred();this._setupDialog(descriptor).show(this);return this.deferred;},onSubmit:function(dialog){return this.listener.onChange(this._createDescriptor(dialog),dialog.isStartRequired()).done($.proxy(function(descriptor){this.deferred.resolve(descriptor);this.deferred=null;},this));},onCancel:function(dialog){dialog.destroy();this.deferred.reject();this.deferred=null;},onLoadServerKeys:function(){return jscape.API.getServerKeys();},onLoadServerAddresses:function(){return jscape.API.getServerAddresses().then($.proxy(function(values){return $.map(values,$.proxy(function(value){return{text:this._formatHostname(value),value:value};},this));},this));},_formatHostname:function(value){return jscape.ServerParameters.allHostsIpv4(value)?window.R.string.APPLICATION_HOST_ALL_IPV4:jscape.ServerParameters.allHostsIpv6(value)?window.R.string.APPLICATION_HOST_ALL_IPV6:value;}});jscape.settings.FtpServiceController=jscape.settings.DefaultGlobalServiceController.extend({DEFAULTS:{"regular":{port:21,keyUsed:false},"explicit SSL":{port:21,keyUsed:true},"forced explicit SSL":{port:21,keyUsed:true},"implicit SSL":{port:990,keyUsed:true}},onChangeType:function(dialog){var type=dialog.getType();if(this.DEFAULTS.hasOwnProperty(type)){dialog.setPort(this.DEFAULTS[type].port);dialog.setKeyUsed(this.DEFAULTS[type].keyUsed);}},_createDescriptor:function(dialog){return jscape.TransportService.ftp(dialog.getHost(),dialog.getPort(),dialog.getType(),dialog.getKeyAlias());},_setupDialog:function(descriptor){var dialog;if(descriptor){dialog=new jscape.settings.EditFtpServiceDialog();dialog.setType(descriptor.type);dialog.setHost(descriptor.host);dialog.setPort(descriptor.port);dialog.setKeyAlias(descriptor.keyAlias);}else{dialog=new jscape.settings.AddFtpServiceDialog();dialog.setType(jscape.TransportService.FTP_TYPE.EXPLICIT_SSL);this.onChangeType(dialog);}
return dialog;}});jscape.settings.FtpServiceDialog=jscape.ui.DefaultDialog.extend({initialize:function(el,options){var initializing=true;this._super($(el),$.extend({width:"40%",maxWidth:700},options||{}));this.fieldset=$("fieldset[name=ftpservicefields]",this.dialog);this.host=$("select[name=host]",this.fieldset).combobox({required:true,onBeforeLoad:function(){return!initializing;},loader:$.proxy(this._onLoad$Hosts,this),width:"60%",panelMinHeight:80,panelHeight:"auto",panelMaxHeight:"50%",validType:"length[1,500]",missingMessage:window.R.string.SERVICES_ERROR_BAD_HOST,invalidMessage:window.R.string.SERVICES_ERROR_BAD_HOST});this.port=$("input[name=port]",this.fieldset).numberspinner({required:true,min:1,max:65535,width:80});this.type=$("select[name=type]",this.fieldset).combobox({required:true,editable:false,onChange:$.proxy(this._onChange$Type,this),width:170,panelHeight:"auto"});this.keyAlias=$("select[name=privatekey]",this.fieldset).combobox({required:true,editable:false,onBeforeLoad:function(){return!initializing;},loader:$.proxy(this._onLoad$Keys,this),textField:"name",valueField:"name",width:"60%",panelMinHeight:80,panelHeight:"auto",panelMaxHeight:"50%"});initializing=false;},getHost:function(){return this.host.combobox("getValue");},setHost:function(value){this.host.combobox("setValue",value);},getPort:function(){return parseInt(this.port.numberspinner("getValue"));},setPort:function(value){this.port.numberspinner("setValue",parseInt(value)).numberspinner("isValid");},getType:function(){return this.type.combobox("getValue");},setType:function(value){var select=this.type.combobox("getValue");this.type.combobox("setValue",value);if(select===value){this._onChange$Type();}},getKeyAlias:function(){return!this.keyAlias.combobox("options").disabled?this.keyAlias.combobox("getValue"):null;},setKeyAlias:function(value){this.keyAlias.combobox("setValue",value);this.setKeyUsed(value!=null);},setKeyUsed:function(value){this.keyAlias.combobox(!!value?"enable":"disable").combobox(!!value?"enableValidation":"disableValidation");},show:function(listener){this._super(listener||jscape.settings.FtpServiceDialog.LISTENER);this.host.combobox("reload");this.keyAlias.combobox("reload");},_onChange$Type:function(){this.listener&&this.listener.onChangeType(this);},_onLoad$Hosts:function(params,success,error){this.listener.onLoadServerAddresses(params).then(success,error);},_onLoad$Keys:function(params,success,error){this.listener.onLoadServerKeys(params).then(success,error);}});jscape.settings.FtpServiceDialog.LISTENER={onChangeType:$.noop,onLoadServerAddresses:$.noop,onLoadServerKeys:$.noop,onSubmit:$.noop,onCancel:$.noop};jscape.settings.AddFtpServiceDialog=jscape.settings.FtpServiceDialog.extend({initialize:function(){var submitButtonId="submit"+this.getIdSuffix();this._super($("#d-services-ftp"),{width:"50%",buttons:[{text:window.R.string.GLOBAL_SERVICES_ADD_BUTTON_SUBMIT||"Add",id:submitButtonId,handler:$.proxy(this._onSubmit,this,false)},{text:window.R.string.GLOBAL_SERVICES_ADD_BUTTON_SUBMIT_AND_START||"Add/Start",handler:$.proxy(this._onSubmit,this,true)},{text:window.R.string.DIALOG_BUTTON_CANCEL||"Cancel",handler:$.proxy(this._onCancel,this)}]});this.okButton=this.dialog.siblings(".dialog-button").children("#"+submitButtonId);},isStartRequired:function(){return!!this.startRequired;},_onSubmit:function(startRequired){this.startRequired=startRequired;return this._super();}});jscape.settings.EditFtpServiceDialog=jscape.settings.FtpServiceDialog.extend({initialize:function(){this._super($("#d-services-ftp"),{width:"50%"});this.setTitle(this._titleFor(null));},setType:function(value){this._super(value);this.setTitle(this._titleFor(value));},isStartRequired:function(){return false;},_titleFor:function(type){switch(type){case jscape.TransportService.FTP_TYPE.IMPLICIT_SSL:return window.R.string.GLOBAL_SERVICES_EDIT_TITLE.supplant({0:window.R.string.APPLICATION_PROTOCOL_IMPLICIT_FTPS});case jscape.TransportService.FTP_TYPE.EXPLICIT_SSL:case jscape.TransportService.FTP_TYPE.FORCED_EXPLICIT_SSL:return window.R.string.GLOBAL_SERVICES_EDIT_TITLE.supplant({0:window.R.string.APPLICATION_PROTOCOL_EXPLICIT_FTPS});default:return window.R.string.GLOBAL_SERVICES_EDIT_TITLE.supplant({0:window.R.string.APPLICATION_PROTOCOL_FTP});}}});jscape.settings.SftpServiceController=jscape.settings.DefaultGlobalServiceController.extend({DEFAULT_PORT:22,_createDescriptor:function(dialog){return jscape.TransportService.sftp(dialog.getHost(),dialog.getPort(),dialog.getAuthentication(),dialog.getKeyAlias());},_setupDialog:function(descriptor){var dialog;if(descriptor){dialog=new jscape.settings.EditSftpServiceDialog();dialog.setHost(descriptor.host);dialog.setPort(descriptor.port);dialog.setAuthentication(descriptor.authenticationType);dialog.setKeyAlias(descriptor.keyAlias);}else{dialog=new jscape.settings.AddSftpServiceDialog();dialog.setPort(this.DEFAULT_PORT);}
return dialog;}});jscape.settings.SftpServiceDialog=jscape.ui.DefaultDialog.extend({initialize:function(el,options){var initializing=true;this._super($(el),$.extend({width:"40%",maxWidth:700},options||{}));this.fieldset=$("fieldset[name=sftpservicefields]",this.dialog);this.host=$("select[name=host]",this.fieldset).combobox({required:true,onBeforeLoad:function(){return!initializing;},loader:$.proxy(this._onLoad$Hosts,this),width:"60%",panelMaxWidth:"auto",panelHeight:"auto",panelMinHeight:80,panelMaxHeight:"40%",validType:"length[1,500]",missingMessage:window.R.string.GLOBAL_SERVICES_ERROR_BAD_HOST,invalidMessage:window.R.string.GLOBAL_SERVICES_ERROR_BAD_HOST});this.port=$("input[name=port]",this.fieldset).numberspinner({required:true,min:1,max:65535,width:80});this.keyAlias=$("select[name=privatekey]",this.fieldset).combobox({required:true,editable:false,onBeforeLoad:function(){return!initializing;},loader:$.proxy(this._onLoad$Keys,this),textField:"name",valueField:"name",width:"60%",panelHeight:"auto",panelMinHeight:80,panelMaxHeight:"40%"});this.auth=$("select[name=auth]",this.fieldset).combobox({required:true,editable:false,width:"30%",panelHeight:"auto"});initializing=false;},show:function(listener){this._super(listener);this.host.combobox("reload");this.keyAlias.combobox("reload");},getHost:function(){return this.host.combobox("getValue");},setHost:function(value){this.host.combobox("setValue",value);},setHosts:function(values){this.host.combobox("loadData",$.map(values,$.proxy(function(value){return{text:this._formatHostname(value),value:value};},this)));},getPort:function(){return parseInt(this.port.numberspinner("getValue"));},setPort:function(value){this.port.numberspinner("setValue",parseInt(value)).numberspinner("validate");},getAuthentication:function(){return this.auth.combobox("getValue");},setAuthentication:function(value){this.auth.combobox("select",value);},getKeyAlias:function(){return!this.keyAlias.combobox("options").disabled?this.keyAlias.combobox("getValue"):null;},setKeyAlias:function(value){this.keyAlias.combobox("setValue",value);},_formatHostname:function(value){return jscape.ServerParameters.allHostsIpv4(value)?window.R.string.APPLICATION_HOST_ALL_IPV4:jscape.ServerParameters.allHostsIpv6(value)?window.R.string.APPLICATION_HOST_ALL_IPV6:value;},_onLoad$Hosts:function(params,success,error){this.listener.onLoadServerAddresses(params).then(success,error);},_onLoad$Keys:function(params,success,error){this.listener.onLoadServerKeys(params).then(success,error);}});jscape.settings.AddSftpServiceDialog=jscape.settings.SftpServiceDialog.extend({initialize:function(){var submitButtonId="submit"+this.getIdSuffix();this._super($("#d-services-sftp"),{width:"50%",buttons:[{text:window.R.string.GLOBAL_SERVICES_ADD_BUTTON_SUBMIT||"Add",id:submitButtonId,handler:$.proxy(this._onSubmit,this,false)},{text:window.R.string.GLOBAL_SERVICES_ADD_BUTTON_SUBMIT_AND_START||"Add/Start",handler:$.proxy(this._onSubmit,this,true)},{text:window.R.string.DIALOG_BUTTON_CANCEL||"Cancel",handler:$.proxy(this._onCancel,this)}]});this.okButton=this.dialog.siblings(".dialog-button").children("#"+submitButtonId);},isStartRequired:function(){return!!this.startRequired;},_onSubmit:function(startRequired){this.startRequired=startRequired;return this._super();}});jscape.settings.EditSftpServiceDialog=jscape.settings.SftpServiceDialog.extend({initialize:function(){this._super($("#d-services-sftp"),{width:"50%"});this.setTitle(window.R.string.GLOBAL_SERVICES_EDIT_TITLE.supplant({0:window.R.string.APPLICATION_PROTOCOL_SFTP}));},isStartRequired:function(){return false;}});jscape.settings.AftpServiceController=jscape.settings.DefaultGlobalServiceController.extend({DEFAULT_PORT:3000,_createDescriptor:function(dialog){return jscape.TransportService.aftp(dialog.getHost(),dialog.getPort(),dialog.getKeyAlias(),dialog.isProtectionRequired());},_setupDialog:function(descriptor){var dialog;if(descriptor){dialog=new jscape.settings.EditAftpServiceDialog();dialog.setHost(descriptor.host);dialog.setPort(descriptor.port);dialog.setKeyAlias(descriptor.keyAlias);dialog.setProtectionRequired(descriptor.protectionRequired);}else{dialog=new jscape.settings.AddAftpServiceDialog();dialog.setPort(this.DEFAULT_PORT);dialog.setProtectionRequired(true);}
return dialog;}});jscape.settings.AftpServiceDialog=jscape.ui.DefaultDialog.extend({initialize:function(el,options){var initializing=true;this._super($(el),$.extend({width:"40%",maxWidth:700},options||{}));this.fieldset=$("fieldset[name=aftpservicefields]",this.dialog);this.host=$("select[name=host]",this.fieldset).combobox({required:true,editable:true,limitToList:true,loader:$.proxy(this._onLoad$Hosts,this),onBeforeLoad:function(){return!initializing;},width:"60%",panelMinHeight:50,panelHeight:"auto",panelMaxHeight:"50%",validType:"length[1,500]",missingMessage:window.R.string.GLOBAL_SERVICES_ERROR_BAD_HOST,invalidMessage:window.R.string.GLOBAL_SERVICES_ERROR_BAD_HOST});this.port=$("input[name=port]",this.fieldset).numberspinner({required:true,min:1,max:65535,width:80});this.keyAlias=$("select[name=privatekey]",this.fieldset).combobox({required:true,editable:false,onBeforeLoad:function(){return!initializing;},loader:$.proxy(this._onLoad$Keys,this),textField:"name",valueField:"name",width:"60%",panelMinHeight:80,panelHeight:"auto",panelMaxHeight:"50%"});this.protectionRequired=$("input[name=requiresecure]:checkbox",this.fieldset);initializing=false;},show:function(listener){this._super(listener);this.host.combobox("reload");this.keyAlias.combobox("reload");},getHost:function(){return this.host.combobox("getValue");},setHost:function(value){this.host.combobox("setValue",value);},getPort:function(){return parseInt(this.port.numberspinner("getValue"));},setPort:function(value){this.port.numberspinner("setValue",parseInt(value)).numberspinner("validate");},getKeyAlias:function(){return!this.keyAlias.combobox("options").disabled?this.keyAlias.combobox("getValue"):null;},setKeyAlias:function(value){this.keyAlias.combobox("setValue",value);},isProtectionRequired:function(){return this.protectionRequired.is(":checked");},setProtectionRequired:function(value){this.protectionRequired.prop("checked",!!value);},_onLoad$Hosts:function(params,success,error){this.listener.onLoadServerAddresses(params).then(success,error);},_onLoad$Keys:function(params,success,error){this.listener.onLoadServerKeys(params).then(success,error);}});jscape.settings.AddAftpServiceDialog=jscape.settings.AftpServiceDialog.extend({initialize:function(){var submitButtonId="submit"+this.getIdSuffix();this._super($("#d-services-aftp"),{width:"50%",buttons:[{text:window.R.string.GLOBAL_SERVICES_ADD_BUTTON_SUBMIT||"Add",id:submitButtonId,handler:$.proxy(this._onSubmit,this,false)},{text:window.R.string.GLOBAL_SERVICES_ADD_BUTTON_SUBMIT_AND_START||"Add/Start",handler:$.proxy(this._onSubmit,this,true)},{text:window.R.string.DIALOG_BUTTON_CANCEL||"Cancel",handler:$.proxy(this._onCancel,this)}]});this.okButton=this.dialog.siblings(".dialog-button").children("#"+submitButtonId);},isStartRequired:function(){return!!this.startRequired;},_onSubmit:function(startRequired){this.startRequired=startRequired;return this._super();}});jscape.settings.EditAftpServiceDialog=jscape.settings.AftpServiceDialog.extend({initialize:function(){this._super($("#d-services-aftp"),{width:"50%"});this.setTitle(window.R.string.GLOBAL_SERVICES_EDIT_TITLE.supplant({0:window.R.string.APPLICATION_PROTOCOL_AFTP}));},isStartRequired:function(){return false;}});jscape.settings.SftpAlgorithmsController=Class.extend({DEFAULT_ALGORITHMS:{kexes:[],keys:[],ciphers:[],macs:[],compressions:[]},deferred:null,start:function(algorithms){this.deferred=$.Deferred();this.serverParams=null;jscape.API.getServerParameters().done($.proxy(function(data){this.serverParams=data;},this)).done($.proxy(function(){this._setupDialog(algorithms||this.DEFAULT_ALGORITHMS).show(this);},this));return this.deferred.promise();},onLoadData:function(){return $.Deferred().resolve(this.serverParams).promise();},onLoadKeyExchanges:function(){return this.onLoadData().then(function(data){return data.sshKexes;});},onLoadKeys:function(){return this.onLoadData().then(function(data){return data.sshHostKeys;});},onLoadCiphers:function(){return this.onLoadData().then(function(data){return data.sshCiphers;});},onLoadMacs:function(){return this.onLoadData().then(function(data){return data.sshMacs;});},onLoadCompressions:function(){return this.onLoadData().then(function(data){return data.sshCompressions;});},onSubmit:function(dialog){var algorithms=this._createAlgorithms(dialog);dialog.destroy();this.deferred.resolve(algorithms);this.deferred=null;},onCancel:function(dialog){dialog.destroy();this.deferred.reject();this.deferred=null;},_createAlgorithms:function(dialog){return{kexes:dialog.getKeyExchanges(),keys:dialog.getKeys(),ciphers:dialog.getCiphers(),macs:dialog.getMacs(),compressions:dialog.getCompressions()};},_setupDialog:function(algorithms){var dialog=new jscape.settings.SftpAlgorithmsDialog();dialog.setKeyExchanges(algorithms.kexes);dialog.setKeys(algorithms.keys);dialog.setCiphers(algorithms.ciphers);dialog.setMacs(algorithms.macs);dialog.setCompressions(algorithms.compressions);return dialog;}});jscape.settings.SftpAlgorithmsDialog=jscape.ui.DefaultDialog.extend({initialize:function(){this._super($("#d-services-sftp-algorithms"),{width:"60%",minWidth:770,maxWidth:870,height:"60%",maxHeight:"80%"});this.fieldset=this.dialog.find(".content").layout({fit:true,doSize:false,border:false}).first();this.tabs=this.dialog.find(".content-tabs").tabs({fit:true,tabPosition:"top",justified:true,pill:true,narrow:false,plain:true,border:true});this.kexes=new jscape.settings.SftpAlgorithmPane($("input[name=searchkexes]",this.dialog),$("div[role=listbox][aria-label=kexes]",this.dialog));this.keys=new jscape.settings.SftpAlgorithmPane($("input[name=searchkeys]",this.dialog),$("div[role=listbox][aria-label=keys]",this.dialog));this.ciphers=new jscape.settings.SftpAlgorithmPane($("input[name=searchciphers]",this.dialog),$("div[role=listbox][aria-label=ciphers]",this.dialog));this.macs=new jscape.settings.SftpAlgorithmPane($("input[name=searchmacs]",this.dialog),$("div[role=listbox][aria-label=macs]",this.dialog));this.compressions=new jscape.settings.SftpAlgorithmPane($("input[name=searchcompressions]",this.dialog),$("div[role=listbox][aria-label=compressions]",this.dialog));this.fieldset.layout("panel","center").panel("resize");},show:function(listener){this._super(listener);this.kexes.show({onLoadData:$.proxy(listener.onLoadKeyExchanges,listener)});this.keys.show({onLoadData:$.proxy(listener.onLoadKeys,listener)});this.ciphers.show({onLoadData:$.proxy(listener.onLoadCiphers,listener)});this.macs.show({onLoadData:$.proxy(listener.onLoadMacs,listener)});this.compressions.show({onLoadData:$.proxy(listener.onLoadCompressions,listener)});this.fieldset.layout("resize");},getKeyExchanges:function(){return this.kexes.getValues();},setKeyExchanges:function(values){this.kexes.setValues(values);},getKeys:function(){return this.keys.getValues();},setKeys:function(values){this.keys.setValues(values);},getCiphers:function(){return this.ciphers.getValues();},setCiphers:function(values){this.ciphers.setValues(values);},getMacs:function(){return this.macs.getValues();},setMacs:function(values){this.macs.setValues(values);},getCompressions:function(){return this.compressions.getValues();},setCompressions:function(values){this.compressions.setValues(values);}});jscape.settings.SftpAlgorithmsDialog.LISTENER={onLoadKeyExchanges:$.noop,onLoadKeys:$.noop,onLoadCiphers:$.noop,onLoadMacs:$.noop,onLoadCompressions:$.noop};jscape.settings.SftpAlgorithmPane=jscape.ui.FormView.extend({timer:null,initialize:function(searchInput,datalist){var initializing=true;this.search=$(searchInput).textbox({required:false,icons:[{iconCls:"icon-clear",handler:$.proxy(this._onClear$SearchInput,this)}],inputEvents:$.extend({},$.fn.textbox.defaults.inputEvents,{keyup:$.proxy(this._onKeyUp$SearchInput,this),keydown:$.proxy(this._onKeyDown$SearchInput,this)}),width:"100%"});this.data=$(datalist);this.data.datalist({fit:true,remoteSort:false,singleSelect:false,checkbox:true,selectOnCheck:true,checkOnSelect:true,textFormatter:function(val,row){return String(row||"").escapeXml();},loadFilter:$.proxy(this._onFilter$Data,this),loader:$.proxy(this._onLoad$Data,this),onBeforeLoad:function(){return!initializing;},onLoadSuccess:$.proxy(this._onLoad$Success,this),onSelect:$.proxy(this._onSelect$Row,this),onSelectAll:$.proxy(this._onSelect$All,this),onUnselect:$.proxy(this._onUnselect$Row,this),onUnselectAll:$.proxy(this._onUnselect$All,this),onRowContextMenu:$.proxy(this._onRow$ContextMenu,this)});initializing=false;},show:function(listener){this.listener=listener||jscape.settings.SftpAlgorithmPane.LISTENER;this.data.datalist("reload");this.search.textbox("textbox").triggerHandler("keyup",{target:this.search});},getValues:function(){return this.values||[];},setValues:function(value){this.data.datalist("clearSelections");for(var i=0,len=value?value.length:0;i<len;++i){var val=value[i];var index=this.data.datalist("getRowIndex",val);if(index!=-1){this.data.datalist("selectRow",index);}else{this._onSelect$Row(-1,val);}}},_onSelect$Row:function(_,row){var index=$.inArray(row,this.values);if(index==-1){this.values.push(row);}},_onSelect$All:function(rows){this.values=rows||[];},_onUnselect$Row:function(_,row){var index=$.inArray(row,this.values);if(index!=-1){this.values.splice(index,1);}},_onUnselect$All:function(){this.values=[];},_onClick$InvertSelection:function(){var copy=[].concat(this.values);for(var i=0,rows=this.data.datagrid("getRows");i<rows.length;++i){if($.inArray(rows[i],copy)>=0){this.data.datagrid("unselectRow",i);}else{this.data.datagrid("selectRow",i);}}},_onLoad$Data:function(params,success,error){return this.listener.onLoadData(params).done($.proxy(function(data){if(!data||!data.length){this.search.textbox("disable");}},this)).done(success).fail(error);},_onLoad$Success:function(){for(var i=0,rows=this.data.datalist("getRows");i<this.values.length;++i){var index=$.inArray(this.values[i],rows);this.data.datalist("selectRow",index);}},_onFilter$Data:function(data){var params=this.data.datalist("options").queryParams||{};var text=(params.query||"").toLocaleLowerCase();return!!text?$.grep(data,function(t){return t.toLocaleLowerCase().indexOf(text)>=0?t:null;}):data;},_onSearch$Data:function(query){this.data.datalist("options").queryParams={query:query};this.data.datalist("loading").datalist("loadData",this.data.datalist("getData")).datalist("loaded");},_onKeyDown$SearchInput:function(e){if(e.keyCode==13){$.fn.textbox.defaults.inputEvents.keydown.call(e.target,e);return false;}if(e.keyCode==27){e.preventDefault();$(e.data.target).textbox("getIcon",0).click();return false;}},_onKeyUp$SearchInput:function(e){var t=$(e.data.target);var icon=t.textbox("getIcon",0);var val=t.textbox("getText");icon.css("visibility",!!val?"visible":"hidden");clearTimeout(this.timer);this.timer=setTimeout($.proxy(this._onSearch$Data,this,val),200);},_onClear$SearchInput:function(e){var t=$(e.data.target);t.textbox("clear").textbox("textbox").focus();t.textbox("getIcon",0).css("visibility","hidden");clearTimeout(this.timer);this._onSearch$Data(null);},_onRow$ContextMenu:function(e){e.preventDefault();var grid=(this.data||$(e.target).closest("div.datagrid-view").children(".datagrid-f"));if(grid&&grid.length){grid.datagrid("cancelEdit");this._showContextMenu(e,[],$(e.target).closest(".datagrid-body"));}},_showContextMenu:function(e,entries,parent){var emptyData=this.data.datagrid("getRows").length==0;this._super(e,[{text:"Select all",handler:$.proxy(function(){this.data.datagrid("selectAll");},this),disabled:emptyData},{text:"Select none",handler:$.proxy(function(){this.data.datagrid("unselectAll");},this),disabled:emptyData},{text:"Invert selection",handler:$.proxy(this._onClick$InvertSelection,this),disabled:emptyData}],parent);}});jscape.settings.SftpAlgorithmPane.LISTENER={onLoadData:$.noop};jscape.settings.FtpConfigurationController=Class.extend({DEFAULT_CONFIG:jscape.ServiceConfiguration.ftp(300000,60000),view:null,config:null,copy:null,sslCiphers:null,initialize:function(){this.ciphersController=new jscape.settings.GlobalServicesCiphersController();},start:function(){if(this.view==null){this.view=new jscape.settings.FtpConfigurationView();}
this.view.show(this);},resume:function(){this.view.refresh();},hasChanged:function(){return this.config&&!Object._equals(this.copy,this._createConfiguration());},onLoadData:function(){return jscape.API.getGlobalServiceConfiguration(jscape.TransportService.Protocol.FTP).then(function(config){return config;},function(){return null;}).then($.proxy(function(config){this.config=config||this.DEFAULT_CONFIG.clone();this.copy=this.config.clone();this.sslCiphers=this.config.cipherSuites||null;this._setupView(this.config);},this));},onApply:function(){var config=this._createConfiguration();return jscape.API.setGlobalServiceConfiguration(jscape.TransportService.Protocol.FTP,config).done($.proxy(function(){this.config=config;this.copy=config.clone();this._setupView(this.config);},this)).done($.proxy(this._fireApplySuccess,this));},onDiscard:function(){this.config=this.copy;this.copy=this.config.clone();this.sslCiphers=this.config&&this.config.cipherSuites||null;this._setupView(this.config);},onSslCiphers:function(){this.ciphersController.start(this.sslCiphers).done($.proxy(function(ciphers){this.sslCiphers=ciphers;},this));},_createConfiguration:function(){return jscape.ServiceConfiguration.ftp(this.view.getTimeout(),this.view.getDataTimeout(),this.view.getBanner(),this.view.getPassiveIp(),this.view.getPassivePortRange(),this.view.getBacklog(),this.view.getSendBufferSize(),this.view.getReceiveBufferSize(),this.view.getDefaultTransferMode(),this.view.getDataConnectionMode(),this.sslCiphers,this.view.isShutdownCommandSsl(),this.view.isShutdownDataSsl(),this.view.isCommandRequireClientCertificate(),this.view.isDataRequireClientCertificate(),this.view.isForceDataEncryption(),this.view.isBlockPasvAttack(),this.view.isBlockBounceAttack(),this.view.getTcpNoDelay(),this.view.getNetworkCharset(),this.view.getFileCharset());},_setupView:function(config){if(config&&this.view){this.view.setTimeout(config.timeout);this.view.setDataTimeout(config.dataTimeout);this.view.setBanner(config.welcomeMessage);this.view.setPassiveIp(config.passiveIp);this.view.setPassivePortRange(config.portRange);this.view.setBacklog(config.backlog);this.view.setSendBufferSize(config.sendBufferSize);this.view.setReceiveBufferSize(config.receiveBufferSize);this.view.setDefaultTransferMode(config.defaultTransferMode);this.view.setDataConnectionMode(config.dataConnectionMode);this.view.setShutdownCommandSsl(config.shutdownSsl);this.view.setShutdownDataSsl(config.shutdownDataSsl);this.view.setCommandRequireClientCertificate(config.commandRequireClientCertificate);this.view.setDataRequireClientCertificate(config.dataRequireClientCertificate);this.view.setForceDataEncryption(config.forceDataEncryption);this.view.setBlockPasvAttack(config.blockPasvAttack);this.view.setBlockBounceAttack(config.blockBounceAttack);this.view.setTcpNoDelay(config.tcpNoDelayEnabled);this.view.setNetworkCharset(config.networkCharset);this.view.setFileCharset(config.fileCharset);}},_fireApplySuccess:function(){$(document).triggerHandler("broadcast",[window.R.string.APPLICATION_SUCCESS_APPLY]);}});jscape.settings.FtpConfigurationView=Class.extend({TIMEOUT_FACTOR:60*1000,BUFFER_FACTOR:1024,DEFAULT_CHARSET:"UTF-8",initialize:function(){this.fieldset=$("#service-ftp-config-fields").layout({fit:true,doSize:false,border:false});this.banner=$("textarea[name=banner]",this.fieldset).textbox({multiline:true,width:"70%",height:90});this.timeout=$("input[name=cmdtimeout]",this.fieldset).numberspinner({required:true,min:0,max:999,value:5,width:80});this.dataTimeout=$("input[name=datatimeout]",this.fieldset).numberspinner({required:true,min:0,max:999,value:1,width:80});this.passiveIp=$("input[name=passiveip]",this.fieldset).textbox({required:false,validType:"length[1,255]",invalidMessage:window.R.string.GLOBAL_SERVICES_ERROR_BAD_PASSIVE_IP,width:"70%"});this.usePortRange=$("input[name=passiveportrange]:checkbox",this.fieldset);this.usePortRange.change($.proxy(function(){var enabled=this.usePortRange.is(":checked");$.each([this.portRangeStart,this.portRangeEnd],function(_,input){input.numberspinner(enabled?"enable":"disable");});},this));this.portRangeStart=$("input[name=passiveportpstart]",this.fieldset).numberspinner({required:true,min:1,max:65535,value:10000,width:80,onChange:$.proxy(this._adjustPortRange,this)});this.portRangeEnd=$("input[name=passiveportpend]",this.fieldset).numberspinner({required:true,min:1,max:65535,value:20000,width:80,onChange:$.proxy(this._adjustPortRange,this)});this.backlog=$("input[name=backlog]",this.fieldset).numberspinner({required:true,min:1,max:999,value:5,width:80});this.useSendBuffer=$("input[name=usesendbuffer]:checkbox",this.fieldset);this.useSendBuffer.change($.proxy(function(){var enabled=this.useSendBuffer.is(":checked");this.sendBufferSize.numberspinner(enabled?"enable":"disable");},this));this.sendBufferSize=$("input[name=sendbuffer]",this.fieldset).numberspinner({required:true,min:64,max:1024,increment:64,value:64,width:80});this.useReceiveBuffer=$("input[name=usereceivebuffer]:checkbox",this.fieldset);this.useReceiveBuffer.change($.proxy(function(){var enabled=this.useReceiveBuffer.is(":checked");this.receiveBufferSize.numberspinner(enabled?"enable":"disable");},this));this.receiveBufferSize=$("input[name=receivebuffer]",this.fieldset).numberspinner({required:true,min:64,max:1024,increment:64,value:64,width:80});this.defaultTransferMode=$("input[name=transfermode]:radio",this.fieldset);this.dataConnectionMode=$("input[name=dataconnectionmode]:radio",this.fieldset);this.forceDataEncryption=$("input[name=forcedataencryption]:checkbox",this.fieldset);this.commandRequireClientCertificate=$("input[name=cmdrequireclientcrt]:checkbox",this.fieldset);this.dataRequireClientCertificate=$("input[name=datarequireclientcrt]:checkbox",this.fieldset);this.shutdownCommandSsl=$("input[name=shutdowncmdssl]:checkbox",this.fieldset);this.shutdownDataSsl=$("input[name=shutdowndatassl]:checkbox",this.fieldset);this.blockBounceAttack=$("input[name=blockbounce]:checkbox",this.fieldset);this.blockPasvAttack=$("input[name=blockpasv]:checkbox",this.fieldset);this.tcpNoDelay=$("input[name=tcpnodelay]:checkbox",this.fieldset);this.networkCharset=$("select[name=networkcharset]",this.fieldset).combobox({required:true,editable:false,width:140});this.fileCharset=$("select[name=filecharset]",this.fieldset).combobox({required:true,editable:false,width:140});this.threatAsciiAsImage=$("input[name=asciiasimage]:checkbox",this.fieldset);this.threatAsciiAsImage.change($.proxy(function(){var enabled=!this.threatAsciiAsImage.is(":checked");this.fileCharset.combobox(enabled?"enable":"disable");},this));this.ciphersButton=$("a[role=button][name=sslciphers]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$CiphersButton,this)});this.applyButton=$("a[role=button][name=apply]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$ApplyButton,this)});this.discardButton=$("a[role=button][name=discard]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$DiscardButton,this)});this.fieldset.layout("panel","south").panel("resize",{height:"auto"});},show:function(listener){this.listener=listener||jscape.settings.FtpConfigurationView.LISTENER;this.fieldset.layout("resize");this._adjustPortRange();},refresh:function(){this.listener.onLoadData().then($.proxy(function(){this.fieldset.form("validate");},this));},getBanner:function(){return this.banner.textbox("getValue").trim();},setBanner:function(value){this.banner.textbox("setValue",value);},getTimeout:function(){return parseInt(this.timeout.numberspinner("getValue"))*this.TIMEOUT_FACTOR;},setTimeout:function(value){this.timeout.numberspinner("setValue",parseInt(value)/this.TIMEOUT_FACTOR);},getDataTimeout:function(){return parseInt(this.dataTimeout.numberspinner("getValue"))*this.TIMEOUT_FACTOR;},setDataTimeout:function(value){this.dataTimeout.numberspinner("setValue",parseInt(value)/this.TIMEOUT_FACTOR);},getPassiveIp:function(){return this.passiveIp.textbox("getValue").trim();},setPassiveIp:function(value){this.passiveIp.textbox("setValue",value);},getPassivePortRange:function(){return this.usePortRange.is(":checked")?{lowerBound:parseInt(this.portRangeStart.numberspinner("getValue")),upperBound:parseInt(this.portRangeEnd.numberspinner("getValue"))}:null;},setPassivePortRange:function(value){if(value&&value.lowerBound&&value.upperBound){this.usePortRange.prop("checked",true).change();this.portRangeEnd.numberspinner("setValue",parseInt(value.upperBound));this.portRangeStart.numberspinner("setValue",parseInt(value.lowerBound));}else{this.usePortRange.prop("checked",false).change();}},getBacklog:function(){return parseInt(this.backlog.numberspinner("getValue"));},setBacklog:function(value){this.backlog.numberspinner("setValue",parseInt(value));},getSendBufferSize:function(){return this.useSendBuffer.is(":checked")?parseInt(this.sendBufferSize.numberspinner("getValue"))*this.BUFFER_FACTOR:null;},setSendBufferSize:function(value){this.useSendBuffer.prop("checked",value!=null).change();if(value!=null){this.sendBufferSize.numberspinner("setValue",parseInt(value)/this.BUFFER_FACTOR);}},getReceiveBufferSize:function(){return this.useReceiveBuffer.is(":checked")?parseInt(this.receiveBufferSize.numberspinner("getValue"))*this.BUFFER_FACTOR:null;},setReceiveBufferSize:function(value){this.useReceiveBuffer.prop("checked",value!=null).change();if(value!=null){this.receiveBufferSize.numberspinner("setValue",parseInt(value)/this.BUFFER_FACTOR);}},getDefaultTransferMode:function(){return this.defaultTransferMode.filter(":checked").val();},setDefaultTransferMode:function(value){this.defaultTransferMode.filter("[value="+value+"]").prop("checked",true);},getDataConnectionMode:function(){return this.dataConnectionMode.filter(":checked").val();},setDataConnectionMode:function(value){this.dataConnectionMode.filter("[value="+value+"]").prop("checked",true);},isForceDataEncryption:function(){return this.forceDataEncryption.is(":checked");},setForceDataEncryption:function(value){this.forceDataEncryption.prop("checked",!!value);},isCommandRequireClientCertificate:function(){return this.commandRequireClientCertificate.is(":checked");},setCommandRequireClientCertificate:function(value){this.commandRequireClientCertificate.prop("checked",!!value);},isDataRequireClientCertificate:function(){return this.dataRequireClientCertificate.is(":checked");},setDataRequireClientCertificate:function(value){this.dataRequireClientCertificate.prop("checked",!!value);},isShutdownCommandSsl:function(){return this.shutdownCommandSsl.is(":checked");},setShutdownCommandSsl:function(value){this.shutdownCommandSsl.prop("checked",!!value);},isShutdownDataSsl:function(){return this.shutdownDataSsl.is(":checked");},setShutdownDataSsl:function(value){this.shutdownDataSsl.prop("checked",!!value);},isBlockBounceAttack:function(){return this.blockBounceAttack.is(":checked");},setBlockBounceAttack:function(value){this.blockBounceAttack.prop("checked",!!value);},isBlockPasvAttack:function(){return this.blockPasvAttack.is(":checked");},setBlockPasvAttack:function(value){this.blockPasvAttack.prop("checked",!!value).change();},getTcpNoDelay:function(){return this.tcpNoDelay.is(":checked");},setTcpNoDelay:function(value){this.tcpNoDelay.prop("checked",!!value);},getNetworkCharset:function(){return this.networkCharset.combobox("getValue");},setNetworkCharset:function(value){this.networkCharset.combobox("setValue",value||this.DEFAULT_CHARSET);},getFileCharset:function(){return this.threatAsciiAsImage.is(":checked")?null:this.fileCharset.combobox("getValue");},setFileCharset:function(value){this.threatAsciiAsImage.prop("checked",value==null).change();this.fileCharset.combobox("setValue",value!=null?value:this.DEFAULT_CHARSET);},_onClick$CiphersButton:function(){this.listener.onSslCiphers();},_onClick$ApplyButton:function(){if(this.fieldset.form("validate")){this.applyButton.linkbutton("disable");this.listener.onApply(this).always($.proxy(function(){this.applyButton.linkbutton("enable");},this));}},_onClick$DiscardButton:function(){this.listener.onDiscard();},_adjustPortRange:function(){var range=this.getPassivePortRange();if(range!=null){function _validate(spinner,validType,validParams){$(spinner).numberspinner("textbox").validatebox({validType:validType,validParams:validParams});return spinner.numberspinner("isValid");}
_validate(this.portRangeStart,"in_range",[this.portRangeStart.numberspinner("options").min,range.upperBound]);_validate(this.portRangeEnd,"in_range",[range.lowerBound,this.portRangeEnd.numberspinner("options").max]);}}});jscape.settings.FtpConfigurationView.LISTENER={onSslCiphers:$.noop,onApply:$.noop,onDiscard:$.noop};jscape.settings.SftpConfigurationController=Class.extend({DEFAULT_CONFIG:jscape.ServiceConfiguration.sftp(300000,"MFT"),view:null,config:null,copy:null,algorithms:null,initialize:function(){this.algorithms={};this.algorithmsController=new jscape.settings.SftpAlgorithmsController();this._initValidators();},start:function(){if(this.view==null){this.view=new jscape.settings.SftpConfigurationView();}
this.view.show(this);},resume:function(){this.view.refresh();},hasChanged:function(){return this.config&&!Object._equals(this.copy,this._createConfiguration());},onLoadData:function(){return jscape.API.getGlobalServiceConfiguration(jscape.TransportService.Protocol.SFTP).then(function(config){return config;},function(){return null;}).then($.proxy(function(config){this.config=config||this.DEFAULT_CONFIG.clone();this.copy=this.config.clone();this._initAlgorithms();this._setupView(this.config);},this));},onApply:function(){var config=this._createConfiguration();return jscape.API.setGlobalServiceConfiguration(jscape.TransportService.Protocol.SFTP,config).done($.proxy(function(){this.config=config;this.copy=config.clone();this._initAlgorithms();this._setupView(this.config);},this)).done($.proxy(this._fireApplySuccess,this));},onDiscard:function(){this.config=this.copy;this.copy=this.config.clone();this._initAlgorithms();this._setupView(this.config);},onSftpAlgorithms:function(){this.algorithmsController.start(this.algorithms).done($.proxy(function(algorithms){this.algorithms=algorithms;},this));},_initAlgorithms:function(){this.algorithms=this.config?{kexes:this.config.supportedKexes,keys:this.config.supportedKeys,ciphers:this.config.supportedCiphers,macs:this.config.supportedMacs,compressions:this.config.supportedCompressions}:{};},_createConfiguration:function(){return jscape.ServiceConfiguration.sftp(this.view.getTimeout(),this.view.getVersion(),this.view.getStartupBanner(),this.view.getAuthenticationBanner(),this.view.getSendBufferSize(),this.view.getReceiveBufferSize(),this.view.getBacklog(),this.view.getTcpNoDelay(),this.view.isDisableExpandedLongName(),this.algorithms.kexes,this.algorithms.keys,this.algorithms.ciphers,this.algorithms.macs,this.algorithms.compressions);},_setupView:function(config){if(config&&this.view){this.view.setTimeout(config.timeout);this.view.setVersion(config.softwareVersion);this.view.setStartupBanner(config.startupBanner);this.view.setAuthenticationBanner(config.authBanner);this.view.setSendBufferSize(config.sendBufferSize);this.view.setReceiveBufferSize(config.receiveBufferSize);this.view.setBacklog(config.backlog);this.view.setTcpNoDelay(config.tcpNoDelayEnabled);this.view.setDisableExpandedLongName(config.disableRealPathExpandedLongName);}},_fireApplySuccess:function(){$(document).triggerHandler("broadcast",[window.R.string.APPLICATION_SUCCESS_APPLY]);},_initValidators:function(){var v=new jscape.Validator();v.rule("sftp_software_version",function(val){return/^[^\s]+$/gi.test(val);},window.R.string.GLOBAL_SERVICES_ERROR_BAD_SFTP_VERSION);}});jscape.settings.SftpConfigurationView=Class.extend({TIMEOUT_FACTOR:60*1000,BUFFER_FACTOR:1024,initialize:function(){this.fieldset=$("#service-sftp-config-fields").layout({fit:true,doSize:false,border:false});this.version=$("input[name=version]",this.fieldset).textbox({validType:"sftp_software_version",width:"70%"});this.startupBanner=$("textarea[name=startupbanner]",this.fieldset).textbox({multiline:true,width:"70%",height:90});this.authBanner=$("textarea[name=authbanner]",this.fieldset).textbox({multiline:true,width:"70%",height:90});this.timeout=$("input[name=timeout]",this.fieldset).numberspinner({required:true,min:0,max:999,value:5,width:80});this.useSendBuffer=$("input[name=usesendbuffer]:checkbox",this.fieldset);this.useSendBuffer.change($.proxy(function(){var enabled=this.useSendBuffer.is(":checked");this.sendBufferSize.numberspinner(enabled?"enable":"disable").numberspinner(enabled?"enableValidation":"disableValidation");},this));this.sendBufferSize=$("input[name=sendbuffer]",this.fieldset).numberspinner({required:true,min:64,max:1024,increment:64,value:64,width:80});this.useReceiveBuffer=$("input[name=usereceivebuffer]:checkbox",this.fieldset);this.useReceiveBuffer.change($.proxy(function(){var enabled=this.useReceiveBuffer.is(":checked");this.receiveBufferSize.numberspinner(enabled?"enable":"disable").numberspinner(enabled?"enableValidation":"disableValidation");},this));this.receiveBufferSize=$("input[name=receivebuffer]",this.fieldset).numberspinner({required:true,min:64,max:1024,increment:64,value:64,width:80});this.backlog=$("input[name=backlog]",this.fieldset).numberspinner({required:true,min:1,max:999,value:5,width:80});this.tcpNoDelay=$("input[name=tcpnodelay]:checkbox",this.fieldset);this.disableLongName=$("input[name=disablelongname]:checkbox",this.fieldset);this.algorithmsButton=$("a[role=button][name=algorithms]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$AlgorithmsButton,this)});this.applyButton=$("a[role=button][name=apply]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$ApplyButton,this)});this.discardButton=$("a[role=button][name=discard]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$DiscardButton,this)});this.fieldset.layout("panel","south").panel("resize",{height:"auto"});},show:function(listener){this.listener=listener||jscape.settings.SftpConfigurationView.LISTENER;this.fieldset.layout("resize");},refresh:function(){this.listener.onLoadData().then($.proxy(function(){this.fieldset.form("validate");},this));},getTimeout:function(){return parseInt(this.timeout.numberspinner("getValue"))*this.TIMEOUT_FACTOR;},setTimeout:function(value){this.timeout.numberspinner("setValue",parseInt(value)/this.TIMEOUT_FACTOR);},getVersion:function(){return this.version.textbox("getValue").trim();},setVersion:function(value){this.version.textbox("setValue",value);},getStartupBanner:function(){return this.startupBanner.textbox("getValue");},setStartupBanner:function(value){this.startupBanner.textbox("setValue",value);},getAuthenticationBanner:function(){return this.authBanner.textbox("getValue");},setAuthenticationBanner:function(value){this.authBanner.textbox("setValue",value);},getSendBufferSize:function(){return this.useSendBuffer.is(":checked")?parseInt(this.sendBufferSize.numberspinner("getValue"))*this.BUFFER_FACTOR:null;},setSendBufferSize:function(value){this.useSendBuffer.prop("checked",value!=null).change();if(value!=null){this.sendBufferSize.numberspinner("setValue",parseInt(value)/this.BUFFER_FACTOR);}},getReceiveBufferSize:function(){return this.useReceiveBuffer.is(":checked")?parseInt(this.receiveBufferSize.numberspinner("getValue"))*this.BUFFER_FACTOR:null;},setReceiveBufferSize:function(value){this.useReceiveBuffer.prop("checked",value!=null).change();if(value!=null){this.receiveBufferSize.numberspinner("setValue",parseInt(value)/this.BUFFER_FACTOR);}},getBacklog:function(){return parseInt(this.backlog.numberspinner("getValue"));},setBacklog:function(value){this.backlog.numberspinner("setValue",parseInt(value));},getTcpNoDelay:function(){return this.tcpNoDelay.is(":checked");},setTcpNoDelay:function(value){this.tcpNoDelay.prop("checked",!!value);},isDisableExpandedLongName:function(){return this.disableLongName.is(":checked");},setDisableExpandedLongName:function(value){this.disableLongName.prop("checked",!!value).change();},_onClick$AlgorithmsButton:function(){this.listener.onSftpAlgorithms();},_onClick$ApplyButton:function(){if(this.fieldset.form("validate")){this.applyButton.linkbutton("disable");this.listener.onApply(this).always($.proxy(function(){this.applyButton.linkbutton("enable");},this));}},_onClick$DiscardButton:function(){this.listener.onDiscard();}});jscape.settings.SftpConfigurationView.LISTENER={onLoadData:$.noop,onSftpAlgorithms:$.noop,onApply:$.noop,onDiscard:$.noop};jscape.settings.AftpConfigurationController=Class.extend({DEFAULT_CONFIG:jscape.ServiceConfiguration.aftp(300000,60000,5,true,10),view:null,config:null,copy:null,sslCiphers:null,initialize:function(){this.ciphersController=new jscape.settings.GlobalServicesCiphersController();},start:function(){if(this.view==null){this.view=new jscape.settings.AftpConfigurationView();}
this.view.show(this);},resume:function(){this.view.refresh();},hasChanged:function(){return this.config&&!Object._equals(this.copy,this._createConfiguration());},onLoadData:function(){return jscape.API.getGlobalServiceConfiguration(jscape.TransportService.Protocol.AFTP).then(function(config){return config;},function(){return null;}).then($.proxy(function(config){this.config=config||this.DEFAULT_CONFIG.clone();this.copy=this.config.clone();this.sslCiphers=this.config.cipherSuites||null;this._setupView(this.config);},this));},onApply:function(){var config=this._createConfiguration();return jscape.API.setGlobalServiceConfiguration(jscape.TransportService.Protocol.AFTP,config).done($.proxy(function(){this.config=config;this.copy=config.clone();this._setupView(this.config);},this)).done($.proxy(this._fireApplySuccess,this));},onDiscard:function(){this.config=this.copy;this.copy=this.config.clone();this.sslCiphers=this.config&&this.config.cipherSuites||null;this._setupView(this.config);},onSslCiphers:function(){this.ciphersController.start(this.sslCiphers).done($.proxy(function(ciphers){this.sslCiphers=ciphers;},this));},_createConfiguration:function(){return jscape.ServiceConfiguration.aftp(this.view.getTimeout(),this.view.getDataTimeout(),this.view.getBacklog(),this.view.getTcpNoDelay(),this.view.getMaxLossListSize(),this.sslCiphers);},_setupView:function(config){if(config&&this.view){this.view.setTimeout(config.timeout);this.view.setDataTimeout(config.dataTimeout);this.view.setBacklog(config.backlog);this.view.setTcpNoDelay(config.tcpNoDelayEnabled);this.view.setMaxLossListSize(config.maxLossListSize);}},_fireApplySuccess:function(){$(document).triggerHandler("broadcast",[window.R.string.APPLICATION_SUCCESS_APPLY]);}});jscape.settings.AftpConfigurationView=Class.extend({TIMEOUT_FACTOR:60*1000,initialize:function(){this.fieldset=$("#service-aftp-config-fields").layout({fit:true,doSize:false,border:false});this.timeout=$("input[name=cmdtimeout]",this.fieldset).numberspinner({required:true,min:0,max:999,value:5,width:80});this.dataTimeout=$("input[name=datatimeout]",this.fieldset).numberspinner({required:true,min:0,max:999,value:5,width:80});this.backlog=$("input[name=backlog]",this.fieldset).numberspinner({required:true,min:1,max:999,value:5,width:80});this.tcpNoDelay=$("input[name=tcpnodelay]:checkbox",this.fieldset);this.lossListSize=$("input[name=losslistsize]",this.fieldset).numberspinner({required:true,min:1,max:99,value:10,width:60});this.ciphersButton=$("a[role=button][name=sslciphers]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$CiphersButton,this)});this.applyButton=$("a[role=button][name=apply]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$ApplyButton,this)});this.discardButton=$("a[role=button][name=discard]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$DiscardButton,this)});this.fieldset.layout("panel","south").panel("resize",{height:"auto"});},show:function(listener){this.listener=listener||jscape.settings.AftpConfigurationView.LISTENER;this.fieldset.layout("resize");},refresh:function(){this.listener.onLoadData().done($.proxy(function(){this.fieldset.form("validate");},this));},getTimeout:function(){return parseInt(this.timeout.numberspinner("getValue"))*this.TIMEOUT_FACTOR;},setTimeout:function(value){this.timeout.numberspinner("setValue",parseInt(value)/this.TIMEOUT_FACTOR);},getDataTimeout:function(){return parseInt(this.dataTimeout.numberspinner("getValue"))*this.TIMEOUT_FACTOR;},setDataTimeout:function(value){this.dataTimeout.numberspinner("setValue",parseInt(value)/this.TIMEOUT_FACTOR);},getBacklog:function(){return parseInt(this.backlog.numberspinner("getValue"));},setBacklog:function(value){this.backlog.numberspinner("setValue",parseInt(value));},getTcpNoDelay:function(){return this.tcpNoDelay.is(":checked");},setTcpNoDelay:function(value){this.tcpNoDelay.prop("checked",!!value);},getMaxLossListSize:function(){return parseInt(this.lossListSize.numberspinner("getValue"));},setMaxLossListSize:function(value){this.lossListSize.numberspinner("setValue",parseInt(value));},_onClick$CiphersButton:function(){this.listener.onSslCiphers();},_onClick$ApplyButton:function(){if(this.fieldset.form("validate")){this.applyButton.linkbutton("disable");this.listener.onApply(this).always($.proxy(function(){this.applyButton.linkbutton("enable");},this));}},_onClick$DiscardButton:function(){this.listener.onDiscard();}});jscape.settings.AftpConfigurationView.LISTENER={onLoadData:$.noop,onSslCiphers:$.noop,onApply:$.noop,onDiscard:$.noop};jscape.settings.GlobalServicesCiphersController=Class.extend({deferred:null,cache:null,start:function(ciphers){this.deferred=$.Deferred();var dialog=this._setupDialog().show(this);dialog.refresh($.proxy(function(){dialog.selectRecords(ciphers);},this));return this.deferred.promise();},onLoadData:function(){if(this.cache&&this.cache.length){return $.Deferred().resolve(this.cache).promise();}
return jscape.API.getServerParameters().then(function(params){return params.sslCiphers;},function(){return[];}).then($.proxy(function(data){this.cache=data||[];return data;},this));},onSelectMedium:function(dialog){dialog.selectRecords(jscape.ServerParameters.mediumCiphers());},onSelectStrong:function(dialog){dialog.selectRecords(jscape.ServerParameters.strongCiphers());},onSubmit:function(dialog){var values=dialog.getCiphers();dialog.destroy();this.deferred.resolve(values);this.deferred=null;},onCancel:function(dialog){dialog.destroy();this.deferred.reject();this.deferred=null;},_setupDialog:function(){return new jscape.settings.GlobalServicesCiphersDialog();}});jscape.settings.GlobalServicesCiphersDialog=jscape.ui.DefaultDialog.extend({initialize:function(){var initializing=true;this._super($("#d-settings-services-ciphers"),{minWidth:630,width:"50%",maxWidth:"70%",height:"70%"});this.fieldset=this.dialog.find(".content").first().layout({fit:true,doSize:false,border:false});this.data=$("table[role=grid][aria-label=sslciphers]",this.fieldset);this.data.datagrid({fit:true,fitColumns:true,showHeader:false,remoteSort:false,singleSelect:false,selectOnCheck:true,checkOnSelect:true,toolbar:"#{id} div.viewpane-toolbar".supplant({id:this.getId()}),loader:$.proxy(this._onLoad$Data,this),onBeforeLoad:function(){return!initializing;},onLoadSuccess:$.proxy(this._adjustButtonsState,this),idField:"value",columns:[[{field:"value",checkbox:true},{field:"text",sortable:true}]]});this.data.filter(".datagrid-body td").css("border","transparent");this.selectAllButton=$("a[role=button][name=all]",this.fieldset).linkbutton({toggle:true,onClick:$.proxy(this._onClick$SelectAllButton,this)});this.selectMediumButton=$("a[role=button][name=medium]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$SelectMediumButton,this)});this.selectStrongButton=$("a[role=button][name=strong]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$SelectStrongButton,this)});this.fieldset.layout("panel","center").panel("resize");initializing=false;},show:function(listener){this._super(listener||jscape.settings.GlobalServicesCiphersDialog.LISTENER);this.fieldset.layout("resize");return this;},refresh:function(callback){this.data.datagrid("reload",callback);},getCiphers:function(){return $.map(this.data.datagrid("getChecked"),function(row){return row.value;});},selectRecords:function(values){if(values&&values.length){this.data.datagrid("unselectAll");for(var i=0;i<values.length;i++){this.data.datagrid("selectRecord",values[i]);}}else{this.data.datagrid("clearChecked");}},_onLoad$Data:function(params,success,error){this.listener.onLoadData(params).then(function(data){return $.map(data,function(val){return{text:val,value:val};})}).then(success,error);},_onClick$SelectAllButton:function(){var text=this.selectAllButton.text();this.selectAllButton.html(this.selectAllButton.html().replace(text,this.selectAllButton.data("toggle-text")));this.selectAllButton.data("toggle-text",text);if(this.selectAllButton.linkbutton("options").selected){this.data.datagrid("selectAll");}else{this.data.datagrid("unselectAll");}},_onClick$SelectMediumButton:function(){this.listener.onSelectMedium(this);},_onClick$SelectStrongButton:function(){this.listener.onSelectStrong(this);},_adjustButtonsState:function(){var enabled=this.data.datagrid("getData").length!=0;this.selectAllButton.linkbutton(enabled?"enable":"disable");this.selectMediumButton.linkbutton(enabled?"enable":"disable");this.selectStrongButton.linkbutton(enabled?"enable":"disable");}});jscape.settings.GlobalServicesCiphersDialog.LISTENER={onSelectMedium:$.noop,onSelectStrong:$.noop,onSubmit:$.noop,onCancel:$.noop};