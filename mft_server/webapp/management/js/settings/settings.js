/* Copyright Â© 2009-2024. Redwood Software Inc. All rights reserved. */
var jscape=jscape||{};jscape.settings=jscape.settings||{};jscape.settings.ServerSettingsApplication=jscape.Application.extend({onReady:function(){this._super();this.view.show(this);},_createView:function(){this._super();this.view=new jscape.settings.ServerSettingsView();},_launch:function(){var _super=this._super;$.when(jscape.API.getServerAddresses(),jscape.API.getServerKeys()).catch(function(){return $.Deferred().resolve([],[]).promise();}).done($.proxy(function(addresses,serverKeys){_super.call(this,addresses,serverKeys,this);},this));}});jscape.settings.ServerSettingsView=jscape.DashboardView.extend({initialize:function(){this._super($("#server-settings").children("[role=tablist]"));this.sidemenu=$("#settings-sidemenu");this.expandCollapseButton=$("#domain-sidemenu-tools-ec-btn").linkbutton({plain:true,selected:false,iconCls:"accordion-collapse accordion-expand",iconAlign:"right",onClick:$.proxy(this._onClick$ExpandCollapseButton,this)});},show:function(){this._super.apply(this,arguments);this.modules.hide();this._initSidemenu(this.sidemenu);this._selectSidemenuItem(this.sidemenu,0);},_onClick$ExpandCollapseButton:function(){var opts=this.expandCollapseButton.linkbutton("options");opts.selected=!opts.selected;if(opts.selected){this._onClick$ExpandAllButton();}else{this._onClick$CollapseAllButton();}},_onClick$ExpandAllButton:function(){var txt=this.expandCollapseButton.find(".l-btn-text");var content=txt.text();txt.text(this.expandCollapseButton.data("toggle-text"));this.expandCollapseButton.data("toggle-text",content);this.expandCollapseButton.find(".accordion-collapse").removeClass("accordion-expand");$.each(this.sidemenu.find(".accordion").accordion("panels"),function(_,p){p.panel("expand");});this.sidemenu.sidemenu("resize",{width:"100%"});},_onClick$CollapseAllButton:function(){var txt=this.expandCollapseButton.find(".l-btn-text");var content=txt.text();txt.text(this.expandCollapseButton.data("toggle-text"));this.expandCollapseButton.data("toggle-text",content);this.expandCollapseButton.find(".accordion-collapse").addClass("accordion-expand");$.each(this.sidemenu.find(".accordion").accordion("panels"),function(_,p){p.panel("collapse");});this.sidemenu.sidemenu("resize",{width:"100%"});},_onSelect$SideMenu:function(item){if(!item){return;}
var module=this.modules.filter(function(_,el){return el.id===item.id;});if(module.length){this.modules.not(module).hide();this._initSubtabs(module.show());if(this._onSelect$Module(item.id,module)){if(module.data("tabs")){module.tabs("resize");}}}},_onSelect$Module:function(id){if(!this.listener){return false;}
if(this.listener.onBeforeSelectModule(id)===false){return false;}
return this.listener.onSelectModule(id);},_subtabs:function(parent){return parent&&parent.length?parent.filter(function(){return $(this).parents("div.dialog").length==0;}):parent;}});jscape.settings.SettingsModule=jscape.ApplicationModule.extend({serverAddresses:null,serverKeys:null,onCreate:function(serverAddresses,serverKeys){this.serverAddresses=serverAddresses;this.serverKeys=serverKeys;this._super();},_fireApplySuccess:function(){$(document).triggerHandler("broadcast",[window.R.string.APPLICATION_SUCCESS_APPLY]);}});jscape.settings.SettingsSubmodule=jscape.settings.SettingsModule.extend({controller:null,initialize:function(controller){this.controller=controller;},onStart:function(){this.controller.start();},onStop:function(){(this.controller.stop||$.noop).apply(this.controller);},onPause:function(){if(typeof this.controller.hasChanged==="function"){if(this.controller.hasChanged()){this._confirmAndApply(this.controller);(this.controller.pause||$.noop).apply(this.controller);}}},onResume:function(){(this.controller.resume||$.noop).apply(this.controller);}});jscape.settings.ConfigManager=Class.extend({subscribers:null,initialize:function(){this.subscribers=[];},subscribe:function(entry){this.subscribers.push(entry);return this;},loadConfig:function(params,defaultConfig){return this.doLoad_(params,defaultConfig).catch($.proxy(function(){return defaultConfig;},this)).then($.proxy(function(config){if(!!config){this._publishConfigurationChanged(config);}
return config;},this));},saveConfig:function(config,stopPropagation){return this.doSave_(config).then($.proxy(function(config){this._publishConfigurationChanged(config);if(!stopPropagation){this._fireSuccessMessage();}
return config;},this));},testConfig:function(config){return this.doTest_(config);},doLoad_:function(params,defaultConfig){return $.Deferred().resolve(defaultConfig).promise();},doSave_:function(config){return $.Deferred().resolve(config).promise();},doTest_:function(config){return $.Deferred().resolve(config).promise();},_publishConfigurationChanged:function(config){for(var i=0,len=this.subscribers.length;i<len;++i){var subscriber=this.subscribers[i];if(subscriber.onConfigurationChanged){subscriber.onConfigurationChanged(config);}}},_fireSuccessMessage:function(){$(document).triggerHandler("broadcast",[window.R.string.APPLICATION_SUCCESS_APPLY]);}});