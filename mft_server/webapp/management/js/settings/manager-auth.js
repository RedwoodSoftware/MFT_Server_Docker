/* Copyright Â© 2009-2024. Redwood Software Inc. All rights reserved. */
jscape.settings=jscape.settings||{};jscape.UsernameConversion={NONE:'NONE',UPPERCASE:'UPPERCASE',LOWERCASE:'LOWERCASE',values:function(){return[this.NONE,this.UPPERCASE,this.LOWERCASE];},valueOf:function(value){return $.inArray(value,this.values())!=-1?value:this.NONE;}};jscape.AuthenticationService=Class.extend({initialize:function(a,b,c){this.type=a||null;this.role=b||null;this.usernameConversion=jscape.UsernameConversion.valueOf(c);}});jscape.AuthenticationService.fromJSON=function(data){var type=jscape.AuthenticationService.typeOf(data);switch(type){case jscape.AuthenticationService.Type.DB:return jscape.AuthenticationService.db(data.url,data.role,data.usernameConversion);case jscape.AuthenticationService.Type.DB_QUERY:return jscape.AuthenticationService.dbQuery(data.url,data.username,data.password,data.sql,data.hasher,data.role,data.usernameConversion);case jscape.AuthenticationService.Type.LDAP:return jscape.AuthenticationService.ldap(data.host,data.port,data.timeout,data.userDN,data.useSsl,data.anonymousAllowed,data.failoverServers,data.role,data.usernameConversion);case jscape.AuthenticationService.Type.LDAP_QUERY:return jscape.AuthenticationService.ldapQuery(data.host,data.port,data.timeout,data.userDN,data.searchUserDN,data.baseDN,data.password,data.hasher,data.filter,data.useSsl,data.anonymousAllowed,data.failoverServers,data.role,data.usernameConversion);case jscape.AuthenticationService.Type.NTLM:return jscape.AuthenticationService.ntlm(data.host,data.windowsDomain,data.role,data.usernameConversion);case jscape.AuthenticationService.Type.PAM:return jscape.AuthenticationService.pam(data.role,data.usernameConversion);case jscape.AuthenticationService.Type.RADIUS:return jscape.AuthenticationService.radius(data.localhost,data.serverhost,data.serverport,data.timeout,data.maxRetransmitAttempts,data.identifier,data.sharedSecret,data.role,data.usernameConversion);case jscape.AuthenticationService.Type.CUSTOM:return jscape.AuthenticationService.custom(data.className,data.role,data.usernameConversion);case jscape.AuthenticationService.Type.MULTIPLE:return jscape.AuthenticationService.multiple(data.configurations);default:return jscape.AuthenticationService.local();}};jscape.AuthenticationService.Type={NONE:'NONE',LOCAL:"LOCAL",DB:"DB",DB_QUERY:"DB_QUERY",LDAP:"LDAP",LDAP_QUERY:"LDAP_QUERY",NTLM:"NTLM",PAM:"PAM",RADIUS:"RADIUS",CUSTOM:"CUSTOM",MULTIPLE:"MULTIPLE"};jscape.AuthenticationService.typeOf=function(data,defaultType){return data&&$.inArray(data.type,[jscape.AuthenticationService.Type.NONE,jscape.AuthenticationService.Type.LOCAL,jscape.AuthenticationService.Type.DB,jscape.AuthenticationService.Type.DB_QUERY,jscape.AuthenticationService.Type.LDAP,jscape.AuthenticationService.Type.LDAP_QUERY,jscape.AuthenticationService.Type.NTLM,jscape.AuthenticationService.Type.PAM,jscape.AuthenticationService.Type.RADIUS,jscape.AuthenticationService.Type.CUSTOM,jscape.AuthenticationService.Type.MULTIPLE])!=-1?data.type:defaultType||jscape.AuthenticationService.local();};jscape.AuthenticationService.NONE=$.extend(new jscape.AuthenticationService(jscape.AuthenticationService.Type.NONE),{toJSON:function(){return null;}});jscape.AuthenticationService.none=function(){return jscape.AuthenticationService.NONE;};jscape.AuthenticationService.local=function(){return new jscape.AuthenticationService(jscape.AuthenticationService.Type.LOCAL);};jscape.AuthenticationService.db=function(url,role,usernameConversion){return $.extend(new jscape.AuthenticationService(jscape.AuthenticationService.Type.DB,role,usernameConversion),{url:url});};jscape.AuthenticationService.dbQuery=function(url,username,password,query,hasher,role,usernameConversion){return $.extend(new jscape.AuthenticationService(jscape.AuthenticationService.Type.DB_QUERY,role,usernameConversion),{url:url,username:username,password:password||"",sql:query,hasher:hasher});};jscape.AuthenticationService.ldap=function(host,port,timeout,userDN,useSsl,anonymousAllowed,failover,role,usernameConversion){return $.extend(new jscape.AuthenticationService(jscape.AuthenticationService.Type.LDAP,role,usernameConversion),{host:host,port:port,timeout:timeout,userDN:userDN,useSsl:!!useSsl,anonymousAllowed:!!anonymousAllowed,failoverServers:$.isArray(failover)?failover:(failover?[failover]:[])});};jscape.AuthenticationService.ldapQuery=function(host,port,timeout,userDN,searchUserDN,baseDN,password,hasher,filter,useSsl,anonymousAllowed,failover,role,usernameConversion){return $.extend(new jscape.AuthenticationService(jscape.AuthenticationService.Type.LDAP_QUERY,role,usernameConversion),{host:host,port:port,timeout:timeout,userDN:userDN,searchUserDN:searchUserDN,baseDN:baseDN,password:password||"",hasher:hasher,filter:filter,useSsl:!!useSsl,anonymousAllowed:!!anonymousAllowed,failoverServers:$.isArray(failover)?failover:(failover?[failover]:[])});};jscape.AuthenticationService.ntlm=function(host,domain,role,usernameConversion){return $.extend(new jscape.AuthenticationService(jscape.AuthenticationService.Type.NTLM,role,usernameConversion),{host:host,windowsDomain:domain});};jscape.AuthenticationService.pam=function(role,usernameConversion){return new jscape.AuthenticationService(jscape.AuthenticationService.Type.PAM,role,usernameConversion);};jscape.AuthenticationService.radius=function(localHost,serverHost,serverPort,timeout,maxRetransmitAttempts,identifier,sharedSecret,role,usernameConversion){return $.extend(new jscape.AuthenticationService(jscape.AuthenticationService.Type.RADIUS,role,usernameConversion),{localhost:localHost,localport:0,serverhost:serverHost,serverport:serverPort,timeout:timeout,maxRetransmitAttempts:maxRetransmitAttempts,identifier:identifier,sharedSecret:sharedSecret});};jscape.AuthenticationService.custom=function(className,role,usernameConversion){return $.extend(new jscape.AuthenticationService(jscape.AuthenticationService.Type.CUSTOM,role,usernameConversion),{className:className||""});};jscape.AuthenticationService.multiple=function(configs){return $.extend(new jscape.AuthenticationService(jscape.AuthenticationService.Type.MULTIPLE,undefined,undefined),{configurations:$.map(configs||[],jscape.AuthenticationService.fromJSON)});};jscape.AdministratorConfirmationService=Class.extend({initialize:function(type){this.type=type||null;}});jscape.AdministratorConfirmationService.fromJSON=function(data){var type=jscape.AdministratorConfirmationService.typeOf(data);switch(type){case jscape.AdministratorConfirmationService.Type.TOTP:return jscape.AdministratorConfirmationService.totp();default:return jscape.AdministratorConfirmationService.none();}};jscape.AdministratorConfirmationService.Type={NONE:'NONE',TOTP:'GOOGLE_AUTHENTICATOR'};jscape.AdministratorConfirmationService.NONE=new jscape.AdministratorConfirmationService(jscape.AdministratorConfirmationService.Type.NONE);jscape.AdministratorConfirmationService.none=function(){return jscape.AdministratorConfirmationService.NONE;};jscape.AdministratorConfirmationService.totp=function(){return new jscape.AdministratorConfirmationService(jscape.AdministratorConfirmationService.Type.TOTP);};jscape.AdministratorConfirmationService.typeOf=function(data,defaultType){if(data&&data.type){var t=(""+data.type).toUpperCase();var types=jscape.AdministratorConfirmationService.Type;if(types.hasOwnProperty(t)){return t;}
for(var key in types){if(types[key]===t){return types[key];}}}
return defaultType||jscape.AdministratorConfirmationService.NONE;};jscape.WebSsoService=Class.extend({initialize:function(a,b,c){this.type=a||null;}});jscape.WebSsoService.fromJSON=function(data){var type=jscape.WebSsoService.typeOf(data);switch(type){case jscape.WebSsoService.Type.OPEN_ID:data=data.openIdData||{};return jscape.WebSsoService.openId(data.signInUrl,data.signOutUrl,data.nonSsoLoginAllowed,data.role,data.usernameConversion);case jscape.WebSsoService.Type.OPEN_ID_CONNECT:data=data.openIdConnectData||{};return jscape.WebSsoService.openIdConnect(data.signInUrl,data.tokenVerificationUrl,data.redirectionUrl,data.clientId,data.clientSecret,data.nonSsoLoginAllowed,data.role,data.usernameConversion);case jscape.WebSsoService.Type.SAML:data=data.samlData||{};return jscape.WebSsoService.saml(data.signInUrl,data.signOutUrl,data.changePasswordUrl,data.decryptionKey,data.verificationHostKey,data.nameIdFormat,data.nonSsoLoginAllowed,data.role,data.usernameConversion);default:return jscape.WebSsoService.none();}};jscape.WebSsoService.Type={NONE:'NONE',OPEN_ID:'OPEN_ID',OPEN_ID_CONNECT:'OPEN_ID_CONNECT',SAML:'SAML'};jscape.WebSsoService.NONE=new jscape.WebSsoService(jscape.WebSsoService.Type.NONE);jscape.WebSsoService.none=function(){return jscape.WebSsoService.NONE;};jscape.WebSsoService.openId=function(signInUrl,signOutUrl,nonSsoLoginAllowed,role,usernameConversion){return $.extend(new jscape.WebSsoService(jscape.WebSsoService.Type.OPEN_ID,role,usernameConversion),{openIdData:{signInUrl:signInUrl,signOutUrl:signOutUrl,role:role,nonSsoLoginAllowed:!!nonSsoLoginAllowed,usernameConversion:jscape.UsernameConversion.valueOf(usernameConversion)}});};jscape.WebSsoService.openIdConnect=function(signInUrl,tokenVerificationUrl,redirectionUrl,clientId,clientSecret,nonSsoLoginAllowed,role,usernameConversion){return $.extend(new jscape.WebSsoService(jscape.WebSsoService.Type.OPEN_ID_CONNECT,role,usernameConversion),{openIdConnectData:{signInUrl:signInUrl,tokenVerificationUrl:tokenVerificationUrl,redirectionUrl:redirectionUrl,clientId:clientId,clientSecret:clientSecret,role:role,nonSsoLoginAllowed:!!nonSsoLoginAllowed,usernameConversion:jscape.UsernameConversion.valueOf(usernameConversion)}});};jscape.WebSsoService.saml=function(signInUrl,signOutUrl,changePasswordUrl,decryptionKey,certificate,nameIdFormat,nonSsoLoginAllowed,role,usernameConversion){return $.extend(new jscape.WebSsoService(jscape.WebSsoService.Type.SAML,role,usernameConversion),{samlData:{signInUrl:signInUrl,signOutUrl:signOutUrl,changePasswordUrl:changePasswordUrl,nameIdFormat:nameIdFormat,decryptionKey:decryptionKey,verificationHostKey:certificate,role:role,nonSsoLoginAllowed:!!nonSsoLoginAllowed,usernameConversion:jscape.UsernameConversion.valueOf(usernameConversion)}});};jscape.WebSsoService.typeOf=function(data,defaultType){return data&&$.inArray(data.type,[jscape.WebSsoService.Type.NONE,jscape.WebSsoService.Type.OPEN_ID,jscape.WebSsoService.Type.OPEN_ID_CONNECT,jscape.WebSsoService.Type.SAML])!=-1?data.type:defaultType||null;};jscape.settings.AuthenticationServiceController=Class.extend({DEFAULT_DESCRIPTOR:jscape.AuthenticationService.local(),view:null,descriptor:null,currentType:null,initialize:function(){this.controllers={LOCAL:jscape.settings.LocalAuthenticationServiceController,DB:jscape.settings.DbAuthenticationServiceController,DB_QUERY:jscape.settings.DbQueryAuthenticationServiceController,LDAP:jscape.settings.LdapAuthenticationServiceController,LDAP_QUERY:jscape.settings.LdapQueryAuthenticationServiceController,NTLM:jscape.settings.NtlmAuthenticationServiceController,PAM:jscape.settings.PamAuthenticationServiceController,RADIUS:jscape.settings.RadiusAuthenticationServiceController,CUSTOM:jscape.settings.CustomAuthenticationServiceController,MULTIPLE:jscape.settings.MultipleAuthenticationServiceController};},start:function(){if(this.view==null){this.view=new jscape.settings.AuthenticationServiceView();this.descriptor=this.DEFAULT_DESCRIPTOR;}
this.view.show(this);},resume:function(){this.view.refresh();},hasChanged:function(){var type=this.descriptor?this.descriptor.type:this.currentType;return type!=this._serviceTypeOf(this.view)||!!this._invokeMethod("hasChanged");},onLoadData:function(){return $.when(jscape.API.getManagementAuthenticationServiceConfiguration(),jscape.API.getManagementRoles()).done($.proxy(function(descriptor,roles){this.descriptor=descriptor;this.roles=roles||[];},this)).fail($.proxy(function(){this.descriptor=this.DEFAULT_DESCRIPTOR;this.roles=[];},this)).always($.proxy(function(){this.view&&this._setupView(this.descriptor);},this));},onApply:function(){var c=this.controllers[this._serviceTypeOf(this.view)]||null;if(!c){return $.Deferred().reject().promise();}
return c.onApply().done($.proxy(function(descriptor){this.descriptor=descriptor;},this));},onDiscard:function(){var c=this.controllers[this._serviceTypeOf(this.view)]||null;c&&c.onDiscard();this._setupView(this.descriptor);return $.Deferred().resolve().promise();},onChange:function(){var changed=this.hasChanged();return $.Deferred().resolve(changed).promise();},onChangeType:function(){var serviceType=this._serviceTypeOf(this.view);$.each(this.controllers,$.proxy(function(type,controller){var t=typeof controller;if(serviceType===type){this.currentType=serviceType;if(t==="function"){var c=new controller(this.view.container());this.controllers[type]=c;c.start(this.descriptor,this.roles);}else{controller.resume(this.descriptor,this.roles);}}else{if(t==="object"){controller.pause();}}},this));},onChangeRoles:function(roles){this.roles=roles||[];this._invokeMethod("setRoles",this.roles);},_serviceTypeOf:function(view){return view?(view.getType()||"").toUpperCase():"";},_setupView:function(descriptor){var type=descriptor?descriptor.type:this.DEFAULT_DESCRIPTOR.type;this.view.setType(type);},_invokeMethod:function(method){var c=this.controllers[this._serviceTypeOf(this.view)];return c&&typeof c==="object"&&c[method]?c[method].apply(c,Array.prototype.slice.call(arguments,1)):undefined;}});jscape.settings.AuthenticationServiceView=jscape.ui.FormView.extend({initialize:function(){this.fieldset=$("#manager-auth-service-fields").layout({fit:true,doSize:false,border:false});this.type=$("select[name=type]",this.fieldset).combobox({required:true,editable:false,selectOnNavigation:false,onChange:$.proxy(this._onChange$Type,this),width:"25%",minWidth:250,panelHeight:"auto",panelMinHeight:80,panelMaxHeight:"40%"});this.applyButton=$("a[role=button][name=apply]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$ApplyButton,this)});this.discardButton=$("a[role=button][name=discard]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$DiscardButton,this)});this._bindEvents(this.fieldset);},container:function(){return this.fieldset.layout("panel","center");},show:function(listener){this.listener=listener||jscape.settings.AuthenticationServiceView.LISTENER;},refresh:function(){this.listener.onLoadData();},getType:function(){return this.type.combobox("getValue");},setType:function(value){var selectedType=this.type.combobox("getValue");this.type.combobox("clear").combobox("select",value);if(selectedType===value){this._onChange$Type();}},_onChange$Type:function(){this.listener.onChangeType(this);this.fieldset.triggerHandler("_change");},_onClick$ApplyButton:function(){this.applyButton.linkbutton("disable");this.listener.onApply(this).catch($.proxy(function(){this.applyButton.linkbutton("enable");},this));},_onClick$DiscardButton:function(){this.listener.onDiscard(this);},_onForm$Change:function(){this.listener.onChange(this).done($.proxy(function(modified){this.applyButton.linkbutton(modified?"enable":"disable");},this));}});jscape.settings.AuthenticationServiceView.LISTENER={onLoadData:$.noop,onChangeType:$.noop,onChange:$.noop,onApply:$.noop,onDiscard:$.noop};jscape.settings.BaseAuthenticationServiceController=Class.extend({VARIABLES:["username","password"],view:null,type:null,descriptor:null,initialize:function(type){this.type=type;this.testController=new jscape.settings.TestAuthenticationServiceController();this.variableController=new jscape.VariableController();this.roles=[];},start:function(descriptor,roles){this.descriptor=descriptor||null;this.view.show(this,roles);this._setupView(this.descriptor);},resume:function(descriptor,roles){this.descriptor=this._support(descriptor)?descriptor:null;this.view.show(this,roles);},pause:function(){this.view.hide();},hasChanged:function(){return this.descriptor!=null&&!Object._equals(this.descriptor,this._createDescriptor());},onAddVariable:function(input){this.variableController.start(input,this.VARIABLES);},onLoadRoles:function(){return $.Deferred().resolve(this.roles).promise();},onChange:function(){var changed=this.hasChanged();return $.Deferred().resolve(changed).promise();},onTest:function(){return this.testController.start(this._createDescriptor());},onApply:function(){if(!this.view.valid()){return $.Deferred().reject().promise();}
return jscape.API.setManagementAuthenticationServiceConfiguration(this._createDescriptor()).done($.proxy(function(descriptor){this.descriptor=descriptor;this._setupView(descriptor);this._fireApplySuccess();},this));},onDiscard:function(){this._setupView(this.descriptor);},setRoles:function(roles){this.roles=roles||[];$(document).triggerHandler("onchangeroles.manager",[this.roles]);},_support:function(descriptor){return!!descriptor&&descriptor.type==this.type;},_createDescriptor:function(){return null;},_setupView:function(descriptor){},_fireApplySuccess:function(){$(document).triggerHandler("broadcast",[window.R.string.APPLICATION_SUCCESS_APPLY]);}});jscape.settings.BaseAuthenticationServiceView=jscape.ui.FormView.extend({focusInField:null,initialize:function(el){var initializing=true;this.fieldset=el.first().layout({fit:true,doSize:false,border:false}).hide();this.useRole=$("input[name=userole]:checkbox",this.fieldset).change($.proxy(this._onChange$UseRole,this));this.role=$("select[name=role]",this.fieldset).combobox({required:true,editable:false,onChange:$.proxy(this._onForm$Change,this),loader:$.proxy(this._onLoad$Roles,this),onBeforeLoad:function(){return!initializing;},onLoadSuccess:$.proxy(this._onLoadSuccess$Roles,this),onLoadError:$.proxy(this._onLoadError$Roles,this),width:200,panelHeight:"auto",panelMinHeight:80,panelMaxHeight:"40%"});this.useUsernameConversion=$("input[name=useusernameconversion]:checkbox",this.fieldset);this.useUsernameConversion.change($.proxy(this._onChange$UseUsernameConversion,this));this.usernameConversion=$("select[name=usernameconversion]",this.fieldset);this.usernameConversion.combobox({required:true,editable:false,onChange:$.proxy(this._onForm$Change,this),onLoadSuccess:$.proxy(this._onLoadSuccess$UsernameConversion,this),onLoadError:$.proxy(this._onLoadError$UsernameConversion,this),width:100,panelHeight:"auto"});this.addVariableButton=$("a[role=button][name=addvar]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$AddVariableButton,this)});this.testButton=$("a[role=button][name=test]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$TestButton,this)});this.fieldset.off("focusin").on("focusin",$.proxy(this._onChange$FocusIn,this));this._bindEvents(this.fieldset);initializing=false;},show:function(listener,roles){this.listener=listener||jscape.settings.BaseAuthenticationServiceView.LISTENER;this.focusInField=null;$(document).on("onchangeroles.manager",$.proxy(this._onChange$Roles,this));this.fieldset.show().layout({height:"auto"});this._onChange$Roles(undefined,roles);this.fieldset.form("validate");},hide:function(){$(document).off("onchangeroles.manager");this.fieldset.hide();this.focusInField=null;},valid:function(){return this.fieldset.form("validate");},getRole:function(){return this.role.length&&this.useRole.is(":checked:not(:disabled)")?this.role.combobox("getValue"):null;},setRole:function(value){if(this.role.length==0){return;}
var data=this.role.combobox("getData");this.role.combobox(data&&data.length!=0?"select":"setValue",value);this.useRole.prop("checked",value!=null).change();},getUsernameConversion:function(){return this.usernameConversion.length&&this.useUsernameConversion.is(":checked:not(:disabled)")?this.usernameConversion.combobox("getValue"):jscape.UsernameConversion.NONE;},setUsernameConversion:function(value){if(this.usernameConversion.length==0){return;}
if(jscape.UsernameConversion.NONE!=value){this.useUsernameConversion.prop("checked",true).change();this.usernameConversion.combobox("select",value);}else{this.useUsernameConversion.prop("checked",false).change();this.usernameConversion.combobox("reset");}},_onLoad$Roles:function(params,success,error){this.listener&&this.listener.onLoadRoles().then(success,error);},_onLoadSuccess$Roles:function(data){if(data&&data.length){this.useRole.prop("disabled",false).change();}else{this.role.combobox("clear");this._onLoadError$Roles();}},_onLoadError$Roles:function(){this.useRole.prop("disabled",true).change();},_onLoadSuccess$UsernameConversion:function(data){if(data&&data.length){this.usernameConversion.combobox("clear").combobox("select",data[0].value);this.useUsernameConversion.change();}else{this._onLoadError$UsernameConversion();}},_onLoadError$UsernameConversion:function(){this.useUsernameConversion.prop("disabled",true).change();},_onChange$Roles:function(e,roles){if(this.role&&this.role.length&&roles){if($.isArray(roles)){this.role.combobox("loadData",roles);}else{this.role.combobox("reload");}}},_onClick$TestButton:function(){if(this.valid()){this.testButton.linkbutton("disable");this.listener.onTest(this).always($.proxy(function(){this.testButton.linkbutton("enable");},this));}},_onClick$AddVariableButton:function(){if(this.focusInField&&this.focusInField.length){this.addVariableButton.linkbutton("disable");this.listener.onAddVariable(this.focusInField);}},_onChange$FocusIn:function(e){var t=$(e.target);if(t&&t.is(this.addVariableButton)){return;}
if(t&&!t.is("[readonly]")&&(t.is("[type=text]")||t.is("textarea"))){this.focusInField=t;if(this.addVariableButton&&this.addVariableButton.length){this.addVariableButton.linkbutton("enable");}}else{if(this.addVariableButton&&this.addVariableButton.length){if(!this.addVariableButton.is(t)){this.focusInField=null;this.addVariableButton.linkbutton("disable");}}else{this.focusInField=null;}}},_onChange$UseRole:function(e){var enabled=$(e.target).is(":checked:not(:disabled)");this.role.combobox(enabled?"enable":"disable").combobox(enabled?"enableValidation":"disableValidation");},_onChange$UseUsernameConversion:function(e){var enabled=$(e.target).is(":checked");this.usernameConversion.combobox(enabled?"enable":"disable").combobox(enabled?"enableValidation":"disableValidation");},_onForm$Change:function(){this.fieldset.closest("[role=group]").triggerHandler("_change");},_showContextMenu:function(e,_,parent){this._super(e,[this.testButton,this.addVariableButton],parent);}});jscape.settings.BaseAuthenticationServiceView.LISTENER={onChange:$.noop,onTest:$.noop,onAddVariable:$.noop};jscape.settings.NoneAuthServiceView=jscape.settings.BaseAuthenticationServiceView.extend({initialize:function(){},show:function(){},hide:function(){},valid:function(){return true;}});jscape.settings.LocalAuthenticationServiceController=jscape.settings.BaseAuthenticationServiceController.extend({initialize:function($parent){this._super(jscape.AuthenticationService.Type.LOCAL);var el=$("#localauthfields").clone().attr("id","").appendTo($parent);this.view=new jscape.settings.LocalAuthenticationServiceView(el);},_createDescriptor:function(){return jscape.AuthenticationService.local();}});jscape.settings.LocalAuthenticationServiceView=jscape.settings.BaseAuthenticationServiceView.extend({initialize:function($el){this._super($el);}});jscape.settings.DbAuthenticationServiceController=jscape.settings.BaseAuthenticationServiceController.extend({initialize:function($parent){this._super(jscape.AuthenticationService.Type.DB);var el=$("#dbauthfields").clone().attr("id","").appendTo($parent);this.view=new jscape.settings.DbAuthenticationServiceView(el);},_createDescriptor:function(){return jscape.AuthenticationService.db(this.view.getUrl(),this.view.getRole(),this.view.getUsernameConversion());},_setupView:function(descriptor){if(descriptor){this.view.setUrl(descriptor.url);this.view.setRole(descriptor.role);this.view.setUsernameConversion(descriptor.usernameConversion);}}});jscape.settings.DbAuthenticationServiceView=jscape.settings.BaseAuthenticationServiceView.extend({initialize:function($el){this._super($el);this.url=$("input[name=dburl]",this.fieldset).textbox({required:true,onChange:$.proxy(this._onForm$Change,this),validType:"length[1,2048]",missingMessage:window.R.string.AUTHENTICATION_ERROR_BAD_DB_URL,invalidMessage:window.R.string.AUTHENTICATION_ERROR_BAD_DB_URL,width:350});},getUrl:function(){return this.url.textbox("getValue").trim();},setUrl:function(value){this.url.textbox("setValue",value);}});jscape.settings.DbQueryAuthenticationServiceController=jscape.settings.BaseAuthenticationServiceController.extend({initialize:function($parent){this._super(jscape.AuthenticationService.Type.DB_QUERY);var el=$("#dbqueryauthfields").clone().attr("id","").appendTo($parent);this.view=new jscape.settings.DbQueryAuthenticationServiceView(el);},_createDescriptor:function(){return jscape.AuthenticationService.dbQuery(this.view.getUrl(),this.view.getUsername(),this.view.getPassword(),this.view.getQuery(),this.view.getHashClass(),this.view.getRole(),this.view.getUsernameConversion());},_setupView:function(descriptor){if(descriptor){this.view.setUrl(descriptor.url);this.view.setUsername(descriptor.username);this.view.setPassword(descriptor.password);this.view.setQuery(descriptor.sql);this.view.setHashClass(descriptor.hasher);this.view.setRole(descriptor.role);this.view.setUsernameConversion(descriptor.usernameConversion);}}});jscape.settings.DbQueryAuthenticationServiceView=jscape.settings.BaseAuthenticationServiceView.extend({initialize:function($el){this._super($el);this.url=$("input[name=dburl]",this.fieldset).textbox({required:true,onChange:$.proxy(this._onForm$Change,this),validType:"length[1,2048]",missingMessage:window.R.string.AUTHENTICATION_ERROR_BAD_DB_URL,invalidMessage:window.R.string.AUTHENTICATION_ERROR_BAD_DB_URL,width:500});this.username=$("input[name=dbuser]",this.fieldset).textbox({required:true,onChange:$.proxy(this._onForm$Change,this),validType:"length[1,50]",missingMessage:window.R.string.AUTHENTICATION_ERROR_BAD_DB_USER,invalidMessage:window.R.string.AUTHENTICATION_ERROR_BAD_DB_USER,width:250});this.password=$("input[name=dbpwd]",this.fieldset).passwordbox2({onChange:$.proxy(this._onForm$Change,this),width:250});this.query=$("textarea[name=query]",this.fieldset).textbox({required:true,multiline:true,onChange:$.proxy(this._onForm$Change,this),validType:"length[1,2000]",missingMessage:window.R.string.AUTHENTICATION_ERROR_BAD_DB_QUERY,invalidMessage:window.R.string.AUTHENTICATION_ERROR_BAD_DB_QUERY,width:610,height:90});this.hashClass=$("input[name=hashclass]",this.fieldset).textbox({onChange:$.proxy(this._onForm$Change,this),width:310});},getUrl:function(){return this.url.textbox("getValue").trim();},setUrl:function(value){this.url.textbox("setValue",value);},getUsername:function(){return this.username.textbox("getValue");},setUsername:function(value){this.username.textbox("setValue",value);},getPassword:function(){return this.password.passwordbox2("getValue");},setPassword:function(value){this.password.passwordbox2("setValue",value);},getQuery:function(){return this.query.textbox("getValue");},setQuery:function(value){this.query.textbox("setValue",value);},getHashClass:function(){return this.hashClass.textbox("getValue");},setHashClass:function(value){this.hashClass.textbox("setValue",value);}});jscape.settings.LdapAuthenticationServiceController=jscape.settings.BaseAuthenticationServiceController.extend({DEFAULT_PORT:389,DEFAULT_TIMEOUT:30*1000,initialize:function($parent){this._super(jscape.AuthenticationService.Type.LDAP);var el=$("#ldapauthfields").clone().attr("id","").appendTo($parent);this.view=new jscape.settings.LdapAuthenticationServiceView(el);},_createDescriptor:function(){var failover=this.view.getFailoverHost()!=null?{host:this.view.getFailoverHost(),port:this.view.getFailoverPort()}:null;return jscape.AuthenticationService.ldap(this.view.getHost(),this.view.getPort(),this.view.getTimeout(),this.view.getUserDN(),this.view.isUseSsl(),this.view.isAnonymousAllowed(),failover,this.view.getRole(),this.view.getUsernameConversion());},_setupView:function(descriptor){if(descriptor){this.view.setHost(descriptor.host);this.view.setPort(descriptor.port);this.view.setTimeout(descriptor.timeout);this.view.setUserDN(descriptor.userDN);this.view.setUseSsl(descriptor.useSsl);this.view.setAnonymousAllowed(descriptor.anonymousAllowed);var failover=descriptor.failoverServers;if(failover&&failover.length){this.view.setFailoverHost(failover[0].host);this.view.setFailoverPort(failover[0].port);}
this.view.setRole(descriptor.role);this.view.setUsernameConversion(descriptor.usernameConversion);}
if(!this._support(descriptor)){this.view.setPort(this.DEFAULT_PORT);this.view.setTimeout(this.DEFAULT_TIMEOUT);this.view.setFailoverPort(this.DEFAULT_PORT);}}});jscape.settings.LdapAuthenticationServiceView=jscape.settings.BaseAuthenticationServiceView.extend({TIMEOUT_FACTOR:1000,initialize:function($el){this._super($el);this.host=$("input[name=host]",this.fieldset).textbox({required:true,onChange:$.proxy(this._onForm$Change,this),validType:"length[1,255]",missingMessage:window.R.string.AUTHENTICATION_ERROR_BAD_LDAP_HOST,invalidMessage:window.R.string.AUTHENTICATION_ERROR_BAD_LDAP_HOST,width:410});this.port=$("input[name=port]",this.fieldset).numberspinner({required:true,min:1,max:65535,onChange:$.proxy(this._onForm$Change,this),width:100});this.timeout=$("input[name=timeout]",this.fieldset).numberspinner({required:true,min:1,max:999,onChange:$.proxy(this._onForm$Change,this),width:60});this.userDN=$("input[name=userdn]",this.fieldset).textbox({required:true,onChange:$.proxy(this._onForm$Change,this),validType:"length[1,255]",missingMessage:window.R.string.AUTHENTICATION_ERROR_BAD_USER_DN,invalidMessage:window.R.string.AUTHENTICATION_ERROR_BAD_USER_DN,width:410});this.useSsl=$("input[name=usessl]",this.fieldset);this.anonymousAllowed=$("input[name=allowanonymous]",this.fieldset);this.useFailover=$("input[name=usefailover]",this.fieldset);this.useFailover.change($.proxy(this._onChange$UseFailover,this));this.failoverHost=$("input[name=failoverhost]",this.fieldset).textbox({required:true,disabled:true,onChange:$.proxy(this._onForm$Change,this),validType:"length[1,255]",missingMessage:window.R.string.AUTHENTICATION_ERROR_BAD_FAILOVER_HOST,invalidMessage:window.R.string.AUTHENTICATION_ERROR_BAD_FAILOVER_HOST,width:410});this.failoverPort=$("input[name=failoverport]",this.fieldset).numberspinner({required:true,disabled:true,min:1,max:65535,onChange:$.proxy(this._onForm$Change,this),width:100});},getHost:function(){return this.host.textbox("getValue");},setHost:function(value){this.host.textbox("setValue",value);},getPort:function(){return parseInt(this.port.numberspinner("getValue"));},setPort:function(value){this.port.numberspinner("setValue",parseInt(value));},getTimeout:function(){return parseInt(this.timeout.numberspinner("getValue"))*this.TIMEOUT_FACTOR;},setTimeout:function(value){this.timeout.numberspinner("setValue",parseInt(value)/this.TIMEOUT_FACTOR);},getUserDN:function(){return this.userDN.textbox("getValue");},setUserDN:function(value){this.userDN.textbox("setValue",value);},isUseSsl:function(){return this.useSsl.is(":checked");},setUseSsl:function(value){this.useSsl.prop("checked",!!value);},isAnonymousAllowed:function(){return this.anonymousAllowed.is(":checked");},setAnonymousAllowed:function(value){this.anonymousAllowed.prop("checked",!!value);},getFailoverHost:function(){return this.useFailover.is(":checked")?this.failoverHost.textbox("getValue"):null;},setFailoverHost:function(value){this.failoverHost.textbox("setValue",value);this.useFailover.prop("checked",!!value).change();},getFailoverPort:function(){return parseInt(this.failoverPort.numberspinner("getValue"));},setFailoverPort:function(value){this.failoverPort.numberspinner("setValue",parseInt(value));},_onChange$UseFailover:function(){var enabled=this.useFailover.is(":checked");this.failoverHost.textbox(enabled?"enable":"disable").textbox("isValid");this.failoverPort.numberspinner(enabled?"enable":"disable");}});jscape.settings.LdapQueryAuthenticationServiceController=jscape.settings.BaseAuthenticationServiceController.extend({DEFAULT_PORT:389,DEFAULT_TIMEOUT:30*1000,initialize:function($parent){this._super(jscape.AuthenticationService.Type.LDAP_QUERY);var el=$("#ldapqueryauthfields").clone().attr("id","").appendTo($parent);this.view=new jscape.settings.LdapQueryAuthenticationServiceView(el);},_createDescriptor:function(){var failover=this.view.getFailoverHost()!=null?{host:this.view.getFailoverHost(),port:this.view.getFailoverPort()}:null;return jscape.AuthenticationService.ldapQuery(this.view.getHost(),this.view.getPort(),this.view.getTimeout(),this.view.getUserDN(),this.view.getSearchUserDN(),this.view.getBaseDN(),this.view.getPassword(),this.view.getHasher(),this.view.getFilter(),this.view.isUseSsl(),this.view.isAnonymousAllowed(),failover,this.view.getRole(),this.view.getUsernameConversion());},_setupView:function(descriptor){if(descriptor){this.view.setHost(descriptor.host);this.view.setPort(descriptor.port);this.view.setTimeout(descriptor.timeout);this.view.setUserDN(descriptor.userDN);this.view.setSearchUserDN(descriptor.searchUserDN);this.view.setBaseDN(descriptor.baseDN);this.view.setPassword(descriptor.password);this.view.setHasher(descriptor.hasher);this.view.setFilter(descriptor.filter);this.view.setUseSsl(descriptor.useSsl);this.view.setAnonymousAllowed(descriptor.anonymousAllowed);var failover=descriptor.failoverServers;if(failover&&failover.length){this.view.setFailoverHost(failover[0].host);this.view.setFailoverPort(failover[0].port);}
this.view.setRole(descriptor.role);this.view.setUsernameConversion(descriptor.usernameConversion);}
if(!this._support(descriptor)){this.view.setPort(this.DEFAULT_PORT);this.view.setTimeout(this.DEFAULT_TIMEOUT);this.view.setFailoverPort(this.DEFAULT_PORT);}}});jscape.settings.LdapQueryAuthenticationServiceView=jscape.settings.BaseAuthenticationServiceView.extend({TIMEOUT_FACTOR:1000,initialize:function($el){this._super($el);this.host=$("input[name=host]",this.fieldset).textbox({required:true,onChange:$.proxy(this._onForm$Change,this),validType:"length[1,255]",missingMessage:window.R.string.AUTHENTICATION_ERROR_BAD_LDAP_HOST,invalidMessage:window.R.string.AUTHENTICATION_ERROR_BAD_LDAP_HOST,width:410});this.port=$("input[name=port]",this.fieldset).numberspinner({required:true,min:1,max:65535,onChange:$.proxy(this._onForm$Change,this),width:100});this.timeout=$("input[name=timeout]",this.fieldset).numberspinner({required:true,min:1,max:999,onChange:$.proxy(this._onForm$Change,this),width:60});this.userDN=$("input[name=userdn]",this.fieldset).textbox({required:true,onChange:$.proxy(this._onForm$Change,this),validType:"length[1,255]",missingMessage:window.R.string.AUTHENTICATION_ERROR_BAD_USER_DN,invalidMessage:window.R.string.AUTHENTICATION_ERROR_BAD_USER_DN,width:410});this.searchUserDN=$("input[name=searchuserdn]",this.fieldset).textbox({required:true,onChange:$.proxy(this._onForm$Change,this),validType:"length[1,255]",missingMessage:window.R.string.AUTHENTICATION_ERROR_BAD_SEARCH_USER_DN,invalidMessage:window.R.string.AUTHENTICATION_ERROR_BAD_SEARCH_USER_DN,width:410});this.password=$("input[name=password]",this.fieldset).passwordbox2({type:"password",onChange:$.proxy(this._onForm$Change,this),width:410});this.baseDN=$("input[name=basedn]",this.fieldset).textbox({onChange:$.proxy(this._onForm$Change,this),width:410});this.filter=$("textarea[name=filter]",this.fieldset).textbox({required:true,multiline:true,onChange:$.proxy(this._onForm$Change,this),validType:"length[1,2000]",missingMessage:window.R.string.AUTHENTICATION_ERROR_BAD_FILTER,invalidMessage:window.R.string.AUTHENTICATION_ERROR_BAD_FILTER,width:610,height:90});this.hasher=$("input[name=hasher]",this.fieldset).textbox({onChange:$.proxy(this._onForm$Change,this),width:410});this.useSsl=$("input[name=usessl]",this.fieldset);this.anonymousAllowed=$("input[name=allowanonymous]",this.fieldset);this.useFailover=$("input[name=usefailover]",this.fieldset);this.useFailover.change($.proxy(this._onChange$UseFailover,this));this.failoverHost=$("input[name=failoverhost]",this.fieldset).textbox({required:true,disabled:true,onChange:$.proxy(this._onForm$Change,this),validType:"length[1,255]",missingMessage:window.R.string.AUTHENTICATION_ERROR_BAD_FAILOVER_HOST,invalidMessage:window.R.string.AUTHENTICATION_ERROR_BAD_FAILOVER_HOST,width:410});this.failoverPort=$("input[name=failoverport]",this.fieldset).numberspinner({required:true,disabled:true,min:1,max:65535,onChange:$.proxy(this._onForm$Change,this),width:100});},getHost:function(){return this.host.textbox("getValue");},setHost:function(value){this.host.textbox("setValue",value);},getPort:function(){return parseInt(this.port.numberspinner("getValue"));},setPort:function(value){this.port.numberspinner("setValue",parseInt(value));},getTimeout:function(){return parseInt(this.timeout.numberspinner("getValue"))*this.TIMEOUT_FACTOR;},setTimeout:function(value){this.timeout.numberspinner("setValue",parseInt(value)/this.TIMEOUT_FACTOR);},getUserDN:function(){return this.userDN.textbox("getValue");},setUserDN:function(value){this.userDN.textbox("setValue",value);},getSearchUserDN:function(){return this.searchUserDN.textbox("getValue");},setSearchUserDN:function(value){this.searchUserDN.textbox("setValue",value);},getBaseDN:function(){return this.baseDN.textbox("getValue");},setBaseDN:function(value){this.baseDN.textbox("setValue",value);},getPassword:function(){return this.password.passwordbox2("getValue");},setPassword:function(value){this.password.passwordbox2("setValue",value);},getHasher:function(){return this.hasher.textbox("getValue");},setHasher:function(value){this.hasher.textbox("setValue",value);},getFilter:function(){return this.filter.textbox("getValue");},setFilter:function(value){this.filter.textbox("setValue",value);},isUseSsl:function(){return this.useSsl.is(":checked");},setUseSsl:function(value){this.useSsl.prop("checked",!!value);},isAnonymousAllowed:function(){return this.anonymousAllowed.is(":checked");},setAnonymousAllowed:function(value){this.anonymousAllowed.prop("checked",!!value);},getFailoverHost:function(){return this.useFailover.is(":checked")?this.failoverHost.textbox("getValue"):null;},setFailoverHost:function(value){this.failoverHost.textbox("setValue",value);this.useFailover.prop("checked",!!value).change();},getFailoverPort:function(){return parseInt(this.failoverPort.numberspinner("getValue"));},setFailoverPort:function(value){this.failoverPort.numberspinner("setValue",parseInt(value));},_onChange$UseFailover:function(){var enabled=this.useFailover.is(":checked");this.failoverHost.textbox(enabled?"enable":"disable").textbox("isValid");this.failoverPort.numberspinner(enabled?"enable":"disable");}});jscape.settings.NtlmAuthenticationServiceController=jscape.settings.BaseAuthenticationServiceController.extend({initialize:function($parent){this._super(jscape.AuthenticationService.Type.NTLM);var el=$("#ntlmauthfields").clone().attr("id","").appendTo($parent);this.view=new jscape.settings.NtlmAuthenticationServiceView(el);},_createDescriptor:function(){return jscape.AuthenticationService.ntlm(this.view.getHost(),this.view.getDomain(),this.view.getRole(),this.view.getUsernameConversion());},_setupView:function(descriptor){if(descriptor){this.view.setHost(descriptor.host);this.view.setDomain(descriptor.windowsDomain);this.view.setRole(descriptor.role);this.view.setUsernameConversion(descriptor.usernameConversion);}}});jscape.settings.NtlmAuthenticationServiceView=jscape.settings.BaseAuthenticationServiceView.extend({initialize:function($el){this._super($el);this.host=$("input[name=host]",this.fieldset).textbox({required:true,onChange:$.proxy(this._onForm$Change,this),validType:"length[1,255]",missingMessage:window.R.string.AUTHENTICATION_ERROR_BAD_NTLM_HOST,invalidMessage:window.R.string.AUTHENTICATION_ERROR_BAD_NTLM_HOST,width:410});this.domain=$("input[name=domain]",this.fieldset).textbox({required:true,onChange:$.proxy(this._onForm$Change,this),validType:"length[1,255]",missingMessage:window.R.string.AUTHENTICATION_ERROR_BAD_NTLM_DOMAIN,invalidMessage:window.R.string.AUTHENTICATION_ERROR_BAD_NTLM_DOMAIN,width:410});},getHost:function(){return this.host.textbox("getValue");},setHost:function(value){this.host.textbox("setValue",value);},getDomain:function(){return this.domain.textbox("getValue");},setDomain:function(value){this.domain.textbox("setValue",value);}});jscape.settings.PamAuthenticationServiceController=jscape.settings.BaseAuthenticationServiceController.extend({initialize:function($parent){this._super(jscape.AuthenticationService.Type.PAM);var el=$("#pamauthfields").clone().attr("id","").appendTo($parent);this.view=new jscape.settings.PamAuthenticationServiceView(el);},_createDescriptor:function(){return jscape.AuthenticationService.pam(this.view.getRole(),this.view.getUsernameConversion());},_setupView:function(descriptor){if(descriptor){this.view.setRole(descriptor.role);this.view.setUsernameConversion(descriptor.usernameConversion);}}});jscape.settings.PamAuthenticationServiceView=jscape.settings.BaseAuthenticationServiceView.extend({initialize:function($el){this._super($el);}});jscape.settings.RadiusAuthenticationServiceController=jscape.settings.BaseAuthenticationServiceController.extend({DEFAULT_PORT:1812,DEFAULT_TIMEOUT:30*1000,DEFAULT_RETRANSMIT_ATTEMPTS:3,inetAddresses:null,initialize:function($parent){this._super(jscape.AuthenticationService.Type.RADIUS);this.inetAddresses=[];var el=$("#radiusauthfields").clone().attr("id","").appendTo($parent);this.view=new jscape.settings.RadiusAuthenticationServiceView(el);},start:function(){($.proxy(function(_super,_args){jscape.API.getServerAddresses().done($.proxy(function(addresses){this.inetAddresses=addresses;},this)).fail($.proxy(function(){this.inetAddresses=[];},this)).always($.proxy(function(){_super.apply(this,_args);},this));},this))(this._super,arguments);},_createDescriptor:function(){return jscape.AuthenticationService.radius(this.view.getLocalHost(),this.view.getServerHost(),this.view.getServerPort(),this.view.getTimeout(),this.view.getMaxRetransmitAttempts(),this.view.getIdentifier(),this.view.getSharedSecret(),this.view.getRole(),this.view.getUsernameConversion());},_setupView:function(descriptor){this.view.setAvailableHosts(this.inetAddresses);if(descriptor){this.view.setLocalHost(descriptor.localhost);this.view.setServerHost(descriptor.serverhost);this.view.setServerPort(descriptor.serverport);this.view.setTimeout(descriptor.timeout);this.view.setMaxRetransmitAttempts(descriptor.maxRetransmitAttempts);this.view.setIdentifier(descriptor.identifier);this.view.setSharedSecret(descriptor.sharedSecret);this.view.setRole(descriptor.role);this.view.setUsernameConversion(descriptor.usernameConversion);}
if(!this._support(descriptor)){this.view.setServerPort(this.DEFAULT_PORT);this.view.setTimeout(this.DEFAULT_TIMEOUT);this.view.setMaxRetransmitAttempts(this.DEFAULT_RETRANSMIT_ATTEMPTS);}}});jscape.settings.RadiusAuthenticationServiceView=jscape.settings.BaseAuthenticationServiceView.extend({TIMEOUT_FACTOR:1000,initialize:function($el){this._super($el);this.localHost=$("select[name=localhost]",this.fieldset).combobox({required:true,onChange:$.proxy(this._onForm$Change,this),validType:"length[1,255]",missingMessage:window.R.string.AUTHENTICATION_ERROR_BAD_RADIUS_HOST,invalidMessage:window.R.string.AUTHENTICATION_ERROR_BAD_RADIUS_HOST,width:250,panelWidth:"auto",panelHeight:"auto",panelMaxHeight:"40%"});this.serverHost=$("input[name=serverhost]",this.fieldset).textbox({required:true,onChange:$.proxy(this._onForm$Change,this),validType:"length[1,255]",missingMessage:window.R.string.AUTHENTICATION_ERROR_BAD_RADIUS_HOST,invalidMessage:window.R.string.AUTHENTICATION_ERROR_BAD_RADIUS_HOST,width:500});this.serverPort=$("input[name=serverport]",this.fieldset).numberspinner({required:true,min:1,max:65535,onChange:$.proxy(this._onForm$Change,this),width:120});this.timeout=$("input[name=timeout]",this.fieldset).numberspinner({required:true,min:1,max:999,onChange:$.proxy(this._onForm$Change,this),width:80});this.retransmitAttempts=$("input[name=retransmitattempts]",this.fieldset).numberspinner({required:true,min:1,max:100,onChange:$.proxy(this._onForm$Change,this),width:80});this.identifier=$("input[name=identifier]",this.fieldset).textbox({required:true,onChange:$.proxy(this._onForm$Change,this),missingMessage:window.R.string.AUTHENTICATION_ERROR_BAD_RADIUS_ID,invalidMessage:window.R.string.AUTHENTICATION_ERROR_BAD_RADIUS_ID,width:500});this.sharedSecret=$("input[name=secret]",this.fieldset).textbox({required:true,onChange:$.proxy(this._onForm$Change,this),missingMessage:window.R.string.AUTHENTICATION_ERROR_BAD_RADIUS_SECRET,invalidMessage:window.R.string.AUTHENTICATION_ERROR_BAD_RADIUS_SECRET,width:500});},getLocalHost:function(){return this.localHost.combobox("getValue");},setLocalHost:function(value){this.localHost.combobox("setValue",value);},setAvailableHosts:function(values){this.localHost.combobox("loadData",$.map(values,$.proxy(function(value){return{text:this._formatHostname(value),value:value};},this)));},getServerHost:function(){return this.serverHost.textbox("getValue");},setServerHost:function(value){this.serverHost.textbox("setValue",value);},getServerPort:function(){return parseInt(this.serverPort.numberspinner("getValue"));},setServerPort:function(value){this.serverPort.numberspinner("setValue",parseInt(value));},getTimeout:function(){return parseInt(this.timeout.numberspinner("getValue"))*this.TIMEOUT_FACTOR;},setTimeout:function(value){this.timeout.numberspinner("setValue",parseInt(value)/this.TIMEOUT_FACTOR);},getMaxRetransmitAttempts:function(){return parseInt(this.retransmitAttempts.numberspinner("getValue"));},setMaxRetransmitAttempts:function(value){this.retransmitAttempts.numberspinner("setValue",parseInt(value));},getIdentifier:function(){return this.identifier.textbox("getValue");},setIdentifier:function(value){this.identifier.textbox("setValue",value);},getSharedSecret:function(){return this.sharedSecret.textbox("getValue");},setSharedSecret:function(value){this.sharedSecret.textbox("setValue",value);},_formatHostname:function(value){return jscape.ServerParameters.allHostsIpv4(value)?window.R.string.APPLICATION_HOST_ALL_IPV4:jscape.ServerParameters.allHostsIpv6(value)?window.R.string.APPLICATION_HOST_ALL_IPV6:value;}});jscape.settings.CustomAuthenticationServiceController=jscape.settings.BaseAuthenticationServiceController.extend({initialize:function($parent){this._super(jscape.AuthenticationService.Type.CUSTOM);var el=$("#customauthfields").clone().attr("id","").appendTo($parent);this.view=new jscape.settings.CustomAuthenticationServiceView(el);},_createDescriptor:function(){return jscape.AuthenticationService.custom(this.view.getClassName(),this.view.getRole(),this.view.getUsernameConversion());},_setupView:function(descriptor){if(descriptor){this.view.setClassName(descriptor.className);this.view.setRole(descriptor.role);this.view.setUsernameConversion(descriptor.usernameConversion);}}});jscape.settings.CustomAuthenticationServiceView=jscape.settings.BaseAuthenticationServiceView.extend({initialize:function($el){this._super($el);this.className=$("input[name=classname]",this.fieldset).textbox({required:true,onChange:$.proxy(this._onForm$Change,this),validType:"length[1,255]",missingMessage:window.R.string.AUTHENTICATION_ERROR_BAD_CLASS,invalidMessage:window.R.string.AUTHENTICATION_ERROR_BAD_CLASS,width:500});},getClassName:function(){return this.className.textbox("getValue");},setClassName:function(value){this.className.textbox("setValue",value);}});jscape.settings.MultipleAuthenticationServiceController=jscape.settings.BaseAuthenticationServiceController.extend({MIN_SERVICES_COUNT:2,MAX_SERVICES_COUNT:5,items:null,copy:null,initialize:function(){this._super(jscape.AuthenticationService.Type.MULTIPLE);this.view=new jscape.settings.MultipleAuthenticationServiceView(this.MIN_SERVICES_COUNT,this.MAX_SERVICES_COUNT);this.addController=new jscape.settings.AddMultipleAuthenticationServiceController();this.editController=new jscape.settings.EditMultipleAuthenticationServiceController();},start:function(config,roles){this.items=this._support(config)?[].concat(config.configurations):[];this.copy=this._copyItems(this.items);this.roles=roles||[];this.view.show(this);this.view.setItems(this.items);},resume:function(roles){this.roles=roles;this.view.show(this);},pause:function(){this.view.hide();},hasChanged:function(){return!Object._equals(this.copy,this.items);},onAdd:function(){return this.addController.start({onTest:$.proxy(function(data){return this.testController.start(this._createTestDescriptor(data,-1));},this)},undefined,this.roles).then($.proxy(function(data){this.items.push(data);this.view.setItems(this.items,this.items.length-1);},this));},onEdit:function(item){var index=$.inArray(item,this.items);if(index==-1){return $.Deferred().reject().promise();}
return this.editController.start({onTest:$.proxy(function(data){return this.testController.start(this._createTestDescriptor(data,index));},this)},item,this.roles).then($.proxy(function(data){this.items[index]=data;this.view.setItems(this.items,index);},this));},onDelete:function(items){return this._confirmDelete(items).then($.proxy(function(items){var index=-1;while(items.length){index=$.inArray(items.pop(),this.items);this.items.splice(index,1);}
if(this.items.length){index=Math.max(0,Math.min(index,this.items.length-1));}else{index=-1;}
this.view.setItems(this.items,index);},this,items));},onMoveUp:function(item){var index=$.inArray(item,this.items);if(index>0){this.items.splice(index-1,2,this.items[index],this.items[index-1]);this.view.setItems(this.items,index-1);}},onMoveDown:function(item){var index=$.inArray(item,this.items);if(index!=-1&&index<this.items.length-1){this.items.splice(index,2,this.items[index+1],this.items[index]);this.view.setItems(this.items,index+1);}},onApply:function(){if(!this.view.valid()){if(this.items.length<this.MIN_SERVICES_COUNT){this.view._showMinServicesCountError();}
return $.Deferred().reject().promise();}
return jscape.API.setManagementAuthenticationServiceConfiguration(this._createDescriptor()).done($.proxy(this._fireApplySuccess,this)).done($.proxy(function(){this.copy=this._copyItems(this.items);},this));},onDiscard:function(){this.items=$.map(this.copy,function(data){return jscape.AuthenticationService.fromJSON(data);});this.view.setItems(this.items);},_copyItems:function(items){return $.map(items,function(data){return jscape.AuthenticationService.fromJSON(data);});},_createTestDescriptor:function(data,index){var items=[].concat(this.items);if(index>=0&&index<items.length){items[index]=data;}else{items.push(data);}
return jscape.AuthenticationService.multiple(items);},_createDescriptor:function(){return jscape.AuthenticationService.multiple(this.items);},_confirmDelete:function(){return jscape.ConfirmDialog.confirm(window.R.string.AUTHENTICATION_CONFIRM_DELETE_TITLE,window.R.string.AUTHENTICATION_CONFIRM_DELETE_MESSAGE);}});jscape.settings.MultipleAuthenticationServiceView=jscape.ui.DatagridView.extend({initialize:function(minServicesCount,maxServicesCount){var initializing=true;this.minCount=parseInt(minServicesCount)||1;this.maxCount=parseInt(maxServicesCount)||1;this.fieldset=$("#multipleauthfields").layout({fit:true,border:false,doSize:false}).hide();this.data=$("table[role=grid][aria-label=multipleauthconfigs]",this.fieldset);this.data.datagrid({fit:true,fitColumns:true,singleSelect:false,remoteSort:false,columns:[[{field:"order",title:$("thead th:nth-child(1)",this.data).text(),width:"15%",formatter:$.proxy(this._formatOrder,this),styler:function(){return"font-weight:bold";}},{field:"type",title:$("thead th:nth-child(2)",this.data).text(),width:"85%",formatter:$.proxy(this._formatType,this)}]],onBeforeSelect:function(){return!$(this).datagrid("options").disabled;},onBeforeCheck:function(){return!$(this).datagrid("options").disabled;},onSelect:$.proxy(this._adjustButtonsState,this),onUnselect:$.proxy(this._adjustButtonsState,this),onUnselectAll:$.proxy(this._adjustButtonsState,this),onDblClickRow:$.proxy(this.onDblClick$Row,this),onRowContextMenu:$.proxy(this._onRow$ContextMenu,this),loader:$.proxy(this._onLoad$Data,this),onBeforeLoad:function(){return!initializing;},onLoadSuccess:$.proxy(this._adjustButtonsState,this)});this.moveUpButton=$("a[role=button][name=moveup]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$MoveUpButton,this)});this.moveDownButton=$("a[role=button][name=movedown]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$MoveDownButton,this)});this.addButton=$("a[role=button][name=add]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$AddButton,this)});this.editButton=$("a[role=button][name=edit]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$EditButton,this)});this.deleteButton=$("a[role=button][name=delete]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$DeleteButton,this)});initializing=false;},show:function(listener){this.listener=listener||jscape.settings.MultipleAuthenticationServiceView.LISTENER;this.fieldset.form("validate");this.fieldset.show().layout({height:"auto"});this._adjustButtonsState();},hide:function(){this.fieldset.hide();},valid:function(){var data=this.data.datagrid("getData");return data.length>=this.minCount&&data.length<=this.maxCount;},setItems:function(items,selectIndex){this.data.datagrid("loadData",items);this.data.datagrid("selectRow",selectIndex);this._onForm$Change();},_formatOrder:function(_,rowData,rowIndex){var values=(window.R.string.AUTHENTICATION_ORDER_FORMAT||"").split(",");return rowIndex<values.length?values[rowIndex]:"";},_formatType:function(value){return window.R.string["AUTHENTICATION_TYPE_"+(""+value).toUpperCase()]||"";},_onClick$AddButton:function(){if(this.data.datagrid("getData").length<this.maxCount){this.listener.onAdd();}else{this._showMaxServicesCountError();}},_onClick$EditButton:function(){this.listener.onEdit(this.selection[0]);},_onClick$DeleteButton:function(){this.listener.onDelete(this.selection);},_onClick$MoveUpButton:function(){this.listener.onMoveUp(this.selection[0]);},_onClick$MoveDownButton:function(){this.listener.onMoveDown(this.selection[0]);},onDblClick$Row:function(index,row){if($.inArray(row,this.selection)==-1||this.selection.length>1){this.data.datagrid("unselectAll").datagrid("selectRow",index);}
this.editButton.click();},_onLoad$Data:function(params,success,error){this.listener.onRefresh().done(success).fail(error);},_onForm$Change:function(){this.fieldset.closest("[role=group]").triggerHandler("_change");},_showContextMenu:function(e){this._super(e,[this.addButton,this.editButton,this.deleteButton,"-",this.moveUpButton,this.moveDownButton]);},_showMinServicesCountError:function(){$.messager.alert(window.R.string.APPLICATION_TITLE,window.R.string.AUTHENTICATION_ERROR_MULTIPLE_MIN_COUNT.supplant({0:this.minCount}),"error");},_showMaxServicesCountError:function(){$.messager.alert(window.R.string.APPLICATION_TITLE,window.R.string.AUTHENTICATION_ERROR_MULTIPLE_MAX_COUNT.supplant({0:this.maxCount}),"warning");},_adjustButtonsState:function(){this.selection=this.data.datagrid("getSelections");var selectionCount=this.selection.length;var totalRowsCount=this.data.datagrid("getRows").length;var index=selectionCount==1?this.data.datagrid("getRowIndex",this.selection[0]):-1;var disabled=this.fieldset.is(":disabled");this.moveUpButton.linkbutton(!disabled&&index>0&&index<=totalRowsCount-1?"enable":"disable");this.moveDownButton.linkbutton(!disabled&&index>=0&&index<totalRowsCount-1?"enable":"disable");this.addButton.linkbutton(!disabled?"enable":"disable");this.editButton.linkbutton(!disabled&&selectionCount==1?"enable":"disable");this.deleteButton.linkbutton(!disabled&&selectionCount!=0?"enable":"disable");}});jscape.settings.MultipleAuthenticationServiceView.LISTENER={onMoveUp:$.noop,onMoveDown:$.noop,onAdd:$.noop,onEdit:$.noop,onDelete:$.noop,onTest:$.noop};jscape.settings.ManagerMultipleAuthServiceController=Class.extend({initialize:function(){this.controllers={LOCAL:jscape.settings.LocalAuthenticationServiceController,DB:jscape.settings.DbAuthenticationServiceController,DB_QUERY:jscape.settings.DbQueryAuthenticationServiceController,LDAP:jscape.settings.LdapAuthenticationServiceController,LDAP_QUERY:jscape.settings.LdapQueryAuthenticationServiceController,NTLM:jscape.settings.NtlmAuthenticationServiceController,PAM:jscape.settings.PamAuthenticationServiceController,RADIUS:jscape.settings.RadiusAuthenticationServiceController,CUSTOM:jscape.settings.CustomAuthenticationServiceController};},start:function(listener,descriptor,roles){this.listener=listener||jscape.settings.ManagerMultipleAuthServiceController.LISTENER;this.roles=roles||[];this.deferred=$.Deferred();this._selectServiceType().then($.proxy(function(type){var theClass=this.controllers[type].extend({onTest:$.proxy(this.onTest,this)});var dialog=this._setupDialog(type,this.roles);this.controller=new theClass(dialog.container());this.controller.start(descriptor,roles);dialog.show(this);},this),$.proxy(function(){this.deferred.reject();},this));return this.deferred.promise();},onSubmit:function(dialog){var data=this.controller._createDescriptor();dialog.destroy();this.deferred.resolve(data);},onCancel:function(dialog){dialog.destroy();return this.deferred.reject();},onTest:function(){return this.listener.onTest(this.controller._createDescriptor());},onLoadRoles:function(){return $.Deferred().resolve(this.roles).promise();},_selectServiceType:function(){return $.Deferred().reject().promise();}});jscape.settings.ManagerMultipleAuthServiceController.LISTENER={onTest:$.noop};jscape.settings.ManagerMultipleAuthServiceDialog=jscape.ui.DefaultDialog.extend({initialize:function(dialog){this._super(dialog,{width:"60%",minWidth:750,height:"60%"});this.fieldset=this.dialog.find(".content").first().layout({fit:true,border:false,doSize:false});this.title=this.dialog.dialog("header").text()||"";},container:function(){return this.fieldset.layout("panel","center");},setServiceType:function(value){this.setTitle(this.title.supplant({0:window.R.string["AUTHENTICATION_TYPE_"+(""+value).toUpperCase()]||""}));},show:function(){this._super.apply(this,arguments);this.fieldset.layout("resize",{width:"auto",height:"auto"});this.fieldset.form("validate");setTimeout($.proxy(function(){this.fieldset.find(".validatebox-invalid").first().trigger("focusin");},this),50);}});jscape.settings.AddMultipleAuthenticationServiceController=jscape.settings.ManagerMultipleAuthServiceController.extend({_selectServiceType:function(){var deferred=$.Deferred();var dialog=new jscape.settings.MultipleAuthenticationServiceTypeDialog();dialog.show({onSubmit:$.proxy(function(d){var type=d.getType();d.destroy();deferred.resolve(type);},this),onCancel:$.proxy(function(d){d.destroy();deferred.reject();},this)});return deferred.promise();},_setupDialog:function(type){var dialog=new jscape.settings.ManagerMultipleAuthServiceDialog($("#d-auth-multi-service-add"));dialog.setServiceType(type);return dialog;}});jscape.settings.EditMultipleAuthenticationServiceController=jscape.settings.ManagerMultipleAuthServiceController.extend({start:function(listener,descriptor,roles){this.serviceType=descriptor.type;return this._super.apply(this,arguments);},_selectServiceType:function(){return $.Deferred().resolve(this.serviceType).promise();},_setupDialog:function(type){var dialog=new jscape.settings.ManagerMultipleAuthServiceDialog($("#d-auth-multi-service-edit"));dialog.setServiceType(type);return dialog;}});jscape.settings.MultipleAuthenticationServiceTypeDialog=jscape.ui.DefaultDialog.extend({initialize:function(){this._super($("#d-auth-service-type"),{width:"40%",minWidth:530,maxWidth:700});this.type=$("select[name=type]",this.dialog).combobox({required:true,limitToList:true,keyHandler:$.extend({},$.fn.combobox.defaults.keyHandler,{enter:$.proxy(function(e){$.fn.combobox.defaults.keyHandler.enter.call(e.data.target,e);if(!this.type.combobox("panel").is(":visible")){var okBtn=this.okButton;setTimeout(function(){okBtn.click();okBtn=undefined;},100);}},this)}),width:"60%",panelHeight:"auto",panelMaxHeight:"40%"});this.type.combobox("textbox").on("focus",function(){$(this).select();});},getType:function(){return this.type.combobox("getValue");}});jscape.settings.TestAuthenticationServiceController=Class.extend({deferred:null,start:function(descriptor){this.deferred=$.Deferred();this.descriptor=descriptor;this._createDialog().show(this);return this.deferred.promise();},onSubmit:function(dialog){var data=dialog.isUseToken()?{token:dialog.getToken()}:{login:dialog.getUsername(),password:dialog.getPassword(),ip:dialog.getClientIp()};return jscape.API.testManagementAuthenticationService(this.descriptor,data).done($.proxy(this._testPassed,this));},onCancel:function(dialog){dialog.destroy();this.deferred.reject();this.deferred=null;},_createDialog:function(){var dialog=new jscape.settings.TestAuthenticationServiceDialog();dialog.setUsePassword();return dialog;},_testPassed:function(){$.messager.alert(window.R.string.AUTHENTICATION_ERROR_TEST_TITLE,window.R.string.AUTHENTICATION_ERROR_TEST_SUCCESS_MESSAGE,"info");this.deferred.resolve();this.deferred=null;}});jscape.settings.TestAuthenticationServiceDialog=jscape.ui.DefaultDialog.extend({initialize:function(){this._super($("#d-test-auth-service"),{width:"40%",minWidth:530});this.fieldset=$("fieldset[name=testauthcredentialsfields]",this.dialog);this.types=$("input[name=type]:radio",this.fieldset).change($.proxy(this._adjustFieldState,this));this.typePassword=this.types.filter("[value=password]");this.typeToken=this.types.filter("[value=token]");this.username=$("input[name=username]",this.fieldset).textbox({width:"75%"});this.password=$("input[name=password]",this.fieldset).passwordbox2({width:"75%"});this.clientIp=$("input[name=clientip]",this.fieldset).textbox({width:"75%"});this.token=$("input[name=token]",this.fieldset).textbox({required:true,width:"75%"});},getUsername:function(){return this.username.textbox("getValue");},getPassword:function(){return this.password.passwordbox2("getValue");},getClientIp:function(){return this.clientIp.textbox("getValue");},getToken:function(){return this.isUseToken()?this.token.textbox("getValue"):null;},isUseToken:function(){return this.typeToken.is(":checked");},setUsePassword:function(){this.typePassword.prop("checked",true).change();},show:function(listener){this._super(listener);this._adjustFieldState();},_adjustFieldState:function(){var enabled=!this.isUseToken();this.username.textbox(enabled?"enable":"disable");this.password.passwordbox2(enabled?"enable":"disable");this.clientIp.textbox(enabled?"enable":"disable");this.token.textbox(this.isUseToken()?"enable":"disable");this.fieldset.form("validate");}});jscape.settings.MultiFactorAuthServiceController=Class.extend({DEFAULT_DESCRIPTOR:jscape.AdministratorConfirmationService.none(),view:null,type:null,descriptor:null,initialize:function(){this.controllers={};this.controllers[jscape.AdministratorConfirmationService.Type.NONE]=jscape.settings.NoneUserConfirmationServiceController;this.controllers[jscape.AdministratorConfirmationService.Type.TOTP]=jscape.settings.TotpUserConfirmationServiceController;},start:function(){if(this.view==null){this.view=new jscape.settings.TwoFactorAuthServiceServiceView();}
this.view.show(this);},resume:function(){this.view.refresh();},onLoadData:function(){return jscape.API.getManagementTwoFactorService().catch(function(){return this.DEFAULT_DESCRIPTOR;}).then($.proxy(function(descriptor){this.descriptor=descriptor;this._setupView(this.descriptor);},this));},onApply:function(){var c=this.controllers[this._serviceTypeOf(this.view)]||null;if(!c){return $.Deferred().reject().promise();}
return c.onApply().done($.proxy(function(descriptor){this.descriptor=descriptor;},this));},onDiscard:function(){var c=this.controllers[this._serviceTypeOf(this.view)]||null;c&&c.onDiscard();this._setupView(this.descriptor);},onChange:function(){var changed=this.hasChanged();return $.Deferred().resolve(changed).promise();},onChangeType:function(view){var serviceType=this._serviceTypeOf(view);$.each(this.controllers,$.proxy(function(type,controller){var t=typeof controller;if(serviceType===type){this.type=serviceType;if(t==="function"){this.controllers[type]=new controller(view.container());this.controllers[type].start(this.descriptor);}else if(t==="object"){controller.resume(this.descriptor);}}else{if(t==="object"){controller.pause();}}},this));},hasChanged:function(){var type=this.descriptor?this.descriptor.type:this.type;return type!=this._serviceTypeOf(this.view)||!!this._invokeMethod("hasChanged");},_serviceTypeOf:function(view){return view?(view.getType()||"").toUpperCase():"";},_setupView:function(descriptor){var type=descriptor&&descriptor.type?descriptor.type:this.DEFAULT_DESCRIPTOR.type;this.view.setType(type);},_invokeMethod:function(method){var c=this.controllers[this._serviceTypeOf(this.view)];return c&&typeof c==="object"&&c[method]?c[method].apply(c,Array.prototype.slice.call(arguments,1)):undefined;}});jscape.settings.TwoFactorAuthServiceServiceView=jscape.ui.FormView.extend({initialize:function(){this.fieldset=$("#manager-two-factor-auth-fields").layout({fit:true,doSize:false,border:false});this.type=$("select[name=type]",this.fieldset).combobox({required:true,editable:false,selectOnNavigation:false,onChange:$.proxy(this._onChange$Type,this),width:"25%",minWidth:300,panelHeight:"auto",panelMinHeight:50,panelMaxHeight:"40%"});this.applyButton=$("a[role=button][name=apply]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$ApplyButton,this)});this.discardButton=$("a[role=button][name=discard]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$DiscardButton,this)});this._bindEvents(this.fieldset);},container:function(){return this.fieldset.layout("panel","center");},show:function(listener){this.listener=listener||jscape.settings.TwoFactorAuthServiceServiceView.LISTENER;},refresh:function(){this.listener.onLoadData();},getType:function(){return this.type.combobox("getValue");},setType:function(value){var selectedType=this.type.combobox("getValue");this.type.combobox("clear").combobox("select",value);if(selectedType===value){this._onChange$Type();}},_onChange$Type:function(){this.listener.onChangeType(this);this.fieldset.triggerHandler("_change");},_onClick$ApplyButton:function(){this.applyButton.linkbutton("disable");this.listener.onApply(this).catch($.proxy(function(){this.applyButton.linkbutton("enable");},this));},_onClick$DiscardButton:function(){this.listener.onDiscard(this);},_onForm$Change:function(){this.listener.onChange(this).done($.proxy(function(modified){this.applyButton.linkbutton(modified?"enable":"disable");},this));}});jscape.settings.TwoFactorAuthServiceServiceView.LISTENER={onLoadData:$.noop,onChangeType:$.noop,onChange:$.noop,onApply:$.noop,onDiscard:$.noop};jscape.settings.NoneUserConfirmationServiceController=jscape.settings.BaseAuthenticationServiceController.extend({initialize:function(){this._super(jscape.AdministratorConfirmationService.Type.NONE);this.view=new jscape.settings.NoneAuthServiceView();},_createDescriptor:function(){return jscape.AdministratorConfirmationService.none();},onApply:function(){return jscape.API.setManagementTwoFactorService(this._createDescriptor()).done($.proxy(function(descriptor){this.descriptor=descriptor;this._fireApplySuccess();},this));}});jscape.settings.TotpUserConfirmationServiceController=jscape.settings.BaseAuthenticationServiceController.extend({initialize:function(){this._super(jscape.AdministratorConfirmationService.Type.TOTP);this.view=new jscape.settings.TotpUserConfirmationServiceControllerView();},onApply:function(){if(!this.view.valid()){return $.Deferred().reject().promise();}
return jscape.API.setManagementTwoFactorService(this._createDescriptor()).done($.proxy(function(descriptor){this.descriptor=descriptor;this._setupView(descriptor);this._fireApplySuccess();},this));},_createDescriptor:function(){return jscape.AdministratorConfirmationService.totp();},_setupView:function(descriptor){}});jscape.settings.TotpUserConfirmationServiceControllerView=jscape.settings.BaseAuthenticationServiceView.extend({initialize:function(){this._super($("#totpuserconfirmfields"));}});jscape.settings.WebSsoAuthServiceController=Class.extend({DEFAULT_DESCRIPTOR:jscape.AuthenticationService.none(),view:null,currentType:null,roles:null,descriptor:null,initialize:function(){this.controllers={};this.controllers[jscape.WebSsoService.Type.NONE]=jscape.settings.NoneWebSsoAuthServiceController;this.controllers[jscape.WebSsoService.Type.OPEN_ID]=jscape.settings.OpenIdAuthServiceController;this.controllers[jscape.WebSsoService.Type.OPEN_ID_CONNECT]=jscape.settings.OpenIdConnectAuthServiceController;this.controllers[jscape.WebSsoService.Type.SAML]=jscape.settings.SamlAuthServiceController;},start:function(){if(this.view==null){this.view=new jscape.settings.WebSsoAuthServiceView();}
this.view.show(this);},resume:function(){this.view.refresh();},onLoadData:function(){return $.when(jscape.API.getManagementWebSsoService(),jscape.API.getManagementRoles()).done($.proxy(function(descriptor,roles){this.descriptor=descriptor;this.roles=roles||[];},this)).fail($.proxy(function(){this.descriptor=this.DEFAULT_DESCRIPTOR;this.roles=[];},this)).always($.proxy(function(){this.view&&this._setupView(this.descriptor);},this));},onApply:function(){var c=this.controllers[this._serviceTypeOf(this.view)]||null;if(!c){return $.Deferred().reject().promise();}
return c.onApply().done($.proxy(function(descriptor){this.descriptor=descriptor;},this));},onDiscard:function(){var c=this.controllers[this._serviceTypeOf(this.view)]||null;c&&c.onDiscard();this._setupView(this.descriptor);},onChange:function(){return $.Deferred().resolve(this.hasChanged()).promise();},onChangeType:function(view){var serviceType=this._serviceTypeOf(view);$.each(this.controllers,$.proxy(function(type,controller){var t=typeof controller;if(serviceType===type){this.currentType=serviceType;if(t==="function"){this.controllers[type]=new controller(view.container());this.controllers[type].start(this.descriptor,this.roles);}else if(t==="object"){controller.resume(this.descriptor,this.roles);}}else{if(t==="object"){controller.pause();}}},this));},onChangeRoles:function(roles){this.roles=roles||[];this._invokeMethod("setRoles",this.roles);},hasChanged:function(){var type=this.descriptor?this.descriptor.type:this.currentType;return type!=this._serviceTypeOf(this.view)||!!this._invokeMethod("hasChanged");},_serviceTypeOf:function(view){return view?(view.getType()||"").toUpperCase():"";},_setupView:function(descriptor){var type=descriptor&&descriptor.type?descriptor.type:this.DEFAULT_DESCRIPTOR.type;this.view.setType(type);},_invokeMethod:function(method){var c=this.controllers[this._serviceTypeOf(this.view)];return c&&typeof c==="object"&&c[method]?c[method].apply(c,Array.prototype.slice.call(arguments,1)):undefined;}});jscape.settings.WebSsoAuthServiceView=jscape.ui.FormView.extend({initialize:function(){this.fieldset=$("#manager-web-sso-auth-fields").layout({fit:true,doSize:false,border:false});this.type=$("select[name=type]",this.fieldset).combobox({required:true,editable:false,selectOnNavigation:false,onChange:$.proxy(this._onChange$Type,this),width:"25%",minWidth:300,panelHeight:"auto",panelMinHeight:80,panelMaxHeight:"40%"});this.applyButton=$("a[role=button][name=apply]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$ApplyButton,this)});this.discardButton=$("a[role=button][name=discard]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$DiscardButton,this)});this._bindEvents(this.fieldset);},container:function(){return this.fieldset.layout("panel","center");},show:function(listener){this.listener=listener||jscape.settings.WebSsoAuthServiceView.LISTENER;},refresh:function(){this.listener.onLoadData();},getType:function(){return this.type.combobox("getValue");},setType:function(value){var selectedType=this.type.combobox("getValue");this.type.combobox("clear").combobox("select",value);if(selectedType===value){this._onChange$Type();}},_onChange$Type:function(){this.listener.onChangeType(this);this.fieldset.triggerHandler("_change");},_onClick$ApplyButton:function(){this.applyButton.linkbutton("disable");this.listener.onApply(this).catch($.proxy(function(){this.applyButton.linkbutton("enable");},this));},_onClick$DiscardButton:function(){this.listener.onDiscard(this);},_onForm$Change:function(){this.listener.onChange(this).done($.proxy(function(modified){this.applyButton.linkbutton(modified?"enable":"disable");},this));}});jscape.settings.WebSsoAuthServiceView.LISTENER={onLoadData:$.noop,onChangeType:$.noop,onChange:$.noop,onApply:$.noop,onDiscard:$.noop};jscape.settings.NoneWebSsoAuthServiceController=jscape.settings.BaseAuthenticationServiceController.extend({initialize:function(){this._super(jscape.WebSsoService.Type.NONE);this.view=new jscape.settings.NoneAuthServiceView();},_createDescriptor:function(){return jscape.WebSsoService.none();},onApply:function(){return jscape.API.setManagementWebSsoService(this._createDescriptor()).done($.proxy(function(descriptor){this.descriptor=descriptor;this._fireApplySuccess();},this));}});jscape.settings.SamlAuthServiceController=jscape.settings.BaseAuthenticationServiceController.extend({decryptionKeys:null,hostKeys:null,initialize:function(){this._super(jscape.WebSsoService.Type.SAML);this.view=new jscape.settings.SamlAuthServiceView();},start:function(){this.decryptionKeys=[];this.hostKeys=[];this._super.apply(this,arguments);},onApply:function(){if(!this.view.valid()){return $.Deferred().reject().promise();}
return jscape.API.setManagementWebSsoService(this._createDescriptor()).done($.proxy(function(descriptor){this.descriptor=descriptor;this._setupView(descriptor);this._fireApplySuccess();},this));},onLoadDecryptionKeys:function(){if(this.decryptionKeys.length){return $.Deferred().resolve(this.decryptionKeys).promise();}
return jscape.API.getServerKeys().then(function(keys){return $.map(keys,function(key){return key.name;});}).done($.proxy(function(names){this.decryptionKeys=names;},this));},onLoadHostKeys:function(){if(this.hostKeys.length){return $.Deferred().resolve(this.hostKeys).promise();}
return jscape.API.getHostCertificates().then(function(certificates){return $.map(certificates,function(c){return c.name;});}).done($.proxy(function(names){this.hostKeys=names;},this));},_createDescriptor:function(){return jscape.WebSsoService.saml(this.view.getSignInUrl(),this.view.getSignOutUrl(),this.view.getChangePasswordUrl(),this.view.getDecryptionKey(),this.view.getHostKey(),this.view.getNameIdFormat(),this.view.isNonSsoLoginAllowed(),this.view.getRole(),this.view.getUsernameConversion());},_setupView:function(data){if(data&&data.type==jscape.WebSsoService.Type.SAML&&data.samlData){data=data.samlData;this.view.setSignInUrl(data.signInUrl);this.view.setSignOutUrl(data.signOutUrl);this.view.setChangePasswordUrl(data.changePasswordUrl);this.view.setDecryptionKey(data.decryptionKey);this.view.setHostKey(data.verificationHostKey);this.view.setNameIdFormat(data.nameIdFormat);this.view.setNonSsoLoginAllowed(data.nonSsoLoginAllowed);this.view.setRole(data.role);this.view.setUsernameConversion(data.usernameConversion);}}});jscape.settings.SamlAuthServiceView=jscape.settings.BaseAuthenticationServiceView.extend({initialize:function(){this._super($("#webssoauthsamlfields"));var initializing=true;this.signInUrl=$("input[name=signinurl]",this.fieldset).textbox({required:true,validType:"length[1,500]",onChange:$.proxy(this._onForm$Change,this),missingMessage:window.R.string.AUTH_ERROR_BAD_SIGNIN_URL,invalidMessage:window.R.string.AUTH_ERROR_BAD_SIGNIN_URL,width:610});this.signOutUrl=$("input[name=signouturl]",this.fieldset).textbox({required:true,validType:"length[1,500]",onChange:$.proxy(this._onForm$Change,this),missingMessage:window.R.string.AUTH_ERROR_BAD_SIGNOUT_URL,invalidMessage:window.R.string.AUTH_ERROR_BAD_SIGNOUT_URL,width:610});this.changePasswordUrl=$("input[name=changepwdurl]",this.fieldset).textbox({onChange:$.proxy(this._onForm$Change,this),width:610});this.nonSsoLoginAllowed=$("input[name=allownonsso]:checkbox",this.fieldset);this.useDecryptionKey=$("input[name=usedecryptionkey]:checkbox",this.fieldset).change($.proxy(function(){this.decryptionKey.combobox(this.useDecryptionKey.is(":checked")?"enable":"disable");},this));this.decryptionKey=$("select[name=decryptionkey]",this.fieldset).combobox({editable:false,disabled:true,loader:$.proxy(this._onLoad$DecryptionKeys,this),onBeforeLoad:function(){return!initializing;},onLoadSuccess:$.proxy(this._onLoadSuccess$DecryptionKey,this),onChange:$.proxy(this._onForm$Change,this),width:250,panelHeight:"auto",panelMinHeight:80,panelMaxHeight:"40%"});this.hostKey=$("select[name=hostkey]",this.fieldset);this.hostKey.combobox({required:true,editable:false,onChange:$.proxy(this._onForm$Change,this),loader:$.proxy(this._onLoad$HostKeys,this),onBeforeLoad:function(){return!initializing;},onLoadSuccess:$.proxy(this._onLoadSuccess$HostKey,this),width:250,panelHeight:"auto",panelMinHeight:150,panelMaxHeight:"40%"});this.nameIdFormat=$("select[name=nameidformat]",this.fieldset).combobox({required:true,editable:false,onChange:$.proxy(this._onForm$Change,this),width:250,panelHeight:"auto",panelMaxHeight:"40%"});initializing=false;},show:function(){this._super.apply(this,arguments);this.decryptionKey.combobox("reload").combobox("resize");this.hostKey.combobox("reload").combobox("resize");this.nameIdFormat.combobox("resize");},getSignInUrl:function(){return this.signInUrl.textbox("getValue");},setSignInUrl:function(value){this.signInUrl.textbox("setValue",value);},getSignOutUrl:function(){return this.signOutUrl.textbox("getValue");},setSignOutUrl:function(value){this.signOutUrl.textbox("setValue",value);},getChangePasswordUrl:function(){return this.changePasswordUrl.textbox("getValue");},setChangePasswordUrl:function(value){this.changePasswordUrl.textbox("setValue",value);},getDecryptionKey:function(){return this.useDecryptionKey.is(":checked")?this.decryptionKey.combobox("getValue"):null;},setDecryptionKey:function(value){this.useDecryptionKey.prop("checked",!!value).change();if(value){this.decryptionKey.combobox("clear").combobox("select",value)}},getHostKey:function(){return this.hostKey.combobox("getValue");},setHostKey:function(value){this.hostKey.combobox("setValue",value);},getNameIdFormat:function(){return this.nameIdFormat.combobox("getValue");},setNameIdFormat:function(value){value&&this.nameIdFormat.combobox("select",value);},isNonSsoLoginAllowed:function(){return this.nonSsoLoginAllowed.is(":checked");},setNonSsoLoginAllowed:function(value){this.nonSsoLoginAllowed.prop("checked",!!value).change();},_onLoad$HostKeys:function(params,success,error){this.listener&&this.listener.onLoadHostKeys().done(success).fail(error);},_onLoadSuccess$HostKey:function(data){if(data&&data.length==0){this.hostKey.combobox("disable").combobox("disableValidation");}},_onLoad$DecryptionKeys:function(params,success,error){this.listener&&this.listener.onLoadDecryptionKeys().done(success).fail(error);},_onLoadSuccess$DecryptionKey:function(data){if(data&&data.length){this.useDecryptionKey.prop("disabled",false).change();}else{this.decryptionKey.combobox("clear");this.useDecryptionKey.prop("checked",false).prop("disabled",true).change();}}});jscape.settings.OpenIdAuthServiceController=jscape.settings.BaseAuthenticationServiceController.extend({initialize:function(){this._super(jscape.WebSsoService.Type.OPEN_ID);this.view=new jscape.settings.OpenIdAuthServiceView();},onApply:function(){if(!this.view.valid()){return $.Deferred().reject().promise();}
return jscape.API.setManagementWebSsoService(this._createDescriptor()).done($.proxy(function(descriptor){this.descriptor=descriptor;this._setupView(descriptor);this._fireApplySuccess();},this));},_createDescriptor:function(){return jscape.WebSsoService.openId(this.view.getSignInUrl(),this.view.getSignOutUrl(),this.view.isNonSsoLoginAllowed(),this.view.getRole(),this.view.getUsernameConversion());},_setupView:function(data){if(data&&data.type==jscape.WebSsoService.Type.OPEN_ID&&data.openIdData){data=data.openIdData;this.view.setSignInUrl(data.signInUrl);this.view.setSignOutUrl(data.signOutUrl);this.view.setNonSsoLoginAllowed(data.nonSsoLoginAllowed);this.view.setRole(data.role);this.view.setUsernameConversion(data.usernameConversion);}}});jscape.settings.OpenIdAuthServiceView=jscape.settings.BaseAuthenticationServiceView.extend({initialize:function(){this._super($("#webssoauthopenidfields"));this.signInUrl=$("input[name=signinurl]",this.fieldset).textbox({required:true,validType:"length[1,500]",onChange:$.proxy(this._onForm$Change,this),missingMessage:window.R.string.AUTH_ERROR_BAD_SIGNIN_URL,invalidMessage:window.R.string.AUTH_ERROR_BAD_SIGNIN_URL,width:610});this.signOutUrl=$("input[name=signouturl]",this.fieldset).textbox({required:true,validType:"length[1,500]",onChange:$.proxy(this._onForm$Change,this),missingMessage:window.R.string.AUTH_ERROR_BAD_SIGNOUT_URL,invalidMessage:window.R.string.AUTH_ERROR_BAD_SIGNOUT_URL,width:610});this.nonSsoLoginAllowed=$("input[name=allownonsso]:checkbox",this.fieldset);},getSignInUrl:function(){return this.signInUrl.textbox("getValue");},setSignInUrl:function(value){this.signInUrl.textbox("setValue",value);},getSignOutUrl:function(){return this.signOutUrl.textbox("getValue");},setSignOutUrl:function(value){this.signOutUrl.textbox("setValue",value);},isNonSsoLoginAllowed:function(){return this.nonSsoLoginAllowed.is(":checked");},setNonSsoLoginAllowed:function(value){this.nonSsoLoginAllowed.prop("checked",!!value).change();}});jscape.settings.OpenIdConnectAuthServiceController=jscape.settings.BaseAuthenticationServiceController.extend({initialize:function(){this._super(jscape.WebSsoService.Type.OPEN_ID_CONNECT);this.view=new jscape.settings.OpenIdConnectAuthServiceView();},onApply:function(){if(!this.view.valid()){return $.Deferred().reject().promise();}
return jscape.API.setManagementWebSsoService(this._createDescriptor()).done($.proxy(function(descriptor){this.descriptor=descriptor;this._setupView(descriptor);this._fireApplySuccess();},this));},_createDescriptor:function(){return jscape.WebSsoService.openIdConnect(this.view.getSignInUrl(),this.view.getTokenUrl(),this.view.getRedirectionUrl(),this.view.getClientId(),this.view.getClientSecret(),this.view.isNonSsoLoginAllowed(),this.view.getRole(),this.view.getUsernameConversion());},_setupView:function(data){if(data&&data.type==jscape.WebSsoService.Type.OPEN_ID_CONNECT&&data.openIdConnectData){data=data.openIdConnectData;this.view.setSignInUrl(data.signInUrl);this.view.setTokenUrl(data.tokenVerificationUrl);this.view.setRedirectionUrl(data.redirectionUrl);this.view.setClientId(data.clientId);this.view.setClientSecret(data.clientSecret);this.view.setNonSsoLoginAllowed(data.nonSsoLoginAllowed);this.view.setRole(data.role);this.view.setUsernameConversion(data.usernameConversion);}}});jscape.settings.OpenIdConnectAuthServiceView=jscape.settings.BaseAuthenticationServiceView.extend({initialize:function(){this._super($("#webssoauthopenidconnectfields"));this.signInUrl=$("input[name=signinurl]",this.fieldset).textbox({required:true,validType:"url",onChange:$.proxy(this._onForm$Change,this),missingMessage:window.R.string.AUTH_ERROR_BAD_SIGNIN_URL,invalidMessage:window.R.string.AUTH_ERROR_BAD_SIGNIN_URL,width:610});this.tokenUrl=$("input[name=tokenurl]",this.fieldset).textbox({required:true,validType:"url",onChange:$.proxy(this._onForm$Change,this),missingMessage:window.R.string.AUTH_ERROR_BAD_TOKEN_URL,invalidMessage:window.R.string.AUTH_ERROR_BAD_TOKEN_URL,width:610});this.redirectionUrl=$("input[name=redirectionurl]",this.fieldset).textbox({required:false,validType:["url","non_empty"],onChange:$.proxy(this._onForm$Change,this),missingMessage:window.R.string.AUTH_ERROR_BAD_REDIRECTION_URL,width:610});this.clientId=$("input[name=clientid]",this.fieldset).textbox({required:true,validType:"length[1,255]",onChange:$.proxy(this._onForm$Change,this),missingMessage:window.R.string.AUTH_ERROR_BAD_CLIENT_ID,invalidMessage:window.R.string.AUTH_ERROR_BAD_CLIENT_ID,width:510});this.clientSecret=$("input[name=clientsecret]",this.fieldset).passwordbox2({required:true,validType:"length[1,255]",onChange:$.proxy(this._onForm$Change,this),missingMessage:window.R.string.AUTH_ERROR_BAD_CLIENT_SECRET,invalidMessage:window.R.string.AUTH_ERROR_BAD_CLIENT_SECRET,width:510});this.nonSsoLoginAllowed=$("input[name=allownonsso]:checkbox",this.fieldset);},getSignInUrl:function(){return this.signInUrl.textbox("getValue");},setSignInUrl:function(value){this.signInUrl.textbox("setValue",value);},getTokenUrl:function(){return this.tokenUrl.textbox("getValue");},setTokenUrl:function(value){this.tokenUrl.textbox("setValue",value);},getRedirectionUrl:function(){return this.redirectionUrl.textbox("getValue");},setRedirectionUrl:function(value){this.redirectionUrl.textbox("setValue",value);},getClientId:function(){return this.clientId.textbox("getValue");},setClientId:function(value){this.clientId.textbox("setValue",value);},getClientSecret:function(){return this.clientSecret.passwordbox2("getValue");},setClientSecret:function(value){this.clientSecret.passwordbox2("setValue",value);},isNonSsoLoginAllowed:function(){return this.nonSsoLoginAllowed.is(":checked");},setNonSsoLoginAllowed:function(value){this.nonSsoLoginAllowed.prop("checked",!!value).change();}});