/* Copyright Â© 2009-2024. Redwood Software Inc. All rights reserved. */
jscape.domain=jscape.domain||{};jscape.ResourceDescriptor=Class.extend({initialize:function(a,b,c,d,e,f,g,h,i,j,k,l,m){this.name=a||"";this.protocol=b||null;this.host=c||"";this.port=parseInt(d)||null;this.timeout=parseInt(e)||null;this.username=f!==undefined?f:null;this.password=g!==undefined?g:null;this.usingCredentials=h||false;this.remoteDirectory=i||null;this.logDirectory=j||null;this.timeToLive=parseInt(k)||null;this.tags=l||[];this.proxyData=m||null;}});jscape.ResourceDescriptor.fromJSON=function(data){var remoteDir=jscape.RemoteDirectory.fromJSON(data.remoteDirectory);if(data.protocol==jscape.ResourceDescriptor.Protocol.WEBDAV){return jscape.ResourceDescriptor.webdav(data.name,data.host,data.port,data.domain,data.path,!!data.useSsl,data.username,undefined,data.usingCredentials,remoteDir,data.logDirectory,data.tags);}else{var proxyData=jscape.ProxyData.fromJSON(data.proxyData);var keyProvider=jscape.KeyProvider.fromJSON(data.keyProvider);var hostKeyProvider=jscape.KeyProvider.fromJSON(data.hostKeyProvider);if(data.protocol==jscape.ResourceDescriptor.Protocol.AFTP){return jscape.ResourceDescriptor.aftp(data.name,data.host,data.port,data.timeout,data.tcpNoDelayEnabled,data.securityMode,data.username,undefined,data.usingCredentials,keyProvider,hostKeyProvider,remoteDir,data.downloadRate,data.uploadRate,data.congestionControlEnabled,data.logDirectory,data.timeToLive,data.tags);}else if(data.protocol==jscape.ResourceDescriptor.Protocol.AGENT){return jscape.ResourceDescriptor.agent(data.name,data.agentName,remoteDir,data.tags);}else if(data.protocol==jscape.ResourceDescriptor.Protocol.FTP){return jscape.ResourceDescriptor.ftp(data.name,data.host,data.port,data.timeout,data.tcpNoDelayEnabled,data.connectionType,data.passive,data.username,undefined,data.usingCredentials,keyProvider,hostKeyProvider,remoteDir,data.logDirectory,data.timeToLive,data.tags);}else if(data.protocol==jscape.ResourceDescriptor.Protocol.SFTP){return jscape.ResourceDescriptor.sftp(data.name,data.host,data.port,data.timeout,data.tcpNoDelayEnabled,data.useAdaptiveConnection,data.startSubsystemReplyRequired,data.username,undefined,data.publicKeyAlgorithm,data.usingCredentials,keyProvider,hostKeyProvider,remoteDir,data.logDirectory,data.timeToLive,data.tags,proxyData);}else if(data.protocol==jscape.ResourceDescriptor.Protocol.AMAZON_S3){return jscape.ResourceDescriptor.amazonS3(data.name,data.encryptionType,data.kmsKeyId,data.username,undefined,data.authenticationType,data.region,data.requesterPaymentRequired,remoteDir,data.logDirectory,data.tags);}else if(data.protocol==jscape.ResourceDescriptor.Protocol.AMAZON_S3_COMPATIBLE){return jscape.ResourceDescriptor.amazonS3Compatible(data.name,data.endPoint,data.username,undefined,data.region,remoteDir,data.logDirectory,data.tags);}else if(data.protocol==jscape.ResourceDescriptor.Protocol.REST){return jscape.ResourceDescriptor.rest(data.name,data.host,data.port,data.timeout,data.sslRequired,data.domain,data.username,undefined,data.usingCredentials,keyProvider,remoteDir,data.logDirectory,data.timeToLive,data.tags);}else if(data.protocol==jscape.ResourceDescriptor.Protocol.TFTP){return jscape.ResourceDescriptor.tftp(data.name,data.host,data.port,data.retransmitTimeout,data.maxRetransmitAttempts,data.logDirectory,data.tags);}else if(data.protocol==jscape.ResourceDescriptor.Protocol.SMB){return jscape.ResourceDescriptor.smb(data.name,data.host,data.port,data.timeout,data.domain,data.username,undefined,data.usingCredentials,remoteDir,data.logDirectory,data.tags);}else if(data.protocol==jscape.ResourceDescriptor.Protocol.GOOGLE_STORAGE){return jscape.ResourceDescriptor.googleStorage(data.name,data.authenticationType,data.credentialsFile,data.credentialsData,remoteDir,data.logDirectory,data.tags);}else if(data.protocol==jscape.ResourceDescriptor.Protocol.GOOGLE_DRIVE){return jscape.ResourceDescriptor.googleDrive(data.name,data.credentialsFile,data.credentialsData,remoteDir,data.logDirectory,data.tags);}else if(data.protocol==jscape.ResourceDescriptor.Protocol.MICROSOFT_AZURE_FILE_STORAGE){return jscape.ResourceDescriptor.microsoftAzureFileStorage(data.name,data.username,undefined,data.authenticationType,data.endPointSuffix,data.sslRequired,remoteDir,data.logDirectory,data.tags);}else if(data.protocol==jscape.ResourceDescriptor.Protocol.MICROSOFT_AZURE_BLOB_STORAGE){return jscape.ResourceDescriptor.microsoftAzureBlobStorage(data.name,data.username,undefined,data.authenticationType,data.endPointSuffix,data.sslRequired,remoteDir,data.logDirectory,data.tags);}else if(data.protocol==jscape.ResourceDescriptor.Protocol.MICROSOFT_AZURE_DATA_LAKE){return jscape.ResourceDescriptor.microsoftAzureDataLake(data.name,data.username,undefined,data.tenantId,data.accountFqdn,data.usingCredentials,remoteDir,data.logDirectory,data.tags);}else if(data.protocol==jscape.ResourceDescriptor.Protocol.MICROSOFT_AZURE_DATA_LAKE_2){return jscape.ResourceDescriptor.microsoftAzureDataLake2(data.name,data.username,undefined,data.endPointSuffix,data.authenticationType,remoteDir,data.logDirectory,data.tags);}else if(data.protocol==jscape.ResourceDescriptor.Protocol.MICROSOFT_ONEDRIVE){return jscape.ResourceDescriptor.microsoftOneDrive(data.name,data.directoryId,data.clientId,data.clientSecret,data.username,data.userRootDriveAccessRequired,remoteDir,data.logDirectory,data.tags);}else if(data.protocol==jscape.ResourceDescriptor.Protocol.BOX){return jscape.ResourceDescriptor.box(data.name,data.credentialsFile,data.credentialsData,remoteDir,data.logDirectory,data.tags);}else if(data.protocol==jscape.ResourceDescriptor.Protocol.DROPBOX){return jscape.ResourceDescriptor.dropbox(data.name,data.accessToken,remoteDir,data.logDirectory,data.tags);}else if(data.protocol==jscape.ResourceDescriptor.Protocol.IBM_CLOUD){return jscape.ResourceDescriptor.ibmCloud(data.name,data.username,undefined,data.endPoint,remoteDir,data.logDirectory,data.tags);}}
throw"Unknown resource type: "+(data&&data.protocol);};jscape.ResourceDescriptor.aftp=function(name,host,port,timeout,tcpNoDelay,securityMode,username,password,usingCredentials,keyProvider,hostKeyProvider,remoteDir,downloadRate,uploadRate,congestionControlEnabled,logDir,timeToLive,tags){return $.extend(new jscape.ResourceDescriptor(name,jscape.ResourceDescriptor.Protocol.AFTP,host,port,timeout,username,password,usingCredentials,remoteDir,logDir,timeToLive,tags),{downloadRate:parseInt(downloadRate)||0,uploadRate:parseInt(uploadRate)||0,congestionControlEnabled:!!congestionControlEnabled,tcpNoDelayEnabled:!!tcpNoDelay,securityMode:securityMode,keyProvider:keyProvider,hostKeyProvider:hostKeyProvider});};jscape.ResourceDescriptor.agent=function(name,agentName,remoteDir,tags){return $.extend(new jscape.ResourceDescriptor(name,jscape.ResourceDescriptor.Protocol.AGENT),{agentName:agentName,remoteDirectory:remoteDir,tags:tags});};jscape.ResourceDescriptor.ftp=function(name,host,port,timeout,tcpNoDelay,connectionType,passive,username,password,usingCredentials,keyProvider,hostKeyProvider,remoteDir,logDir,timeToLive,tags){return $.extend(new jscape.ResourceDescriptor(name,jscape.ResourceDescriptor.Protocol.FTP,host,port,timeout,username,password,usingCredentials,remoteDir,logDir,timeToLive,tags),{tcpNoDelayEnabled:!!tcpNoDelay,connectionType:connectionType,passive:!!passive,keyProvider:keyProvider,hostKeyProvider:hostKeyProvider});};jscape.ResourceDescriptor.sftp=function(name,host,port,timeout,tcpNoDelay,useAdaptiveConnection,startSubsystemReplyRequired,username,password,publicKeyAlgorithm,usingCredentials,keyProvider,hostKeyProvider,remoteDir,logDir,timeToLive,tags,proxyData){return $.extend(new jscape.ResourceDescriptor(name,jscape.ResourceDescriptor.Protocol.SFTP,host,port,timeout,username,password,usingCredentials,remoteDir,logDir,timeToLive,tags,proxyData),{tcpNoDelayEnabled:!!tcpNoDelay,useAdaptiveConnection:!!useAdaptiveConnection,startSubsystemReplyRequired:!!startSubsystemReplyRequired,publicKeyAlgorithm:publicKeyAlgorithm||null,keyProvider:keyProvider,hostKeyProvider:hostKeyProvider});};jscape.ResourceDescriptor.webdav=function(name,host,port,domain,path,useSsl,username,password,usingCredentials,remoteDir,logDir,tags){return $.extend(new jscape.ResourceDescriptor(name,jscape.ResourceDescriptor.Protocol.WEBDAV,host,port,undefined,username,password,usingCredentials,remoteDir,logDir,null,tags),{domain:domain,path:path,useSsl:!!useSsl});};jscape.ResourceDescriptor.amazonS3=function(name,encryptionType,kmsKey,username,password,authenticationType,region,paymentRequired,remoteDir,logDir,tags){return $.extend(new jscape.ResourceDescriptor(name,jscape.ResourceDescriptor.Protocol.AMAZON_S3,undefined,undefined,undefined,username,password,undefined,remoteDir,logDir,null,tags),{encryptionType:encryptionType||"NONE",kmsKeyId:kmsKey,authenticationType:authenticationType,region:region,requesterPaymentRequired:!!paymentRequired});};jscape.ResourceDescriptor.amazonS3Compatible=function(name,endPoint,username,password,region,remoteDir,logDir,tags){return $.extend(new jscape.ResourceDescriptor(name,jscape.ResourceDescriptor.Protocol.AMAZON_S3_COMPATIBLE,undefined,undefined,undefined,username,password,undefined,remoteDir,logDir,null,tags),{endPoint:endPoint,region:region});};jscape.ResourceDescriptor.googleStorage=function(name,authenticationType,keyFile,credentialsData,remoteDir,logDir,tags){return $.extend(new jscape.ResourceDescriptor(name,jscape.ResourceDescriptor.Protocol.GOOGLE_STORAGE,undefined,undefined,undefined,undefined,undefined,undefined,remoteDir,logDir,null,tags),{authenticationType:authenticationType,credentialsFile:keyFile,credentialsData:credentialsData});};jscape.ResourceDescriptor.googleDrive=function(name,keyFile,credentialsData,remoteDir,logDir,tags){return $.extend(new jscape.ResourceDescriptor(name,jscape.ResourceDescriptor.Protocol.GOOGLE_DRIVE,undefined,undefined,undefined,undefined,undefined,undefined,remoteDir,logDir,null,tags),{credentialsFile:keyFile,credentialsData:credentialsData});};jscape.ResourceDescriptor.microsoftAzureDataLake=function(name,username,password,tenantId,azureAccount,usingCredentials,remoteDir,logDir,tags){return $.extend(new jscape.ResourceDescriptor(name,jscape.ResourceDescriptor.Protocol.MICROSOFT_AZURE_DATA_LAKE,undefined,undefined,undefined,username,password,usingCredentials,remoteDir,logDir,null,tags),{tenantId:tenantId||"",accountFqdn:azureAccount||""});};jscape.ResourceDescriptor.microsoftAzureDataLake2=function(name,username,password,endpoint,authenticationType,remoteDir,logDir,tags){return $.extend(new jscape.ResourceDescriptor(name,jscape.ResourceDescriptor.Protocol.MICROSOFT_AZURE_DATA_LAKE_2,undefined,undefined,undefined,username,password,undefined,remoteDir,logDir,null,tags),{endPointSuffix:endpoint||"",authenticationType:authenticationType});};jscape.ResourceDescriptor.microsoftAzureFileStorage=function(name,username,password,authenticationType,endPointSuffix,sslRequired,remoteDir,logDir,tags){return $.extend(new jscape.ResourceDescriptor(name,jscape.ResourceDescriptor.Protocol.MICROSOFT_AZURE_FILE_STORAGE,undefined,undefined,undefined,username,password,undefined,remoteDir,logDir,null,tags),{endPointSuffix:endPointSuffix||"",sslRequired:!!sslRequired,authenticationType:authenticationType});};jscape.ResourceDescriptor.microsoftAzureBlobStorage=function(name,username,password,authenticationType,endPointSuffix,sslRequired,remoteDir,logDir,tags){return $.extend(new jscape.ResourceDescriptor(name,jscape.ResourceDescriptor.Protocol.MICROSOFT_AZURE_BLOB_STORAGE,undefined,undefined,undefined,username,password,undefined,remoteDir,logDir,null,tags),{endPointSuffix:endPointSuffix||"",sslRequired:!!sslRequired,authenticationType:authenticationType});};jscape.ResourceDescriptor.microsoftOneDrive=function(name,directoryId,clientId,clientSecret,username,rootDriveAccessRequired,remoteDir,logDir,tags){return $.extend(new jscape.ResourceDescriptor(name,jscape.ResourceDescriptor.Protocol.MICROSOFT_ONEDRIVE,undefined,undefined,undefined,undefined,undefined,undefined,remoteDir,logDir,undefined,tags),{directoryId:directoryId,clientId:clientId,clientSecret:clientSecret,username:username,userRootDriveAccessRequired:!!rootDriveAccessRequired});};jscape.ResourceDescriptor.rest=function(name,host,port,timeout,sslRequired,domain,username,password,usingCredentials,keyProvider,remoteDir,logDir,timeToLive,tags){return $.extend(new jscape.ResourceDescriptor(name,jscape.ResourceDescriptor.Protocol.REST,host,port,timeout,username,password,usingCredentials,remoteDir,logDir,timeToLive,tags),{sslRequired:!!sslRequired,domain:domain,keyProvider:keyProvider});};jscape.ResourceDescriptor.tftp=function(name,host,port,retransmitTimeout,maxRetransmitAttempts,logDir,tags){return $.extend(new jscape.ResourceDescriptor(name,jscape.ResourceDescriptor.Protocol.TFTP,host,port,undefined,undefined,undefined,false,undefined,logDir,null,tags),{retransmitTimeout:retransmitTimeout,maxRetransmitAttempts:maxRetransmitAttempts});};jscape.ResourceDescriptor.smb=function(name,host,port,timeout,domain,username,password,usingCredentials,remoteDir,logDir,tags){return $.extend(new jscape.ResourceDescriptor(name,jscape.ResourceDescriptor.Protocol.SMB,host,port,timeout,username,password,usingCredentials,remoteDir,logDir,null,tags),{domain:domain});};jscape.ResourceDescriptor.box=function(name,credentialsFile,credentialsData,remoteDir,logDir,tags){return $.extend(new jscape.ResourceDescriptor(name,jscape.ResourceDescriptor.Protocol.BOX,undefined,undefined,undefined,undefined,undefined,undefined,remoteDir,logDir,undefined,tags),{credentialsFile:credentialsFile,credentialsData:credentialsData});};jscape.ResourceDescriptor.dropbox=function(name,accessToken,remoteDir,logDir,tags){return $.extend(new jscape.ResourceDescriptor(name,jscape.ResourceDescriptor.Protocol.DROPBOX,undefined,undefined,undefined,undefined,undefined,undefined,remoteDir,logDir,undefined,tags),{accessToken:accessToken});};jscape.ResourceDescriptor.ibmCloud=function(name,username,password,endPoint,remoteDir,logDir,tags){return $.extend(new jscape.ResourceDescriptor(name,jscape.ResourceDescriptor.Protocol.IBM_CLOUD,undefined,undefined,undefined,username,password,undefined,remoteDir,logDir,undefined,tags),{endPoint:endPoint});};jscape.ResourceDescriptor.Protocol={AFTP:"AFTP",AGENT:"Agent",AMAZON_S3:"AmazonS3",AMAZON_S3_COMPATIBLE:"S3 Compatible",BOX:"Box",DROPBOX:"Dropbox",IBM_CLOUD:"IbmCloud",GOOGLE_STORAGE:"Google Cloud Storage",GOOGLE_DRIVE:"Google Drive",MICROSOFT_AZURE_DATA_LAKE:"Microsoft Azure Data Lake",MICROSOFT_AZURE_DATA_LAKE_2:"Microsoft Azure Data Lake Gen2",MICROSOFT_AZURE_FILE_STORAGE:"Microsoft Azure File Storage",MICROSOFT_AZURE_BLOB_STORAGE:"Microsoft Azure Blob Storage",MICROSOFT_ONEDRIVE:"Microsoft OneDrive",FTP:"FTP",REST:"REST",SFTP:"SFTP",SMB:"SMB",WEBDAV:"WebDAV",TFTP:"TFTP"};jscape.ResourceDescriptor.Protocol.values=function(){return $.map(this,function(value){return typeof value==="string"?value:null;});};jscape.RemoteDirectory=Class.extend({initialize:function(type){this.type=type||jscape.RemoteDirectory.Type.REMOTE;},isRemote:function(){return this.type==jscape.RemoteDirectory.Type.REMOTE||this.type==jscape.RemoteDirectory.Type.REMOTE_PATH;},toJSON:function(){var obj=$.extend({"@type":this.type},this);delete obj.type;return obj;}});jscape.RemoteDirectory.Type={LOCAL:"LOCAL",REMOTE:"REMOTE",REMOTE_PATH:"REMOTE_PATH"};jscape.RemoteDirectory.fromJSON=function(data){var type=data&&data["@type"]in jscape.RemoteDirectory.Type?data["@type"]:null;return data?$.extend(new jscape.RemoteDirectory(type),data):new jscape.RemoteDirectory(type);};jscape.RemoteDirectory.local=function(){return new jscape.RemoteDirectory(jscape.RemoteDirectory.Type.LOCAL);};jscape.RemoteDirectory.remote=function(path){return path&&path.trim().length?$.extend(new jscape.RemoteDirectory(jscape.RemoteDirectory.Type.REMOTE_PATH),{path:path}):new jscape.RemoteDirectory(jscape.RemoteDirectory.Type.REMOTE);};jscape.domain.NetworkStorageModule=jscape.domain.DomainModule.extend({onCreate:function(_,app,actions,functions){this._super.apply(this,arguments);this.controller=new jscape.domain.NetworkStorageController(functions);},onStart:function(){this.controller.start(this.domainName);},onStop:function(){this.controller.stop();},onResume:function(){this.controller.resume();},onPause:function(){this.controller.pause();}});jscape.domain.NetworkStorageController=jscape.ui.DatagridController.extend({view:null,initialize:function(functions){this.functions=$.grep(functions||[],function(i){return"GetSecret"===i.name;});this.addController=new jscape.domain.AddNetworkStorageController();this.editController=new jscape.domain.EditNetworkStorageController();this.testController=new jscape.domain.TestNetworkStorageController();this.deleteController=new jscape.domain.DeleteNetworkStorageController();this._initValidators();},start:function(domainName){this.domainName=domainName;if(this.view==null){this.view=new jscape.domain.ReverseProxiesView();}
this.view.show(this);},stop:function(){},pause:function(){},resume:function(){this.view.refresh();},onLoadData:function(params){params=jscape.Page.requestParameters(params);return jscape.API.listNetworkStorage(this.domainName,params.startIndex,params.count,params.query).then(jscape.Page.datagridFormatter());},onAddProxy:function(){this.addController.start(this,this.domainName,this.functions).done($.proxy(this._proxyAdded,this));},onEditProxy:function(proxy){var index=$.inArray(proxy,this.view.getReverseProxies());if(index!=-1){this.editController.start(this,this.domainName,proxy,this.functions).done($.proxy(this._proxyEdited,this,index));}},onDeleteProxy:function(proxies){return this.deleteController.start(this.domainName,proxies).done($.proxy(this._proxyDeleted,this,proxies));},onTestProxy:function(descriptor){return this.testController.start(this.domainName,descriptor);},onTestServer:function(descriptor){return this.onTestProxy(descriptor);},_proxyAdded:function(proxy){this._recordAdded(proxy);},_proxyEdited:function(index,proxy){this._recordEdited(proxy);},_proxyDeleted:function(proxies){this._recordDeleted(proxies);},_initValidators:function(){var v=new jscape.Validator();v.nonEmptyRule("proxy_debugdir_nonempty",window.R.string.PROXIES_ERROR_BAD_DEBUG_DIR);v.rule("proxy_unique",$.proxy(this._proxyNotExists,this),window.R.string.PROXIES_ERROR_ALREADY_EXISTS);},_proxyNotExists:function(value,excludes){return $.grep(this.view.getReverseProxies(),function(proxy){return proxy.name==value&&(excludes==undefined||$.inArray(proxy.name,excludes)==-1);}).length==0;}});jscape.domain.ReverseProxiesView=jscape.ui.DatagridView.extend({selection:null,initialize:function(){var initializing=true;this.fieldset=$("#network-storage-fields").layout({fit:true,doSize:false,border:false});this.data=$("table[role=grid][aria-label=networkstorage]",this.fieldset);this.data.datagrid({fit:true,fitColumns:true,singleSelect:true,pagination:true,search:true,remoteSearch:true,remoteSort:true,sortName:"name",idField:"name",columns:[[{field:"name",title:$("thead th:nth-child(1)",this.data).text(),sortable:true,width:"20%"},{field:"protocol",title:$("thead th:nth-child(2)",this.data).text(),width:"15%",sortable:false,formatter:$.proxy(this._formatProtocol,this),finder:{type:"combobox",options:{data:$.map(jscape.ResourceDescriptor.Protocol.values(),$.proxy(function(value){return{text:this._formatProtocol(value),value:value};},this)),width:250,panelWidth:250,panelHeight:"auto",panelMaxHeight:"50%"}}},{field:"host",title:$("thead th:nth-child(3)",this.data).text(),width:"15%"},{field:"port",title:$("thead th:nth-child(4)",this.data).text(),searchable:false,align:"right",width:"5%"},{field:"username",title:$("thead th:nth-child(5)",this.data).text(),width:"10%"},{field:"remoteDirectory",title:$("thead th:nth-child(6)",this.data).text(),searchable:false,formatter:$.proxy(function(_,row){return this._formatRemoteDirectory(row);},this),width:"10%"},{field:"details",title:$("thead th:nth-child(7)",this.data).text(),searchable:false,formatter:$.proxy(function(_,row){return this._formatDetails(row);},this),width:"10%"},{field:"tags",title:$("thead th:nth-child(8)",this.data).text(),width:"15%",formatter:function(value){return String($.isArray(value)?value.join(", "):value).escapeXml();}}]],onSelect:$.proxy(this._adjustButtonsState,this),onUnselect:$.proxy(this._adjustButtonsState,this),onUnselectAll:$.proxy(this._adjustButtonsState,this),onDblClickRow:$.proxy(this._onClick$EditButton,this),onRowContextMenu:$.proxy(this._onRow$ContextMenu,this),loader:$.proxy(this._onLoad$Data,this),onBeforeLoad:function(){return!initializing;},onLoadSuccess:$.proxy(this._adjustButtonsState,this)});this.addButton=$("a[role=button][name=add]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$AddButton,this)});this.editButton=$("a[role=button][name=edit]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$EditButton,this)});this.testButton=$("a[role=button][name=test]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$TestButton,this)});this.deleteButton=$("a[role=button][name=delete]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$DeleteButton,this)});initializing=false;},show:function(listener){this.listener=listener||jscape.domain.ReverseProxiesView.LISTENER;this._adjustButtonsState();},getReverseProxies:function(){return this.getRecords();},_onLoad$Data:function(params,success,error){this.listener.onLoadData(params).then(success,error);},_formatProtocol:function(value){switch(value){case jscape.ResourceDescriptor.Protocol.IBM_CLOUD:return window.R.string["APPLICATION_PROTOCOL_IBM_CLOUD"]||"";case jscape.ResourceDescriptor.Protocol.REST:return window.R.string["APPLICATION_PROTOCOL_REST_PARTNER"]||"";case jscape.ResourceDescriptor.Protocol.MICROSOFT_AZURE_DATA_LAKE_2:return window.R.string["APPLICATION_PROTOCOL_MICROSOFT_AZURE_DATA_LAKE_2"]||"";default:return window.R.string["APPLICATION_PROTOCOL_"+(value+"").toUpperCase().replace(/\s+/g,"_")]||"";}},_formatRemoteDirectory:function(row){return row.remoteDirectory&&row.remoteDirectory.isRemote()?String(row.remoteDirectory.path||"/").escapeXml():"";},_formatDetails:function(row){return row.connectionType?String(row.connectionType).escapeXml():row.securityMode?window.R.string[("PROXIES_SECURITY_MODE_"+row.securityMode).toUpperCase()]||"":"";},_onClick$AddButton:function(){this.listener.onAddProxy();},_onClick$EditButton:function(){this.listener.onEditProxy(this.selection[0]);},_onClick$TestButton:function(){this.testButton.linkbutton({iconCls:'icon-loading',disabled:true,__testing:true});this.listener.onTestProxy(this.selection[0]).always($.proxy(function(){this.testButton.linkbutton({iconCls:'',disabled:false,__testing:false});this._adjustButtonsState();},this));},_onClick$DeleteButton:function(){this.deleteButton.linkbutton("disable");this.listener.onDeleteProxy(this.selection).always($.proxy(this._adjustButtonsState,this));},_showContextMenu:function(e){this._super(e,[this.addButton,this.editButton,this.deleteButton,"-",this.testButton]);},_adjustButtonsState:function(){this.selection=this.data.datagrid("getSelections");var testAllowed=this.selection.length==1&&this.selection[0].protocol!==jscape.ResourceDescriptor.Protocol.AGENT;this.editButton.linkbutton(this.selection.length==1?"enable":"disable");this.testButton.linkbutton(testAllowed&&!this.testButton.linkbutton("options").__testing?"enable":"disable");this.deleteButton.linkbutton(this.selection.length!=0?"enable":"disable");}});jscape.domain.ReverseProxiesView.LISTENER={onRefresh:$.noop,onAddProxy:$.noop,onEditProxy:$.noop,onTestProxy:$.noop,onDeleteProxy:$.noop};jscape.domain.BaseNetworkStorageController=Class.extend({clientKeyProvider:null,deferred:null,initialize:function(functions){this.clientKeyController=new jscape.domain.ClientKeyController();this.variableController=new jscape.VariableController();this.functionController=new jscape.FunctionController();this.functions=functions||[];},start:function(listener,domainName,keyProvider){this.listener=listener||jscape.domain.BaseNetworkStorageController.LISTENER;this.domainName=domainName;this.clientKeyProvider=keyProvider||null;this.deferred=$.Deferred();this._setupDialog().show(this);return this.deferred.promise();},onCancel:function(dialog){dialog.destroy();this.deferred.reject();this.deferred=null;},onTest:function(dialog){return this.listener.onTestServer(this._createDescriptor(dialog));},onAddVariable:function(input){this.variableController.start(input,{loader:$.proxy(function(_,success,error){this.onLoadVariables().done(success).fail(error);},this)});},onLoadVariables:function(){return this.variables?$.Deferred().resolve(this.variables).promise():jscape.API.getNetworkStorageVariables(this.domainName).then($.proxy(function(items){this.variables=items;return items;},this));},onAddFunction:function(input){return this.functionController.start(input,this.functions||[]);},onLoadFileContent:function(files){var deferred=$.Deferred();var promise=deferred.promise();if(window.FileReader&&files&&files.length&&$.inArray(files[0].type,["text/plain","application/json"])!=-1){var reader=new FileReader();reader.onload=$.proxy(function(e){deferred.resolve(e.target.result);reader.onload=reader.onerror=null;deferred=reader=null;},this);reader.onerror=$.proxy(function(){deferred.reject();reader.onload=reader.onerror=null;deferred=reader=null;},this);reader.readAsText(files[0]);}else{deferred.reject();}
return promise;},onSelectClientKey:function(){this.clientKeyController.start(this.domainName,this.clientKeyProvider).done($.proxy(function(provider){this.clientKeyProvider=provider;},this));},onSelectKeyFile:function(){return new SelectPathController($.proxy(jscape.API.listKeystorePath,jscape.API),$.proxy(jscape.API.createKeystorePath,jscape.API)).selectFile().then(function(entry){return entry.path;});},onSelectDebugDir:function(){return new SelectPathController($.proxy(jscape.API.listDebugDir,jscape.API),$.proxy(jscape.API.createDebugPath,jscape.API)).selectDirectory().then(function(entry){return entry.path;})},onAddTag:function(value){return jscape.API.storeAclTag(value);},onLoadTags:function(){return jscape.API.getDomainTags(this.domainName);},_loadHostKeys:function(){return jscape.API.getHostCertificates(this.domainName).then(function(certificates){return $.map(certificates,function(certificate){return certificate.name;});});},_setupView:function(){throw"Not implemented";},_createDescriptor:function(dialog){throw"Not implemented";}});jscape.domain.BaseNetworkStorageController.LISTENER={onTestServer:$.noop};jscape.domain.NetworkStorageDialog=jscape.ui.DefaultDialog.extend({focusInField:null,initialize:function(dialog){var initializing=true;this._super(dialog,{width:"75%",height:"90%",doSize:false});this.fieldset=$("#d-networkstorage-content"+this.getIdSuffix()).layout({fit:true,doSize:false,border:false});this.fieldset.focusin($.proxy(this._onForm$FocusIn,this));this.debugLog=$("input[name=debuglog]:checkbox",this.fieldset);this.debugLog.change($.proxy(function(){var enabled=this.debugLog.is(":checked");this.debugDir.textbox(enabled?"enable":"disable").textbox(enabled?"enableValidation":"disableValidation");this.debugDirBrowseButton.linkbutton(enabled?"enable":"disable");},this));this.debugDir=$("input[name=debugdir]",this.fieldset).textbox({required:true,validaType:"proxy_debugdir_nonempty",missingMessage:window.R.string.PROXIES_ERROR_BAD_DEBUG_DIR,width:"50%"});this.debugDirBrowseButton=$("a[role=button][name=debugdirbrowse]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$DebugDirBrowseButton,this)});this.tags=$("select[name=tags]",this.fieldset).tagbox({limitToList:jscape.acl&&!jscape.acl.tic,hasDownArrow:true,loader:$.proxy(this._onLoad$Tags,this),onBeforeLoad:function(){return!initializing;},onAddTag:$.proxy(this._onClick$AddTagButton,this),tagEditor:$("#d-add-tag-inline"),width:"60%",panelHeight:"auto",panelMinHeight:50});this.proxyType=$("select[name=proxytype]",this.fieldset).combobox({editable:false,onChange:$.proxy(this.onChange$ProxyType,this),width:"40%",panelMinHeight:50,panelHeight:"auto",panelMaxHeight:"50%"});this.proxyHost=$("input[name=proxyhost]",this.fieldset).textbox({required:false,validType:"non_empty",missingMessage:window.R.string.TRADING_PARTNERS_ERROR_BAD_HOST,width:"60%"});this.proxyPort=$("input[name=proxyport]",this.fieldset).numberspinner({required:false,min:1,max:65535,width:100});this.proxyUsername=$("input[name=proxyuser]",this.fieldset).textbox({width:"50%"});this.proxyPassword=$("input[name=proxypwd]",this.fieldset).passwordbox2({width:"50%"});this.addVariableButton=$("a[role=button][name=addvar]",this.dialog).linkbutton({disabled:true,onClick:$.proxy(this._onClick$AddVariableButton,this)});this.functionsButton=$("a[role=button][name=addfunction]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$FunctionsButton,this)});this.testButton=$("a[role=button][name=test]",this.dialog).linkbutton({onClick:$.proxy(this._onClick$TestButton,this)});initializing=false;},getDebugDirectory:function(){return this.debugLog.is(":checked")?this.debugDir.textbox("getValue"):null;},setDebugDirectory:function(value){this.debugLog.prop("checked",value!=null).change();this.debugDir.textbox("setValue",value||"");},getProxyType:function(){return this.proxyType.length&&!/none/ig.test(this.proxyType.combobox("getValue"))?this.proxyType.combobox("getValue"):null;},setProxyType:function(value){this.proxyType.length&&this.proxyType.combobox("select",value);},getProxyHost:function(){return this.proxyHost.textbox("getValue");},setProxyHost:function(value){this.proxyHost.textbox("setValue",value);},getProxyPort:function(){return this.proxyPort.numberspinner("getValue");},setProxyPort:function(value){this.proxyPort.numberspinner("setValue",value);},getProxyUsername:function(){return this.proxyUsername.length?this.proxyUsername.textbox("getValue"):null;},setProxyUsername:function(value){this.proxyUsername.length&&this.proxyUsername.textbox("setValue",value);},getProxyPassword:function(){return this.proxyPassword.length?this.proxyPassword.passwordbox2("getValue"):null;},setProxyPassword:function(value){this.proxyPassword.length&&this.proxyPassword.passwordbox2("setValue",value);},getTags:function(){return this.tags.tagbox("getValues");},setTags:function(values){this.tags.tagbox("setValues",values);},show:function(listener){this.focusInField=null;this._super(listener||jscape.domain.NetworkStorageDialog.LISTENER);this.tags.tagbox("reload");},_onClick$AddTagButton:function(tag){this.listener.onAddTag(tag).done($.proxy(function(){this.tags.tagbox("reload");},this));},_onLoad$Tags:function(params,success,error){this.listener.onLoadTags(params).done(success).fail(error);},_insertVariableAllowed:function(field){return field&&field.length&&(field.is("input[type=text]")||field.is("textarea"));},_insertFunctionAllowed:function(field){return field&&field.length&&(field.is("input:not([type=radio])")||field.is("textarea"));},_onClick$AddVariableButton:function(){var field=this.focusInField;if(field&&this._insertVariableAllowed(field)){this.addVariableButton.linkbutton("disable");this.listener.onAddVariable(field);}},_onClick$FunctionsButton:function(){var field=this.focusInField;if(field&&field.is(":not(:disabled)")){this.listener.onAddFunction(field);}},_onClick$DebugDirBrowseButton:function(){this.debugDirBrowseButton.linkbutton("disable");this.listener.onSelectDebugDir(this).done($.proxy(function(path){this.setDebugDirectory(path);},this)).always($.proxy(function(){this.debugDirBrowseButton.linkbutton("enable");},this));},_onClick$TestButton:function(){if(this.fieldset.form("validate")){this.testButton.linkbutton({iconCls:'icon-loading',disabled:true,__testing:true});this.listener.onTest(this).always($.proxy(function(){this.testButton.linkbutton({iconCls:'',disabled:false,__testing:false});},this));}},onChange$ProxyType:function(){var type=this.getProxyType();this.proxyHost.length&&this.proxyHost.textbox(type!=null?"enable":"disable");this.proxyPort.length&&this.proxyPort.numberspinner(type!=null?"enable":"disable");this.proxyUsername.length&&this.proxyUsername.textbox(type!=null?"enable":"disable");this.proxyPassword.length&&this.proxyPassword.passwordbox2(type!=null&&jscape.ProxyData.Type.SOCKS4!=type?"enable":"disable");},_onForm$FocusIn:function(e){var t=$(e.target);if(this.addVariableButton.is(t)||this.functionsButton.is(t)){t=$(e.relatedTarget);}
if(t.is(":not(:disabled):not([readonly]):visible")){this.focusInField=t;this.addVariableButton.linkbutton(this._insertVariableAllowed(t)?"enable":"disable");this.functionsButton.linkbutton(this._insertFunctionAllowed(t)?"enable":"disable");}else{this.focusInField=null;this.addVariableButton.linkbutton("disable");this.functionsButton.linkbutton("disable");}}});jscape.domain.NetworkStorageDialog.LISTENER={onTest:$.noop,onSelectDebugDir:$.noop,onAddVariable:$.noop,onAddFunction:$.noop};jscape.domain.AddFtpNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({SECURITY_MODE_KEY_USAGE:{'regular':false,'explicit SSL':true,'implicit SSL':true},DEFAULT_PORTS:{'regular':21,'explicit SSL':21,'implicit SSL':990},onSubmit:function(dialog){return this.listener.onAddNetworkStorage(this._createDescriptor(dialog));},onSelectClientKey:function(){this.clientKeyController.start(this.domainName,this.clientKeyProvider,false,true).done($.proxy(function(provider){this.clientKeyProvider=provider;},this));},_setupDialog:function(){var dialog=new jscape.domain.AddFtpNetworkStorageDialog();dialog.setKeyUsage(this.SECURITY_MODE_KEY_USAGE);dialog.setDefaultPorts(this.DEFAULT_PORTS);dialog.setPort(this.DEFAULT_PORTS[dialog.getConnectionType()]);dialog.setTimeout(1000);dialog.setTcpNoDelay(true);dialog.setUsername("");dialog.setPassword("");dialog.setUsePassiveMode(true);dialog.setRemoteDirectory(true);dialog.setDebugDirectory(null);dialog.setMaxAge(10*60*1000);this._loadHostKeys().done(function(keys){dialog.setHostKeys(keys);});return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.ftp(dialog.getName(),dialog.getHost(),dialog.getPort(),dialog.getTimeout(),dialog.getTcpNoDelay(),dialog.getConnectionType(),dialog.isUsePassiveMode(),dialog.getUsername(),dialog.getPassword(),dialog.isReplayCredentials(),this.clientKeyProvider,dialog.getHostKey()!=null?new jscape.ServerKeyProvider(dialog.getHostKey()):null,dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getMaxAge(),dialog.getTags());}});jscape.domain.EditFtpNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({SECURITY_MODE_KEY_USAGE:{'regular':false,'explicit SSL':true,'implicit SSL':true},DEFAULT_PORTS:{'REGULAR':21,'EXPLICIT_SSL':21,'IMPLICIT_SSL':990},descriptor:null,start:function(listener,domainName,descriptor){this.descriptor=descriptor;return this._super(listener,domainName,descriptor.keyProvider);},onSubmit:function(dialog){return this.listener.onEditNetworkStorage(this._createDescriptor(dialog));},onSelectClientKey:function(){this.clientKeyController.start(this.domainName,this.clientKeyProvider,false,true).done($.proxy(function(provider){this.clientKeyProvider=provider;},this));},_setupDialog:function(){var dialog=new jscape.domain.EditFtpNetworkStorageDialog();var descriptor=this.descriptor;if(descriptor){dialog.setName(descriptor.name);dialog.setHost(descriptor.host);dialog.setPort(descriptor.port);dialog.setTimeout(descriptor.timeout);dialog.setTcpNoDelay(descriptor.tcpNoDelayEnabled);dialog.setConnectionType(descriptor.connectionType);dialog.setKeyUsage(this.SECURITY_MODE_KEY_USAGE);dialog.setUsername(descriptor.username);dialog.setPassword(descriptor.password);dialog.setUsePassiveMode(descriptor.passive);dialog.setRemoteDirectoryPath(descriptor.remoteDirectory.path);dialog.setRemoteDirectory(jscape.RemoteDirectory.Type.LOCAL!=descriptor.remoteDirectory.type);dialog.setDebugDirectory(descriptor.logDirectory);dialog.setMaxAge(descriptor.timeToLive);dialog.setTags(descriptor.tags);}
this._loadHostKeys().done(function(keys){dialog.setHostKeys(keys);descriptor&&dialog.setHostKey(descriptor.hostKeyProvider?descriptor.hostKeyProvider.keyAlias:null);});return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.ftp(this.descriptor.name,dialog.getHost(),dialog.getPort(),dialog.getTimeout(),dialog.getTcpNoDelay(),dialog.getConnectionType(),dialog.isUsePassiveMode(),dialog.getUsername(),dialog.getPassword(),dialog.isReplayCredentials(),this.clientKeyProvider,dialog.getHostKey()!=null?new jscape.ServerKeyProvider(dialog.getHostKey()):null,dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getMaxAge(),dialog.getTags());}});jscape.domain.FtpNetworkStorageDialog=jscape.domain.NetworkStorageDialog.extend({TIMEOUT_FACTOR:60*1000,DEFAULT_MAX_AGE:10,keyUsage:null,defaultPorts:null,initialize:function(dialog){this._super(dialog);var initializing=true;this.keyUsage={};this.defaultPorts={};this.host=$("input[name=host]",this.fieldset).textbox({required:true,validType:"non_empty",missingMessage:window.R.string.PROXIES_ERROR_BAD_HOST,invalidMessage:window.R.string.PROXIES_ERROR_BAD_HOST,width:"60%"});this.port=$("input[name=port]",this.fieldset).numberspinner({required:true,min:1,max:65535,width:100});this.timeout=$("input[name=timeout]",this.fieldset).numberspinner({required:true,min:1,max:60,width:60});this.tcpNoDelay=$("input[name=tcpnodelay]:checkbox",this.fieldset);this.connectionType=$("select[name=connectiontype]",this.fieldset).combobox({required:true,editable:false,width:120,panelHeight:"auto",onChange:$.proxy(function(val){if(!initializing)this._adjustSecurityMode(val);},this)});this.useHostKey=$("input[name=usehostkey]:checkbox",this.fieldset).prop("disabled",true);this.useHostKey.change($.proxy(function(){this.hostKey.combobox(this.useHostKey.is(":checked:not(:disabled)")?"enable":"disable");},this));this.hostKey=$("select[name=hostkey]",this.fieldset);this.hostKey.combobox({editable:false,disabled:true,width:170,panelHeight:"auto",panelMaxHeight:150,onLoadSuccess:$.proxy(function(data){this.useHostKey.prop("disabled",data.length==0);if(data.length!=0){this.hostKey.combobox("select",data[0].value);}},this)});this.clientKeyButton=$("a[role=button][name=selectclientkey]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$ClientKeyButton,this)});this.credentials=$("input[name=credentials]:radio",this.fieldset);this.enterCredentials=this.credentials.filter("[value=enter]");this.replayCredentials=this.credentials.filter("[value=replay]");this.credentials.change($.proxy(function(){var enabled=this.enterCredentials.is(":checked");this.username.textbox(enabled?"enable":"disable").textbox("isValid");this.password.passwordbox2(enabled?"enable":"disable");},this));this.username=$("input[name=username]",this.fieldset).textbox({required:true,validType:"proxy_username_nonempty",missingMessage:window.R.string.PROXIES_ERROR_BAD_USER,width:"50%"});this.password=$("input[name=userpwd]",this.fieldset).passwordbox2({width:"50%"});this.passive=$("input[name=passivemode]:checkbox",this.fieldset);this.remoteDirectory=$("input[name=remotedirectory]:radio",this.fieldset).change($.proxy(function(){this.remoteDirectoryPath.textbox(this.isRemoteDirectory()?"enable":"disable");},this));this.remoteDirectoryPath=$("input[name=remotepath]",this.fieldset).textbox({width:"60%"});this.maxAge=$("input[name=maxage]:checkbox",this.fieldset);this.maxAge.change($.proxy(function(){var enabled=this.maxAge.is(":checked");this.ttl.numberspinner(enabled?"enable":"disable").numberspinner(enabled?"enableValidation":"disableValidation")},this));this.ttl=$("input[name=ttl]",this.fieldset).numberspinner({required:true,disabled:true,min:1,max:1000,width:70});initializing=false;},getName:function(){throw"Abstract method";},getHost:function(){return this.host.textbox("getValue");},setHost:function(value){this.host.textbox("setValue",value);},getPort:function(){return this.port.numberspinner("getValue");},setPort:function(value){this.port.numberspinner("setValue",value);},getTimeout:function(){return this.timeout.numberspinner("getValue")*this.TIMEOUT_FACTOR;},setTimeout:function(value){this.timeout.numberspinner("setValue",parseInt(value)/this.TIMEOUT_FACTOR);},getTcpNoDelay:function(){return this.tcpNoDelay.is(":checked");},setTcpNoDelay:function(value){this.tcpNoDelay.prop("checked",!!value);},setKeyUsage:function(values){this.keyUsage=$.extend({},values);},setDefaultPorts:function(values){this.defaultPorts=$.extend({},values);},getConnectionType:function(){return this.connectionType.combobox("getValue");},setConnectionType:function(value){this.connectionType.combobox("setValue",value);},isReplayCredentials:function(){return this.replayCredentials.is(":checked");},getUsername:function(){return this.enterCredentials.is(":checked")?this.username.textbox("getValue"):null;},setUsername:function(value){if(value!=null){this.username.textbox("setValue",value);this.enterCredentials.prop("checked",true).change();}else{this.replayCredentials.prop("checked",true).change();}},getPassword:function(){return this.enterCredentials.is(":checked")?this.password.passwordbox2("getValue"):null;},setPassword:function(value){this.password.passwordbox2("setValue",value);},getHostKey:function(){return this.useHostKey.is(":checked:not(:disabled)")?this.hostKey.combobox("getValue"):null;},setHostKey:function(value){this.useHostKey.prop("checked",value!=null).change();if(value!=null){this.hostKey.combobox("setValue",value);}},setHostKeys:function(values){this.hostKey.combobox("loadData",values);},isUsePassiveMode:function(){return this.passive.is(":checked");},setUsePassiveMode:function(value){this.passive.prop("checked",!!value);},isRemoteDirectory:function(){return this.remoteDirectory.filter("[value=remote]").is(":checked");},setRemoteDirectory:function(value){this.remoteDirectory.filter(!!value?"[value=remote]":":not([value=remote])").first().prop("checked",true).change();},getRemoteDirectoryPath:function(){return this.remoteDirectoryPath.textbox("getValue");},setRemoteDirectoryPath:function(value){this.remoteDirectoryPath.textbox("setValue",value);this.setRemoteDirectory(value&&value.length!=0);},getMaxAge:function(){return this.maxAge.is(":checked")?this.ttl.numberspinner("getValue")*this.TIMEOUT_FACTOR:null;},setMaxAge:function(value){value=parseInt(value);this.maxAge.prop("checked",!isNaN(value)).change();this.ttl.numberspinner("setValue",!isNaN(value)?value/this.TIMEOUT_FACTOR:this.DEFAULT_MAX_AGE);},show:function(listener){this._super(listener||jscape.domain.FtpNetworkStorageDialog.LISTENER);this.remoteDirectory.change();this._adjustSecurityMode(this.getConnectionType());},_insertVariableAllowed:function(field){return this._super(field)&&this.remoteDirectoryPath.textbox("textbox").is(field);},_onClick$ClientKeyButton:function(){this.listener.onSelectClientKey();},_adjustSecurityMode:function(mode){var enabled=!!this.keyUsage[mode];this.useHostKey.prop("disabled",!enabled).change();this.clientKeyButton.linkbutton(enabled?"enable":"disable");var port=parseInt(this.defaultPorts[mode]);if(!isNaN(port)){this.port.numberspinner("setValue",port);}}});jscape.domain.FtpNetworkStorageDialog.LISTENER=$.extend({},jscape.domain.NetworkStorageDialog.LISTENER,{onSelectClientKey:$.noop});jscape.domain.AddFtpNetworkStorageDialog=jscape.domain.FtpNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-add-ftp"));this.name=$("input[name=name]",this.fieldset).textbox({required:true,validType:["non_empty","proxy_unique"],missingMessage:window.R.string.PROXIES_ERROR_BAD_NAME,invalidMessage:window.R.string.PROXIES_ERROR_BAD_NAME,width:"60%"});},getName:function(){return this.name.textbox("getValue");}});jscape.domain.EditFtpNetworkStorageDialog=jscape.domain.FtpNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-edit-ftp"));this.title=this.dialog.dialog("header").text()||"";},setName:function(value){this.dialog.dialog("setTitle",this.title.supplant({0:value}));}});jscape.domain.AddSftpNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({onSubmit:function(dialog){return this.listener.onAddNetworkStorage(this._createDescriptor(dialog));},onLoadHostKeys:function(){return $.when(jscape.API.getHostCertificates(this.domainName),jscape.API.getHostPublicKeys(this.domainName)).then(function(certificates,publicKeys){return[].concat($.map(certificates,function(c){return c.name;}),$.map(publicKeys,function(pk){return pk.name;}))});},onSelectClientKey:function(){this.clientKeyController.start(this.domainName,this.clientKeyProvider,true,false).done($.proxy(function(provider){this.clientKeyProvider=provider;},this));},_setupDialog:function(){var dialog=new jscape.domain.AddSftpNetworkStorageDialog();dialog.setPort(22);dialog.setTimeout(1000);dialog.setTcpNoDelay(true);dialog.setUsername("");dialog.setPassword("");dialog.setRemoteDirectory(true);dialog.setDebugDirectory(null);dialog.setMaxAge(10*60*1000);return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.sftp(dialog.getName(),dialog.getHost(),dialog.getPort(),dialog.getTimeout(),dialog.getTcpNoDelay(),dialog.isUseAdaptiveMode(),dialog.isStartSubsystemReplyRequired(),dialog.getUsername(),dialog.getPassword(),dialog.getPublicKeyAlgorithm(),dialog.isReplayCredentials(),this.clientKeyProvider,dialog.getHostKey()!=null?new jscape.ServerKeyProvider(dialog.getHostKey()):null,dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getMaxAge(),dialog.getTags(),dialog.getProxyType()!=null?new jscape.ProxyData(dialog.getProxyType(),dialog.getProxyHost(),dialog.getProxyPort(),dialog.getProxyUsername(),dialog.getProxyPassword()):null);}});jscape.domain.EditSftpNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({descriptor:null,start:function(listener,domainName,descriptor){this.descriptor=descriptor;return this._super(listener,domainName,descriptor.keyProvider);},onSubmit:function(dialog){return this.listener.onEditNetworkStorage(this._createDescriptor(dialog));},onLoadHostKeys:function(){return $.when(jscape.API.getHostCertificates(this.domainName),jscape.API.getHostPublicKeys(this.domainName)).then(function(certificates,publicKeys){return[].concat($.map(certificates,function(c){return c.name;}),$.map(publicKeys,function(pk){return pk.name;}))});},onSelectClientKey:function(){this.clientKeyController.start(this.domainName,this.clientKeyProvider,true,false).done($.proxy(function(provider){this.clientKeyProvider=provider;},this));},_setupDialog:function(){var dialog=new jscape.domain.EditSftpNetworkStorageDialog();var descriptor=this.descriptor;if(descriptor){dialog.setName(descriptor.name);dialog.setHost(descriptor.host);dialog.setPort(descriptor.port);dialog.setTimeout(descriptor.timeout);dialog.setTcpNoDelay(descriptor.tcpNoDelayEnabled);dialog.setUsername(descriptor.username);dialog.setPassword(descriptor.password);dialog.setPublicKeyAlgorithm(descriptor.publicKeyAlgorithm);dialog.setHostKey(descriptor.hostKeyProvider?descriptor.hostKeyProvider.keyAlias:null);dialog.setUseAdaptiveMode(descriptor.useAdaptiveConnection);dialog.setStartSubsystemReplyRequired(descriptor.startSubsystemReplyRequired);dialog.setRemoteDirectoryPath(descriptor.remoteDirectory.path);dialog.setRemoteDirectory(jscape.RemoteDirectory.Type.LOCAL!=descriptor.remoteDirectory.type);dialog.setDebugDirectory(descriptor.logDirectory);dialog.setMaxAge(descriptor.timeToLive);dialog.setTags(descriptor.tags);var proxy=descriptor.proxyData;if(proxy){dialog.setProxyType(proxy.type);dialog.setProxyHost(proxy.host);dialog.setProxyPort(proxy.port);dialog.setProxyUsername(proxy.username);dialog.setProxyPassword(proxy.password);}}
return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.sftp(this.descriptor.name,dialog.getHost(),dialog.getPort(),dialog.getTimeout(),dialog.getTcpNoDelay(),dialog.isUseAdaptiveMode(),dialog.isStartSubsystemReplyRequired(),dialog.getUsername(),dialog.getPassword(),dialog.getPublicKeyAlgorithm(),dialog.isReplayCredentials(),this.clientKeyProvider,dialog.getHostKey()!=null?new jscape.ServerKeyProvider(dialog.getHostKey()):null,dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getMaxAge(),dialog.getTags(),dialog.getProxyType()!=null?new jscape.ProxyData(dialog.getProxyType(),dialog.getProxyHost(),dialog.getProxyPort(),dialog.getProxyUsername(),dialog.getProxyPassword()):null);}});jscape.domain.SftpNetworkStorageDialog=jscape.domain.NetworkStorageDialog.extend({TIMEOUT_FACTOR:60*1000,DEFAULT_MAX_AGE:10,initialize:function(dialog){this._super(dialog);var initializing=true;this.host=$("input[name=host]",this.fieldset).textbox({required:true,validType:"non_empty",missingMessage:window.R.string.PROXIES_ERROR_BAD_HOST,invalidMessage:window.R.string.PROXIES_ERROR_BAD_HOST,width:"60%"});this.port=$("input[name=port]",this.fieldset).numberspinner({required:true,min:1,max:65535,width:100});this.timeout=$("input[name=timeout]",this.fieldset).numberspinner({required:true,min:1,max:60,width:60});this.tcpNoDelay=$("input[name=tcpnodelay]:checkbox",this.fieldset);this.publicKeyAlgorithm=$("select[name=publickeyalgorithm]",this.fieldset).combobox({editable:false,autoSelectFirst:true,width:200,panelHeight:"auto",panelMaxHeight:"40%"});this.useHostKey=$("input[name=usehostkey]:checkbox",this.fieldset).prop("disabled",true);this.useHostKey.change($.proxy(function(){this.hostKey.combobox(this.useHostKey.is(":checked:not(:disabled)")?"enable":"disable");},this));this.hostKey=$("select[name=hostkey]",this.fieldset);this.hostKey.combobox({editable:false,disabled:true,width:170,panelHeight:"auto",panelMaxHeight:150,loader:$.proxy(this._onLoad$HostKeys,this),onBeforeLoad:function(){return!initializing;},onLoadSuccess:$.proxy(function(data){this.useHostKey.prop("disabled",data.length==0).change();},this)});this.clientKeyButton=$("a[role=button][name=selectclientkey]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$ClientKeyButton,this)});this.credentials=$("input[name=credentials]:radio",this.fieldset);this.enterCredentials=this.credentials.filter("[value=enter]");this.replayCredentials=this.credentials.filter("[value=replay]");this.credentials.change($.proxy(function(){var enabled=this.enterCredentials.is(":checked");this.username.textbox(enabled?"enable":"disable").textbox(enabled?"enableValidation":"disableValidation");this.password.passwordbox2(enabled?"enable":"disable");},this));this.username=$("input[name=username]",this.fieldset).textbox({required:true,validType:"proxy_username_nonempty",missingMessage:window.R.string.PROXIES_ERROR_BAD_USER,width:"50%"});this.password=$("input[name=userpwd]",this.fieldset).passwordbox2({width:"50%"});this.useAdaptiveMode=$("input[name=adaptivemode]:checkbox");this.startSubsystemReply=$("input[name=startsubsystemreply]:checkbox");this.remoteDirectory=$("input[name=remotedirectory]:radio",this.fieldset).change($.proxy(function(){this.remoteDirectoryPath.textbox(this.isRemoteDirectory()?"enable":"disable");},this));this.remoteDirectoryPath=$("input[name=remotepath]",this.fieldset).textbox({width:"60%"});this.maxAge=$("input[name=maxage]:checkbox",this.fieldset);this.maxAge.change($.proxy(function(){var enabled=this.maxAge.is(":checked");this.ttl.numberspinner(enabled?"enable":"disable").numberspinner(enabled?"enableValidation":"disableValidation")},this));this.ttl=$("input[name=ttl]",this.fieldset).numberspinner({required:true,disabled:true,min:1,max:1000,width:70});initializing=false;},getName:function(){throw"Abstract method.";},getHost:function(){return this.host.textbox("getValue");},setHost:function(value){this.host.textbox("setValue",value);},getPort:function(){return this.port.numberspinner("getValue");},setPort:function(value){this.port.numberspinner("setValue",value);},getTimeout:function(){return this.timeout.numberspinner("getValue")*this.TIMEOUT_FACTOR;},setTimeout:function(value){this.timeout.numberspinner("setValue",parseInt(value)/this.TIMEOUT_FACTOR);},getTcpNoDelay:function(){return this.tcpNoDelay.is(":checked");},setTcpNoDelay:function(value){this.tcpNoDelay.prop("checked",!!value);},isReplayCredentials:function(){return this.replayCredentials.is(":checked");},getUsername:function(){return this.enterCredentials.is(":checked")?this.username.textbox("getValue"):null;},setUsername:function(value){if(value!=null){this.username.textbox("setValue",value);this.enterCredentials.prop("checked",true).change();}else{this.replayCredentials.prop("checked",true).change();}},getPassword:function(){return this.enterCredentials.is(":checked")?this.password.passwordbox2("getValue"):null;},setPassword:function(value){this.password.passwordbox2("setValue",value);},getPublicKeyAlgorithm:function(){return this.publicKeyAlgorithm.combobox("getValue");},setPublicKeyAlgorithm:function(value){return this.publicKeyAlgorithm.combobox("setValue",value);},getHostKey:function(){return this.useHostKey.is(":checked:not(:disabled)")?this.hostKey.combobox("getValue"):null;},setHostKey:function(value){this.useHostKey.prop("checked",value!=null).change();if(value!=null){this.hostKey.combobox("setValue",value);}},isUseAdaptiveMode:function(){return this.useAdaptiveMode.is(":checked");},setUseAdaptiveMode:function(value){this.useAdaptiveMode.prop("checked",!!value);},isStartSubsystemReplyRequired:function(){return this.startSubsystemReply.is(":checked");},setStartSubsystemReplyRequired:function(value){this.startSubsystemReply.prop("checked",!!value);},isRemoteDirectory:function(){return this.remoteDirectory.filter("[value=remote]").is(":checked");},setRemoteDirectory:function(value){this.remoteDirectory.filter(!!value?"[value=remote]":":not([value=remote])").first().prop("checked",true).change();},getRemoteDirectoryPath:function(){return this.remoteDirectoryPath.textbox("getValue");},setRemoteDirectoryPath:function(value){this.remoteDirectoryPath.textbox("setValue",value);this.setRemoteDirectory(value&&value.length!=0);},getMaxAge:function(){return this.maxAge.is(":checked")?this.ttl.numberspinner("getValue")*this.TIMEOUT_FACTOR:null;},setMaxAge:function(value){value=parseInt(value);this.maxAge.prop("checked",!isNaN(value)).change();this.ttl.numberspinner("setValue",!isNaN(value)?value/this.TIMEOUT_FACTOR:this.DEFAULT_MAX_AGE);},show:function(listener){this._super(listener||jscape.domain.SftpNetworkStorageDialog.LISTENER);this.hostKey.combobox("reload");},_insertVariableAllowed:function(field){return this._super(field)&&this.remoteDirectoryPath.textbox("textbox").is(field);},_onLoad$HostKeys:function(params,success,error){this.listener.onLoadHostKeys(params).done(success).fail(error);},_onClick$ClientKeyButton:function(){this.listener.onSelectClientKey();}});jscape.domain.SftpNetworkStorageDialog.LISTENER=$.extend({},jscape.domain.NetworkStorageDialog.LISTENER,{onSelectClientKey:$.noop,onLoadHostKeys:$.noop});jscape.domain.AddSftpNetworkStorageDialog=jscape.domain.SftpNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-add-sftp"));this.name=$("input[name=name]",this.fieldset).textbox({required:true,validType:["non_empty","proxy_unique"],missingMessage:window.R.string.PROXIES_ERROR_BAD_NAME,invalidMessage:window.R.string.PROXIES_ERROR_BAD_NAME,width:"60%"});},getName:function(){return this.name.textbox("getValue");}});jscape.domain.EditSftpNetworkStorageDialog=jscape.domain.SftpNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-edit-sftp"));this.title=this.dialog.dialog("header").text()||"";},setName:function(value){this.dialog.dialog("setTitle",this.title.supplant({0:value}));}});jscape.domain.AddAftpNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({SECURITY_MODE_KEY_USAGE:{'NO_PROTECTION':false,'FULL_TIME_PROTECTED':true,'AUTHENTICATION_PROTECTED':true},onSubmit:function(dialog){return this.listener.onAddNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.AddAftpNetworkStorageDialog();dialog.setPort(3000);dialog.setTimeout(1000);dialog.setTcpNoDelay(true);dialog.setDownloadRate(45*1000*1000);dialog.setUploadRate(45*1000*1000);dialog.setKeyUsage(this.SECURITY_MODE_KEY_USAGE);dialog.setUsername("");dialog.setPassword("");dialog.setRemoteDirectory(true);dialog.setDebugDirectory(null);dialog.setMaxAge(10*60*1000);this._loadHostKeys().done(function(keys){dialog.setHostKeys(keys);});return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.aftp(dialog.getName(),dialog.getHost(),dialog.getPort(),dialog.getTimeout(),dialog.getTcpNoDelay(),dialog.getSecurityMode(),dialog.getUsername(),dialog.getPassword(),dialog.isReplayCredentials(),this.clientKeyProvider,dialog.getHostKey()!=null?new jscape.ServerKeyProvider(dialog.getHostKey()):null,dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDownloadRate(),dialog.getUploadRate(),dialog.isCongestionControlEnabled(),dialog.getDebugDirectory(),dialog.getMaxAge(),dialog.getTags());}});jscape.domain.EditAftpNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({SECURITY_MODE_KEY_USAGE:{'NO_PROTECTION':false,'FULL_TIME_PROTECTED':true,'AUTHENTICATION_PROTECTED':true},start:function(listener,domainName,descriptor){this.descriptor=descriptor;return this._super(listener,domainName,descriptor.keyProvider);},onSubmit:function(dialog){return this.listener.onEditNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.EditAftpNetworkStorageDialog();var descriptor=this.descriptor;if(descriptor){dialog.setName(descriptor.name);dialog.setHost(descriptor.host);dialog.setPort(descriptor.port);dialog.setTimeout(descriptor.timeout);dialog.setTcpNoDelay(descriptor.tcpNoDelayEnabled);dialog.setSecurityMode(descriptor.securityMode);dialog.setKeyUsage(this.SECURITY_MODE_KEY_USAGE);dialog.setUsername(descriptor.username);dialog.setPassword(descriptor.password);dialog.setRemoteDirectoryPath(descriptor.remoteDirectory.path);dialog.setRemoteDirectory(jscape.RemoteDirectory.Type.LOCAL!=descriptor.remoteDirectory.type);dialog.setDownloadRate(descriptor.downloadRate);dialog.setUploadRate(descriptor.uploadRate);dialog.setCongestionControlEnabled(descriptor.congestionControlEnabled);dialog.setDebugDirectory(descriptor.logDirectory);dialog.setMaxAge(descriptor.timeToLive);dialog.setTags(descriptor.tags);}
this._loadHostKeys().done(function(keys){dialog.setHostKeys(keys);descriptor&&dialog.setHostKey(descriptor.hostKeyProvider?descriptor.hostKeyProvider.keyAlias:null);});return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.aftp(this.descriptor.name,dialog.getHost(),dialog.getPort(),dialog.getTimeout(),dialog.getTcpNoDelay(),dialog.getSecurityMode(),dialog.getUsername(),dialog.getPassword(),dialog.isReplayCredentials(),this.clientKeyProvider,dialog.getHostKey()!=null?new jscape.ServerKeyProvider(dialog.getHostKey()):null,dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDownloadRate(),dialog.getUploadRate(),dialog.isCongestionControlEnabled(),dialog.getDebugDirectory(),dialog.getMaxAge(),dialog.getTags());}});jscape.domain.AftpNetworkStorageDialog=jscape.domain.NetworkStorageDialog.extend({TIMEOUT_FACTOR:60*1000,DEFAULT_BIT_RATE:45*1000*1000,DEFAULT_MAX_AGE:10,keyUsage:{},initialize:function(dialog){this._super(dialog);var initializing=true;this.host=$("input[name=host]",this.fieldset).textbox({required:true,validType:"non_empty",missingMessage:window.R.string.PROXIES_ERROR_BAD_HOST,invalidMessage:window.R.string.PROXIES_ERROR_BAD_HOST,width:"60%"});this.port=$("input[name=port]",this.fieldset).numberspinner({required:true,min:1,max:65535,width:100});this.timeout=$("input[name=timeout]",this.fieldset).numberspinner({required:true,min:1,max:60,width:60});this.tcpNoDelay=$("input[name=tcpnodelay]:checkbox",this.fieldset);this.security=$("select[name=security]",this.fieldset).combobox({required:true,editable:false,onChange:$.proxy(function(val){if(!initializing){this._adjustSecurityMode(val);}},this),width:"40%",panelHeight:"auto"});this.useHostKey=$("input[name=usehostkey]:checkbox",this.fieldset).prop("disabled",true);this.useHostKey.change($.proxy(function(){this.hostKey.combobox(this.useHostKey.is(":checked:not(:disabled)")?"enable":"disable");},this));this.hostKey=$("select[name=hostkey]",this.fieldset);this.hostKey.combobox({editable:false,disabled:true,width:170,panelHeight:"auto",panelMaxHeight:150,onLoadSuccess:$.proxy(function(data){this.useHostKey.prop("disabled",data.length==0);if(data.length!=0){this.hostKey.combobox("select",data[0].value);}},this)});this.clientKeyButton=$("a[role=button][name=selectclientkey]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$ClientKeyButton,this)});this.credentials=$("input[name=credentials]:radio",this.fieldset);this.enterCredentials=this.credentials.filter("[value=enter]");this.replayCredentials=this.credentials.filter("[value=replay]");this.credentials.change($.proxy(function(){var enabled=this.enterCredentials.is(":checked");this.username.textbox(enabled?"enable":"disable").textbox(enabled?"enableValidation":"disableValidation");this.password.passwordbox2(enabled?"enable":"disable");},this));this.username=$("input[name=username]",this.fieldset).textbox({required:true,validType:"proxy_username_nonempty",missingMessage:window.R.string.PROXIES_ERROR_BAD_USER,width:"40%"});this.password=$("input[name=userpwd]",this.fieldset).passwordbox2({width:"40%"});this.remoteDirectory=$("input[name=remotedirectory]:radio",this.fieldset).change($.proxy(function(){this.remoteDirectoryPath.textbox(this.isRemoteDirectory()?"enable":"disable");},this));this.remoteDirectoryPath=$("input[name=remotepath]",this.fieldset).textbox({width:"60%"});this.maxAge=$("input[name=maxage]:checkbox",this.fieldset);this.maxAge.change($.proxy(function(){var enabled=this.maxAge.is(":checked");this.ttl.numberspinner(enabled?"enable":"disable").numberspinner(enabled?"enableValidation":"disableValidation")},this));this.ttl=$("input[name=ttl]",this.fieldset).numberspinner({required:true,disabled:true,min:1,max:1000,width:70});this.downloadRate=$("input[name=downloadrate]",this.fieldset).numberspinner({required:true,min:1,max:9999,increment:10,value:this.DEFAULT_BIT_RATE,unitbox:$("select[name=downloadrateunit]",this.fieldset).combobox({required:true,editable:false,width:100,panelHeight:"auto"}),width:"15%"});this.uploadRate=$("input[name=uploadrate]",this.fieldset).numberspinner({required:true,min:1,max:9999,increment:10,value:this.DEFAULT_BIT_RATE,unitbox:$("select[name=uploadrateunit]",this.fieldset).combobox({required:true,editable:false,width:100,panelHeight:"auto"}),width:"15%"});this.congestionControlEnabled=$("input[name=congestioncontrol]:checkbox",this.fieldset);initializing=false;},getName:function(){throw"Abstract method.";},getHost:function(){return this.host.textbox("getValue");},setHost:function(value){this.host.textbox("setValue",value);},getPort:function(){return this.port.numberspinner("getValue");},setPort:function(value){this.port.numberspinner("setValue",value);},getTimeout:function(){return this.timeout.numberspinner("getValue")*this.TIMEOUT_FACTOR;},setTimeout:function(value){this.timeout.numberspinner("setValue",parseInt(value)/this.TIMEOUT_FACTOR);},getTcpNoDelay:function(){return this.tcpNoDelay.is(":checked");},setTcpNoDelay:function(value){this.tcpNoDelay.prop("checked",!!value);},setKeyUsage:function(keyUsage){this.keyUsage=$.extend({},keyUsage);},getSecurityMode:function(){return this.security.combobox("getValue");},setSecurityMode:function(value){this.security.combobox("setValue",value);},isReplayCredentials:function(){return this.replayCredentials.is(":checked");},getUsername:function(){return this.enterCredentials.is(":checked")?this.username.textbox("getValue"):null;},setUsername:function(value){if(value!=null){this.username.textbox("setValue",value);this.enterCredentials.prop("checked",true).change();}else{this.replayCredentials.prop("checked",true).change();}},getPassword:function(){return this.enterCredentials.is(":checked")?this.password.passwordbox2("getValue"):null;},setPassword:function(value){this.password.passwordbox2("setValue",value);},getHostKey:function(){return this.useHostKey.is(":checked:not(:disabled)")?this.hostKey.combobox("getValue"):null;},setHostKey:function(value){this.useHostKey.prop("checked",value!=null).change();if(value!=null){this.hostKey.combobox("setValue",value);}},setHostKeys:function(values){this.hostKey.combobox("loadData",values);},isRemoteDirectory:function(){return this.remoteDirectory.filter("[value=remote]").is(":checked");},setRemoteDirectory:function(value){this.remoteDirectory.filter(!!value?"[value=remote]":":not([value=remote])").first().prop("checked",true).change();},getRemoteDirectoryPath:function(){return this.remoteDirectoryPath.textbox("getValue");},setRemoteDirectoryPath:function(value){this.remoteDirectoryPath.textbox("setValue",value);this.setRemoteDirectory(value&&value.length!=0);},getMaxAge:function(){return this.maxAge.is(":checked")?this.ttl.numberspinner("getValue")*this.TIMEOUT_FACTOR:null;},setMaxAge:function(value){value=parseInt(value);this.maxAge.prop("checked",!isNaN(value)).change();this.ttl.numberspinner("setValue",!isNaN(value)?value/this.TIMEOUT_FACTOR:this.DEFAULT_MAX_AGE);},getDownloadRate:function(){return parseInt(this.downloadRate.numberspinner("getValue"));},setDownloadRate:function(value){this.downloadRate.numberspinner("setValue",parseInt(value));},getUploadRate:function(){return parseInt(this.uploadRate.numberspinner("getValue"));},setUploadRate:function(value){this.uploadRate.numberspinner("setValue",parseInt(value));},isCongestionControlEnabled:function(){return this.congestionControlEnabled.is(":checked");},setCongestionControlEnabled:function(value){this.congestionControlEnabled.prop("checked",!!value);},show:function(listener){this._super(listener||jscape.domain.AftpNetworkStorageDialog.LISTENER);this._adjustSecurityMode(this.getSecurityMode());},_insertVariableAllowed:function(field){return this._super(field)&&this.remoteDirectoryPath.textbox("textbox").is(field);},_onClick$ClientKeyButton:function(){this.listener.onSelectClientKey();},_adjustSecurityMode:function(mode){var enabled=!!this.keyUsage[mode];this.useHostKey.prop("disabled",!enabled).change();this.clientKeyButton.linkbutton(enabled?"enable":"disable");}});jscape.domain.AftpNetworkStorageDialog.LISTENER=$.extend({},jscape.domain.NetworkStorageDialog.LISTENER,{onSelectClientKey:$.noop});jscape.domain.AddAftpNetworkStorageDialog=jscape.domain.AftpNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-add-aftp"));this.name=$("input[name=name]",this.fieldset).textbox({required:true,validType:["non_empty","proxy_unique"],missingMessage:window.R.string.PROXIES_ERROR_BAD_NAME,invalidMessage:window.R.string.PROXIES_ERROR_BAD_NAME,width:"60%"});},getName:function(){return this.name.textbox("getValue");}});jscape.domain.EditAftpNetworkStorageDialog=jscape.domain.AftpNetworkStorageDialog.extend({proxyName:"",initialize:function(){this._super($("#d-proxy-edit-aftp"));this.title=this.dialog.dialog("header").text()||"";},getName:function(){return this.proxyName;},setName:function(value){this.proxyName=value;this.dialog.dialog("setTitle",this.title.supplant({0:value}));}});jscape.domain.AddWebDavNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({onSubmit:function(dialog){return this.listener.onAddNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.AddWebDavNetworkStorageDialog();dialog.setPort(80);dialog.setUsername("");dialog.setPassword("");dialog.setPath("/");dialog.setRemoteDirectory(true);dialog.setDebugDirectory(null);return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.webdav(dialog.getName(),dialog.getHost(),dialog.getPort(),dialog.getDomain(),dialog.getPath(),dialog.isUseSsl(),dialog.getUsername(),dialog.getPassword(),dialog.isReplayCredentials(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.EditWebDavNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({start:function(listener,domainName,descriptor){this.descriptor=descriptor;return this._super(listener,domainName);},onSubmit:function(dialog){return this.listener.onEditNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.EditWebDavNetworkStorageDialog();var descriptor=this.descriptor;if(descriptor){dialog.setName(descriptor.name);dialog.setHost(descriptor.host);dialog.setPort(descriptor.port);dialog.setUsername(descriptor.username);dialog.setPassword(descriptor.password);dialog.setPath(descriptor.path);dialog.setDomain(descriptor.domain);dialog.setUseSsl(descriptor.useSsl);dialog.setRemoteDirectoryPath(descriptor.remoteDirectory.path);dialog.setRemoteDirectory(jscape.RemoteDirectory.Type.LOCAL!=descriptor.remoteDirectory.type);dialog.setDebugDirectory(descriptor.logDirectory);dialog.setTags(descriptor.tags);}
return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.webdav(this.descriptor.name,dialog.getHost(),dialog.getPort(),dialog.getDomain(),dialog.getPath(),dialog.isUseSsl(),dialog.getUsername(),dialog.getPassword(),dialog.isReplayCredentials(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.WebDavNetworkStorageDialog=jscape.domain.NetworkStorageDialog.extend({initialize:function(dialog){this._super(dialog);this.host=$("input[name=host]",this.fieldset).textbox({required:true,validType:"non_empty",missingMessage:window.R.string.PROXIES_ERROR_BAD_HOST,invalidMessage:window.R.string.PROXIES_ERROR_BAD_HOST,width:"60%"});this.port=$("input[name=port]",this.fieldset).numberspinner({required:true,min:1,max:65535,width:100});this.path=$("input[name=path]",this.fieldset).textbox({width:"50%"});this.domain=$("input[name=domain]",this.fieldset).textbox({width:"50%"});this.credentials=$("input[name=credentials]:radio",this.fieldset);this.enterCredentials=this.credentials.filter("[value=enter]");this.replayCredentials=this.credentials.filter("[value=replay]");this.credentials.change($.proxy(function(){var enabled=this.enterCredentials.is(":checked");this.username.textbox(enabled?"enable":"disable").textbox(enabled?"enableValidation":"disableValidation");this.password.passwordbox2(enabled?"enable":"disable");},this));this.username=$("input[name=username]",this.fieldset).textbox({required:true,validType:"proxy_username_nonempty",missingMessage:window.R.string.PROXIES_ERROR_BAD_USER,width:"50%"});this.password=$("input[name=userpwd]",this.fieldset).passwordbox2({width:"50%"});this.useSsl=$("input[name=ssl]:checkbox",this.fieldset);this.remoteDirectory=$("input[name=remotedirectory]:radio",this.fieldset).change($.proxy(function(){this.remoteDirectoryPath.textbox(this.isRemoteDirectory()?"enable":"disable");},this));this.remoteDirectoryPath=$("input[name=remotepath]",this.fieldset).textbox({width:"60%"});},getName:function(){throw"Abstract method.";},getHost:function(){return this.host.textbox("getValue");},setHost:function(value){this.host.textbox("setValue",value);},getPort:function(){return this.port.numberspinner("getValue");},setPort:function(value){this.port.numberspinner("setValue",value);},getPath:function(){return this.path.textbox("getValue");},setPath:function(value){this.path.textbox("setValue",value);},getDomain:function(){return this.domain.textbox("getValue");},setDomain:function(value){this.domain.textbox("setValue",value);},isReplayCredentials:function(){return this.replayCredentials.is(":checked");},getUsername:function(){return this.enterCredentials.is(":checked")?this.username.textbox("getValue"):null;},setUsername:function(value){if(value!=null){this.username.textbox("setValue",value);this.enterCredentials.prop("checked",true).change();}else{this.replayCredentials.prop("checked",true).change();}},getPassword:function(){return this.enterCredentials.is(":checked")?this.password.passwordbox2("getValue"):null;},setPassword:function(value){this.password.passwordbox2("setValue",value);},isUseSsl:function(){return this.useSsl.is(":checked");},setUseSsl:function(value){this.useSsl.prop("checked",!!value);},isRemoteDirectory:function(){return this.remoteDirectory.filter("[value=remote]").is(":checked");},setRemoteDirectory:function(value){this.remoteDirectory.filter(!!value?"[value=remote]":":not([value=remote])").first().prop("checked",true).change();},getRemoteDirectoryPath:function(){return this.remoteDirectoryPath.textbox("getValue");},setRemoteDirectoryPath:function(value){this.remoteDirectoryPath.textbox("setValue",value);this.setRemoteDirectory(value&&value.length!=0);},_insertVariableAllowed:function(field){return this._super(field)&&this.remoteDirectoryPath.textbox("textbox").is(field);}});jscape.domain.AddWebDavNetworkStorageDialog=jscape.domain.WebDavNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-add-webdav"));this.name=$("input[name=name]",this.fieldset).textbox({required:true,validType:["non_empty","proxy_unique"],missingMessage:window.R.string.PROXIES_ERROR_BAD_NAME,invalidMessage:window.R.string.PROXIES_ERROR_BAD_NAME,width:"60%"});},getName:function(){return this.name.textbox("getValue");}});jscape.domain.EditWebDavNetworkStorageDialog=jscape.domain.WebDavNetworkStorageDialog.extend({proxyName:"",initialize:function(){this._super($("#d-proxy-edit-webdav"));this.title=this.dialog.dialog("header").text()||"";},getName:function(){return this.proxyName;},setName:function(value){this.proxyName=value;this.dialog.dialog("setTitle",this.title.supplant({0:value}));}});jscape.domain.AddRestNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({onSubmit:function(dialog){return this.listener.onAddNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.AddRestNetworkStorageDialog();dialog.setPort(80);dialog.setTimeout(1000);dialog.setUsername("");dialog.setPassword("");dialog.setRemoteDirectory(true);dialog.setDebugDirectory(null);dialog.setMaxAge(10*60*1000);return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.rest(dialog.getName(),dialog.getHost(),dialog.getPort(),dialog.getTimeout(),dialog.isSslRequired(),dialog.getDomain(),dialog.getUsername(),dialog.getPassword(),dialog.isReplayCredentials(),dialog.getKeyFile().length!=0?new jscape.FileKeyProvider(dialog.getKeyFile(),dialog.getKeyFilePassword()):null,dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getMaxAge(),dialog.getTags());}});jscape.domain.EditRestNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({start:function(listener,domainName,descriptor){this.descriptor=descriptor;return this._super(listener,domainName);},onSubmit:function(dialog){return this.listener.onEditNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.EditRestNetworkStorageDialog();var descriptor=this.descriptor;if(descriptor){dialog.setName(descriptor.name);dialog.setHost(descriptor.host);dialog.setPort(descriptor.port);dialog.setTimeout(descriptor.timeout);dialog.setSslRequired(descriptor.sslRequired);dialog.setDomain(descriptor.domain);dialog.setUsername(descriptor.username);dialog.setPassword(descriptor.password);if(descriptor.keyProvider){dialog.setKeyFile(descriptor.keyProvider.file);dialog.setKeyFilePassword(descriptor.keyProvider.filePassword);}
dialog.setRemoteDirectoryPath(descriptor.remoteDirectory.path);dialog.setRemoteDirectory(jscape.RemoteDirectory.Type.LOCAL!=descriptor.remoteDirectory.type);dialog.setDebugDirectory(descriptor.logDirectory);dialog.setMaxAge(descriptor.timeToLive);dialog.setTags(descriptor.tags);}
return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.rest(this.descriptor.name,dialog.getHost(),dialog.getPort(),dialog.getTimeout(),dialog.isSslRequired(),dialog.getDomain(),dialog.getUsername(),dialog.getPassword(),dialog.isReplayCredentials(),dialog.getKeyFile().length!=0?new jscape.FileKeyProvider(dialog.getKeyFile(),dialog.getKeyFilePassword()):null,dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getMaxAge(),dialog.getTags());}});jscape.domain.RestNetworkStorageDialog=jscape.domain.NetworkStorageDialog.extend({TIMEOUT_FACTOR:60*1000,initialize:function(dialog){this._super(dialog);this.host=$("input[name=host]",this.fieldset).textbox({required:true,validType:"non_empty",missingMessage:window.R.string.PROXIES_ERROR_BAD_HOST,invalidMessage:window.R.string.PROXIES_ERROR_BAD_HOST,width:"60%"});this.port=$("input[name=port]",this.fieldset).numberspinner({required:true,min:1,max:65535,width:100});this.timeout=$("input[name=timeout]",this.fieldset).numberspinner({required:true,min:1,max:60,width:60});this.sslRequired=$("input[name=ssl]:checkbox",this.fieldset);this.domain=$("input[name=domain]",this.fieldset).textbox({required:true,width:"50%"});this.credentials=$("input[name=credentials]:radio",this.fieldset);this.enterCredentials=this.credentials.filter("[value=enter]");this.replayCredentials=this.credentials.filter("[value=replay]");this.credentials.change($.proxy(function(){var enabled=this.enterCredentials.is(":checked");this.username.textbox(enabled?"enable":"disable").textbox(enabled?"enableValidation":"disableValidation");this.password.passwordbox2(enabled?"enable":"disable");},this));this.username=$("input[name=username]",this.fieldset).textbox({required:true,validType:"proxy_username_nonempty",missingMessage:window.R.string.PROXIES_ERROR_BAD_USER,width:"50%"});this.password=$("input[name=userpwd]",this.fieldset).passwordbox2({width:"50%"});this.keyFile=$("input[name=keyfile]",this.fieldset).textbox({width:"50%"});this.keyFilePassword=$("input[name=keyfilepwd]",this.fieldset).passwordbox2({width:"50%"});this.keyFileBrowseButton=$("a[role=button][name=keyfilebrowse]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$KeyFileBrowseButton,this)});this.remoteDirectory=$("input[name=remotedirectory]:radio",this.fieldset).change($.proxy(function(){this.remoteDirectoryPath.textbox(this.isRemoteDirectory()?"enable":"disable");},this));this.remoteDirectoryPath=$("input[name=remotepath]",this.fieldset).textbox({width:"60%"});this.maxAge=$("input[name=maxage]:checkbox",this.fieldset);this.maxAge.change($.proxy(function(){var enabled=this.maxAge.is(":checked");this.ttl.numberspinner(enabled?"enable":"disable").numberspinner(enabled?"enableValidation":"disableValidation");},this));this.ttl=$("input[name=ttl]",this.fieldset).numberspinner({required:true,disabled:true,min:1,max:1000,width:70});},getName:function(){throw"Abstract method.";},getHost:function(){return this.host.textbox("getValue");},setHost:function(value){this.host.textbox("setValue",value);},getPort:function(){return this.port.numberspinner("getValue");},setPort:function(value){this.port.numberspinner("setValue",value);},getTimeout:function(){return this.timeout.numberspinner("getValue")*this.TIMEOUT_FACTOR;},setTimeout:function(value){this.timeout.numberspinner("setValue",parseInt(value)/this.TIMEOUT_FACTOR);},isSslRequired:function(){return this.sslRequired.is(":checked");},setSslRequired:function(value){this.sslRequired.prop("checked",!!value);},getDomain:function(){return this.domain.textbox("getValue");},setDomain:function(value){this.domain.textbox("setValue",value);},isReplayCredentials:function(){return this.replayCredentials.is(":checked");},getUsername:function(){return this.enterCredentials.is(":checked")?this.username.textbox("getValue"):null;},setUsername:function(value){if(value!=null){this.username.textbox("setValue",value);this.enterCredentials.prop("checked",true).change();}else{this.replayCredentials.prop("checked",true).change();}},getPassword:function(){return this.enterCredentials.is(":checked")?this.password.passwordbox2("getValue"):null;},setPassword:function(value){this.password.passwordbox2("setValue",value);},getKeyFile:function(){return this.keyFile.textbox("getValue").trim();},setKeyFile:function(value){this.keyFile.textbox("setValue",value);},getKeyFilePassword:function(){return this.keyFilePassword.passwordbox2("getValue");},setKeyFilePassword:function(value){this.keyFilePassword.passwordbox2("setValue",value);},isRemoteDirectory:function(){return this.remoteDirectory.filter("[value=remote]").is(":checked");},setRemoteDirectory:function(value){this.remoteDirectory.filter(!!value?"[value=remote]":":not([value=remote])").first().prop("checked",true).change();},getRemoteDirectoryPath:function(){return this.remoteDirectoryPath.textbox("getValue");},setRemoteDirectoryPath:function(value){this.remoteDirectoryPath.textbox("setValue",value);this.setRemoteDirectory(value&&value.length!=0);},getMaxAge:function(){return this.maxAge.is(":checked")?this.ttl.numberspinner("getValue")*this.TIMEOUT_FACTOR:null;},setMaxAge:function(value){value=parseInt(value);this.maxAge.prop("checked",!isNaN(value)).change();this.ttl.numberspinner("setValue",!isNaN(value)?value/this.TIMEOUT_FACTOR:this.DEFAULT_MAX_AGE);},show:function(listener){this._super(listener||jscape.domain.RestNetworkStorageDialog.LISTENER);},_insertVariableAllowed:function(field){return this._super(field)&&this.remoteDirectoryPath.textbox("textbox").is(field);},_onClick$KeyFileBrowseButton:function(){this.keyFileBrowseButton.linkbutton("disable");this.listener.onSelectKeyFile(this).done($.proxy(function(value){this.keyFile.textbox("setValue",value).textbox("textbox").select().focus();},this)).always($.proxy(function(){this.keyFileBrowseButton.linkbutton("enable");},this));}});jscape.domain.RestNetworkStorageDialog.LISTENER=$.extend({},jscape.domain.NetworkStorageDialog.LISTENER,{onSelectKeyFile:$.noop});jscape.domain.AddRestNetworkStorageDialog=jscape.domain.RestNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-add-rest"));this.name=$("input[name=name]",this.fieldset).textbox({required:true,validType:["non_empty","proxy_unique"],missingMessage:window.R.string.PROXIES_ERROR_BAD_NAME,invalidMessage:window.R.string.PROXIES_ERROR_BAD_NAME,width:"60%"});},getName:function(){return this.name.textbox("getValue");}});jscape.domain.EditRestNetworkStorageDialog=jscape.domain.RestNetworkStorageDialog.extend({proxyName:"",initialize:function(){this._super($("#d-proxy-edit-rest"));this.title=this.dialog.dialog("header").text()||"";},getName:function(){return this.proxyName;},setName:function(value){this.proxyName=value;this.dialog.dialog("setTitle",this.title.supplant({0:value}));}});jscape.domain.AddAmazonS3NetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({DEFAULT_REGION:"us-west-2",kmsKeys:{params:null,items:null},onRefreshKmsKeys:function(dialog){var descriptor=this._createDescriptor(dialog);var params={u:descriptor.username,p:descriptor.password,r:descriptor.region};if(this.kmsKeys&&Object._equals(params,this.kmsKeys.params)&&this.kmsKeys.items&&this.kmsKeys.items.length){return $.Deferred().resolve(this.kmsKeys.items);}
if(!descriptor.name){descriptor.name="amazons3";}
return jscape.API.getNetworkStorageAmazonKmsKeys(this.domainName,descriptor.name,descriptor).done($.proxy(function(keys){this.kmsKeys={params:params,items:keys};},this));},onSubmit:function(dialog){return this.listener.onAddNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.AddAmazonS3NetworkStorageDialog();dialog.setUsername("");dialog.setPassword("");dialog.setRegion(this.DEFAULT_REGION);dialog.setRemoteDirectory(true);dialog.setDebugDirectory(null);return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.amazonS3(dialog.getName(),dialog.getEncryptionType(),dialog.getKmsKey(),dialog.getUsername(),dialog.getPassword(),dialog.getAuthenticationType(),dialog.getRegion(),dialog.isPaymentRequired(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.EditAmazonS3NetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({kmsKeys:{params:null,items:null},start:function(listener,domainName,descriptor){this.descriptor=descriptor;return this._super(listener,domainName);},onRefreshKmsKeys:function(dialog){var descriptor=this._createDescriptor(dialog);var params={u:descriptor.username,p:descriptor.password,r:descriptor.region};if(this.kmsKeys&&Object._equals(params,this.kmsKeys.params)&&this.kmsKeys.items&&this.kmsKeys.items.length){return $.Deferred().resolve(this.kmsKeys.items);}
return jscape.API.getNetworkStorageAmazonKmsKeys(this.domainName,this.descriptor.name,descriptor).done($.proxy(function(keys){this.kmsKeys={params:params,items:keys};},this));},onSubmit:function(dialog){return this.listener.onEditNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.EditAmazonS3NetworkStorageDialog();var descriptor=this.descriptor;if(descriptor){dialog.setName(descriptor.name);dialog.setEncryptionType("NONE"!==descriptor.encryptionType?descriptor.encryptionType:null);dialog.setKmsKey(descriptor.kmsKeyId);dialog.setUsername(descriptor.username);dialog.setPassword(descriptor.password);dialog.setAuthenticationType(descriptor.authenticationType);dialog.setRegion(descriptor.region);dialog.setPaymentRequired(descriptor.requesterPaymentRequired);dialog.setRemoteDirectoryPath(descriptor.remoteDirectory.path);dialog.setRemoteDirectory(jscape.RemoteDirectory.Type.LOCAL!=descriptor.remoteDirectory.type);dialog.setDebugDirectory(descriptor.logDirectory);dialog.setTags(descriptor.tags);}
return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.amazonS3(this.descriptor.name,dialog.getEncryptionType(),dialog.getKmsKey(),dialog.getUsername(),dialog.getPassword(),dialog.getAuthenticationType(),dialog.getRegion(),dialog.isPaymentRequired(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.AmazonS3NetworkStorageDialog=jscape.domain.NetworkStorageDialog.extend({initialize:function(dialog){this._super(dialog);var initializing=true;this.useEncryption=$("input[name=encrypt]:checkbox",this.fieldset).change($.proxy(function(){this.encryption.change();},this));this.encryption=$("input[name=encryption]:radio",this.fieldset);this.ecnryptionAwsKms=this.encryption.filter("[value=AWS_KMS_MANAGED_KEYS]");this.encryptionAwsKmsKey=$("select[name=kmskey]",this.fieldset).combobox({required:true,editable:false,width:220,inputEvents:$.extend({},$.fn.combobox.defaults.inputEvents,{focus:function(e){$(e.data.target).combobox("reload");}}),onBeforeLoad:function(){return!initializing;},loader:$.proxy(this._onLoad$KmsKeys,this)});this.encryption.change($.proxy(function(){if(this.useEncryption.is(":checked")){this.encryption.each(function(_,input){$(input).prop("disabled",false);});this.encryptionAwsKmsKey.combobox(this.ecnryptionAwsKms.is(":checked")?"enable":"disable");}else{this.encryption.each(function(_,input){$(input).prop("disabled",true);});this.encryptionAwsKmsKey.combobox("disable");}},this)).first().prop("checked",true).end().change();this.authentication=$("input[name=authentication]:radio",this.fieldset);this.enterCredentials=this.authentication.filter("[value=CREDENTIALS]");this.replayCredentials=this.authentication.filter("[value=USER_CREDENTIALS]");this.authentication.change($.proxy(function(){var enabled=this.enterCredentials.is(":checked");this.username.textbox(enabled?"enable":"disable").textbox(enabled?"enableValidation":"disableValidation");this.password.passwordbox2(enabled?"enable":"disable");},this));this.username=$("input[name=username]",this.fieldset).textbox({required:true,validType:"proxy_username_nonempty",missingMessage:window.R.string.PROXIES_ERROR_BAD_USER,width:"50%"});this.password=$("input[name=password]",this.fieldset).passwordbox2({width:"50%"});this.region=$("select[name=region]",this.fieldset).combobox({required:true,editable:false,width:"40%"});this.paymentRequired=$("input[name=requesterpays]:checkbox",this.fieldset);this.remoteDirectory=$("input[name=remotedirectory]:radio",this.fieldset).change($.proxy(function(){this.remoteDirectoryPath.textbox(this.isRemoteDirectory()?"enable":"disable");},this));this.remoteDirectoryPath=$("input[name=remotepath]",this.fieldset).textbox({width:"60%"});initializing=false;},getName:function(){throw"Abstract method.";},getEncryptionType:function(){return this.useEncryption.is(":checked")?this.encryption.filter(":checked").val():null;},setEncryptionType:function(value){if(value){this.encryption.filter("[value="+value+"]").prop("checked",true);this.useEncryption.prop("checked",true).change();}else{this.useEncryption.prop("checked",false).change();}},getKmsKey:function(){return this.ecnryptionAwsKms.is(":checked:not(:disabled)")?this.encryptionAwsKmsKey.combobox("getValue"):null;},setKmsKey:function(value){this.encryptionAwsKmsKey.combobox("setValue",value);},getUsername:function(){return this.enterCredentials.is(":checked")?this.username.textbox("getValue"):null;},setUsername:function(value){if(value!=null){this.username.textbox("setValue",value);this.enterCredentials.prop("checked",true).change();}else{this.replayCredentials.prop("checked",true).change();}},getPassword:function(){return this.enterCredentials.is(":checked")?this.password.passwordbox2("getValue"):null;},setPassword:function(value){this.password.passwordbox2("setValue",value);},getAuthenticationType:function(){return this.authentication.filter(":checked").val();},setAuthenticationType:function(value){this.authentication.filter("[value="+value+"]").prop("checked",true).change();},isRemoteDirectory:function(){return this.remoteDirectory.filter("[value=remote]").is(":checked");},setRemoteDirectory:function(value){this.remoteDirectory.filter(!!value?"[value=remote]":":not([value=remote])").first().prop("checked",true).change();},getRegion:function(){return this.region.combobox("getValue");},setRegion:function(value){this.region.combobox("select",value);},isPaymentRequired:function(){return this.paymentRequired.is(":checked");},setPaymentRequired:function(value){this.paymentRequired.prop("checked",!!value);},getRemoteDirectoryPath:function(){return this.remoteDirectoryPath.textbox("getValue");},setRemoteDirectoryPath:function(value){this.remoteDirectoryPath.textbox("setValue",value);this.setRemoteDirectory(value&&value.length!=0);},_insertVariableAllowed:function(field){return this._super(field)&&this.remoteDirectoryPath.textbox("textbox").is(field);},_onLoad$KmsKeys:function(params,success,error){this.listener.onRefreshKmsKeys(this).done(success).fail(error);}});jscape.domain.AddAmazonS3NetworkStorageDialog=jscape.domain.AmazonS3NetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-add-amazons3"));this.name=$("input[name=name]",this.fieldset).textbox({required:true,validType:["non_empty","proxy_unique"],missingMessage:window.R.string.PROXIES_ERROR_BAD_NAME,invalidMessage:window.R.string.PROXIES_ERROR_BAD_NAME,width:"60%"});},getName:function(){return this.name.textbox("getValue");}});jscape.domain.EditAmazonS3NetworkStorageDialog=jscape.domain.AmazonS3NetworkStorageDialog.extend({proxyName:"",initialize:function(){this._super($("#d-proxy-edit-amazons3"));this.title=this.dialog.dialog("header").text()||"";},getName:function(){return this.proxyName;},setName:function(value){this.proxyName=value;this.dialog.dialog("setTitle",this.title.supplant({0:value}));}});jscape.domain.AddAmazonS3CompatibleNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({DEFAULT_REGION:"us-west-2",onSubmit:function(dialog){return this.listener.onAddNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.AddAmazonS3CompatibleNetworkStorageDialog();dialog.setUsername("");dialog.setPassword("");dialog.setRemoteDirectory(true);dialog.setDebugDirectory(null);return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.amazonS3Compatible(dialog.getName(),dialog.getEndPoint(),dialog.getUsername(),dialog.getPassword(),dialog.getRegion(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.EditAmazonS3CompatibleNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({start:function(listener,domainName,descriptor){this.descriptor=descriptor;return this._super(listener,domainName);},onSubmit:function(dialog){return this.listener.onEditNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.EditAmazonS3CompatibleNetworkStorageDialog();var descriptor=this.descriptor;if(descriptor){dialog.setName(descriptor.name);dialog.setEndPoint(descriptor.endPoint);dialog.setUsername(descriptor.username);dialog.setPassword(descriptor.password);dialog.setRegion(descriptor.region);dialog.setRemoteDirectoryPath(descriptor.remoteDirectory.path);dialog.setRemoteDirectory(jscape.RemoteDirectory.Type.LOCAL!=descriptor.remoteDirectory.type);dialog.setDebugDirectory(descriptor.logDirectory);dialog.setTags(descriptor.tags);}
return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.amazonS3Compatible(this.descriptor.name,dialog.getEndPoint(),dialog.getUsername(),dialog.getPassword(),dialog.getRegion(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.AmazonS3CompatibleNetworkStorageDialog=jscape.domain.NetworkStorageDialog.extend({initialize:function(dialog){this._super(dialog);this.endPoint=$("input[name=endpoint]",this.fieldset).textbox({required:true,validType:"url",width:"60%"});this.username=$("input[name=username]",this.fieldset).textbox({required:true,validType:"proxy_username_nonempty",missingMessage:window.R.string.PROXIES_ERROR_BAD_USER,width:"50%"});this.password=$("input[name=password]",this.fieldset).passwordbox2({width:"50%"});this.region=$("input[name=region]",this.fieldset).textbox({required:false,validType:"non_empty",width:"40%"});this.remoteDirectory=$("input[name=remotedirectory]:radio",this.fieldset).change($.proxy(function(){this.remoteDirectoryPath.textbox(this.isRemoteDirectory()?"enable":"disable");},this));this.remoteDirectoryPath=$("input[name=remotepath]",this.fieldset).textbox({width:"60%"});},getName:function(){throw"Abstract method.";},getEndPoint:function(){return this.endPoint.textbox("getValue");},setEndPoint:function(value){this.endPoint.textbox("setValue",value);},getUsername:function(){return this.username.textbox("getValue");},setUsername:function(value){this.username.textbox("setValue",value);},getPassword:function(){return this.password.passwordbox2("getValue");},setPassword:function(value){this.password.passwordbox2("setValue",value);},isRemoteDirectory:function(){return this.remoteDirectory.filter("[value=remote]").is(":checked");},setRemoteDirectory:function(value){this.remoteDirectory.filter(!!value?"[value=remote]":":not([value=remote])").first().prop("checked",true).change();},getRegion:function(){return this.region.textbox("getValue");},setRegion:function(value){this.region.textbox("setValue",value);},getRemoteDirectoryPath:function(){return this.remoteDirectoryPath.textbox("getValue");},setRemoteDirectoryPath:function(value){this.remoteDirectoryPath.textbox("setValue",value);this.setRemoteDirectory(value&&value.length!=0);},_insertVariableAllowed:function(field){return this._super(field)&&this.remoteDirectoryPath.textbox("textbox").is(field);}});jscape.domain.AddAmazonS3CompatibleNetworkStorageDialog=jscape.domain.AmazonS3CompatibleNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-add-amazons3-compatible"));this.name=$("input[name=name]",this.fieldset).textbox({required:true,validType:["non_empty","proxy_unique"],missingMessage:window.R.string.PROXIES_ERROR_BAD_NAME,invalidMessage:window.R.string.PROXIES_ERROR_BAD_NAME,width:"60%"});},getName:function(){return this.name.textbox("getValue");}});jscape.domain.EditAmazonS3CompatibleNetworkStorageDialog=jscape.domain.AmazonS3CompatibleNetworkStorageDialog.extend({proxyName:"",initialize:function(){this._super($("#d-proxy-edit-amazons3-compatible"));this.title=this.dialog.dialog("header").text()||"";},getName:function(){return this.proxyName;},setName:function(value){this.proxyName=value;this.dialog.dialog("setTitle",this.title.supplant({0:value}));}});jscape.domain.AddTftpNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({onSubmit:function(dialog){return this.listener.onAddNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.AddTftpNetworkStorageDialog();dialog.setPort(69);dialog.setRetransmitInterval(3000);dialog.setMaxRetransmitAttempts(6);dialog.setDebugDirectory(null);return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.tftp(dialog.getName(),dialog.getHost(),dialog.getPort(),dialog.getRetransmitInterval(),dialog.getMaxRetransmitAttempts(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.EditTftpNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({start:function(listener,domainName,descriptor){this.descriptor=descriptor;return this._super(listener,domainName);},onSubmit:function(dialog){return this.listener.onEditNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.EditTftpNetworkStorageDialog();var descriptor=this.descriptor;if(descriptor){dialog.setName(descriptor.name);dialog.setHost(descriptor.host);dialog.setPort(descriptor.port);dialog.setRetransmitInterval(descriptor.retransmitTimeout);dialog.setMaxRetransmitAttempts(descriptor.maxRetransmitAttempts);dialog.setDebugDirectory(descriptor.logDirectory);dialog.setTags(descriptor.tags);}
return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.tftp(this.descriptor.name,dialog.getHost(),dialog.getPort(),dialog.getRetransmitInterval(),dialog.getMaxRetransmitAttempts(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.TftpNetworkStorageDialog=jscape.domain.NetworkStorageDialog.extend({TIME_FACTOR:1000,initialize:function(dialog){this._super(dialog);this.host=$("input[name=host]",this.fieldset).textbox({required:true,validType:"non_empty",missingMessage:window.R.string.PROXIES_ERROR_BAD_HOST,invalidMessage:window.R.string.PROXIES_ERROR_BAD_HOST,width:"60%"});this.port=$("input[name=port]",this.fieldset).numberspinner({required:true,min:1,max:65535,width:100});this.retransmitInterval=$("input[name=retransmitinterval]",this.fieldset).numberspinner({required:true,min:1,max:255,width:60});this.retransmitAttempts=$("input[name=retransmitattempts]",this.fieldset).numberspinner({required:true,min:1,max:100,width:60});},getName:function(){throw"Abstract method.";},getHost:function(){return this.host.textbox("getValue");},setHost:function(value){this.host.textbox("setValue",value);},getPort:function(){return this.port.numberspinner("getValue");},setPort:function(value){this.port.numberspinner("setValue",parseInt(value)).numberspinner("validate");},getRetransmitInterval:function(){return parseInt(this.retransmitInterval.numberspinner("getValue"))*this.TIME_FACTOR;},setRetransmitInterval:function(value){this.retransmitInterval.numberspinner("setValue",parseInt(value)/this.TIME_FACTOR);},getMaxRetransmitAttempts:function(){return parseInt(this.retransmitAttempts.numberspinner("getValue"));},setMaxRetransmitAttempts:function(value){this.retransmitAttempts.numberspinner("setValue",parseInt(value)).numberspinner("validate");}});jscape.domain.AddTftpNetworkStorageDialog=jscape.domain.TftpNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-add-tftp"));this.name=$("input[name=name]",this.fieldset).textbox({required:true,validType:["non_empty","proxy_unique"],missingMessage:window.R.string.PROXIES_ERROR_BAD_NAME,invalidMessage:window.R.string.PROXIES_ERROR_BAD_NAME,width:"60%"});},getName:function(){return this.name.textbox("getValue");}});jscape.domain.EditTftpNetworkStorageDialog=jscape.domain.TftpNetworkStorageDialog.extend({proxyName:"",initialize:function(){this._super($("#d-proxy-edit-tftp"));this.title=this.dialog.dialog("header").text()||"";},getName:function(){return this.proxyName;},setName:function(value){this.proxyName=value;this.dialog.dialog("setTitle",this.title.supplant({0:value}));}});jscape.domain.AddSmbNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({onSubmit:function(dialog){return this.listener.onAddNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.AddSmbNetworkStorageDialog();dialog.setPort(445);dialog.setTimeout(60*1000);dialog.setUsername("");dialog.setPassword("");dialog.setRemoteDirectory(true);dialog.setDebugDirectory(null);return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.smb(dialog.getName(),dialog.getHost(),dialog.getPort(),dialog.getTimeout(),dialog.getDomain(),dialog.getUsername(),dialog.getPassword(),dialog.isReplayCredentials(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.EditSmbNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({start:function(listener,domainName,descriptor){this.descriptor=descriptor;return this._super(listener,domainName);},onSubmit:function(dialog){return this.listener.onEditNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.EditSmbNetworkStorageDialog();var descriptor=this.descriptor;if(descriptor){dialog.setName(descriptor.name);dialog.setHost(descriptor.host);dialog.setPort(descriptor.port);dialog.setTimeout(descriptor.timeout);dialog.setUsername(descriptor.username);dialog.setPassword(descriptor.password);dialog.setDomain(descriptor.domain);dialog.setRemoteDirectoryPath(descriptor.remoteDirectory.path);dialog.setRemoteDirectory(jscape.RemoteDirectory.Type.LOCAL!=descriptor.remoteDirectory.type);dialog.setDebugDirectory(descriptor.logDirectory);dialog.setTags(descriptor.tags);}
return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.smb(this.descriptor.name,dialog.getHost(),dialog.getPort(),dialog.getTimeout(),dialog.getDomain(),dialog.getUsername(),dialog.getPassword(),dialog.isReplayCredentials(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.SmbNetworkStorageDialog=jscape.domain.NetworkStorageDialog.extend({TIMEOUT_FACTOR:60*1000,initialize:function(dialog){this._super(dialog);this.host=$("input[name=host]",this.fieldset).textbox({required:true,validType:"non_empty",missingMessage:window.R.string.PROXIES_ERROR_BAD_HOST,invalidMessage:window.R.string.PROXIES_ERROR_BAD_HOST,width:"60%"});this.port=$("input[name=port]",this.fieldset).numberspinner({required:true,min:1,max:65535,width:100});this.timeout=$("input[name=timeout]",this.fieldset).numberspinner({required:true,min:1,max:60,width:60});this.credentials=$("input[name=credentials]:radio",this.fieldset);this.enterCredentials=this.credentials.filter("[value=enter]");this.replayCredentials=this.credentials.filter("[value=replay]");this.credentials.change($.proxy(function(){var enabled=this.enterCredentials.is(":checked");this.username.textbox(enabled?"enable":"disable").textbox(enabled?"enableValidation":"disableValidation");this.password.passwordbox2(enabled?"enable":"disable");},this));this.username=$("input[name=username]",this.fieldset).textbox({required:true,validType:"proxy_username_nonempty",missingMessage:window.R.string.PROXIES_ERROR_BAD_USER,width:"50%"});this.password=$("input[name=userpwd]",this.fieldset).passwordbox2({width:"50%"});this.domain=$("input[name=domain]",this.fieldset).textbox({width:"50%"});this.remoteDirectory=$("input[name=remotedirectory]:radio",this.fieldset).change($.proxy(function(){this.remoteDirectoryPath.textbox(this.isRemoteDirectory()?"enable":"disable");},this));this.remoteDirectoryPath=$("input[name=remotepath]",this.fieldset).textbox({width:"60%"});},getName:function(){throw"Abstract method.";},getHost:function(){return this.host.textbox("getValue");},setHost:function(value){this.host.textbox("setValue",value);},getPort:function(){return this.port.numberspinner("getValue");},setPort:function(value){this.port.numberspinner("setValue",value);},getTimeout:function(){return this.timeout.numberspinner("getValue")*this.TIMEOUT_FACTOR;},setTimeout:function(value){this.timeout.numberspinner("setValue",parseInt(value)/this.TIMEOUT_FACTOR).numberspinner("validate");},getDomain:function(){return this.domain.textbox("getValue");},setDomain:function(value){this.domain.textbox("setValue",value);},isReplayCredentials:function(){return this.replayCredentials.is(":checked");},getUsername:function(){return this.enterCredentials.is(":checked")?this.username.textbox("getValue"):null;},setUsername:function(value){if(value!=null){this.username.textbox("setValue",value);this.enterCredentials.prop("checked",true).change();}else{this.replayCredentials.prop("checked",true).change();}},getPassword:function(){return this.enterCredentials.is(":checked")?this.password.passwordbox2("getValue"):null;},setPassword:function(value){this.password.passwordbox2("setValue",value);},isRemoteDirectory:function(){return this.remoteDirectory.filter("[value=remote]").is(":checked");},setRemoteDirectory:function(value){this.remoteDirectory.filter(!!value?"[value=remote]":":not([value=remote])").first().prop("checked",true).change();},getRemoteDirectoryPath:function(){return this.remoteDirectoryPath.textbox("getValue");},setRemoteDirectoryPath:function(value){this.remoteDirectoryPath.textbox("setValue",value);this.setRemoteDirectory(value&&value.length!=0);},_insertVariableAllowed:function(field){return this._super(field)&&this.remoteDirectoryPath.textbox("textbox").is(field);}});jscape.domain.AddSmbNetworkStorageDialog=jscape.domain.SmbNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-add-smb"));this.name=$("input[name=name]",this.fieldset).textbox({required:true,validType:["non_empty","proxy_unique"],missingMessage:window.R.string.PROXIES_ERROR_BAD_NAME,width:"60%"});},getName:function(){return this.name.textbox("getValue");}});jscape.domain.EditSmbNetworkStorageDialog=jscape.domain.SmbNetworkStorageDialog.extend({proxyName:"",initialize:function(){this._super($("#d-proxy-edit-smb"));this.title=this.dialog.dialog("header").text()||"";},getName:function(){return this.proxyName;},setName:function(value){this.proxyName=value;this.dialog.dialog("setTitle",this.title.supplant({0:value}));}});jscape.domain.AddGoogleStorageNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({onSubmit:function(dialog){return this.listener.onAddNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.AddGoogleStorageNetworkStorageDialog();dialog.setRemoteDirectory(true);dialog.setDebugDirectory(null);return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.googleStorage(dialog.getName(),dialog.getAuthenticationType(),dialog.getCredentialsFile(),dialog.getCredentialsData(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());},onSelectKeyFile:function(){return new SelectPathController($.proxy(jscape.API.listFileSystem,jscape.API),$.proxy(jscape.API.createFileSystemPath,jscape.API)).selectFile().then(function(entry){return entry.path;});}});jscape.domain.EditGoogleStorageNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({start:function(listener,domainName,descriptor){this.descriptor=descriptor;return this._super(listener,domainName);},onSubmit:function(dialog){return this.listener.onEditNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.EditGoogleStorageNetworkStorageDialog();var descriptor=this.descriptor;if(descriptor){dialog.setName(descriptor.name);dialog.setAuthenticationType(descriptor.authenticationType);if(!!descriptor.credentialsFile){dialog.setCredentialsFile(descriptor.credentialsFile);}else{dialog.setCredentialsData("");}
dialog.setRemoteDirectoryPath(descriptor.remoteDirectory.path);dialog.setRemoteDirectory(jscape.RemoteDirectory.Type.LOCAL!=descriptor.remoteDirectory.type);dialog.setDebugDirectory(descriptor.logDirectory);dialog.setTags(descriptor.tags);}
return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.googleStorage(this.descriptor.name,dialog.getAuthenticationType(),dialog.getCredentialsFile(),dialog.getCredentialsData(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());},onSelectKeyFile:function(){return new SelectPathController($.proxy(jscape.API.listFileSystem,jscape.API),$.proxy(jscape.API.createFileSystemPath,jscape.API)).selectFile().then(function(entry){return entry.path;});}});jscape.domain.GoogleStorageNetworkStorageDialog=jscape.domain.NetworkStorageDialog.extend({initialize:function(dialog){this._super(dialog);this.authentication=$("input[name=authentication]:radio",this.fieldset);this.keyType=$("input[name=useprivatekey]:radio",this.fieldset).change($.proxy(this._onChange$KeyType,this));this.keyFile=$("input[name=privatekeyfile]",this.fieldset).textbox({required:true,validType:"non_empty",buttonText:"...",buttonAlign:"right",buttonIcon:null,onClickButton:$.proxy(this._onClick$BrowseKeyFileButton,this),width:"45%"});this.keyData=$("textarea[name=privatekeydata]",this.fieldset).filebox({required:true,readonly:false,multiline:true,validType:["non_empty","json"],buttonText:"...",buttonAlign:"right",accept:"text/plain, application/json",multiple:false,onChange:$.proxy(this._onChange$KeyData,this),width:"45%",height:80});this.keyData.filebox("textbox").prop("readonly",false);var btn=this.keyData.filebox("button");btn.find(".filebox-label").css("height",btn.height());this.keyType.filter("[value=file]").prop("checked",true).change();this.authentication.change($.proxy(this._onChange$AuthType,this)).first().prop("checked",true).end().change();this.remoteDirectory=$("input[name=remotedirectory]:radio",this.fieldset).change($.proxy(function(){this.remoteDirectoryPath.textbox(this.isRemoteDirectory()?"enable":"disable");},this));this.remoteDirectoryPath=$("input[name=remotepath]",this.fieldset).textbox({width:"60%"});},getAuthenticationType:function(){return this.authentication.filter(":checked").val();},setAuthenticationType:function(value){this.authentication.filter("[value="+value+"]").prop("checked",true).change();},getCredentialsData:function(){return!this.keyData.textbox("options").disabled?this.keyData.filebox("getText"):null;},setCredentialsData:function(value){this.keyData.textbox("setText",value);this.keyType.filter("[value=data]").prop("checked",true).change();},getCredentialsFile:function(){return!this.keyFile.textbox("options").disabled?this.keyFile.textbox("getValue"):null;},setCredentialsFile:function(value){this.keyFile.textbox("setValue",value);this.keyType.filter("[value=file]").prop("checked",true).change();},isRemoteDirectory:function(){return this.remoteDirectory.filter("[value=remote]").is(":checked");},setRemoteDirectory:function(value){this.remoteDirectory.filter(!!value?"[value=remote]":":not([value=remote])").first().prop("checked",true).change();},getRemoteDirectoryPath:function(){return this.remoteDirectoryPath.textbox("getValue");},setRemoteDirectoryPath:function(value){this.remoteDirectoryPath.textbox("setValue",value);this.setRemoteDirectory(value&&value.length!=0);},_onClick$BrowseKeyFileButton:function(){this.keyFile.textbox("button").linkbutton("disable");this.listener.onSelectKeyFile().done($.proxy(function(value){this.keyFile.textbox("setValue",value).textbox("textbox").focus();},this)).always($.proxy(function(){this.keyFile.textbox("button").linkbutton("enable");},this));},_onChange$KeyData:function(){this.keyData.filebox("button").linkbutton("disable");this.listener.onLoadFileContent(this.keyData.filebox("files")).done($.proxy(function(data){this.keyData.filebox("clear").filebox("setText",data);},this)).fail($.proxy(function(){this.keyData.filebox("clear").filebox("setText","");},this)).always($.proxy(function(){this.keyData.filebox("button").linkbutton("enable");},this));},_onChange$KeyType:function(){var type=this.keyType.filter(":checked").val();this.keyFile.textbox(type=="file"?"enable":"disable");this.keyData.textbox(type=="data"?"enable":"disable");},_onChange$AuthType:function(){if("CREDENTIALS_FILE"!=this.authentication.filter(":checked").val()){this.keyType.prop("disabled",true);this.keyFile.textbox("disable");this.keyData.textbox("disable");}else{this.keyType.prop("disabled",false).change();}},_insertVariableAllowed:function(field){return this._super(field)&&this.remoteDirectoryPath.textbox("textbox").is(field);}});jscape.domain.AddGoogleStorageNetworkStorageDialog=jscape.domain.GoogleStorageNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-add-googlestorage"));this.name=$("input[name=name]",this.fieldset).textbox({required:true,validType:["non_empty","proxy_unique"],missingMessage:window.R.string.PROXIES_ERROR_BAD_NAME,invalidMessage:window.R.string.PROXIES_ERROR_BAD_NAME,width:"60%"});},getName:function(){return this.name.textbox("getValue");}});jscape.domain.EditGoogleStorageNetworkStorageDialog=jscape.domain.GoogleStorageNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-edit-googlestorage"));this.keyData.filebox("textbox").validatebox("options").required=false;this.title=this.dialog.dialog("header").text()||"";},setName:function(value){this.dialog.dialog("setTitle",this.title.supplant({0:value}));}});jscape.domain.AddGoogleDriveNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({onSubmit:function(dialog){return this.listener.onAddNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.AddGoogleDriveNetworkStorageDialog();dialog.setRemoteDirectory(true);dialog.setDebugDirectory(null);return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.googleDrive(dialog.getName(),dialog.getCredentialsFile(),dialog.getCredentialsData(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());},onSelectKeyFile:function(){return new SelectPathController($.proxy(jscape.API.listFileSystem,jscape.API),$.proxy(jscape.API.createFileSystemPath,jscape.API)).selectFile().then(function(entry){return entry.path;});}});jscape.domain.EditGoogleDriveNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({start:function(listener,domainName,descriptor){this.descriptor=descriptor;return this._super(listener,domainName);},onSubmit:function(dialog){return this.listener.onEditNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.EditGoogleDriveNetworkStorageDialog();var descriptor=this.descriptor;if(descriptor){dialog.setName(descriptor.name);if(!!descriptor.credentialsFile){dialog.setCredentialsFile(descriptor.credentialsFile);}else{dialog.setCredentialsData("");}
dialog.setRemoteDirectoryPath(descriptor.remoteDirectory.path);dialog.setRemoteDirectory(jscape.RemoteDirectory.Type.LOCAL!=descriptor.remoteDirectory.type);dialog.setDebugDirectory(descriptor.logDirectory);dialog.setTags(descriptor.tags);}
return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.googleDrive(this.descriptor.name,dialog.getCredentialsFile(),dialog.getCredentialsData(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());},onSelectKeyFile:function(){return new SelectPathController($.proxy(jscape.API.listFileSystem,jscape.API),$.proxy(jscape.API.createFileSystemPath,jscape.API)).selectFile().then(function(entry){return entry.path;});}});jscape.domain.GoogleDriveNetworkStorageDialog=jscape.domain.NetworkStorageDialog.extend({initialize:function(dialog){this._super(dialog);this.keyType=$("input[name=useprivatekey]:radio",this.fieldset).change($.proxy(this._onChange$KeyType,this));this.keyFile=$("input[name=privatekeyfile]",this.fieldset).textbox({required:true,validType:"non_empty",buttonText:"...",buttonAlign:"right",buttonIcon:null,onClickButton:$.proxy(this._onClick$BrowseKeyFileButton,this),width:"45%"});this.keyData=$("textarea[name=privatekeydata]",this.fieldset).filebox({required:true,readonly:false,multiline:true,validType:["non_empty","json"],buttonText:"...",buttonAlign:"right",accept:"text/plain, application/json",multiple:false,onChange:$.proxy(this._onChange$KeyData,this),width:"45%",height:80});this.keyData.filebox("textbox").prop("readonly",false);var btn=this.keyData.filebox("button");btn.find(".filebox-label").css("height",btn.height());this.keyType.filter("[value=file]").prop("checked",true).change();this.remoteDirectory=$("input[name=remotedirectory]:radio",this.fieldset).change($.proxy(function(){this.remoteDirectoryPath.textbox(this.isRemoteDirectory()?"enable":"disable");},this));this.remoteDirectoryPath=$("input[name=remotepath]",this.fieldset).textbox({width:"60%"});},getCredentialsData:function(){return!this.keyData.textbox("options").disabled?this.keyData.filebox("getText"):null;},setCredentialsData:function(value){this.keyData.textbox("setText",value);this.keyType.filter("[value=data]").prop("checked",true).change();},getCredentialsFile:function(){return!this.keyFile.textbox("options").disabled?this.keyFile.textbox("getValue"):null;},setCredentialsFile:function(value){this.keyFile.textbox("setValue",value);this.keyType.filter("[value=file]").prop("checked",true).change();},isRemoteDirectory:function(){return this.remoteDirectory.filter("[value=remote]").is(":checked");},setRemoteDirectory:function(value){this.remoteDirectory.filter(!!value?"[value=remote]":":not([value=remote])").first().prop("checked",true).change();},getRemoteDirectoryPath:function(){return this.remoteDirectoryPath.textbox("getValue");},setRemoteDirectoryPath:function(value){this.remoteDirectoryPath.textbox("setValue",value);this.setRemoteDirectory(value&&value.length!=0);},_onClick$BrowseKeyFileButton:function(){this.keyFile.textbox("button").linkbutton("disable");this.listener.onSelectKeyFile().done($.proxy(function(value){this.keyFile.textbox("setValue",value).textbox("textbox").focus();},this)).always($.proxy(function(){this.keyFile.textbox("button").linkbutton("enable");},this));},_onChange$KeyData:function(){this.keyData.filebox("button").linkbutton("disable");this.listener.onLoadFileContent(this.keyData.filebox("files")).done($.proxy(function(data){this.keyData.filebox("clear").filebox("setText",data);},this)).fail($.proxy(function(){this.keyData.filebox("clear").filebox("setText","");},this)).always($.proxy(function(){this.keyData.filebox("button").linkbutton("enable");},this));},_onChange$KeyType:function(){var type=this.keyType.filter(":checked").val();this.keyFile.textbox(type=="file"?"enable":"disable");this.keyData.textbox(type=="data"?"enable":"disable");},_insertVariableAllowed:function(field){return this._super(field)&&this.remoteDirectoryPath.textbox("textbox").is(field);}});jscape.domain.AddGoogleDriveNetworkStorageDialog=jscape.domain.GoogleDriveNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-add-googledrive"));this.name=$("input[name=name]",this.fieldset).textbox({required:true,validType:["non_empty","proxy_unique"],missingMessage:window.R.string.PROXIES_ERROR_BAD_NAME,invalidMessage:window.R.string.PROXIES_ERROR_BAD_NAME,width:"60%"});},getName:function(){return this.name.textbox("getValue");}});jscape.domain.EditGoogleDriveNetworkStorageDialog=jscape.domain.GoogleDriveNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-edit-googledrive"));this.keyData.filebox("textbox").validatebox("options").required=false;this.title=this.dialog.dialog("header").text()||"";},setName:function(value){this.dialog.dialog("setTitle",this.title.supplant({0:value}));}});jscape.domain.AddMicrosoftAzureFileStorageController=jscape.domain.BaseNetworkStorageController.extend({onSubmit:function(dialog){return this.listener.onAddNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.AddMicrosoftAzureFileStorageDialog();dialog.setUsername("");dialog.setPassword("");dialog.setEndPointSuffix("core.windows.net");dialog.setRemoteDirectory(true);dialog.setDebugDirectory(null);return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.microsoftAzureFileStorage(dialog.getName(),dialog.getUsername(),dialog.getPassword(),dialog.getAuthenticationType(),dialog.getEndPointSuffix(),dialog.isUseSsl(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.EditMicrosoftAzureFileStorageController=jscape.domain.BaseNetworkStorageController.extend({start:function(listener,domainName,descriptor){this.descriptor=descriptor;return this._super(listener,domainName);},onSubmit:function(dialog){return this.listener.onEditNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.EditMicrosoftAzureFileStorageDialog();var descriptor=this.descriptor;if(descriptor){dialog.setName(descriptor.name);dialog.setUsername(descriptor.username);dialog.setPassword(descriptor.password);dialog.setAuthenticationType(descriptor.authenticationType);dialog.setEndPointSuffix(descriptor.endPointSuffix);dialog.setUseSsl(descriptor.sslRequired);dialog.setRemoteDirectoryPath(descriptor.remoteDirectory.path);dialog.setRemoteDirectory(jscape.RemoteDirectory.Type.LOCAL!=descriptor.remoteDirectory.type);dialog.setDebugDirectory(descriptor.logDirectory);dialog.setTags(descriptor.tags);}
return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.microsoftAzureFileStorage(this.descriptor.name,dialog.getUsername(),dialog.getPassword(),dialog.getAuthenticationType(),dialog.getEndPointSuffix(),dialog.isUseSsl(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.MicrosoftAzureNetworkStorageDialog=jscape.domain.NetworkStorageDialog.extend({initialize:function(dialog){this._super(dialog);this.username=$("input[name=username]",this.fieldset).textbox({required:true,validType:"non_empty",missingMessage:window.R.string.PROXIES_ERROR_BAD_USER,invalidMessage:window.R.string.PROXIES_ERROR_BAD_USER,width:"60%"});this.password=$("input[name=userpwd]",this.fieldset).passwordbox2({required:true,width:"60%"});this.endPointSuffix=$("input[name=endpointsuffix]",this.fieldset).textbox({required:false,validType:"non_empty",width:"60%"});this.authentication=$("input[name=authtype]:radio",this.fieldset).change($.proxy(this._onChange$AuthType,this));this.replayCredentials=this.authentication.filter("[value=USER_CREDENTIALS]");this.amiRole=this.authentication.filter("[value=AMI_ROLE]");this.enterCredentials=this.authentication.filter("[value=CREDENTIALS]").prop("checked",true);this.remoteDirectory=$("input[name=remotedirectory]:radio",this.fieldset).change($.proxy(function(){this.remoteDirectoryPath.textbox(this.isRemoteDirectory()?"enable":"disable");},this));this.remoteDirectoryPath=$("input[name=remotepath]",this.fieldset).textbox({width:"60%"});},getEndPointSuffix:function(){return this.endPointSuffix.textbox("getValue");},setEndPointSuffix:function(value){this.endPointSuffix.textbox("setValue",value);},isReplayCredentials:function(){return this.replayCredentials.is(":checked");},isUseCredentials:function(){return this.enterCredentials.is(":checked");},isUseRole:function(){return this.amiRole.length&&this.amiRole.is(":checked");},getUsername:function(){return this.isUseCredentials()||this.isUseRole()?this.username.textbox("getValue"):null;},setUsername:function(value){if(value==null){this.username.textbox("clear");this.replayCredentials.prop("checked",true).change();}else{this.username.textbox("setValue",value);if(this.replayCredentials.is(":checked")){this.replayCredentials.prop("checked",false).change();}}},getPassword:function(){return this.isUseCredentials()||this.isUseRole()?this.password.passwordbox2("getValue"):null;},setPassword:function(value){this.password.passwordbox2("setValue",value);},getAuthenticationType:function(){return this.authentication.filter(":checked").val();},setAuthenticationType:function(value){this.authentication.filter("[value="+value+"]").prop("checked",true).change();},isRemoteDirectory:function(){return this.remoteDirectory.filter("[value=remote]").is(":checked");},setRemoteDirectory:function(value){this.remoteDirectory.filter(!!value?"[value=remote]":":not([value=remote])").first().prop("checked",true).change();},getRemoteDirectoryPath:function(){return this.remoteDirectoryPath.textbox("getValue");},setRemoteDirectoryPath:function(value){this.remoteDirectoryPath.textbox("setValue",value);this.setRemoteDirectory(value&&value.length!=0);},_onChange$AuthType:function(){if(this.isUseCredentials()||this.isUseRole()){var required=this.isUseCredentials();this.username.textbox("enable").textbox({required:required}).textbox("isValid");this.password.passwordbox2("enable").passwordbox2({required:required}).passwordbox2("isValid");}else if(this.isReplayCredentials()){this.username.textbox("disable");this.password.passwordbox2("disable");}},_insertVariableAllowed:function(field){return this._super(field)&&this.remoteDirectoryPath.textbox("textbox").is(field);}});jscape.domain.AddMicrosoftAzureFileStorageDialog=jscape.domain.MicrosoftAzureNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-add-microsoftazure-filestorage"));this.name=$("input[name=name]",this.fieldset).textbox({required:true,validType:["non_empty","proxy_unique"],missingMessage:window.R.string.PROXIES_ERROR_BAD_NAME,invalidMessage:window.R.string.PROXIES_ERROR_BAD_NAME,width:"60%"});this.useSsl=$("input[name=ssl]:checkbox",this.fieldset);},getName:function(){return this.name.textbox("getValue");},isUseSsl:function(){return this.useSsl.is(":checked");},setUseSsl:function(value){this.useSsl.prop("checked",!!value);}});jscape.domain.EditMicrosoftAzureFileStorageDialog=jscape.domain.MicrosoftAzureNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-edit-microsoftazure-filestorage"));this.title=this.dialog.dialog("header").text()||"";this.username.textbox({required:false});this.password.passwordbox2({required:false}).passwordbox2("textbox").validatebox("options").required=false;this.useSsl=$("input[name=ssl]:checkbox",this.fieldset);},setName:function(value){this.dialog.dialog("setTitle",this.title.supplant({0:value}));},isUseSsl:function(){return this.useSsl.is(":checked");},setUseSsl:function(value){this.useSsl.prop("checked",!!value);},_onChange$AuthType:function(){if(this.isUseCredentials()||this.isUseRole()){this.username.textbox("enable").textbox({required:false}).textbox("isValid");this.password.passwordbox2("enable").passwordbox2({required:false}).passwordbox2("isValid");}else if(this.isReplayCredentials()){this.username.textbox("disable");this.password.passwordbox2("disable");}}});jscape.domain.AddMicrosoftAzureBlobStorageController=jscape.domain.BaseNetworkStorageController.extend({onSubmit:function(dialog){return this.listener.onAddNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.AddMicrosoftAzureBlobStorageDialog();dialog.setUsername("");dialog.setPassword("");dialog.setEndPointSuffix("core.windows.net");dialog.setRemoteDirectory(true);dialog.setDebugDirectory(null);return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.microsoftAzureBlobStorage(dialog.getName(),dialog.getUsername(),dialog.getPassword(),dialog.getAuthenticationType(),dialog.getEndPointSuffix(),dialog.isUseSsl(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.EditMicrosoftAzureBlobStorageController=jscape.domain.BaseNetworkStorageController.extend({start:function(listener,domainName,descriptor){this.descriptor=descriptor;return this._super(listener,domainName);},onSubmit:function(dialog){return this.listener.onEditNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.EditMicrosoftAzureBlobStorageDialog();var descriptor=this.descriptor;if(descriptor){dialog.setName(descriptor.name);dialog.setUsername(descriptor.username);dialog.setPassword(descriptor.password);dialog.setAuthenticationType(descriptor.authenticationType);dialog.setEndPointSuffix(descriptor.endPointSuffix);dialog.setUseSsl(descriptor.sslRequired);dialog.setRemoteDirectoryPath(descriptor.remoteDirectory.path);dialog.setRemoteDirectory(jscape.RemoteDirectory.Type.LOCAL!=descriptor.remoteDirectory.type);dialog.setDebugDirectory(descriptor.logDirectory);dialog.setTags(descriptor.tags);}
return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.microsoftAzureBlobStorage(this.descriptor.name,dialog.getUsername(),dialog.getPassword(),dialog.getAuthenticationType(),dialog.getEndPointSuffix(),dialog.isUseSsl(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.AddMicrosoftAzureBlobStorageDialog=jscape.domain.MicrosoftAzureNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-add-microsoftazure-blobstorage"));this.name=$("input[name=name]",this.fieldset).textbox({required:true,validType:["non_empty","proxy_unique"],missingMessage:window.R.string.PROXIES_ERROR_BAD_NAME,invalidMessage:window.R.string.PROXIES_ERROR_BAD_NAME,width:"60%"});this.useSsl=$("input[name=ssl]:checkbox",this.fieldset);},getName:function(){return this.name.textbox("getValue");},isUseSsl:function(){return this.useSsl.is(":checked");},setUseSsl:function(value){this.useSsl.prop("checked",!!value);}});jscape.domain.EditMicrosoftAzureBlobStorageDialog=jscape.domain.MicrosoftAzureNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-edit-microsoftazure-blobstorage"));this.title=this.dialog.dialog("header").text()||"";this.username.textbox({required:false});this.password.passwordbox2({required:false}).passwordbox2("textbox").validatebox("options").required=false;this.useSsl=$("input[name=ssl]:checkbox",this.fieldset);},setName:function(value){this.dialog.dialog("setTitle",this.title.supplant({0:value}));},isUseSsl:function(){return this.useSsl.is(":checked");},setUseSsl:function(value){this.useSsl.prop("checked",!!value);},_onChange$AuthType:function(){if(this.isUseCredentials()||this.isUseRole()){this.username.textbox("enable").textbox({required:false}).textbox("isValid");this.password.passwordbox2("enable").passwordbox2({required:false}).passwordbox2("isValid");}else if(this.isReplayCredentials()){this.username.textbox("disable");this.password.passwordbox2("disable");}}});jscape.domain.AddMicrosoftAzureDataLakeController=jscape.domain.BaseNetworkStorageController.extend({onSubmit:function(dialog){return this.listener.onAddNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.AddMicrosoftAzureDataLakeDialog();dialog.setUsername("");dialog.setPassword("");dialog.setRemoteDirectory(true);dialog.setDebugDirectory(null);return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.microsoftAzureDataLake(dialog.getName(),dialog.getUsername(),dialog.getPassword(),dialog.getTenantId(),dialog.getAzureAccount(),dialog.isReplayCredentials(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.EditMicrosoftAzureDataLakeController=jscape.domain.BaseNetworkStorageController.extend({start:function(listener,domainName,descriptor){this.descriptor=descriptor;return this._super(listener,domainName);},onSubmit:function(dialog){return this.listener.onEditNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.EditMicrosoftAzureDataLakeDialog();var descriptor=this.descriptor;if(descriptor){dialog.setName(descriptor.name);dialog.setUsername(descriptor.username);dialog.setPassword(descriptor.password);dialog.setTenantId(descriptor.tenantId);dialog.setAzureAccount(descriptor.accountFqdn);dialog.setRemoteDirectoryPath(descriptor.remoteDirectory.path);dialog.setRemoteDirectory(jscape.RemoteDirectory.Type.LOCAL!=descriptor.remoteDirectory.type);dialog.setDebugDirectory(descriptor.logDirectory);dialog.setTags(descriptor.tags);}
return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.microsoftAzureDataLake(this.descriptor.name,dialog.getUsername(),dialog.getPassword(),dialog.getTenantId(),dialog.getAzureAccount(),dialog.isReplayCredentials(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.AddMicrosoftAzureDataLakeDialog=jscape.domain.MicrosoftAzureNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-add-microsoftazure-datalake"));this.name=$("input[name=name]",this.fieldset).textbox({required:true,validType:["non_empty","proxy_unique"],missingMessage:window.R.string.PROXIES_ERROR_BAD_NAME,invalidMessage:window.R.string.PROXIES_ERROR_BAD_NAME,width:"60%"});this.tenantId=$("input[name=tenantId]",this.fieldset).textbox({required:true,validType:"non_empty",width:"60%"});this.azureAccount=$("input[name=azureaccount]",this.fieldset).textbox({required:true,validType:"non_empty",width:"60%"});},getName:function(){return this.name.textbox("getValue");},getTenantId:function(){return this.tenantId.textbox("getValue");},getAzureAccount:function(){return this.azureAccount.textbox("getValue");}});jscape.domain.EditMicrosoftAzureDataLakeDialog=jscape.domain.MicrosoftAzureNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-edit-microsoftazure-datalake"));this.title=this.dialog.dialog("header").text()||"";this.password.passwordbox2({required:false});this.tenantId=$("input[name=tenantId]",this.fieldset).textbox({required:true,validType:"non_empty",width:"60%"});this.azureAccount=$("input[name=azureaccount]",this.fieldset).textbox({required:true,validType:"non_empty",width:"60%"});},setName:function(value){this.dialog.dialog("setTitle",this.title.supplant({0:value}));},getTenantId:function(){return this.tenantId.textbox("getValue");},setTenantId:function(value){this.tenantId.textbox("setValue",value);},getAzureAccount:function(){return this.azureAccount.textbox("getValue");},setAzureAccount:function(value){this.azureAccount.textbox("setValue",value);}});jscape.domain.AddMicrosoftAzureDataLake2Controller=jscape.domain.BaseNetworkStorageController.extend({onSubmit:function(dialog){return this.listener.onAddNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.AddMicrosoftAzureDataLake2Dialog();dialog.setUsername("");dialog.setPassword("");dialog.setRemoteDirectory(true);dialog.setDebugDirectory(null);return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.microsoftAzureDataLake2(dialog.getName(),dialog.getUsername(),dialog.getPassword(),dialog.getEndpoint(),dialog.getAuthenticationType(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.EditMicrosoftAzureDataLake2Controller=jscape.domain.BaseNetworkStorageController.extend({start:function(listener,domainName,descriptor){this.descriptor=descriptor;return this._super(listener,domainName);},onSubmit:function(dialog){return this.listener.onEditNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.EditMicrosoftAzureDataLake2Dialog();var descriptor=this.descriptor;if(descriptor){dialog.setName(descriptor.name);dialog.setUsername(descriptor.username);dialog.setPassword(descriptor.password);dialog.setEndpoint(descriptor.endPointSuffix);dialog.setAuthenticationType(descriptor.authenticationType);dialog.setRemoteDirectoryPath(descriptor.remoteDirectory.path);dialog.setRemoteDirectory(jscape.RemoteDirectory.Type.LOCAL!=descriptor.remoteDirectory.type);dialog.setDebugDirectory(descriptor.logDirectory);dialog.setTags(descriptor.tags);}
return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.microsoftAzureDataLake2(this.descriptor.name,dialog.getUsername(),dialog.getPassword(),dialog.getEndpoint(),dialog.getAuthenticationType(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.AddMicrosoftAzureDataLake2Dialog=jscape.domain.MicrosoftAzureNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-add-microsoftazure-datalake-2"));this.name=$("input[name=name]",this.fieldset).textbox({required:true,validType:["non_empty","proxy_unique"],missingMessage:window.R.string.PROXIES_ERROR_BAD_NAME,invalidMessage:window.R.string.PROXIES_ERROR_BAD_NAME,width:"60%"});this.password.passwordbox2({required:false}).passwordbox2("textbox").validatebox("options").required=false;this.endpoint=$("input[name=endpoint]",this.fieldset).textbox({required:false,validType:"non_empty",width:"60%"});},getName:function(){return this.name.textbox("getValue");},getEndpoint:function(){return this.endpoint.textbox("getValue");},setEndpoint:function(value){this.endpoint.textbox("setValue",value);}});jscape.domain.EditMicrosoftAzureDataLake2Dialog=jscape.domain.MicrosoftAzureNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-edit-microsoftazure-datalake-2"));this.title=this.dialog.dialog("header").text()||"";this.username.textbox({required:false});this.password.passwordbox2({required:false}).passwordbox2("textbox").validatebox("options").required=false;this.endpoint=$("input[name=endpoint]",this.fieldset).textbox({required:false,validType:"non_empty",width:"60%"});},setName:function(value){this.dialog.dialog("setTitle",this.title.supplant({0:value}));},getEndpoint:function(){return this.endpoint.textbox("getValue");},setEndpoint:function(value){this.endpoint.textbox("setValue",value);},_onChange$AuthType:function(){if(this.isUseCredentials()||this.isUseRole()){this.username.textbox("enable").textbox({required:false}).textbox("isValid");this.password.passwordbox2("enable").passwordbox2({required:false}).passwordbox2("isValid");}else if(this.isReplayCredentials()){this.username.textbox("disable");this.password.passwordbox2("disable");}}});jscape.domain.AddMicrosoftOneDriveNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({onSubmit:function(dialog){return this.listener.onAddNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.AddMicrosoftOneDriveNetworkStorageDialog();dialog.setRemoteDirectory(true);dialog.setDebugDirectory(null);return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.microsoftOneDrive(dialog.getName(),dialog.getDirectoryId(),dialog.getClientId(),dialog.getClientSecret(),dialog.getUsername(),dialog.isUserRootDriveAccessRequired(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.EditMicrosoftOneDriveNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({start:function(listener,domainName,descriptor){this.descriptor=descriptor;return this._super(listener,domainName);},onSubmit:function(dialog){return this.listener.onEditNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.EditMicrosoftOneDriveNetworkStorageDialog();var descriptor=this.descriptor;if(descriptor){dialog.setName(descriptor.name);dialog.setDirectoryId(descriptor.directoryId);dialog.setClientId(descriptor.clientId);dialog.setClientSecret(descriptor.clientSecret);dialog.setUsername(descriptor.username);dialog.setUserRootDriveAccessRequired(descriptor.userRootDriveAccessRequired);if(descriptor.remoteDirectory){dialog.setRemoteDirectoryPath(descriptor.remoteDirectory.path);dialog.setRemoteDirectory(jscape.RemoteDirectory.Type.LOCAL!=descriptor.remoteDirectory.type);}
dialog.setDebugDirectory(descriptor.logDirectory);dialog.setTags(descriptor.tags);}
return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.microsoftOneDrive(this.descriptor.name,dialog.getDirectoryId(),dialog.getClientId(),dialog.getClientSecret(),dialog.getUsername(),dialog.isUserRootDriveAccessRequired(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.MicrosoftOneDriveNetworkStorageDialog=jscape.domain.NetworkStorageDialog.extend({initialize:function(dialog){this._super(dialog);this.directory=$("input[name=dir]",this.fieldset).textbox({required:true,width:"60%"});this.client=$("input[name=client]",this.fieldset).textbox({required:true,width:"60%"});this.secret=$("input[name=secret]",this.fieldset).passwordbox2({required:true,width:"60%"});this.user=$("input[name=user]",this.fieldset).textbox({validType:"non_empty",width:"60%"});this.rootAccess=$("input[name=rootaccess]:checkbox",this.fieldset);this.remoteDirectory=$("input[name=remotedirectory]:radio",this.fieldset).change($.proxy(function(){this.remoteDirectoryPath.textbox(this.isRemoteDirectory()?"enable":"disable");},this));this.remoteDirectoryPath=$("input[name=remotepath]",this.fieldset).textbox({width:"60%"});},getDirectoryId:function(){return this.directory.textbox("getValue");},setDirectoryId:function(value){this.directory.textbox("setValue",value);},getClientId:function(){return this.client.textbox("getValue");},setClientId:function(value){this.client.textbox("setValue",value);},getClientSecret:function(){return this.secret.passwordbox2("getValue");},setClientSecret:function(value){this.secret.passwordbox2("setValue",value);},getUsername:function(){return this.user.textbox("getValue");},setUsername:function(value){this.user.textbox("setValue",value);},isUserRootDriveAccessRequired:function(){return this.rootAccess.is(":checked");},setUserRootDriveAccessRequired:function(value){this.rootAccess.prop("checked",value).change();},isRemoteDirectory:function(){return this.remoteDirectory.filter("[value=remote]").is(":checked");},setRemoteDirectory:function(value){this.remoteDirectory.filter(!!value?"[value=remote]":":not([value=remote])").first().prop("checked",true).change();},getRemoteDirectoryPath:function(){return this.remoteDirectoryPath.textbox("getValue");},setRemoteDirectoryPath:function(value){this.remoteDirectoryPath.textbox("setValue",value);this.setRemoteDirectory(value&&value.length!=0);},_insertVariableAllowed:function(field){return this._super(field)&&this.remoteDirectoryPath.textbox("textbox").is(field);}});jscape.domain.AddMicrosoftOneDriveNetworkStorageDialog=jscape.domain.MicrosoftOneDriveNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-add-microsort-onedrive"));this.name=$("input[name=name]",this.fieldset).textbox({required:true,validType:["non_empty","proxy_unique"],missingMessage:window.R.string.PROXIES_ERROR_BAD_NAME,invalidMessage:window.R.string.PROXIES_ERROR_BAD_NAME,width:"60%"});},getName:function(){return this.name.textbox("getValue");}});jscape.domain.EditMicrosoftOneDriveNetworkStorageDialog=jscape.domain.MicrosoftOneDriveNetworkStorageDialog.extend({proxyName:"",initialize:function(){this._super($("#d-proxy-edit-microsoft-onedrive"));this.title=this.dialog.dialog("header").text()||"";},getName:function(){return this.proxyName;},setName:function(value){this.proxyName=value;this.dialog.dialog("setTitle",this.title.supplant({0:value}));}});jscape.domain.AddNetworkStorageController=Class.extend({deferred:null,initialize:function(){this.controllerMap={};this.controllerMap[jscape.ResourceDescriptor.Protocol.AFTP]=jscape.domain.AddAftpNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.AGENT]=jscape.domain.AddAgentNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.AMAZON_S3]=jscape.domain.AddAmazonS3NetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.AMAZON_S3_COMPATIBLE]=jscape.domain.AddAmazonS3CompatibleNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.BOX]=jscape.domain.AddBoxNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.DROPBOX]=jscape.domain.AddDropboxNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.GOOGLE_STORAGE]=jscape.domain.AddGoogleStorageNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.GOOGLE_DRIVE]=jscape.domain.AddGoogleDriveNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.IBM_CLOUD]=jscape.domain.AddIbmCloudNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.MICROSOFT_AZURE_FILE_STORAGE]=jscape.domain.AddMicrosoftAzureFileStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.MICROSOFT_AZURE_BLOB_STORAGE]=jscape.domain.AddMicrosoftAzureBlobStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.MICROSOFT_AZURE_DATA_LAKE]=jscape.domain.AddMicrosoftAzureDataLakeController;this.controllerMap[jscape.ResourceDescriptor.Protocol.MICROSOFT_AZURE_DATA_LAKE_2]=jscape.domain.AddMicrosoftAzureDataLake2Controller;this.controllerMap[jscape.ResourceDescriptor.Protocol.MICROSOFT_ONEDRIVE]=jscape.domain.AddMicrosoftOneDriveNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.FTP]=jscape.domain.AddFtpNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.REST]=jscape.domain.AddRestNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.SFTP]=jscape.domain.AddSftpNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.SMB]=jscape.domain.AddSmbNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.WEBDAV]=jscape.domain.AddWebDavNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.TFTP]=jscape.domain.AddTftpNetworkStorageController;},start:function(listener,domainName,functions){this.listener=listener||jscape.domain.AddNetworkStorageController.LISTENER;this.domainName=domainName;this.functions=functions;this.deferred=$.Deferred();this._setupDialog().show(this);return this.deferred.promise();},onTestServer:function(descriptor){return this.listener.onTestServer(descriptor);},onAddNetworkStorage:function(descriptor){return jscape.API.addNetworkStorage(this.domainName,descriptor).done($.proxy(function(descriptor){this.deferred.resolve(descriptor);this.deferred=null;},this));},onSubmit:function(dialog){var protocol=dialog.getProtocol();dialog.destroy();var theClass=this.controllerMap[protocol];if(typeof theClass=="function"){var controller=new theClass(this.functions);controller.start(this,this.domainName).fail($.proxy(function(){this.deferred.reject();this.deferred=null;},this));}},onCancel:function(dialog){dialog.destroy();this.deferred.reject();this.deferred=null;},_setupDialog:function(){return new jscape.domain.AddNetworkStorageProtocolDialog();}});jscape.domain.AddNetworkStorageController.LISTENER={onTestServer:$.noop};jscape.domain.AddNetworkStorageProtocolDialog=jscape.ui.DefaultDialog.extend({initialize:function(){this._super($("#d-proxy-add-protocol"),{width:530,resizable:false});this.protocol=$("select[name=protocol]",this.dialog);this.protocol.combobox({required:true,limitToList:true,formatter:$.proxy(this._formatProtocol,this),onLoadSuccess:$.proxy(this._onLoad$Success,this),width:"50%",panelHeight:"auto",panelMaxHeight:"40%",loadFilter:function(data){var f=$(this).combobox("options").textField;return data.sort(function(a,b){return a[f].localeCompare(b[f]);});},keyHandler:$.extend({},$.fn.combobox.defaults.keyHandler,{enter:$.proxy(function(e){$.fn.combobox.defaults.keyHandler.enter.call(e.data.target,e);if(!this.protocol.combobox("panel").is(":visible")){var okBtn=this.okButton;setTimeout(function(){okBtn.click();okBtn=undefined;},100);}},this)})});this.protocol.combobox("textbox").on("focus",function(){$(this).select();});},getProtocol:function(){return this.protocol.combobox("getValue");},show:function(listener){this._super(listener);this.protocol.combobox("textbox").focus();this._onForm$Change();},_formatProtocol:function(row){var text=row[this.protocol.combobox("options").textField];return!!row.disabled&&row.title?'<span aria-label="{tip}">{text}</span>'.supplant({tip:(row.title||"").escapeXml(),text:text}):text;},_onLoad$Success:function(){this._createTooltips(this.protocol.combobox("panel").find(".combobox-item"),function(el){return $(el).find("span[aria-label]").attr("aria-label")||"";});}});jscape.domain.EditNetworkStorageController=Class.extend({deferred:null,initialize:function(){this.controllerMap={};this.controllerMap[jscape.ResourceDescriptor.Protocol.AFTP]=jscape.domain.EditAftpNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.AGENT]=jscape.domain.EditAgentNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.AMAZON_S3]=jscape.domain.EditAmazonS3NetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.AMAZON_S3_COMPATIBLE]=jscape.domain.EditAmazonS3CompatibleNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.BOX]=jscape.domain.EditBoxNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.DROPBOX]=jscape.domain.EditDropboxNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.GOOGLE_STORAGE]=jscape.domain.EditGoogleStorageNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.GOOGLE_DRIVE]=jscape.domain.EditGoogleDriveNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.IBM_CLOUD]=jscape.domain.EditIbmCloudNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.MICROSOFT_AZURE_FILE_STORAGE]=jscape.domain.EditMicrosoftAzureFileStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.MICROSOFT_AZURE_BLOB_STORAGE]=jscape.domain.EditMicrosoftAzureBlobStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.MICROSOFT_AZURE_DATA_LAKE]=jscape.domain.EditMicrosoftAzureDataLakeController;this.controllerMap[jscape.ResourceDescriptor.Protocol.MICROSOFT_AZURE_DATA_LAKE_2]=jscape.domain.EditMicrosoftAzureDataLake2Controller;this.controllerMap[jscape.ResourceDescriptor.Protocol.MICROSOFT_ONEDRIVE]=jscape.domain.EditMicrosoftOneDriveNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.FTP]=jscape.domain.EditFtpNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.REST]=jscape.domain.EditRestNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.SFTP]=jscape.domain.EditSftpNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.SMB]=jscape.domain.EditSmbNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.WEBDAV]=jscape.domain.EditWebDavNetworkStorageController;this.controllerMap[jscape.ResourceDescriptor.Protocol.TFTP]=jscape.domain.EditTftpNetworkStorageController;},start:function(listener,domainName,descriptor,functions){this.listener=listener||jscape.domain.EditNetworkStorageController.LISTENER;this.domainName=domainName;this.functions=functions;this.deferred=$.Deferred();jscape.API.getNetworkStorage(this.domainName,descriptor.name).then($.proxy(this._editDescriptor,this)).fail($.proxy(function(){this.deferred.reject();this.deferred=null;},this));return this.deferred.promise();},onEditNetworkStorage:function(descriptor){return jscape.API.setNetworkStorage(this.domainName,descriptor.name,descriptor).done($.proxy(function(){this.deferred.resolve(descriptor);this.deferred=null;},this));},onTestServer:function(descriptor){return this.listener.onTestServer(descriptor);},_editDescriptor:function(descriptor){var theClass=this.controllerMap[descriptor.protocol];if(typeof theClass==="function"){var controller=new theClass(this.functions);return controller.start(this,this.domainName,descriptor);}
return $.Deferred().reject().promise();}});jscape.domain.EditNetworkStorageController.LISTENER={onTestServer:$.noop};jscape.domain.TestNetworkStorageController=Class.extend({descriptor:null,deferred:null,start:function(domainName,descriptor){this.domainName=domainName;this.descriptor=descriptor;this.deferred=$.Deferred();var promise=this.deferred.promise();if(this._testCredentialsRequired(descriptor)){this._setupDialog().show(this);}else{this._doTest(descriptor);}
return promise;},onSubmit:function(dialog){$.extend({},this.descriptor,{username:dialog.getUsername(),password:dialog.getPassword()});this._doTest(this.descriptor);return this.deferred;},onCancel:function(dialog){dialog.destroy();this.deferred.reject();this.deferred=null;},_testCredentialsRequired:function(descriptor){return!!descriptor.usingCredentials||((jscape.ResourceDescriptor.Protocol.AMAZON_S3==descriptor.protocol||jscape.ResourceDescriptor.Protocol.AMAZON_S3_COMPATIBLE==descriptor.protocol)&&"USER_CREDENTIALS"==descriptor.authenticationType);},_setupDialog:function(){return new jscape.domain.ProxyCredentialsDialog();},_doTest:function(descriptor){return jscape.API.testNetworkStorage(this.domainName,this.descriptor.name,descriptor).then($.proxy(this._testComplete,this),$.proxy(function(){this.deferred.reject();},this));},_testComplete:function(data){if(data&&data.valid===false){this._testFailed(data.message);}else{this._testPassed(data?data.message:"");}},_testPassed:function(message){$.messager.alert(window.R.string.PROXIES_TEST_DIALOG_TITLE,message||window.R.string.PROXIES_MESSAGE_TEST_PASSED,"info");this.deferred.resolve();},_testFailed:function(message){$.messager.alert(window.R.string.PROXIES_TEST_DIALOG_TITLE,message||window.R.string.PROXIES_MESSAGE_TEST_FAILED,"error");this.deferred.reject();}});jscape.domain.ProxyCredentialsDialog=jscape.ui.DefaultDialog.extend({initialize:function(){this._super($("#d-proxies-test"),{width:530,resizable:false});this.fieldset=$("fieldset[name=testnetworkstoragefields]",this.dialog);this.username=$("[name=username]",this.fieldset).textbox({validType:"non_empty",width:"60%"});this.password=$("[name=password]",this.fieldset).passwordbox2({width:"60%"});},show:function(listener){this._super(listener);this.username.textbox("textbox").focus();},getUsername:function(){return this.username.textbox("getValue");},getPassword:function(){return this.password.passwordbox2("getValue");}});jscape.domain.DeleteNetworkStorageController=Class.extend({deferred:null,start:function(domainName,proxies){this.domainName=domainName;this.deferred=$.Deferred();this._confirmDelete(proxies).done($.proxy(this._deleteConfirmed,this,proxies)).fail($.proxy(function(){this.deferred.reject();this.deferred=null;},this));return this.deferred.promise();},_confirmDelete:function(proxies){var text=$.map(proxies,function(proxy){return proxy.name;}).join(", ");return jscape.ConfirmDialog.confirm(window.R.string.PROXIES_CONFIRM_DELETE_TITLE,window.R.string.PROXIES_CONFIRM_DELETE_MESSAGE.supplant({0:text}));},_deleteConfirmed:function(proxies){$.when.apply(jQuery,$.map(proxies,$.proxy(function(proxy){return jscape.API.deleteNetworkStorage(this.domainName,proxy.name);},this))).done($.proxy(function(){this.deferred.resolve(proxies);this.deferred=null;},this)).fail($.proxy(function(){this.deferred.reject();this.deferred=null;},this));}});jscape.domain.AddAgentNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({onLoadAgents:function(){return jscape.API.getAccountNames(this.domainName);},onSubmit:function(dialog){return this.listener.onAddNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.AddAgentNetworkStorageDialog();dialog.setRemoteDirectory(true);return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.agent(dialog.getName(),dialog.getAgentName(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getTags());}});jscape.domain.EditAgentNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({start:function(listener,domainName,descriptor){this.descriptor=descriptor;return this._super(listener,domainName);},onLoadAgents:function(){return jscape.API.getAccountNames(this.domainName);},onSubmit:function(dialog){return this.listener.onEditNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.EditAgentNetworkStorageDialog();var descriptor=this.descriptor;if(descriptor){dialog.setName(descriptor.name);dialog.setAgentName(descriptor.agentName);if(descriptor.remoteDirectory){dialog.setRemoteDirectoryPath(descriptor.remoteDirectory.path);dialog.setRemoteDirectory(jscape.RemoteDirectory.Type.LOCAL!=descriptor.remoteDirectory.type);}
dialog.setTags(descriptor.tags);}
return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.agent(this.descriptor.name,dialog.getAgentName(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getTags());}});jscape.domain.AgentNetworkStorageDialog=jscape.domain.NetworkStorageDialog.extend({initialize:function(dialog){this._super(dialog);var initializing=true;this.agent=$("select[name=agent]",this.fieldset).combobox({required:true,editable:true,limitToList:true,loader:$.proxy(this._onLoad$Data,this),onBeforeLoad:function(){return!initializing;},width:"50%",panelHeight:"auto",panelMaxHeight:"50%"});this.remoteDirectory=$("input[name=remotedirectory]:radio",this.fieldset).change($.proxy(function(){this.remoteDirectoryPath.textbox(this.isRemoteDirectory()?"enable":"disable");},this));this.remoteDirectoryPath=$("input[name=remotepath]",this.fieldset).textbox({width:"60%"});initializing=false;},getAgentName:function(){return this.agent.combobox("getValue");},setAgentName:function(value){this.agent.combobox("setValue",value);},isRemoteDirectory:function(){return this.remoteDirectory.filter("[value=remote]").is(":checked");},setRemoteDirectory:function(value){this.remoteDirectory.filter(!!value?"[value=remote]":":not([value=remote])").first().prop("checked",true).change();},getRemoteDirectoryPath:function(){return this.remoteDirectoryPath.textbox("getValue");},setRemoteDirectoryPath:function(value){this.remoteDirectoryPath.textbox("setValue",value);this.setRemoteDirectory(value&&value.length!=0);},show:function(){this._super.apply(this,arguments);this.agent.combobox("reload");return this;},_onLoad$Data:function(params,success,error){this.listener.onLoadAgents().then(success,error);},_insertVariableAllowed:function(field){return this._super(field)&&this.remoteDirectoryPath.textbox("textbox").is(field);}});jscape.domain.AddAgentNetworkStorageDialog=jscape.domain.AgentNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-add-agent"));this.name=$("input[name=name]",this.fieldset).textbox({required:true,validType:["non_empty","proxy_unique"],missingMessage:window.R.string.PROXIES_ERROR_BAD_NAME,invalidMessage:window.R.string.PROXIES_ERROR_BAD_NAME,width:"60%"});},getName:function(){return this.name.textbox("getValue");}});jscape.domain.EditAgentNetworkStorageDialog=jscape.domain.AgentNetworkStorageDialog.extend({proxyName:"",initialize:function(){this._super($("#d-proxy-edit-agent"));this.title=this.dialog.dialog("header").text()||"";},getName:function(){return this.proxyName;},setName:function(value){this.proxyName=value;this.dialog.dialog("setTitle",this.title.supplant({0:value}));}});jscape.domain.AddBoxNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({onSubmit:function(dialog){return this.listener.onAddNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.AddBoxNetworkStorageDialog();dialog.setRemoteDirectory(true);dialog.setDebugDirectory(null);return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.box(dialog.getName(),dialog.getCredentialsFile(),dialog.getCredentialsData(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());},onSelectKeyFile:function(){return new SelectPathController($.proxy(jscape.API.listFileSystem,jscape.API),$.proxy(jscape.API.createFileSystemPath,jscape.API)).selectFile().then(function(entry){return entry.path;});}});jscape.domain.EditBoxNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({start:function(listener,domainName,descriptor){this.descriptor=descriptor;return this._super(listener,domainName);},onSubmit:function(dialog){return this.listener.onEditNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.EditBoxNetworkStorageDialog();var descriptor=this.descriptor;if(descriptor){dialog.setName(descriptor.name);if(!!descriptor.credentialsFile){dialog.setCredentialsFile(descriptor.credentialsFile);}else{dialog.setCredentialsData("");}
if(descriptor.remoteDirectory){dialog.setRemoteDirectoryPath(descriptor.remoteDirectory.path);dialog.setRemoteDirectory(jscape.RemoteDirectory.Type.LOCAL!=descriptor.remoteDirectory.type);}
dialog.setDebugDirectory(descriptor.logDirectory);dialog.setTags(descriptor.tags);}
return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.box(this.descriptor.name,dialog.getCredentialsFile(),dialog.getCredentialsData(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());},onSelectKeyFile:function(){return new SelectPathController($.proxy(jscape.API.listFileSystem,jscape.API),$.proxy(jscape.API.createFileSystemPath,jscape.API)).selectFile().then(function(entry){return entry.path;});}});jscape.domain.BoxNetworkStorageDialog=jscape.domain.NetworkStorageDialog.extend({initialize:function(dialog){this._super(dialog);this.keyType=$("input[name=useprivatekey]:radio",this.fieldset).change($.proxy(this._onChange$KeyType,this));this.keyFile=$("input[name=privatekeyfile]",this.fieldset).textbox({required:true,validType:"non_empty",buttonText:"...",buttonAlign:"right",buttonIcon:null,onClickButton:$.proxy(this._onClick$BrowseKeyFileButton,this),width:"45%"});this.keyData=$("textarea[name=privatekeydata]",this.fieldset).filebox({required:true,readonly:false,multiline:true,validType:["non_empty","json"],buttonText:"...",buttonAlign:"right",accept:"text/plain, application/json",multiple:false,onChange:$.proxy(this._onChange$KeyData,this),width:"45%",height:80});this.keyData.filebox("textbox").prop("readonly",false);var btn=this.keyData.filebox("button");btn.find(".filebox-label").css("height",btn.height());this.keyType.filter("[value=file]").prop("checked",true).change();this.remoteDirectory=$("input[name=remotedirectory]:radio",this.fieldset).change($.proxy(function(){this.remoteDirectoryPath.textbox(this.isRemoteDirectory()?"enable":"disable");},this));this.remoteDirectoryPath=$("input[name=remotepath]",this.fieldset).textbox({width:"60%"});},getCredentialsData:function(){return!this.keyData.textbox("options").disabled?this.keyData.filebox("getText"):null;},setCredentialsData:function(value){this.keyData.textbox("setText",value);this.keyType.filter("[value=data]").prop("checked",true).change();},getCredentialsFile:function(){return!this.keyFile.textbox("options").disabled?this.keyFile.textbox("getValue"):null;},setCredentialsFile:function(value){this.keyFile.textbox("setValue",value);this.keyType.filter("[value=file]").prop("checked",true).change();},isRemoteDirectory:function(){return this.remoteDirectory.filter("[value=remote]").is(":checked");},setRemoteDirectory:function(value){this.remoteDirectory.filter(!!value?"[value=remote]":":not([value=remote])").first().prop("checked",true).change();},getRemoteDirectoryPath:function(){return this.remoteDirectoryPath.textbox("getValue");},setRemoteDirectoryPath:function(value){this.remoteDirectoryPath.textbox("setValue",value);this.setRemoteDirectory(value&&value.length!=0);},_onClick$BrowseKeyFileButton:function(){this.keyFile.textbox("button").linkbutton("disable");this.listener.onSelectKeyFile().done($.proxy(function(value){this.keyFile.textbox("setValue",value).textbox("textbox").focus();},this)).always($.proxy(function(){this.keyFile.textbox("button").linkbutton("enable");},this));},_onChange$KeyData:function(){this.keyData.filebox("button").linkbutton("disable");this.listener.onLoadFileContent(this.keyData.filebox("files")).done($.proxy(function(data){this.keyData.filebox("clear").filebox("setText",data);},this)).fail($.proxy(function(){this.keyData.filebox("clear").filebox("setText","");},this)).always($.proxy(function(){this.keyData.filebox("button").linkbutton("enable");},this));},_onChange$KeyType:function(){var type=this.keyType.filter(":checked").val();this.keyFile.textbox(type=="file"?"enable":"disable");this.keyData.textbox(type=="data"?"enable":"disable");},_insertVariableAllowed:function(field){return this._super(field)&&this.remoteDirectoryPath.textbox("textbox").is(field);}});jscape.domain.AddBoxNetworkStorageDialog=jscape.domain.BoxNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-add-box"));this.name=$("input[name=name]",this.fieldset).textbox({required:true,validType:["non_empty","proxy_unique"],missingMessage:window.R.string.PROXIES_ERROR_BAD_NAME,invalidMessage:window.R.string.PROXIES_ERROR_BAD_NAME,width:"60%"});},getName:function(){return this.name.textbox("getValue");}});jscape.domain.EditBoxNetworkStorageDialog=jscape.domain.BoxNetworkStorageDialog.extend({proxyName:"",initialize:function(){this._super($("#d-proxy-edit-box"));this.keyData.filebox("textbox").validatebox("options").required=false;this.title=this.dialog.dialog("header").text()||"";},getName:function(){return this.proxyName;},setName:function(value){this.proxyName=value;this.dialog.dialog("setTitle",this.title.supplant({0:value}));}});jscape.domain.AddDropboxNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({onSubmit:function(dialog){return this.listener.onAddNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.AddDropboxNetworkStorageDialog();dialog.setRemoteDirectory(true);dialog.setDebugDirectory(null);return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.dropbox(dialog.getName(),dialog.getAccessToken(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.EditDropboxNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({start:function(listener,domainName,descriptor){this.descriptor=descriptor;return this._super(listener,domainName);},onSubmit:function(dialog){return this.listener.onEditNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.EditDropboxNetworkStorageDialog();var descriptor=this.descriptor;if(descriptor){dialog.setName(descriptor.name);dialog.setAccessToken(descriptor.accessToken);if(descriptor.remoteDirectory){dialog.setRemoteDirectoryPath(descriptor.remoteDirectory.path);dialog.setRemoteDirectory(jscape.RemoteDirectory.Type.LOCAL!=descriptor.remoteDirectory.type);}
dialog.setDebugDirectory(descriptor.logDirectory);dialog.setTags(descriptor.tags);}
return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.dropbox(this.descriptor.name,dialog.getAccessToken(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.DropboxNetworkStorageDialog=jscape.domain.NetworkStorageDialog.extend({initialize:function(dialog){this._super(dialog);this.token=$("input[name=token]",this.fieldset).passwordbox2({required:true,width:"60%"});this.remoteDirectory=$("input[name=remotedirectory]:radio",this.fieldset).change($.proxy(function(){this.remoteDirectoryPath.textbox(this.isRemoteDirectory()?"enable":"disable");},this));this.remoteDirectoryPath=$("input[name=remotepath]",this.fieldset).textbox({width:"60%"});},getAccessToken:function(){return this.token.passwordbox2("getValue");},setAccessToken:function(value){this.token.passwordbox2("setValue",value);},isRemoteDirectory:function(){return this.remoteDirectory.filter("[value=remote]").is(":checked");},setRemoteDirectory:function(value){this.remoteDirectory.filter(!!value?"[value=remote]":":not([value=remote])").first().prop("checked",true).change();},getRemoteDirectoryPath:function(){return this.remoteDirectoryPath.textbox("getValue");},setRemoteDirectoryPath:function(value){this.remoteDirectoryPath.textbox("setValue",value);this.setRemoteDirectory(value&&value.length!=0);},_insertVariableAllowed:function(field){return this._super(field)&&this.remoteDirectoryPath.textbox("textbox").is(field);}});jscape.domain.AddDropboxNetworkStorageDialog=jscape.domain.DropboxNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-add-dropbox"));this.name=$("input[name=name]",this.fieldset).textbox({required:true,validType:["non_empty","proxy_unique"],missingMessage:window.R.string.PROXIES_ERROR_BAD_NAME,invalidMessage:window.R.string.PROXIES_ERROR_BAD_NAME,width:"60%"});},getName:function(){return this.name.textbox("getValue");}});jscape.domain.EditDropboxNetworkStorageDialog=jscape.domain.DropboxNetworkStorageDialog.extend({proxyName:"",initialize:function(){this._super($("#d-proxy-edit-dropbox"));this.title=this.dialog.dialog("header").text()||"";},getName:function(){return this.proxyName;},setName:function(value){this.proxyName=value;this.dialog.dialog("setTitle",this.title.supplant({0:value}));}});jscape.domain.AddIbmCloudNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({onSubmit:function(dialog){return this.listener.onAddNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.AddIbmCloudNetworkStorageDialog();dialog.setUsername("");dialog.setPassword("");dialog.setRemoteDirectory(true);dialog.setDebugDirectory(null);return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.ibmCloud(dialog.getName(),dialog.getUsername(),dialog.getPassword(),dialog.getEndPoint(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.EditIbmCloudNetworkStorageController=jscape.domain.BaseNetworkStorageController.extend({start:function(listener,domainName,descriptor){this.descriptor=descriptor;return this._super(listener,domainName);},onSubmit:function(dialog){return this.listener.onEditNetworkStorage(this._createDescriptor(dialog));},_setupDialog:function(){var dialog=new jscape.domain.EditIbmCloudNetworkStorageDialog();var descriptor=this.descriptor;if(descriptor){dialog.setName(descriptor.name);dialog.setUsername(descriptor.username);dialog.setPassword(descriptor.password);dialog.setEndPoint(descriptor.endPoint);dialog.setRemoteDirectoryPath(descriptor.remoteDirectory.path);dialog.setRemoteDirectory(jscape.RemoteDirectory.Type.LOCAL!=descriptor.remoteDirectory.type);dialog.setDebugDirectory(descriptor.logDirectory);dialog.setTags(descriptor.tags);}
return dialog;},_createDescriptor:function(dialog){return jscape.ResourceDescriptor.ibmCloud(this.descriptor.name,dialog.getUsername(),dialog.getPassword(),dialog.getEndPoint(),dialog.isRemoteDirectory()?jscape.RemoteDirectory.remote(dialog.getRemoteDirectoryPath()):jscape.RemoteDirectory.local(),dialog.getDebugDirectory(),dialog.getTags());}});jscape.domain.IbmCloudNetworkStorageDialog=jscape.domain.NetworkStorageDialog.extend({initialize:function(dialog){this._super(dialog);this.endPoint=$("input[name=endpoint]",this.fieldset).textbox({required:true,validType:"non_empty",width:"60%"});this.username=$("input[name=username]",this.fieldset).textbox({validType:"non_empty",missingMessage:window.R.string.PROXIES_ERROR_BAD_USER,invalidMessage:window.R.string.PROXIES_ERROR_BAD_USER,width:"60%"});this.password=$("input[name=userpwd]",this.fieldset).passwordbox2({width:"60%"});this.remoteDirectory=$("input[name=remotedirectory]:radio",this.fieldset).change($.proxy(function(){this.remoteDirectoryPath.textbox(this.isRemoteDirectory()?"enable":"disable");},this));this.remoteDirectoryPath=$("input[name=remotepath]",this.fieldset).textbox({width:"60%"});},getEndPoint:function(){return this.endPoint.textbox("getValue");},setEndPoint:function(value){this.endPoint.textbox("setValue",value);},getUsername:function(){return this.username.textbox("getValue");},setUsername:function(value){this.username.textbox("setValue",value);},getPassword:function(){return this.password.passwordbox2("getValue");},setPassword:function(value){this.password.passwordbox2("setValue",value);},isRemoteDirectory:function(){return this.remoteDirectory.filter("[value=remote]").is(":checked");},setRemoteDirectory:function(value){this.remoteDirectory.filter(!!value?"[value=remote]":":not([value=remote])").first().prop("checked",true).change();},getRemoteDirectoryPath:function(){return this.remoteDirectoryPath.textbox("getValue");},setRemoteDirectoryPath:function(value){this.remoteDirectoryPath.textbox("setValue",value);this.setRemoteDirectory(value&&value.length!=0);},_insertVariableAllowed:function(field){return this._super(field)&&this.remoteDirectoryPath.textbox("textbox").is(field);}});jscape.domain.AddIbmCloudNetworkStorageDialog=jscape.domain.IbmCloudNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-add-ibmcloud"));this.name=$("input[name=name]",this.fieldset).textbox({required:true,validType:["non_empty","proxy_unique"],missingMessage:window.R.string.PROXIES_ERROR_BAD_NAME,invalidMessage:window.R.string.PROXIES_ERROR_BAD_NAME,width:"60%"});},getName:function(){return this.name.textbox("getValue");}});jscape.domain.EditIbmCloudNetworkStorageDialog=jscape.domain.IbmCloudNetworkStorageDialog.extend({initialize:function(){this._super($("#d-proxy-edit-ibmcloud"));this.title=this.dialog.dialog("header").text()||"";},setName:function(value){this.dialog.dialog("setTitle",this.title.supplant({0:value}));}});