/* Copyright Â© 2009-2024. Redwood Software Inc. All rights reserved. */
jscape.domain=jscape.domain||{};jscape.ServiceConfiguration=Class.extend({initialize:function(a){this.protocol=a||undefined;},clone:function(){var attrs={};$.each(["uploadForms","languages"],$.proxy(function(_,prop){if($.type(this[prop])=="array"){attrs[prop]=$.map(this[prop],function(entry){return entry.clone();});}},this));return $.extend(new jscape.ServiceConfiguration(),this,attrs);}});jscape.ServiceConfiguration.fromJSON=function(data){if(data){$.each({"uploadForms":function(value){return $.map(value||[],jscape.UploadForm.fromJSON);},"languages":function(value){return $.map(value||[],jscape.WebResources.fromJSON);}},function(prop,provider){if(data.hasOwnProperty(prop)){data[prop]=provider(data[prop]);}});if(data.hasOwnProperty("theme")&&!data.theme){data.theme="default";}
if(data.hasOwnProperty("fileOverwritingPolicy")){data.fileOverwritingPolicy=jscape.ServiceConfiguration.FileOverwritingPolicy.valueOf(data.fileOverwritingPolicy);}
return $.extend(new jscape.ServiceConfiguration(),data);}
return null;};jscape.ServiceConfiguration.FileOverwritingPolicy={PROHIBIT:"PROHIBIT",OVERWRITE:"OVERWRITE",GENERATE_UNIQUE_NAME:"GENERATE_UNIQUE_NAME",valueOf:function(value){for(var key in this){if(typeof this[key]==="string"&&this[key].toLowerCase()==(value+"").toLowerCase()){return this[key];}}return null;}};jscape.ServiceConfiguration.ftp=function(timeout,dataTimeout,banner,passiveIp,portRange,backlog,sendBuffer,receiveBuffer,transferMode,dataConnectionMode,ciphers,shutdownCommandSsl,shutdownDataSsl,commandClientCertificate,dataClientCertificate,forceDataEncryption,blockPasv,blockBounce,tcpNoDelay,networkCharset,fileCharset){return $.extend(new jscape.ServiceConfiguration(jscape.TransportService.Protocol.FTP),{timeout:parseInt(timeout)||0,dataTimeout:parseInt(dataTimeout)||0,welcomeMessage:banner||"",passiveIp:passiveIp||"",portRange:portRange||null,backlog:parseInt(backlog)||5,sendBufferSize:parseInt(sendBuffer)||null,receiveBufferSize:parseInt(receiveBuffer)||null,defaultTransferMode:transferMode=="IMAGE"?transferMode:"ASCII",dataConnectionMode:dataConnectionMode||"ALL",cipherSuites:ciphers||undefined,shutdownSsl:!!shutdownCommandSsl,shutdownDataSsl:!!shutdownDataSsl,commandRequireClientCertificate:!!commandClientCertificate,dataRequireClientCertificate:!!dataClientCertificate,forceDataEncryption:!!forceDataEncryption,blockPasvAttack:!!blockPasv,blockBounceAttack:!!blockBounce,tcpNoDelayEnabled:!!tcpNoDelay,networkCharset:networkCharset,fileCharset:fileCharset});};jscape.ServiceConfiguration.aftp=function(timeout,dataTimeout,backlog,tcpNoDelay,maxLossListSize,ciphers){return $.extend(new jscape.ServiceConfiguration(jscape.TransportService.Protocol.AFTP),{timeout:parseInt(timeout)||0,dataTimeout:parseInt(dataTimeout)||0,backlog:parseInt(backlog)||5,tcpNoDelayEnabled:!!tcpNoDelay,maxLossListSize:parseInt(maxLossListSize)||10,cipherSuites:ciphers||undefined});};jscape.ServiceConfiguration.sftp=function(timeout,version,startupBanner,authBanner,sendBuffer,receiveBuffer,backlog,tcpNoDelay,disableExpandedLongName,sshKexes,sshHostKeys,sshCiphers,sshMacs,sshCompressions){return $.extend(new jscape.ServiceConfiguration(jscape.TransportService.Protocol.SFTP),{timeout:parseInt(timeout)||0,softwareVersion:version||"JSCAPE",startupBanner:startupBanner||"",authBanner:authBanner||"",sendBufferSize:parseInt(sendBuffer)||null,receiveBufferSize:parseInt(receiveBuffer)||null,backlog:parseInt(backlog)||5,tcpNoDelayEnabled:!!tcpNoDelay,disableRealPathExpandedLongName:!!disableExpandedLongName,supportedKexes:sshKexes,supportedKeys:sshHostKeys,supportedCiphers:sshCiphers,supportedMacs:sshMacs,supportedCompressions:sshCompressions});};jscape.ServiceConfiguration.oftp=function(timeout,maxDataBufferSize,maxCredit,backlog,fileOverwritingPolicy,ciphers,protocols){return $.extend(new jscape.ServiceConfiguration(jscape.TransportService.Protocol.OFTP),{timeout:parseInt(timeout)||0,maxDataExchangeBufferSize:parseInt(maxDataBufferSize)||0,maxCredit:parseInt(maxCredit)||0,backlog:parseInt(backlog)||5,cipherSuites:ciphers||undefined,enabledProtocols:protocols||undefined,fileOverwritingPolicy:jscape.ServiceConfiguration.FileOverwritingPolicy.valueOf(fileOverwritingPolicy)||jscape.ServiceConfiguration.FileOverwritingPolicy.PROHIBIT});};jscape.ServiceConfiguration.tftp=function(retransmitAttempts,retransmitInterval,dirListingGenerationEnabled,fileHashGenerationEnabled){return $.extend(new jscape.ServiceConfiguration(jscape.TransportService.Protocol.TFTP),{maxRetransmitAttempts:parseInt(retransmitAttempts)||0,retransmitInterval:parseInt(retransmitInterval)||0,directoryListingGenerationEnabled:!!dirListingGenerationEnabled,fileHashGenerationEnabled:!!fileHashGenerationEnabled});};jscape.ServiceConfiguration.http=function(theme,logoData,timeout,logoutUrl,autoLogout,selfRegistration,searchConfiguration,docViewerEnabled,adHocEnabled,showTransferType,showLoginInfo,showAccountLink,showSearch,uploadForms,uploadFormRequired,languages){return $.extend(new jscape.ServiceConfiguration(jscape.TransportService.Protocol.HTTP),{theme:theme||"default",logoData:logoData||"",timeout:parseInt(timeout)||0,logoutUrl:logoutUrl||undefined,autoLogout:autoLogout||null,selfRegistration:selfRegistration||new jscape.SelfRegistrationConfiguration(),searchConfiguration:searchConfiguration||new jscape.SearchConfiguration(),documentViewerEnabled:!!docViewerEnabled,adHocTransferEnabled:!!adHocEnabled,showTransferType:!!showTransferType,showLoginInfo:!!showLoginInfo,showAccountLink:!!showAccountLink,showSearch:!!showSearch,uploadForms:uploadForms||[],uploadFormRequired:!!uploadFormRequired,languages:languages});};jscape.ServiceConfiguration.webdav=function(theme,logoData,logoutUrl,showLoginInfo,showAccountLink,languages){return $.extend(new jscape.ServiceConfiguration(jscape.TransportService.Protocol.WEBDAV),{theme:theme||"default",logoData:logoData||"",logoutUrl:logoutUrl||undefined,showLoginInfo:!!showLoginInfo,showAccountLink:!!showAccountLink,languages:languages||[]});};jscape.SelfRegistrationConfiguration=Class.extend({initialize:function(a,b){this.enabled=a||false;this.accountTemplate=b||"Default";}});jscape.SelfRegistrationConfiguration.fromJSON=function(data){return new jscape.SelfRegistrationConfiguration(data||data.enabled,data&&data.accountTemplate);};jscape.SearchConfiguration=Class.extend({initialize:function(a,b){this.category=a||jscape.SearchConfiguration.DEFAULT_CATEGORY;this.showCategoryDropdown=b||false;}});jscape.SearchConfiguration.fromJSON=function(data){return data?new jscape.SearchConfiguration(data.category,data.showCategoryDropdown):new jscape.SearchConfiguration();};jscape.SearchConfiguration.DEFAULT_CATEGORY="CONTENT";jscape.UploadForm=Class.extend({initialize:function(a,b,c,d,e,f){this.name=a||"";this.description=b||"";this.enabled=!!c;this.batch=!!d;this.group=e||null;this.inputs=f||[];},clone:function(){return new jscape.UploadForm(this.name,this.description,this.enabled,this.batch,this.group,$.map(this.inputs,function(entry){return entry.clone();}));}});jscape.UploadForm.fromJSON=function(data){return $.extend(new jscape.UploadForm(),data,{inputs:$.map(data.inputs||[],jscape.UploadForm.Input.fromJSON)});};jscape.UploadForm.Input=Class.extend({initialize:function(a,b,c,d,e){this.type=a||jscape.UploadForm.Input.TYPE.TEXT;this.name=b||"";this.label=c||"";this.value=$.isArray(d)?d.join(","):d||"";this.required=e!==undefined?!!e:true;},clone:function(){return new jscape.UploadForm.Input(this.type,this.name,this.label,this.value,this.required);},toJSON:function(){var multivalue=$.inArray(this.type,[jscape.UploadForm.Input.TYPE.DROPDOWN,jscape.UploadForm.Input.TYPE.MULTISELECT,jscape.UploadForm.Input.TYPE.RADIO])!=-1;return $.extend({type:this.type,name:this.name,label:this.label,required:this.required},multivalue?{values:this.value.split(",")}:{value:this.value});}});jscape.UploadForm.Input.fromJSON=function(data){return new jscape.UploadForm.Input(data.type,data.name,data.label,data.value||data.values,data.required);};jscape.UploadForm.Input.TYPE={TEXT:'TEXT',MEMO:'MEMO',DROPDOWN:'DROPDOWN',MULTISELECT:'MULTISELECT',RADIO:'RADIO'};jscape.domain.FtpConfigurationController=Class.extend({DEFAULT_CONFIG:jscape.ServiceConfiguration.ftp(300000,60000),view:null,config:null,copy:null,sslCiphers:null,initialize:function(){this.ciphersController=new jscape.domain.SslCiphersController();},start:function(domainName){this.domainName=domainName;if(this.view==null){this.view=new jscape.domain.FtpConfigurationView();}
this.view.show(this);},resume:function(){this.view.refresh();},hasChanged:function(){return this.config&&!Object._equals(this.copy,this._createConfiguration());},onLoadData:function(){return jscape.API.getServiceConfiguration(this.domainName,jscape.TransportService.Protocol.FTP).then(function(config){return config;},function(){return null;}).then($.proxy(function(config){this.config=config||this.DEFAULT_CONFIG.clone();this.copy=this.config.clone();this.sslCiphers=this.config.cipherSuites||null;this._setupView(this.config);},this));},onApply:function(){var config=this._createConfiguration();return jscape.API.setServiceConfiguration(this.domainName,jscape.TransportService.Protocol.FTP,config).done($.proxy(function(){this.config=config;this.copy=config.clone();this._setupView(this.config);},this)).done($.proxy(this._fireApplySuccess,this));},onDiscard:function(){this.config=this.copy;this.copy=this.config.clone();this.sslCiphers=this.config&&this.config.cipherSuites||null;this._setupView(this.config);},onSslCiphers:function(){this.ciphersController.start(this.domainName,this.sslCiphers).done($.proxy(function(ciphers){this.sslCiphers=ciphers;},this));},_createConfiguration:function(){return jscape.ServiceConfiguration.ftp(this.view.getTimeout(),this.view.getDataTimeout(),this.view.getBanner(),this.view.getPassiveIp(),this.view.getPassivePortRange(),this.view.getBacklog(),this.view.getSendBufferSize(),this.view.getReceiveBufferSize(),this.view.getDefaultTransferMode(),this.view.getDataConnectionMode(),this.sslCiphers,this.view.isShutdownCommandSsl(),this.view.isShutdownDataSsl(),this.view.isCommandRequireClientCertificate(),this.view.isDataRequireClientCertificate(),this.view.isForceDataEncryption(),this.view.isBlockPasvAttack(),this.view.isBlockBounceAttack(),this.view.getTcpNoDelay(),this.view.getNetworkCharset(),this.view.getFileCharset());},_setupView:function(config){if(config&&this.view){this.view.setTimeout(config.timeout);this.view.setDataTimeout(config.dataTimeout);this.view.setBanner(config.welcomeMessage);this.view.setPassiveIp(config.passiveIp);this.view.setPassivePortRange(config.portRange);this.view.setBacklog(config.backlog);this.view.setSendBufferSize(config.sendBufferSize);this.view.setReceiveBufferSize(config.receiveBufferSize);this.view.setDefaultTransferMode(config.defaultTransferMode);this.view.setDataConnectionMode(config.dataConnectionMode);this.view.setShutdownCommandSsl(config.shutdownSsl);this.view.setShutdownDataSsl(config.shutdownDataSsl);this.view.setCommandRequireClientCertificate(config.commandRequireClientCertificate);this.view.setDataRequireClientCertificate(config.dataRequireClientCertificate);this.view.setForceDataEncryption(config.forceDataEncryption);this.view.setBlockPasvAttack(config.blockPasvAttack);this.view.setBlockBounceAttack(config.blockBounceAttack);this.view.setTcpNoDelay(config.tcpNoDelayEnabled);this.view.setNetworkCharset(config.networkCharset);this.view.setFileCharset(config.fileCharset);}},_fireApplySuccess:function(){$(document).triggerHandler("broadcast",[window.R.string.APPLICATION_SUCCESS_APPLY]);}});jscape.domain.FtpConfigurationView=Class.extend({TIMEOUT_FACTOR:60*1000,BUFFER_FACTOR:1024,DEFAULT_CHARSET:"UTF-8",initialize:function(){this.fieldset=$("#service-ftp-config-fields").layout({fit:true,doSize:false,border:false});this.banner=$("textarea[name=banner]",this.fieldset).textbox({multiline:true,width:"70%",height:90});this.timeout=$("input[name=cmdtimeout]",this.fieldset).numberspinner({required:true,min:0,max:999,value:5,width:80});this.dataTimeout=$("input[name=datatimeout]",this.fieldset).numberspinner({required:true,min:0,max:999,value:1,width:80});this.passiveIp=$("input[name=passiveip]",this.fieldset).textbox({required:false,validType:"length[1,255]",invalidMessage:window.R.string.SERVICES_ERROR_BAD_PASSIVE_IP,width:"70%"});this.usePortRange=$("input[name=passiveportrange]:checkbox",this.fieldset);this.usePortRange.change($.proxy(function(){var enabled=this.usePortRange.is(":checked");$.each([this.portRangeStart,this.portRangeEnd],function(_,input){input.numberspinner(enabled?"enable":"disable").numberspinner(enabled?"enableValidation":"disableValidation");});},this));this.portRangeStart=$("input[name=passiveportpstart]",this.fieldset).numberspinner({required:true,min:1,max:65535,value:10000,width:80,onChange:$.proxy(this._adjustPortRange,this)});this.portRangeEnd=$("input[name=passiveportpend]",this.fieldset).numberspinner({required:true,min:1,max:65535,value:20000,width:80,onChange:$.proxy(this._adjustPortRange,this)});this.backlog=$("input[name=backlog]",this.fieldset).numberspinner({required:true,min:1,max:999,value:5,width:80});this.useSendBuffer=$("input[name=usesendbuffer]:checkbox",this.fieldset);this.useSendBuffer.change($.proxy(function(){var enabled=this.useSendBuffer.is(":checked");this.sendBufferSize.numberspinner(enabled?"enable":"disable").numberspinner(enabled?"enableValidation":"disableValidation");},this));this.sendBufferSize=$("input[name=sendbuffer]",this.fieldset).numberspinner({required:true,min:64,max:1024,increment:64,value:64,width:80});this.useReceiveBuffer=$("input[name=usereceivebuffer]:checkbox",this.fieldset);this.useReceiveBuffer.change($.proxy(function(){var enabled=this.useReceiveBuffer.is(":checked");this.receiveBufferSize.numberspinner(enabled?"enable":"disable").numberspinner(enabled?"enableValidation":"disableValidation");},this));this.receiveBufferSize=$("input[name=receivebuffer]",this.fieldset).numberspinner({required:true,min:64,max:1024,increment:64,value:64,width:80});this.defaultTransferMode=$("input[name=transfermode]:radio",this.fieldset);this.dataConnectionMode=$("input[name=dataconnectionmode]:radio",this.fieldset);this.forceDataEncryption=$("input[name=forcedataencryption]:checkbox",this.fieldset);this.commandRequireClientCertificate=$("input[name=cmdrequireclientcrt]:checkbox",this.fieldset);this.dataRequireClientCertificate=$("input[name=datarequireclientcrt]:checkbox",this.fieldset);this.shutdownCommandSsl=$("input[name=shutdowncmdssl]:checkbox",this.fieldset);this.shutdownDataSsl=$("input[name=shutdowndatassl]:checkbox",this.fieldset);this.blockBounceAttack=$("input[name=blockbounce]:checkbox",this.fieldset);this.blockPasvAttack=$("input[name=blockpasv]:checkbox",this.fieldset);this.tcpNoDelay=$("input[name=tcpnodelay]:checkbox",this.fieldset);this.networkCharset=$("select[name=networkcharset]",this.fieldset).combobox({required:true,editable:false,width:140});this.fileCharset=$("select[name=filecharset]",this.fieldset).combobox({required:true,editable:false,width:140});this.threatAsciiAsImage=$("input[name=asciiasimage]:checkbox",this.fieldset);this.threatAsciiAsImage.change($.proxy(function(){var enabled=!this.threatAsciiAsImage.is(":checked");this.fileCharset.combobox(enabled?"enable":"disable").combobox(enabled?"enableValidation":"disableValidation");},this));this.ciphersButton=$("a[role=button][name=sslciphers]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$CiphersButton,this)});this.applyButton=$("a[role=button][name=apply]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$ApplyButton,this)});this.discardButton=$("a[role=button][name=discard]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$DiscardButton,this)});this.fieldset.layout("panel","south").panel("resize",{height:"auto"});},show:function(listener){this.listener=listener||jscape.domain.FtpConfigurationView.LISTENER;this.fieldset.layout("resize");this._adjustPortRange();},refresh:function(){this.listener.onLoadData().then($.proxy(function(){this.fieldset.form("validate");},this));},getBanner:function(){return this.banner.textbox("getValue").trim();},setBanner:function(value){this.banner.textbox("setValue",value);},getTimeout:function(){return parseInt(this.timeout.numberspinner("getValue"))*this.TIMEOUT_FACTOR;},setTimeout:function(value){this.timeout.numberspinner("setValue",parseInt(value)/this.TIMEOUT_FACTOR);},getDataTimeout:function(){return parseInt(this.dataTimeout.numberspinner("getValue"))*this.TIMEOUT_FACTOR;},setDataTimeout:function(value){this.dataTimeout.numberspinner("setValue",parseInt(value)/this.TIMEOUT_FACTOR);},getPassiveIp:function(){return this.passiveIp.textbox("getValue").trim();},setPassiveIp:function(value){this.passiveIp.textbox("setValue",value);},getPassivePortRange:function(){return this.usePortRange.is(":checked")?{lowerBound:parseInt(this.portRangeStart.numberspinner("getValue")),upperBound:parseInt(this.portRangeEnd.numberspinner("getValue"))}:null;},setPassivePortRange:function(value){if(value&&value.lowerBound&&value.upperBound){this.usePortRange.prop("checked",true).change();this.portRangeEnd.numberspinner("setValue",parseInt(value.upperBound));this.portRangeStart.numberspinner("setValue",parseInt(value.lowerBound));}else{this.usePortRange.prop("checked",false).change();}},getBacklog:function(){return parseInt(this.backlog.numberspinner("getValue"));},setBacklog:function(value){this.backlog.numberspinner("setValue",parseInt(value));},getSendBufferSize:function(){return this.useSendBuffer.is(":checked")?parseInt(this.sendBufferSize.numberspinner("getValue"))*this.BUFFER_FACTOR:null;},setSendBufferSize:function(value){this.useSendBuffer.prop("checked",value!=null).change();if(value!=null){this.sendBufferSize.numberspinner("setValue",parseInt(value)/this.BUFFER_FACTOR);}},getReceiveBufferSize:function(){return this.useReceiveBuffer.is(":checked")?parseInt(this.receiveBufferSize.numberspinner("getValue"))*this.BUFFER_FACTOR:null;},setReceiveBufferSize:function(value){this.useReceiveBuffer.prop("checked",value!=null).change();if(value!=null){this.receiveBufferSize.numberspinner("setValue",parseInt(value)/this.BUFFER_FACTOR);}},getDefaultTransferMode:function(){return this.defaultTransferMode.filter(":checked").val();},setDefaultTransferMode:function(value){this.defaultTransferMode.filter("[value="+value+"]").prop("checked",true);},getDataConnectionMode:function(){return this.dataConnectionMode.filter(":checked").val();},setDataConnectionMode:function(value){this.dataConnectionMode.filter("[value="+value+"]").prop("checked",true);},isForceDataEncryption:function(){return this.forceDataEncryption.is(":checked");},setForceDataEncryption:function(value){this.forceDataEncryption.prop("checked",!!value);},isCommandRequireClientCertificate:function(){return this.commandRequireClientCertificate.is(":checked");},setCommandRequireClientCertificate:function(value){this.commandRequireClientCertificate.prop("checked",!!value);},isDataRequireClientCertificate:function(){return this.dataRequireClientCertificate.is(":checked");},setDataRequireClientCertificate:function(value){this.dataRequireClientCertificate.prop("checked",!!value);},isShutdownCommandSsl:function(){return this.shutdownCommandSsl.is(":checked");},setShutdownCommandSsl:function(value){this.shutdownCommandSsl.prop("checked",!!value);},isShutdownDataSsl:function(){return this.shutdownDataSsl.is(":checked");},setShutdownDataSsl:function(value){this.shutdownDataSsl.prop("checked",!!value);},isBlockBounceAttack:function(){return this.blockBounceAttack.is(":checked");},setBlockBounceAttack:function(value){this.blockBounceAttack.prop("checked",!!value);},isBlockPasvAttack:function(){return this.blockPasvAttack.is(":checked");},setBlockPasvAttack:function(value){this.blockPasvAttack.prop("checked",!!value).change();},getTcpNoDelay:function(){return this.tcpNoDelay.is(":checked");},setTcpNoDelay:function(value){this.tcpNoDelay.prop("checked",!!value);},getNetworkCharset:function(){return this.networkCharset.combobox("getValue");},setNetworkCharset:function(value){this.networkCharset.combobox("setValue",value||this.DEFAULT_CHARSET);},getFileCharset:function(){return this.threatAsciiAsImage.is(":checked")?null:this.fileCharset.combobox("getValue");},setFileCharset:function(value){this.threatAsciiAsImage.prop("checked",value==null).change();this.fileCharset.combobox("setValue",value!=null?value:this.DEFAULT_CHARSET);},_onClick$CiphersButton:function(){this.listener.onSslCiphers();},_onClick$ApplyButton:function(){if(this.fieldset.form("validate")){this.applyButton.linkbutton("disable");this.listener.onApply(this).always($.proxy(function(){this.applyButton.linkbutton("enable");},this));}},_onClick$DiscardButton:function(){this.listener.onDiscard();},_adjustPortRange:function(){var range=this.getPassivePortRange();if(range!=null){function _validate(spinner,validType,validParams){$(spinner).numberspinner("textbox").validatebox({validType:validType,validParams:validParams});return spinner.numberspinner("isValid");}
_validate(this.portRangeStart,"in_range",[this.portRangeStart.numberspinner("options").min,range.upperBound]);_validate(this.portRangeEnd,"in_range",[range.lowerBound,this.portRangeEnd.numberspinner("options").max]);}}});jscape.domain.FtpConfigurationView.LISTENER={onSslCiphers:$.noop,onApply:$.noop,onDiscard:$.noop};jscape.domain.SftpConfigurationController=Class.extend({DEFAULT_CONFIG:jscape.ServiceConfiguration.sftp(300000,"MFT"),view:null,config:null,copy:null,algorithms:null,initialize:function(){this.algorithms={};this.algorithmsController=new jscape.domain.SftpAlgorithmsController();this._initValidators();},start:function(domainName){this.domainName=domainName;if(this.view==null){this.view=new jscape.domain.SftpConfigurationView();}
this.view.show(this);},resume:function(){this.view.refresh();},hasChanged:function(){return this.config&&!Object._equals(this.copy,this._createConfiguration());},onLoadData:function(){return jscape.API.getServiceConfiguration(this.domainName,jscape.TransportService.Protocol.SFTP).then(function(config){return config;},function(){return null;}).then($.proxy(function(config){this.config=config||this.DEFAULT_CONFIG.clone();this.copy=this.config.clone();this._initAlgorithms();this._setupView(this.config);},this));},onApply:function(){var config=this._createConfiguration();return jscape.API.setServiceConfiguration(this.domainName,jscape.TransportService.Protocol.SFTP,config).done($.proxy(function(){this.config=config;this.copy=config.clone();this._initAlgorithms();this._setupView(this.config);},this)).done($.proxy(this._fireApplySuccess,this));},onDiscard:function(){this.config=this.copy;this.copy=this.config.clone();this._initAlgorithms();this._setupView(this.config);},onSftpAlgorithms:function(){this.algorithmsController.start(this.domainName,this.algorithms).done($.proxy(function(algorithms){this.algorithms=algorithms;},this));},_initAlgorithms:function(){this.algorithms=this.config?{kexes:this.config.supportedKexes,keys:this.config.supportedKeys,ciphers:this.config.supportedCiphers,macs:this.config.supportedMacs,compressions:this.config.supportedCompressions}:{};},_createConfiguration:function(){return jscape.ServiceConfiguration.sftp(this.view.getTimeout(),this.view.getVersion(),this.view.getStartupBanner(),this.view.getAuthenticationBanner(),this.view.getSendBufferSize(),this.view.getReceiveBufferSize(),this.view.getBacklog(),this.view.getTcpNoDelay(),this.view.isDisableExpandedLongName(),this.algorithms.kexes,this.algorithms.keys,this.algorithms.ciphers,this.algorithms.macs,this.algorithms.compressions);},_setupView:function(config){if(config&&this.view){this.view.setTimeout(config.timeout);this.view.setVersion(config.softwareVersion);this.view.setStartupBanner(config.startupBanner);this.view.setAuthenticationBanner(config.authBanner);this.view.setSendBufferSize(config.sendBufferSize);this.view.setReceiveBufferSize(config.receiveBufferSize);this.view.setBacklog(config.backlog);this.view.setTcpNoDelay(config.tcpNoDelayEnabled);this.view.setDisableExpandedLongName(config.disableRealPathExpandedLongName);}},_fireApplySuccess:function(){$(document).triggerHandler("broadcast",[window.R.string.APPLICATION_SUCCESS_APPLY]);},_initValidators:function(){var v=new jscape.Validator();v.rule("sftp_software_version",function(val){return/^[^\s]+$/gi.test(val);},window.R.string.SERVICES_ERROR_BAD_SFTP_VERSION);}});jscape.domain.SftpConfigurationView=Class.extend({TIMEOUT_FACTOR:60*1000,BUFFER_FACTOR:1024,initialize:function(){this.fieldset=$("#service-sftp-config-fields").layout({fit:true,doSize:false,border:false});this.version=$("input[name=version]",this.fieldset).textbox({width:"70%",validType:"sftp_software_version"});this.startupBanner=$("textarea[name=startupbanner]",this.fieldset).textbox({multiline:true,width:"70%",height:90});this.authBanner=$("textarea[name=authbanner]",this.fieldset).textbox({multiline:true,width:"70%",height:90});this.timeout=$("input[name=timeout]",this.fieldset).numberspinner({required:true,min:0,max:999,value:5,width:80});this.useSendBuffer=$("input[name=usesendbuffer]:checkbox",this.fieldset);this.useSendBuffer.change($.proxy(function(){var enabled=this.useSendBuffer.is(":checked");this.sendBufferSize.numberspinner(enabled?"enable":"disable").numberspinner(enabled?"enableValidation":"disableValidation");},this));this.sendBufferSize=$("input[name=sendbuffer]",this.fieldset).numberspinner({required:true,min:64,max:1024,increment:64,value:64,width:80});this.useReceiveBuffer=$("input[name=usereceivebuffer]:checkbox",this.fieldset);this.useReceiveBuffer.change($.proxy(function(){var enabled=this.useReceiveBuffer.is(":checked");this.receiveBufferSize.numberspinner(enabled?"enable":"disable").numberspinner(enabled?"enableValidation":"disableValidation");},this));this.receiveBufferSize=$("input[name=receivebuffer]",this.fieldset).numberspinner({required:true,min:64,max:1024,increment:64,value:64,width:80});this.backlog=$("input[name=backlog]",this.fieldset).numberspinner({required:true,min:1,max:999,value:5,width:80});this.tcpNoDelay=$("input[name=tcpnodelay]:checkbox",this.fieldset);this.disableLongName=$("input[name=disablelongname]:checkbox",this.fieldset);this.algorithmsButton=$("a[role=button][name=algorithms]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$AlgorithmsButton,this)});this.applyButton=$("a[role=button][name=apply]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$ApplyButton,this)});this.discardButton=$("a[role=button][name=discard]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$DiscardButton,this)});this.fieldset.layout("panel","south").panel("resize",{height:"auto"});},show:function(listener){this.listener=listener||jscape.domain.SftpConfigurationView.LISTENER;this.fieldset.layout("resize");},refresh:function(){this.listener.onLoadData().then($.proxy(function(){this.fieldset.form("validate");},this));},getTimeout:function(){return parseInt(this.timeout.numberspinner("getValue"))*this.TIMEOUT_FACTOR;},setTimeout:function(value){this.timeout.numberspinner("setValue",parseInt(value)/this.TIMEOUT_FACTOR);},getVersion:function(){return this.version.textbox("getValue").trim();},setVersion:function(value){this.version.textbox("setValue",value);},getStartupBanner:function(){return this.startupBanner.textbox("getValue");},setStartupBanner:function(value){this.startupBanner.textbox("setValue",value);},getAuthenticationBanner:function(){return this.authBanner.textbox("getValue");},setAuthenticationBanner:function(value){this.authBanner.textbox("setValue",value);},getSendBufferSize:function(){return this.useSendBuffer.is(":checked")?parseInt(this.sendBufferSize.numberspinner("getValue"))*this.BUFFER_FACTOR:null;},setSendBufferSize:function(value){this.useSendBuffer.prop("checked",value!=null).change();if(value!=null){this.sendBufferSize.numberspinner("setValue",parseInt(value)/this.BUFFER_FACTOR);}},getReceiveBufferSize:function(){return this.useReceiveBuffer.is(":checked")?parseInt(this.receiveBufferSize.numberspinner("getValue"))*this.BUFFER_FACTOR:null;},setReceiveBufferSize:function(value){this.useReceiveBuffer.prop("checked",value!=null).change();if(value!=null){this.receiveBufferSize.numberspinner("setValue",parseInt(value)/this.BUFFER_FACTOR);}},getBacklog:function(){return parseInt(this.backlog.numberspinner("getValue"));},setBacklog:function(value){this.backlog.numberspinner("setValue",parseInt(value));},getTcpNoDelay:function(){return this.tcpNoDelay.is(":checked");},setTcpNoDelay:function(value){this.tcpNoDelay.prop("checked",!!value);},isDisableExpandedLongName:function(){return this.disableLongName.is(":checked");},setDisableExpandedLongName:function(value){this.disableLongName.prop("checked",!!value).change();},_onClick$AlgorithmsButton:function(){this.listener.onSftpAlgorithms();},_onClick$ApplyButton:function(){if(this.fieldset.form("validate")){this.applyButton.linkbutton("disable");this.listener.onApply(this).always($.proxy(function(){this.applyButton.linkbutton("enable");},this));}},_onClick$DiscardButton:function(){this.listener.onDiscard();}});jscape.domain.SftpConfigurationView.LISTENER={onLoadData:$.noop,onSftpAlgorithms:$.noop,onApply:$.noop,onDiscard:$.noop};jscape.domain.AftpConfigurationController=Class.extend({DEFAULT_CONFIG:jscape.ServiceConfiguration.aftp(300000,60000,5,true,10),view:null,config:null,copy:null,sslCiphers:null,initialize:function(){this.ciphersController=new jscape.domain.SslCiphersController();},start:function(domainName){this.domainName=domainName;if(this.view==null){this.view=new jscape.domain.AftpConfigurationView();}
this.view.show(this);},resume:function(){this.view.refresh();},hasChanged:function(){return this.config&&!Object._equals(this.copy,this._createConfiguration());},onLoadData:function(){return jscape.API.getServiceConfiguration(this.domainName,jscape.TransportService.Protocol.AFTP).then(function(config){return config;},function(){return null;}).then($.proxy(function(config){this.config=config||this.DEFAULT_CONFIG.clone();this.copy=this.config.clone();this.sslCiphers=this.config.cipherSuites||null;this._setupView(this.config);},this));},onApply:function(){var config=this._createConfiguration();return jscape.API.setServiceConfiguration(this.domainName,jscape.TransportService.Protocol.AFTP,config).done($.proxy(function(){this.config=config;this.copy=config.clone();this._setupView(this.config);},this)).done($.proxy(this._fireApplySuccess,this));},onDiscard:function(){this.config=this.copy;this.copy=this.config.clone();this.sslCiphers=this.config&&this.config.cipherSuites||null;this._setupView(this.config);},onSslCiphers:function(){this.ciphersController.start(this.domainName,this.sslCiphers).done($.proxy(function(ciphers){this.sslCiphers=ciphers;},this));},_createConfiguration:function(){return jscape.ServiceConfiguration.aftp(this.view.getTimeout(),this.view.getDataTimeout(),this.view.getBacklog(),this.view.getTcpNoDelay(),this.view.getMaxLossListSize(),this.sslCiphers);},_setupView:function(config){if(config&&this.view){this.view.setTimeout(config.timeout);this.view.setDataTimeout(config.dataTimeout);this.view.setBacklog(config.backlog);this.view.setTcpNoDelay(config.tcpNoDelayEnabled);this.view.setMaxLossListSize(config.maxLossListSize);}},_fireApplySuccess:function(){$(document).triggerHandler("broadcast",[window.R.string.APPLICATION_SUCCESS_APPLY]);}});jscape.domain.AftpConfigurationView=Class.extend({TIMEOUT_FACTOR:60*1000,initialize:function(){this.fieldset=$("#service-aftp-config-fields").layout({fit:true,doSize:false,border:false});this.timeout=$("input[name=cmdtimeout]",this.fieldset).numberspinner({required:true,min:0,max:999,value:5,width:80});this.dataTimeout=$("input[name=datatimeout]",this.fieldset).numberspinner({required:true,min:0,max:999,value:5,width:80});this.backlog=$("input[name=backlog]",this.fieldset).numberspinner({required:true,min:1,max:999,value:5,width:80});this.tcpNoDelay=$("input[name=tcpnodelay]:checkbox",this.fieldset);this.lossListSize=$("input[name=losslistsize]",this.fieldset).numberspinner({required:true,min:1,max:99,value:10,width:60});this.ciphersButton=$("a[role=button][name=sslciphers]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$CiphersButton,this)});this.applyButton=$("a[role=button][name=apply]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$ApplyButton,this)});this.discardButton=$("a[role=button][name=discard]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$DiscardButton,this)});this.fieldset.layout("panel","south").panel("resize",{height:"auto"});},show:function(listener){this.listener=listener||jscape.domain.AftpConfigurationView.LISTENER;this.fieldset.layout("resize");},refresh:function(){this.listener.onLoadData().done($.proxy(function(){this.fieldset.form("validate");},this));},getTimeout:function(){return parseInt(this.timeout.numberspinner("getValue"))*this.TIMEOUT_FACTOR;},setTimeout:function(value){this.timeout.numberspinner("setValue",parseInt(value)/this.TIMEOUT_FACTOR);},getDataTimeout:function(){return parseInt(this.dataTimeout.numberspinner("getValue"))*this.TIMEOUT_FACTOR;},setDataTimeout:function(value){this.dataTimeout.numberspinner("setValue",parseInt(value)/this.TIMEOUT_FACTOR);},getBacklog:function(){return parseInt(this.backlog.numberspinner("getValue"));},setBacklog:function(value){this.backlog.numberspinner("setValue",parseInt(value));},getTcpNoDelay:function(){return this.tcpNoDelay.is(":checked");},setTcpNoDelay:function(value){this.tcpNoDelay.prop("checked",!!value);},getMaxLossListSize:function(){return parseInt(this.lossListSize.numberspinner("getValue"));},setMaxLossListSize:function(value){this.lossListSize.numberspinner("setValue",parseInt(value));},_onClick$CiphersButton:function(){this.listener.onSslCiphers();},_onClick$ApplyButton:function(){if(this.fieldset.form("validate")){this.applyButton.linkbutton("disable");this.listener.onApply(this).always($.proxy(function(){this.applyButton.linkbutton("enable");},this));}},_onClick$DiscardButton:function(){this.listener.onDiscard();}});jscape.domain.AftpConfigurationView.LISTENER={onLoadData:$.noop,onSslCiphers:$.noop,onApply:$.noop,onDiscard:$.noop};jscape.domain.OftpConfigurationController=Class.extend({DEFAULT_CONFIG:jscape.ServiceConfiguration.oftp(30*1000,4096,10),view:null,config:null,copy:null,sslCiphers:null,initialize:function(){this.ciphersController=new jscape.domain.SslCiphersController();},start:function(domainName){this.domainName=domainName;if(this.view==null){this.view=new jscape.domain.OftpConfigurationView();}
this.view.show(this);},resume:function(){this.view.refresh();},hasChanged:function(){return this.config&&!Object._equals(this.copy,this._createConfiguration());},onLoadData:function(){return jscape.API.getServiceConfiguration(this.domainName,jscape.TransportService.Protocol.OFTP).then(function(config){return config;},function(){return null;}).then($.proxy(function(config){this.config=config||this.DEFAULT_CONFIG.clone();this.copy=this.config.clone();this.sslCiphers=this.config.cipherSuites||null;this._setupView(this.config);},this));},onApply:function(){var config=this._createConfiguration();return jscape.API.setServiceConfiguration(this.domainName,jscape.TransportService.Protocol.OFTP,config).done($.proxy(function(){this.config=config;this.copy=config.clone();this._setupView(this.config);},this)).done($.proxy(this._fireApplySuccess,this));},onDiscard:function(){this.config=this.copy;this.copy=this.config.clone();this.sslCiphers=this.config&&this.config.cipherSuites||null;this._setupView(this.config);},onSslCiphers:function(){this.ciphersController.start(this.domainName,this.sslCiphers).done($.proxy(function(ciphers){this.sslCiphers=ciphers;},this));},_createConfiguration:function(){return jscape.ServiceConfiguration.oftp(this.view.getTimeout(),this.view.getMaxDataBufferSize(),this.view.getMaxCredit(),this.view.getBacklog(),this.view.getFileOverwritingPolicy(),this.sslCiphers,this.config.enabledProtocols);},_setupView:function(config){if(config&&this.view){this.view.setTimeout(config.timeout);this.view.setMaxDataBufferSize(config.maxDataExchangeBufferSize);this.view.setMaxCredit(config.maxCredit);this.view.setBacklog(config.backlog);this.view.setFileOverwritingPolicy(config.fileOverwritingPolicy!==jscape.ServiceConfiguration.FileOverwritingPolicy.PROHIBIT?config.fileOverwritingPolicy:null);}},_fireApplySuccess:function(){$(document).triggerHandler("broadcast",[window.R.string.APPLICATION_SUCCESS_APPLY]);}});jscape.domain.OftpConfigurationView=Class.extend({TIMEOUT_FACTOR:1000,initialize:function(){this.fieldset=$("#service-oftp-config-fields").layout({fit:true,doSize:false,border:false});this.timeout=$("input[name=timeout]",this.fieldset).numberspinner({required:true,min:0,max:999,width:80});this.dataBuffer=$("input[name=buffer]",this.fieldset).numberspinner({required:true,min:128,max:99999,increment:10,width:100});this.credit=$("input[name=credit]",this.fieldset).numberspinner({required:true,min:1,max:999,width:80});this.backlog=$("input[name=backlog]",this.fieldset).numberspinner({required:true,min:1,max:999,value:5,width:80});this.fileOverwriting=$("input[name=fileoverwriting]:checkbox",this.fieldset).change($.proxy(function(){var enabled=this.fileOverwriting.is(":checked:not(:disabled)");this.fileOverwritingPolicy.combobox(enabled?"enable":"disable").combobox(enabled?"enableValidation":"disableValidation");},this));this.fileOverwritingPolicy=$("select[name=fileoverwritingpolicy]",this.fieldset).combobox({editable:false,validType:"non_empty",onLoadSuccess:$.noop,width:200,panelHeight:"auto"});this.ciphersButton=$("a[role=button][name=sslciphers]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$CiphersButton,this)});this.applyButton=$("a[role=button][name=apply]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$ApplyButton,this)});this.discardButton=$("a[role=button][name=discard]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$DiscardButton,this)});this.fieldset.layout("panel","south").panel("resize",{height:"auto"});},show:function(listener){this.listener=listener||jscape.domain.OftpConfigurationView.LISTENER;this.fieldset.layout("resize");},refresh:function(){this.listener.onLoadData().done($.proxy(function(){this.fieldset.form("validate");},this));},getTimeout:function(){return parseInt(this.timeout.numberspinner("getValue"))*this.TIMEOUT_FACTOR;},setTimeout:function(value){this.timeout.numberspinner("setValue",parseInt(value)/this.TIMEOUT_FACTOR).numberspinner("validate");},getMaxDataBufferSize:function(){return parseInt(this.dataBuffer.numberspinner("getValue"));},setMaxDataBufferSize:function(value){this.dataBuffer.numberspinner("setValue",parseInt(value)).numberspinner("validate");},getMaxCredit:function(){return parseInt(this.credit.numberspinner("getValue"));},setMaxCredit:function(value){this.credit.numberspinner("setValue",parseInt(value)).numberspinner("validate");},getFileOverwritingPolicy:function(){return this.fileOverwriting.is(":checked")?this.fileOverwritingPolicy.combobox("getValue"):null;},getBacklog:function(){return parseInt(this.backlog.numberspinner("getValue"));},setBacklog:function(value){this.backlog.numberspinner("setValue",parseInt(value));},setFileOverwritingPolicy:function(value){if(value!=null){this.fileOverwriting.prop("checked",true).change();this.fileOverwritingPolicy.combobox("select",value);}else{this.fileOverwriting.prop("checked",false).change();this.fileOverwritingPolicy.combobox("reset");}},_onClick$CiphersButton:function(){this.listener.onSslCiphers();},_onClick$ApplyButton:function(){if(this.fieldset.form("validate")){this.applyButton.linkbutton("disable");this.listener.onApply(this).always($.proxy(function(){this.applyButton.linkbutton("enable");},this));}},_onClick$DiscardButton:function(){this.listener.onDiscard();}});jscape.domain.OftpConfigurationView.LISTENER={onLoadData:$.noop,onSslCiphers:$.noop,onApply:$.noop,onDiscard:$.noop};jscape.domain.TftpConfigurationController=Class.extend({DEFAULT_CONFIG:jscape.ServiceConfiguration.tftp(6,3000,true,true),view:null,config:null,start:function(domainName){this.domainName=domainName;if(this.view==null){this.view=new jscape.domain.TftpConfigurationView();}
this.view.show(this);},resume:function(){this.view.refresh();},hasChanged:function(){return this.config&&!Object._equals(this.config,this._createConfiguration());},onLoadData:function(){return jscape.API.getServiceConfiguration(this.domainName,jscape.TransportService.Protocol.TFTP).then(function(config){return config;},function(){return null;}).then($.proxy(function(config){this.config=config||this.DEFAULT_CONFIG.clone();this._setupView(this.config);},this));},onApply:function(){var config=this._createConfiguration();return jscape.API.setServiceConfiguration(this.domainName,jscape.TransportService.Protocol.TFTP,config).done($.proxy(function(){this.config=config.clone();this._setupView(config);},this)).done($.proxy(this._fireApplySuccess,this));},onDiscard:function(){var config=this.config;this.config=config.clone();this._setupView(this.config);},_createConfiguration:function(){return jscape.ServiceConfiguration.tftp(this.view.getMaxRetransmitAttempts(),this.view.getRetransmitInterval(),this.view.isDirectoryListingGenerationEnabled(),this.view.isFileHashGenerationEnabled());},_setupView:function(config){if(config&&this.view){this.view.setMaxRetransmitAttempts(config.maxRetransmitAttempts);this.view.setRetransmitInterval(config.retransmitInterval);this.view.setDirectoryListingGenerationEnabled(config.directoryListingGenerationEnabled);this.view.setFileHashGenerationEnabled(config.fileHashGenerationEnabled);}},_fireApplySuccess:function(){$(document).triggerHandler("broadcast",[window.R.string.APPLICATION_SUCCESS_APPLY]);}});jscape.domain.TftpConfigurationView=Class.extend({TIME_FACTOR:1000,initialize:function(){this.fieldset=$("#service-tftp-config-fields").layout({fit:true,doSize:false,border:false});this.retransmitAttempts=$("input[name=retransmitattempts]",this.fieldset).numberspinner({required:true,min:0,max:100,width:80});this.retransmitInterval=$("input[name=retransmitinterval]",this.fieldset).numberspinner({required:true,min:1,max:255,width:80});this.dirListingGeneration=$("input[name=generatedirlisting]",this.fieldset);this.fileHashGeneration=$("input[name=generatefilehash]",this.fieldset);this.applyButton=$("a[role=button][name=apply]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$ApplyButton,this)});this.discardButton=$("a[role=button][name=discard]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$DiscardButton,this)});this.fieldset.layout("panel","south").panel("resize",{height:"auto"});},show:function(listener){this.listener=listener||jscape.domain.TftpConfigurationView.LISTENER;this.fieldset.layout("resize");},refresh:function(){this.listener.onLoadData().done($.proxy(function(){this.fieldset.form("validate");},this));},getMaxRetransmitAttempts:function(){return parseInt(this.retransmitAttempts.numberspinner("getValue"));},setMaxRetransmitAttempts:function(value){this.retransmitAttempts.numberspinner("setValue",parseInt(value)).numberspinner("validate");},getRetransmitInterval:function(){return parseInt(this.retransmitInterval.numberspinner("getValue"))*this.TIME_FACTOR;},setRetransmitInterval:function(value){this.retransmitInterval.numberspinner("setValue",parseInt(value)/this.TIME_FACTOR).numberspinner("validate");},isDirectoryListingGenerationEnabled:function(){return this.dirListingGeneration.is(":checked");},setDirectoryListingGenerationEnabled:function(value){this.dirListingGeneration.prop("checked",!!value);},isFileHashGenerationEnabled:function(){return this.fileHashGeneration.is(":checked");},setFileHashGenerationEnabled:function(value){this.fileHashGeneration.prop("checked",!!value);},_onClick$ApplyButton:function(){if(this.fieldset.form("validate")){this.applyButton.linkbutton("disable");this.listener.onApply(this).always($.proxy(function(){this.applyButton.linkbutton("enable");},this));}},_onClick$DiscardButton:function(){this.listener.onDiscard();}});jscape.domain.TftpConfigurationView.LISTENER={onLoadData:$.noop,onApply:$.noop,onDiscard:$.noop};jscape.domain.HttpConfigurationController=Class.extend({DEFAULT_CONFIG:jscape.ServiceConfiguration.http("","",600000,"",null,null,false,true,true,true,true,true,true),DEFAULT_SEARCH_CATEGORY:jscape.SearchConfiguration.DEFAULT_CATEGORY,config:null,languages:null,uploadForms:null,view:null,initialize:function(themeLoader){this.themeLoader=themeLoader;this.formsController=new jscape.domain.UploadFormsController();this.resourcesController=new jscape.domain.WebResourcesController();},start:function(domainName){this.domainName=domainName;if(this.view==null){this.view=new jscape.domain.HttpConfigurationView();}
this.view.show(this);},resume:function(){this.view.refresh();},hasChanged:function(){return this.config&&!Object._equals(this.config,this._createConfiguration());},onLoadData:function(){return jscape.API.getServiceConfiguration(this.domainName,jscape.TransportService.Protocol.HTTP).then(function(config){return config;},function(){return null;}).then($.proxy(function(config){this.config=config||this.DEFAULT_CONFIG.clone();this.languages=this.config.languages;this.uploadForms=this.config.uploadForms;this._setupView(this.config);},this));},onApply:function(){var config=this._createConfiguration();return jscape.API.setServiceConfiguration(this.domainName,jscape.TransportService.Protocol.HTTP,config).done($.proxy(function(){this.config=config.clone();this.languages=this.config.languages;this.uploadForms=this.config.uploadForms;this._fireApplySuccess();},this));},onDiscard:function(){var config=this.config;this.config=config.clone();this.languages=this.config.languages;this.uploadForms=this.config.uploadForms;this._setupView(this.config);},onSetupForms:function(){var forms=$.map(this.uploadForms,function(form){return form.clone();});jscape.API.getGroupNames(this.domainName).always($.proxy(function(groupNames){this.formsController.start(forms,groupNames).done($.proxy(function(values){this.uploadForms=values;},this));},this));},onSetupResources:function(){var copy=$.map(this.languages,function(lang){return lang.clone();});this.resourcesController.start(this.domainName,jscape.TransportService.Protocol.HTTP,copy).done($.proxy(function(values){this.languages=values;},this));},onChangeLogo:function(file){if(file&&file.type.match("image.*")&&window.FileReader){var type=file.type;var reader=new FileReader();reader.onload=$.proxy(function(e){this.view.setLogoData(e.target.result,type);reader.onload=null;type=reader=null;},this);reader.readAsDataURL(file);}else{this.view.setLogoData(null);}},onChangeTheme:function(){var c=new jscape.themes.WebThemeConfigurationController(this.themeLoader,this.view.container());return c.start(this.view.getTheme()).done($.proxy(function(theme){this.view.setTheme(theme);},this));},_createConfiguration:function(){return jscape.ServiceConfiguration.http(this.view.getTheme(),this.view.getLogoData(),this.view.getTimeout(),this.view.getLogoutUrl(),this.view.getAutoLogout(),new jscape.SelfRegistrationConfiguration(this.view.getSelfRegistrationTemplate()!=null,this.view.getSelfRegistrationTemplate()),new jscape.SearchConfiguration(this.view.getSearchCategory()),this.view.isDocumentViewerEnabled(),this.view.isAdHocTransferEnabled(),this.view.isShowTransferMode(),this.view.isShowLoginInfo(),this.view.isShowAccountLink(),this.view.isShowSearch(),this.uploadForms,this.view.isUploadFormRequired(),this.languages);},_setupView:function(config){if(config&&this.view){this.view.setTheme(config.theme);this.view.setLogoData(config.logoData);this.view.setTimeout(config.timeout);this.view.setLogoutUrl(config.logoutUrl);this.view.setAutoLogout(config.autoLogout);this.view.setDocumentViewerEnabled(config.documentViewerEnabled);this.view.setAdHocTransferEnabled(config.adHocTransferEnabled);this.view.setShowTransferMode(config.showTransferType);this.view.setShowLoginInfo(config.showLoginInfo);this.view.setShowAccountLink(config.showAccountLink);this.view.setShowSearch(config.showSearch);if(config.searchConfiguration){this.view.setSearchCategory(config.searchConfiguration.category);}else{this.view.setSearchCategory(this.DEFAULT_SEARCH_CATEGORY);}
this.view.setUploadFormRequired(config.uploadFormRequired);}
jscape.API.getAccountTemplateNames(this.domainName).done($.proxy(function(templates){this.view.setSelfRegistrationTemplates(templates.sort());if(config){this.view.setSelfRegistrationTemplate(config.selfRegistration&&config.selfRegistration.enabled?config.selfRegistration.accountTemplate:null);}},this));},_fireApplySuccess:function(){$(document).triggerHandler("broadcast",[window.R.string.APPLICATION_SUCCESS_APPLY]);}});jscape.domain.HttpConfigurationView=Class.extend({DATA_URL:{pattern:/data:image\/.*;base64,(.+)/,template:"data:{0};base64,{1}",placeholder:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"},DEFAULT_TEMPLATE_NAME:"Default",TIMEOUT_FACTOR:60*1000,GRACE_PERIOD_FACTOR:1000,initialize:function(){this.fieldset=$("#service-http-config-fields").layout({fit:true,doSize:false,border:false});this.theme=$("input[name=theme]",this.fieldset).textbox({required:false,editable:false,readonly:true,width:"20%",minWidth:200});this.theme.textbox("textbox").click($.proxy(function(){this.changeThemeButton.click();},this));this.changeThemeButton=$("a[role=button][name=changetheme]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$ChangeThemeButton,this)});this.logo=$("<img />").prependTo($(".logo-preview",this.fieldset)).click($.proxy(function(){this.logoFile.click();},this));this.logoFile=$("input[name=logo]",this.fieldset).css({width:0,height:0,opacity:0,position:"absolute",left:"-10000px"});this.logoFile.change($.proxy(this._onChange$Logo,this));this.logoButton=$("a[role=button][name=changelogo]",this.fieldset).linkbutton({onClick:$.proxy(function(){this.logoFile.click();},this)}).css("vertical-align","top");this.logoutUrl=$("input[name=logouturl]",this.fieldset).textbox({required:false,width:"50%"});this.timeout=$("input[name=timeout]",this.fieldset).numberspinner({required:true,min:1,max:180,width:70});this.autoLogoutEnabled=$("input[name=autologout]:checkbox",this.fieldset);this.autoLogoutEnabled.change($.proxy(function(){var enabled=this.autoLogoutEnabled.is(":checked");$.each([this.autoLogoutTimeout,this.autoLogoutGracePeriod],function(_,input){input.numberspinner(enabled?"enable":"disable").numberspinner(enabled?"enableValidation":"disableValidation");})},this));this.autoLogoutTimeout=$("input[name=autologouttimeout]",this.fieldset).numberspinner({required:true,min:1,max:180,value:1,width:70});this.autoLogoutGracePeriod=$("input[name=autologoutgraceperiod]",this.fieldset).numberspinner({required:true,min:10,max:600,value:10,increment:10,width:70});this.signupEnabled=$("input[name=signupallowed]:checkbox",this.fieldset).prop("disabled",true);this.signupEnabled.change($.proxy(function(){var enabled=this.signupEnabled.is(":checked");this.signupAccountTemplate.combobox(enabled?"enable":"disable").combobox(enabled?"enableValidation":"disableValidation");},this));this.signupAccountTemplate=$("select[name=signuptemplate]",this.fieldset);this.signupAccountTemplate.combobox({required:true,editable:true,limitToList:true,disabled:true,onLoadSuccess:$.proxy(function(data){if(data.length){this.signupEnabled.prop("disabled",false);this.signupAccountTemplate.combobox("select",this.DEFAULT_TEMPLATE_NAME).combobox("resize",170);}else{this.signupEnabled.prop("disabled",true);}},this),panelHeight:"auto"});this.searchCategory=$("select[name=searchcategory]",this.fieldset).combobox({required:true,editable:false,limitToList:true,disabled:true,width:200,panelHeight:"auto"});this.docViewerEnabled=$("input[name=docviewerallowed]:checkbox",this.fieldset);this.adHocTransferEnabled=$("input[name=adhoctransferallowed]:checkbox",this.fieldset);this.showLogin=$("input[name=showlogin]:checkbox",this.fieldset);this.showSearch=$("input[name=showsearch]:checkbox",this.fieldset).change($.proxy(function(){this.searchCategory.combobox(this.isShowSearch()?"enable":"disable");},this));this.showTransferMode=$("input[name=showtransfermode]:checkbox",this.fieldset);this.showAccount=$("input[name=showaccount]:checkbox",this.fieldset);this.resourcesButton=$("a[role=button][name=resources]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$ResourcesButton,this)});this.uploadFormsButton=$("a[role=button][name=uploadforms]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$FormsButton,this)});this.uploadFormRequired=$("input[name=uploadformrequired]:checkbox",this.fieldset);this.applyButton=$("a[role=button][name=apply]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$ApplyButton,this)});this.discardButton=$("a[role=button][name=discard]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$DiscardButton,this)});this.fieldset.layout("panel","south").panel("resize",{height:"auto"});},container:function(){return this.fieldset;},show:function(listener){this.listener=listener||jscape.domain.HttpConfigurationView.LISTENER;this.fieldset.layout("resize").form("validate");this.showSearch.change();},refresh:function(){this.listener.onLoadData().done($.proxy(function(){this.fieldset.form("validate");},this));},getTheme:function(){return this.theme.textbox("getValue");},setTheme:function(value){this.theme.textbox("setValue",value);},getLogoData:function(){var dataUrl=this.logo.attr("src");return dataUrl&&dataUrl!=this.DATA_URL.placeholder?dataUrl.replace(this.DATA_URL.pattern,"$1"):"";},setLogoData:function(data,type){data=data?data:this.DATA_URL.placeholder;this.logo[0].src=this.DATA_URL.pattern.test(data)?data:this.DATA_URL.template.supplant({0:type||"image/png",1:data||""});},getTimeout:function(){return parseInt(this.timeout.numberspinner("getValue"))*this.TIMEOUT_FACTOR;},setTimeout:function(value){this.timeout.numberspinner("setValue",parseInt(value)/this.TIMEOUT_FACTOR);},getLogoutUrl:function(){return this.logoutUrl.textbox("getValue");},setLogoutUrl:function(value){this.logoutUrl.textbox("setValue",value);},getAutoLogout:function(){return this.autoLogoutEnabled.is(":checked")?{timeout:parseInt(this.autoLogoutTimeout.numberspinner("getValue"))*this.TIMEOUT_FACTOR,gracePeriod:parseInt(this.autoLogoutGracePeriod.numberspinner("getValue"))*this.GRACE_PERIOD_FACTOR}:null;},setAutoLogout:function(value){if(value&&value.timeout){this.autoLogoutEnabled.prop("checked",true).change();this.autoLogoutTimeout.numberspinner("setValue",parseInt(value.timeout)/this.TIMEOUT_FACTOR).numberspinner("isValid");this.autoLogoutGracePeriod.numberspinner("setValue",parseInt(value.gracePeriod)/this.GRACE_PERIOD_FACTOR).numberspinner("isValid");}else{this.autoLogoutEnabled.prop("checked",false).change();}},getSelfRegistrationTemplate:function(){return this.signupEnabled.is(":checked")?this.signupAccountTemplate.combobox("getValue"):null;},setSelfRegistrationTemplate:function(value){this.signupEnabled.prop("checked",value!=null).change();if(value!=null){this.signupAccountTemplate.combobox("select",value);}},setSelfRegistrationTemplates:function(values){this.signupAccountTemplate.combobox("loadData",values);},getSearchCategory:function(){return this.searchCategory.combobox("getValue");},setSearchCategory:function(value){if(!!value){this.searchCategory.combobox("setValue",value);}},isDocumentViewerEnabled:function(){return this.docViewerEnabled.is(":checked");},setDocumentViewerEnabled:function(value){this.docViewerEnabled.prop("checked",!!value);},isAdHocTransferEnabled:function(){return this.adHocTransferEnabled.is(":checked");},setAdHocTransferEnabled:function(value){this.adHocTransferEnabled.prop("checked",!!value).change();},isShowTransferMode:function(){return this.showTransferMode.is(":checked");},setShowTransferMode:function(value){this.showTransferMode.prop("checked",!!value);},isShowSearch:function(){return this.showSearch.is(":checked");},setShowSearch:function(value){this.showSearch.prop("checked",!!value).change();},isShowLoginInfo:function(){return this.showLogin.is(":checked");},setShowLoginInfo:function(value){this.showLogin.prop("checked",!!value);},isShowAccountLink:function(){return this.showAccount.is(":checked");},setShowAccountLink:function(value){this.showAccount.prop("checked",!!value).change();},isUploadFormRequired:function(){return this.uploadFormRequired.is(":checked");},setUploadFormRequired:function(value){this.uploadFormRequired.prop("checked",!!value);},_onClick$FormsButton:function(){this.listener.onSetupForms();},_onClick$ResourcesButton:function(){this.listener.onSetupResources();},_onChange$Logo:function(e){var files=e.target.files;if(files&&files.length){this.listener.onChangeLogo(files[0]);}
return false;},_onClick$ChangeThemeButton:function(){this.changeThemeButton.linkbutton("disable");this.listener.onChangeTheme().always($.proxy(function(){this.changeThemeButton.linkbutton("enable");},this));},_onClick$ApplyButton:function(){if(this.fieldset.form("validate")){this.applyButton.linkbutton("disable");this.listener.onApply(this).always($.proxy(function(){this.applyButton.linkbutton("enable");},this));}},_onClick$DiscardButton:function(){this.listener.onDiscard();}});jscape.domain.HttpConfigurationView.LISTENER={onLoadData:$.noop,onSetupForms:$.noop,onSetupResources:$.noop,onChangeLogo:$.noop,onChangeTheme:$.noop,onApply:$.noop,onDiscard:$.noop};jscape.domain.SslCiphersController=Class.extend({deferred:null,ciphers:null,start:function(domainName,ciphers){this.domainName=domainName;this.deferred=$.Deferred();this._setupDialog(ciphers).show(this);return this.deferred.promise();},onSelectMedium:function(dialog){dialog.setCiphers(jscape.ServerParameters.mediumCiphers());},onSelectStrong:function(dialog){dialog.setCiphers(jscape.ServerParameters.strongCiphers());},onSubmit:function(dialog){var ciphers=dialog.getCiphers();dialog.destroy();this.deferred.resolve(ciphers);},onCancel:function(dialog){dialog.destroy();this.deferred.reject();},_setupDialog:function(ciphers){var dialog=new jscape.domain.SslCiphersDialog();if(this.ciphers==null){$.when(jscape.API.getServerParameters(),jscape.API.getDomainStatistics(this.domainName)).done($.proxy(function(params,stats){this.ciphers=stats&&stats.fipsModeEnabled?params.sslFipsCiphers:params.sslCiphers;dialog.setSslCiphers(this.ciphers);dialog.setCiphers(ciphers);},this)).fail($.proxy(function(){this.ciphers=null;},this));}else{dialog.setSslCiphers(this.ciphers);dialog.setCiphers(ciphers);}
return dialog;}});jscape.domain.SslCiphersDialog=jscape.ui.DefaultDialog.extend({initialize:function(){this._super($("#d-services-ciphers"),{minWidth:630,width:"50%",maxWidth:"70%",height:"70%"});this.fieldset=this.dialog.find(".content").first().layout({fit:true,doSize:false,border:false});this.data=$("table[role=grid][aria-label=sslciphers]",this.dialog);this.data.datagrid({fit:true,showHeader:false,remoteSort:false,singleSelect:false,selectOnCheck:true,checkOnSelect:true,toolbar:"#{id} div.viewpane-toolbar".supplant({id:this.getId()}),onLoadSuccess:$.proxy(this._adjustButtonsState,this),idField:"value",columns:[[{field:"value",checkbox:true},{field:"text",sortable:true}]]});this.data.filter(".datagrid-body td").css("border","transparent");this.selectAllButton=$("a[role=button][name=all]",this.dialog).linkbutton({toggle:true,onClick:$.proxy(this._onClick$SelectAllButton,this)});this.selectMediumButton=$("a[role=button][name=medium]",this.dialog).linkbutton({disabled:true,onClick:$.proxy(this._onClick$SelectMediumButton,this)});this.selectStrongButton=$("a[role=button][name=strong]",this.dialog).linkbutton({disabled:true,onClick:$.proxy(this._onClick$SelectStrongButton,this)});this.fieldset.layout("panel","center").panel("resize");},show:function(listener){this._super(listener||jscape.domain.SslCiphersDialog.LISTENER);this.fieldset.layout("resize");},getCiphers:function(){return $.map(this.data.datagrid("getChecked"),function(row){return row.value;});},setCiphers:function(values){if(values&&values.length){this.data.datagrid("unselectAll");for(var i=0;i<values.length;i++){this.data.datagrid("selectRecord",values[i]);}}else{this.data.datagrid("clearChecked");}},setSslCiphers:function(values){this.data.datagrid("loadData",$.map(values,function(value){return{text:value,value:value};}));},_onClick$SelectAllButton:function(){var text=this.selectAllButton.text();this.selectAllButton.html(this.selectAllButton.html().replace(text,this.selectAllButton.data("toggle-text")));this.selectAllButton.data("toggle-text",text);if(this.selectAllButton.linkbutton("options").selected){this.data.datagrid("selectAll");}else{this.data.datagrid("unselectAll");}},_onClick$SelectMediumButton:function(){this.listener.onSelectMedium(this);},_onClick$SelectStrongButton:function(){this.listener.onSelectStrong(this);},_adjustButtonsState:function(){var enabled=this.data.datagrid("getData").length!=0;this.selectAllButton.linkbutton(enabled?"enable":"disable");this.selectMediumButton.linkbutton(enabled?"enable":"disable");this.selectStrongButton.linkbutton(enabled?"enable":"disable");}});jscape.domain.SslCiphersDialog.LISTENER={onSelectMedium:$.noop,onSelectStrong:$.noop,onSubmit:$.noop,onCancel:$.noop};jscape.domain.SftpAlgorithmsController=Class.extend({DEFAULT_ALGORITHMS:{kexes:[],keys:[],ciphers:[],macs:[],compressions:[]},deferred:null,start:function(domainName,algorithms){this.serverParams=null;this.fipsMode=false;this.deferred=$.Deferred();$.when(jscape.API.getServerParameters(),jscape.API.getDomainStatistics(domainName)).done($.proxy(function(params,stats){this.serverParams=params;this.fipsMode=stats&&stats.fipsModeEnabled;},this)).done($.proxy(function(){this._setupDialog(algorithms||this.DEFAULT_ALGORITHMS).show(this);},this));return this.deferred.promise();},onLoadData:function(){return $.Deferred().resolve(this.serverParams).promise();},onLoadKeyExchanges:function(){return this.onLoadData().then(function(data){return data.sshKexes;});},onLoadKeys:function(){return this.onLoadData().then(function(data){return data.sshHostKeys;});},onLoadCiphers:function(){return this.onLoadData().then(function(data){return!!this.fipsMode?data.sshFipsCiphers:data.sshCiphers;});},onLoadMacs:function(){return this.onLoadData().then(function(data){return!!this.fipsMode?data.sshFipsMacs:data.sshMacs;});},onLoadCompressions:function(){return this.onLoadData().then(function(data){return data.sshCompressions;});},onSubmit:function(dialog){var algorithms=this._createAlgorithms(dialog);dialog.destroy();this.deferred.resolve(algorithms);this.deferred=null;},onCancel:function(dialog){dialog.destroy();this.deferred.reject();this.deferred=null;},_createAlgorithms:function(dialog){return{kexes:dialog.getKeyExchanges(),keys:dialog.getKeys(),ciphers:dialog.getCiphers(),macs:dialog.getMacs(),compressions:dialog.getCompressions()};},_setupDialog:function(algorithms){var dialog=new jscape.domain.SftpAlgorithmsDialog();dialog.setKeyExchanges(algorithms.kexes);dialog.setKeys(algorithms.keys);dialog.setCiphers(algorithms.ciphers);dialog.setMacs(algorithms.macs);dialog.setCompressions(algorithms.compressions);return dialog;}});jscape.domain.SftpAlgorithmsDialog=jscape.ui.DefaultDialog.extend({initialize:function(){this._super($("#d-services-sftp-algorithms"),{width:"60%",minWidth:770,maxWidth:870,height:"60%",maxHeight:"80%"});this.fieldset=this.dialog.find(".content").layout({fit:true,doSize:false,border:false}).first();this.tabs=this.dialog.find(".content-tabs").tabs({fit:true,tabPosition:"top",justified:true,pill:true,narrow:false,plain:true,border:true});this.kexes=new jscape.domain.SftpAlgorithmPane($("input[name=searchkexes]",this.dialog),$("div[role=listbox][aria-label=kexes]",this.dialog));this.keys=new jscape.domain.SftpAlgorithmPane($("input[name=searchkeys]",this.dialog),$("div[role=listbox][aria-label=keys]",this.dialog));this.ciphers=new jscape.domain.SftpAlgorithmPane($("input[name=searchciphers]",this.dialog),$("div[role=listbox][aria-label=ciphers]",this.dialog));this.macs=new jscape.domain.SftpAlgorithmPane($("input[name=searchmacs]",this.dialog),$("div[role=listbox][aria-label=macs]",this.dialog));this.compressions=new jscape.domain.SftpAlgorithmPane($("input[name=searchcompressions]",this.dialog),$("div[role=listbox][aria-label=compressions]",this.dialog));this.fieldset.layout("panel","center").panel("resize");},show:function(listener){this._super(listener);this.kexes.show({onLoadData:$.proxy(listener.onLoadKeyExchanges,listener)});this.keys.show({onLoadData:$.proxy(listener.onLoadKeys,listener)});this.ciphers.show({onLoadData:$.proxy(listener.onLoadCiphers,listener)});this.macs.show({onLoadData:$.proxy(listener.onLoadMacs,listener)});this.compressions.show({onLoadData:$.proxy(listener.onLoadCompressions,listener)});this.fieldset.layout("resize");},getKeyExchanges:function(){return this.kexes.getValues();},setKeyExchanges:function(values){this.kexes.setValues(values);},getKeys:function(){return this.keys.getValues();},setKeys:function(values){this.keys.setValues(values);},getCiphers:function(){return this.ciphers.getValues();},setCiphers:function(values){this.ciphers.setValues(values);},getMacs:function(){return this.macs.getValues();},setMacs:function(values){this.macs.setValues(values);},getCompressions:function(){return this.compressions.getValues();},setCompressions:function(values){this.compressions.setValues(values);}});jscape.domain.SftpAlgorithmsDialog.LISTENER={onLoadKeyExchanges:$.noop,onLoadKeys:$.noop,onLoadCiphers:$.noop,onLoadMacs:$.noop,onLoadCompressions:$.noop};jscape.domain.SftpAlgorithmPane=jscape.ui.FormView.extend({timer:null,initialize:function(searchInput,datalist){var initializing=true;this.search=$(searchInput).textbox({required:false,icons:[{iconCls:"icon-clear",handler:$.proxy(this._onClear$SearchInput,this)}],inputEvents:$.extend({},$.fn.textbox.defaults.inputEvents,{keyup:$.proxy(this._onKeyUp$SearchInput,this),keydown:$.proxy(this._onKeyDown$SearchInput,this)}),width:"100%"});this.data=$(datalist);this.data.datalist({fit:true,remoteSort:false,singleSelect:false,checkbox:true,selectOnCheck:true,checkOnSelect:true,textFormatter:function(val,row){return String(row||"").escapeXml();},loadFilter:$.proxy(this._onFilter$Data,this),loader:$.proxy(this._onLoad$Data,this),onBeforeLoad:function(){return!initializing;},onLoadSuccess:$.proxy(this._onLoad$Success,this),onSelect:$.proxy(this._onSelect$Row,this),onSelectAll:$.proxy(this._onSelect$All,this),onUnselect:$.proxy(this._onUnselect$Row,this),onUnselectAll:$.proxy(this._onUnselect$All,this),onRowContextMenu:$.proxy(this._onRow$ContextMenu,this)});initializing=false;},show:function(listener){this.listener=listener||jscape.domain.SftpAlgorithmPane.LISTENER;this.data.datalist("reload");this.search.textbox("textbox").triggerHandler("keyup",{target:this.search});},getValues:function(){return this.values||[];},setValues:function(value){this.data.datalist("clearSelections");for(var i=0,len=value?value.length:0;i<len;++i){var val=value[i];var index=this.data.datalist("getRowIndex",val);if(index!=-1){this.data.datalist("selectRow",index);}else{this._onSelect$Row(-1,val);}}},_onSelect$Row:function(_,row){var index=$.inArray(row,this.values);if(index==-1){this.values.push(row);}},_onSelect$All:function(rows){this.values=rows||[];},_onUnselect$Row:function(_,row){var index=$.inArray(row,this.values);if(index!=-1){this.values.splice(index,1);}},_onUnselect$All:function(){this.values=[];},_onClick$InvertSelection:function(){var copy=[].concat(this.values);for(var i=0,rows=this.data.datagrid("getRows");i<rows.length;++i){if($.inArray(rows[i],copy)>=0){this.data.datagrid("unselectRow",i);}else{this.data.datagrid("selectRow",i);}}},_onLoad$Data:function(params,success,error){return this.listener.onLoadData(params).done($.proxy(function(data){if(!data||!data.length){this.search.textbox("disable");}},this)).done(success).fail(error);},_onLoad$Success:function(){for(var i=0,rows=this.data.datalist("getRows");i<this.values.length;++i){var index=$.inArray(this.values[i],rows);this.data.datalist("selectRow",index);}},_onFilter$Data:function(data){var params=this.data.datalist("options").queryParams||{};var text=(params.query||"").toLocaleLowerCase();return!!text?$.grep(data,function(t){return t.toLocaleLowerCase().indexOf(text)>=0?t:null;}):data;},_onSearch$Data:function(query){this.data.datalist("options").queryParams={query:query};this.data.datalist("loading").datalist("loadData",this.data.datalist("getData")).datalist("loaded");},_onKeyDown$SearchInput:function(e){if(e.keyCode==13){$.fn.textbox.defaults.inputEvents.keydown.call(e.target,e);return false;}if(e.keyCode==27){e.preventDefault();$(e.data.target).textbox("getIcon",0).click();return false;}},_onKeyUp$SearchInput:function(e){var t=$(e.data.target);var icon=t.textbox("getIcon",0);var val=t.textbox("getText");icon.css("visibility",!!val?"visible":"hidden");clearTimeout(this.timer);this.timer=setTimeout($.proxy(this._onSearch$Data,this,val),200);},_onClear$SearchInput:function(e){var t=$(e.data.target);t.textbox("clear").textbox("textbox").focus();t.textbox("getIcon",0).css("visibility","hidden");clearTimeout(this.timer);this._onSearch$Data(null);},_onRow$ContextMenu:function(e){e.preventDefault();var grid=(this.data||$(e.target).closest("div.datagrid-view").children(".datagrid-f"));if(grid&&grid.length){grid.datagrid("cancelEdit");this._showContextMenu(e,[],$(e.target).closest(".datagrid-body"));}},_showContextMenu:function(e,entries,parent){var emptyData=this.data.datagrid("getRows").length==0;this._super(e,[{text:"Select all",handler:$.proxy(function(){this.data.datagrid("selectAll");},this),disabled:emptyData},{text:"Select none",handler:$.proxy(function(){this.data.datagrid("unselectAll");},this),disabled:emptyData},{text:"Invert selection",handler:$.proxy(this._onClick$InvertSelection,this),disabled:emptyData}],parent);}});jscape.domain.SftpAlgorithmPane.LISTENER={onLoadData:$.noop};jscape.domain.WebResourcesController=Class.extend({resources:null,deferred:null,start:function(domainName,protocol,resources){this.deferred=$.Deferred();this.domainName=domainName;this.protocol=protocol;this.resources=$.map(resources||[],function(item){return item.clone();});this.defaultResources=$.grep(resources,function(item){return item.isDefault();});this._setupDialog().show(this).refresh();return this.deferred.promise();},onLoadData:function(){return $.Deferred().resolve(this.resources);},onAddLanguage:function(dialog){var deferred=$.Deferred();var addDialog=new jscape.domain.AddLanguageDialog();addDialog.disableLanguages($.map(this.resources,function(entry){return entry.lang;}));addDialog.show({onSubmit:$.proxy(function(d){return deferred.resolve(d.getLanguage(),d.getDisplayName());},this),onCancel:function(d){d.destroy();deferred.reject();}});return deferred.promise().then($.proxy(function(language,displayName){return this._createWebResources(language,displayName);},this)).then($.proxy(function(resources){this.resources.push(resources);dialog.refresh();dialog.selectLanguage(resources.lang);},this));},onResetToDefault:function(dialog){return jscape.API.getServiceWebResources(this.domainName,this.protocol).done($.proxy(function(languages){this.resources=languages;dialog.refresh();},this));},onChangeResource:function(lang,key,value){$.each(this.resources,function(_,item){if(item.lang==lang&&item.properties.hasOwnProperty(key)){item.properties[key]=value;return false;}});},onSubmit:function(dialog){return this.deferred.resolve(this.resources);},onCancel:function(dialog){dialog.destroy();this.deferred.reject();},_createWebResources:function(language,displayName){var properties=this.defaultResources.length?this.defaultResources[0].clone().properties:{};return new jscape.WebResources(language,displayName,properties);},_setupDialog:function(){return new jscape.domain.WebResourcesDialog();}});jscape.domain.WebResourcesDialog=jscape.ui.DefaultDialog.extend({DEFAULT_LANG:"default",initialize:function(){var initializing=true;this._super($("#d-services-webresources"),{width:"75%",height:"80%",minHeight:570});this.search=$("input[name=search]",this.fieldset).textbox({required:false,icons:[{iconCls:"icon-clear",handler:$.proxy(this._onClear$SearchInput,this)}],inputEvents:$.extend({},$.fn.textbox.defaults.inputEvents,{keyup:$.proxy(this._onKeyUp$SearchInput,this),keydown:$.proxy(this._onKeyDown$SearchInput,this)}),width:"100%"});this.keys=$("[role=listbox][aria-label=resourcekeys]",this.fieldset);this.keys.tree({fit:true,formatter:$.proxy(this._formatResourceKey,this),loader:$.proxy(this._onLoad$Resources,this),loadFilter:$.proxy(this._onLoadFilter$Resources,this),onBeforeLoad:function(){return!initializing;},onLoadSuccess:$.proxy(this._onLoadSuccess$Resources,this),onSelect:$.proxy(this._onSelect$ResourceKey,this),onContextMenu:function(e,node){e.preventDefault();$(this).tree("select",node.target);}});this.values=$("table[role=grid][aria-label=resourcevalues]",this.fieldset);this.values.datalist({fit:true,singleSelect:true,remoteSort:false,showGroup:true,groupField:"lang",valueField:"value",groupFormatter:function(val,rows){return"<code>"+(rows.length?rows[0].defaultLang?rows[0].displayName:"{lang} ({displayName})".supplant(rows[0]):val)+"</code>";},columns:[[{field:"value",formatter:function(_,row){return row.value;},editor:{type:"textbox",options:{multiline:true,width:"100%",minHeight:80}},width:"100%"}]],onBeforeSelect:function(){return false;},onLoadSuccess:$.proxy(this._onLoadSuccess$Values,this),onBeginEdit:$.proxy(this._onBegin$EditValue,this),onEndEdit:$.proxy(this._onEnd$EditValue,this),onAfterEdit:$.proxy(this._onAfter$EditValue,this)});this.addButton=$("a[role=button][name=add]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$AddButton,this)});this.resetButton=$("a[role=button][name=reset]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$ResetButton,this)});this._adjustButtonsBarLayout(this.fieldset);initializing=false;},show:function(){this._super.apply(this,arguments);return this;},refresh:function(){this.keysLoaded=false;this.keys.tree("reload");},selectLanguage:function(value){if(!this.keysLoaded){this.selectedLanguage=value;return;}
var opts=this.values.datalist("options");var rows=this.values.datalist("getRows");for(var i=0,len=rows.length;i<len;++i){if(rows[i][opts.groupField]===value){this.values.datalist("highlightRow",i);break;}}},_formatResourceKey:function(node){var modified=false;$.each(node.attributes.resources,function(_,row){if(row.value!==row.originalValue){modified=true;return false;}});return(modified?"*":"")+node.text;},_onLoad$Resources:function(params,success,error){this.listener.onLoadData(params).then($.proxy(function(data){this.values.datalist("loadData",[]);return data;},this)).then(success,error);},_onLoadSuccess$Resources:function(_,data){this.keysLoaded=true;this.currentNode=null;if(data&&data.length){var node=this.keys.tree("find",data[0]);node&&this.keys.tree("select",node.target);}},_onLoadFilter$Resources:function(data){if(!data||!data.length){return data;}
var keys=[];for(var i=0,len=data.length;i<len;++i){$.each(Object.keys(data[i].properties||{}),function(_,key){if($.inArray(key,keys)==-1){keys.push(key);}});}
return $.map(keys,$.proxy(function(key){return{id:key,text:String(key).escapeXml(),iconCls:"icon-none",attributes:{resources:$.map(data,$.proxy(function(item){return{lang:item.lang,displayName:item.displayName,defaultLang:item.isDefault(),value:item.properties[key]||"",originalValue:item.properties[key]};},this))}};},this));},_onSelect$ResourceKey:function(node){for(var i=0,len=this.values.datalist("getRows").length;i<len;++i){this.values.datalist("endEdit",i);}
if(this.currentNode!=node){!!this.currentNode&&this.keys.tree("update",{target:this.currentNode.target});this.currentNode=node;}
this.values.datalist("loadData",node.attributes.resources.sort(function(o1,o2){return o1.lang===o2.lang?0:(!!o1.defaultLang?-1:(!!o2.defaultLang?1:o1.lang<o2.lang?-1:1));}));if(!!this.selectedLanguage){this.selectLanguage(this.selectedLanguage);}},_onLoadSuccess$Values:function(){this._beginEditRows();},_onBegin$EditValue:function(index){var opts=this.values.datalist("options");var ed=this.values.datalist("getEditor",{index:index,field:opts.valueField});if(!!ed&&ed.target){var t=$(ed.target);if(t.hasClass("textbox-f")){t=t.textbox("textbox");}
if(t.length){t.height(t.height()+(t[0].scrollHeight||0)+50);}}},_onEnd$EditValue:function(index,row,changes){var property=!!this.currentNode?this.currentNode.id:null;var language=this.values.datalist("getRows")[index].lang;$.each(changes,$.proxy(function(key,value){row[key]=value;this.listener.onChangeResource(language,property,value);},this));},_onAfter$EditValue:function(){this._onForm$Change();},_beginEditRows:function(){for(var i=0,len=this.values.datalist("getRows").length;i<len;++i){this.values.datalist("beginEdit",i);}},_onKeyDown$SearchInput:function(e){if(e.keyCode==13){$.fn.textbox.defaults.inputEvents.keydown.call(e.target,e);return false;}if(e.keyCode==27){e.preventDefault();$(e.data.target).textbox("getIcon",0).click();return false;}},_onKeyUp$SearchInput:function(e){var t=$(e.data.target);var icon=t.textbox("getIcon",0);var val=t.textbox("getText");icon.css("visibility",!!val?"visible":"hidden");clearTimeout(this.timer);this.timer=setTimeout($.proxy(function(query){this.keys.tree("doFilter",query);},this,val),200);},_onClear$SearchInput:function(e){var t=$(e.data.target);t.textbox("clear").textbox("textbox").focus();t.textbox("getIcon",0).css("visibility","hidden");clearTimeout(this.timer);this.keys.tree("doFilter","");},_onSubmit:function(){this.values.datalist("acceptChanges");return this._super.apply(this,arguments);},_onCancel:function(){this.values.datalist("rejectChanges");return this._super.apply(this,arguments);},_onClick$AddButton:function(){this.values.datalist("acceptChanges");this.addButton.linkbutton("disable");this.listener.onAddLanguage(this).catch($.proxy(function(){this.search.textbox("clear");this.keys.tree("doFilter","");this._beginEditRows();},this)).always($.proxy(function(){this.addButton.linkbutton("enable");},this));},_onClick$ResetButton:function(){this.selectedLanguage=null;this.search.textbox("clear");this.resetButton.linkbutton("disable");this.listener.onResetToDefault(this).always($.proxy(function(){this.resetButton.linkbutton("enable");},this));}});jscape.domain.WebResourcesDialog.LISTENER={onLoadData:$.noop,onAddLanguage:$.noop,onResetToDefault:$.noop,onChangeResource:$.noop,onSubmit:$.noop,onCancel:$.noop};jscape.domain.AddLanguageDialog=jscape.ui.DefaultDialog.extend({initialize:function(){this._super($("#d-services-addwebresource"),{width:530,minHeight:230,resizable:false});this.language=$("select[name=language]",this.dialog).combobox({required:true,editable:false,width:"60%",panelHeight:"auto",panelMaxHeight:"40%"});},getLanguage:function(){return this.language.combobox("getValue");},getDisplayName:function(){return this.language.combobox("getText");},disableLanguages:function(values){if(values.length==0){return;}
var data=this.language.combobox("getData");var valueField=this.language.combobox("options").valueField;$.each(data,function(index,entry){entry.disabled=$.inArray(entry[valueField],values)!=-1;});this.language.combobox("loadData",data);},show:function(listener){this._super(listener);$.each(this.language.combobox("getData"),$.proxy(function(_,entry){if(!entry.disabled){this.language.combobox("select",entry);return false;}},this));}});jscape.domain.UploadFormsController=Class.extend({forms:null,dialog:null,deferred:null,initialize:function(){this.addController=new jscape.domain.AddFormController();this.editController=new jscape.domain.EditFormController();this._initValidators();},start:function(forms,groupNames){this.forms=forms||[];this.groups=groupNames||[];this.deferred=$.Deferred();this.dialog=this._setupDialog(forms);this.dialog.show(this);return this.deferred.promise();},onFormUp:function(form){var index=$.inArray(form,this.forms);if(index>0){this.forms.splice(index-1,2,this.forms[index],this.forms[index-1]);this.dialog.setForms(this.forms);this.dialog.selectItem(form);}},onFormDown:function(form){var index=$.inArray(form,this.forms);if(index!=-1&&index<this.forms.length-1){this.forms.splice(index,2,this.forms[index+1],this.forms[index]);this.dialog.setForms(this.forms);this.dialog.selectItem(form);}},onAddForm:function(){this.addController.start(this.groups).done($.proxy(this._formAdded,this));},onEditForm:function(form){var index=$.inArray(form,this.forms);if(index!=-1){this.editController.start(this.groups,form).done($.proxy(this._formEdited,this,index));}},onDeleteForm:function(forms){this._confirmDelete(forms).done($.proxy(this._formDeleted,this,forms));},onSubmit:function(dialog){dialog.destroy();this.deferred.resolve(this.forms);this.dialog=null;},onCancel:function(dialog){dialog.destroy();this.deferred.reject();this.dialog=null;},_formAdded:function(form){this.forms.push(form);this.dialog.setForms(this.forms);this.dialog.selectItem(form);},_formEdited:function(index,form){this.forms[index]=form;this.dialog.setForms(this.forms);this.dialog.selectItem(form);},_formDeleted:function(forms){var index=-1;while(forms.length){index=$.inArray(forms.pop(),this.forms);this.forms.splice(index,1);}
this.dialog.setForms(this.forms);if(this.forms.length){index=Math.max(0,Math.min(index,this.forms.length-1));this.dialog.selectItem(this.forms[index]);}},_confirmDelete:function(forms){var text=$.map(forms||[],function(form){return form.name;}).join(", ");return jscape.ConfirmDialog.confirm(window.R.string.UPLOAD_FORMS_CONFIRM_DELETE_TITLE,window.R.string.UPLOAD_FORMS_CONFIRM_DELETE_MESSAGE.supplant({0:text}));},_setupDialog:function(forms){var dialog=new jscape.domain.UploadFormsDialog();dialog.setForms(forms);return dialog;},_initValidators:function(){var v=new jscape.Validator();v.rule("uploadform_name",$.proxy(this._uploadFormNameValid,this),window.R.string.UPLOAD_FORMS_ERROR_BAD_NAME);v.rule("uploadform_unique",$.proxy(this._uploadFormUnique,this),window.R.string.UPLOAD_FORMS_ERROR_ALREADY_EXISTS);},_uploadFormNameValid:function(value){return/^[^\s_.]+$/.test(value);},_uploadFormUnique:function(value){return $.grep(this.forms,function(form){return form.name===value;}).length==0;}});jscape.domain.UploadFormsDialog=jscape.ui.DefaultDialog.extend({selection:null,initialize:function(){this._super($("#d-services-uploadforms"),{width:"60%",resizable:false});this.fieldset=$("fieldset[name=uploadformsfields]",this.dialog);this.data=$("table[role=grid][aria-label=uploadforms]",this.fieldset);this.data.datagrid({fit:true,fitColumns:true,singleSelect:true,onSelect:$.proxy(this._adjustRowSelection,this),onUnselect:$.proxy(this._adjustRowSelection,this),onDblClickRow:$.proxy(this._onClick$EditButton,this),onLoadSuccess:$.proxy(this._adjustRowSelection,this),idField:"name",columns:[[{field:"name",title:$("thead th:nth-child(1)",this.data).text(),width:"70%"},{field:"enabled",title:$("thead th:nth-child(2)",this.data).text(),width:"30%"}]]});this.moveUpButton=$("a[role=button][name=moveup]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$MoveUpButton,this)});this.moveDownButton=$("a[role=button][name=movedown]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$MoveDownButton,this)});this.addButton=$("a[role=button][name=add]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$AddButton,this)});this.editButton=$("a[role=button][name=edit]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$EditButton,this)});this.deleteButton=$("a[role=button][name=delete]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$DeleteButton,this)});},setForms:function(values){this.data.datagrid("loading").datagrid("loadData",values).datagrid("loaded");},selectItem:function(value){this.data.datagrid("selectRow",this.data.datagrid("getRowIndex",value));},show:function(listener){this._super(listener||jscape.domain.UploadFormsDialog.LISTENER);this.selection=[];this._adjustButtonsState();},_onClick$MoveUpButton:function(){this.listener.onFormUp(this.selection[0]);},_onClick$MoveDownButton:function(){this.listener.onFormDown(this.selection[0]);},_onClick$AddButton:function(){this.listener.onAddForm();},_onClick$EditButton:function(){this.listener.onEditForm(this.selection[0]);},_onClick$DeleteButton:function(){this.listener.onDeleteForm(this.selection);},_adjustRowSelection:function(){this.selection=this.data.datagrid("getSelections");this._adjustButtonsState();},_adjustButtonsState:function(){var index=this.selection.length==1?this.data.datagrid("getRowIndex",this.selection[0]):-1;var count=this.data.datagrid("getRows").length;this.moveUpButton.linkbutton(index>0&&index<=count-1?"enable":"disable");this.moveDownButton.linkbutton(index>=0&&index<count-1?"enable":"disable");this.editButton.linkbutton(this.selection.length==1?"enable":"disable");this.deleteButton.linkbutton(this.selection.length!=0?"enable":"disable");}});jscape.domain.UploadFormsDialog.LISTENER={onFormUp:$.noop,onFormDown:$.noop,onAddForm:$.noop,onEditForm:$.noop,onDeleteForm:$.noop,onSubmit:$.noop,onCancel:$.noop};jscape.domain.BaseFormController=Class.extend({deferred:null,dialog:null,inputs:null,initialize:function(){this.addController=new jscape.domain.AddFormInputController();this.editController=new jscape.domain.EditFormInputController();},start:function(groups,inputs){this.inputs=inputs||[];this.deferred=$.Deferred();this.dialog=this._setupDialog(groups).show(this);return this.deferred.promise();},onInputUp:function(input){var index=$.inArray(input,this.inputs);if(index>0){this.inputs.splice(index-1,2,this.inputs[index],this.inputs[index-1]);this.dialog.setInputs(this.inputs);this.dialog.selectItem(input);}},onInputDown:function(input){var index=$.inArray(input,this.inputs);if(index!=-1&&index<this.inputs.length-1){this.inputs.splice(index,2,this.inputs[index+1],this.inputs[index]);this.dialog.setInputs(this.inputs);this.dialog.selectItem(input);}},onAddInput:function(){this.addController.start().done($.proxy(function(input){this.inputs.push(input);this.dialog.setInputs(this.inputs);this.dialog.selectItem(input);},this));},onEditInput:function(input){var index=$.inArray(input,this.inputs);if(index!=-1){this.editController.start(input).done($.proxy(function(input){this.inputs[index]=input;this.dialog.setInputs(this.inputs);this.dialog.selectItem(input);},this));}},onDeleteInput:function(inputs){var index=-1;while(inputs.length){index=$.inArray(inputs.pop(),this.inputs);this.inputs.splice(index,1);}
this.dialog.setInputs(this.inputs);},onSubmit:function(dialog){var form=this._createForm(dialog);dialog.destroy();this.deferred.resolve(form);},onCancel:function(dialog){dialog.destroy();this.deferred.reject();},_createForm:function(dialog){throw"Abstract method";},_setupDialog:function(groups){},_initValidators:function(){var v=new jscape.Validator();v.rule("uploadform_input_name",$.proxy(this._uploadFormInputNameValid,this),window.R.string.UPLOAD_FORMS_ERROR_BAD_INPUT_NAME);v.rule("uploadform_input_unique",$.proxy(this._uploadFormInputNotExists,this),window.R.string.UPLOAD_FORMS_ERROR_INPUT_ALREADY_EXISTS);},_uploadFormInputNameValid:function(value){return/^[^\s_.]+$/gi.test(value);},_uploadFormInputNotExists:function(value){return $.grep(this.inputs,function(input){return input.name==value;}).length==0;}});jscape.domain.AddFormController=jscape.domain.BaseFormController.extend({start:function(groups){this._initValidators();return this._super(groups,[]);},_createForm:function(dialog){return new jscape.UploadForm(dialog.getName(),dialog.getDescription(),dialog.isEnabled(),dialog.isBatch(),dialog.getGroup(),dialog.getInputs());},_setupDialog:function(groups){var dialog=new jscape.domain.AddFormDialog();dialog.setGroups(groups);dialog.setBatch(true);dialog.setEnabled(true);return dialog;}});jscape.domain.EditFormController=jscape.domain.BaseFormController.extend({start:function(groups,form){this.form=form;this._initValidators();return this._super(groups,form.inputs);},_createForm:function(dialog){return new jscape.UploadForm(this.form.name,dialog.getDescription(),dialog.isEnabled(),dialog.isBatch(),dialog.getGroup(),dialog.getInputs());},_setupDialog:function(groups){var dialog=new jscape.domain.EditFormDialog();dialog.setFormName(this.form.name);dialog.setDescription(this.form.description);dialog.setEnabled(this.form.enabled);dialog.setBatch(this.form.batch);dialog.setGroups(groups);dialog.setGroup(this.form.group);dialog.setInputs(this.form.inputs);return dialog;}});jscape.domain.BaseFormDialog=jscape.ui.DefaultDialog.extend({selection:null,initialize:function(dialog){this._super(dialog,{width:"60%"});this.fieldset=$("fieldset[name=uploadformfields]",this.dialog);this.description=$("input[name=description]",this.fieldset).textbox({width:"70%"});this.prompt=$("input[name=prompt]:radio",this.fieldset);this.groupEnabled=$("input[name=grouprequired]:checkbox",this.fieldset);this.groupEnabled.change($.proxy(function(){var enabled=this.groupEnabled.is(":checked");this.group.combobox(enabled?"enable":"disable").combobox(enabled?"enableValidation":"disableValidation");},this));this.group=$("select[name=group]",this.fieldset);this.group.combobox({required:true,editable:false,disabled:true,width:150,panelHeight:"auto",onLoadSuccess:$.proxy(function(data){if(data.length){this.group.combobox("select",data[0].value);}else{this.groupEnabled.prop("disabled",true).prop("checked",false).change();}},this)});this.enabled=$("input[name=enabled]:checkbox",this.fieldset);this.inputs=$("table[role=grid][aria-label=inputs]",this.fieldset);this.inputs.datagrid({fit:true,fitColumns:true,remoteSort:false,ctrlSelect:true,onSelect:$.proxy(this._adjustRowSelection,this),onUnselect:$.proxy(this._adjustRowSelection,this),onDblClickRow:$.proxy(this._onClick$EditButton,this),onLoadSuccess:$.proxy(this._adjustRowSelection,this),columns:[[{field:"name",title:$("thead th:nth-child(1)",this.inputs).text(),width:100},{field:"type",title:$("thead th:nth-child(2)",this.inputs).text(),width:80},{field:"value",title:$("thead th:nth-child(3)",this.inputs).text(),width:150},{field:"required",title:$("thead th:nth-child(4)",this.inputs).text(),width:60}]]});this.moveUpButton=$("a[role=button][name=moveup]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$MoveUpButton,this)});this.moveDownButton=$("a[role=button][name=movedown]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$MoveDownButton,this)});this.addButton=$("a[role=button][name=add]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$AddButton,this)});this.editButton=$("a[role=button][name=edit]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$EditButton,this)});this.deleteButton=$("a[role=button][name=delete]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$DeleteButton,this)});},getDescription:function(){return this.description.textbox("getValue");},setDescription:function(value){this.description.textbox("setValue",value);},isBatch:function(){return this.prompt.filter("[value=batch]").is(":checked");},setBatch:function(value){this.prompt.filter(!!value?"[value=batch]":"[value=file]").prop("checked",true);},getGroup:function(){return this.groupEnabled.is(":checked")?this.group.combobox("getValue"):null;},setGroup:function(value){this.groupEnabled.prop("checked",value!=null).change();if(value!=null){this.group.combobox("setValue",value);}},setGroups:function(values){this.group.combobox("loadData",values);},isEnabled:function(){return this.enabled.is(":checked");},setEnabled:function(value){this.enabled.prop("checked",!!value);},getInputs:function(){return this.inputs.datagrid("getRows");},setInputs:function(values){this.inputs.datagrid("loading").datagrid("loadData",values).datagrid("loaded");},selectItem:function(input){this.inputs.datagrid("selectRow",this.inputs.datagrid("getRowIndex",input));},show:function(listener){this._super(listener||jscape.domain.BaseFormDialog.LISTENER);this.selection=[];this._adjustButtonsState();return this;},_onClick$MoveUpButton:function(){this.listener.onInputUp(this.selection[0]);},_onClick$MoveDownButton:function(){this.listener.onInputDown(this.selection[0]);},_onClick$AddButton:function(){this.listener.onAddInput();},_onClick$EditButton:function(){this.listener.onEditInput(this.selection[0]);},_onClick$DeleteButton:function(){this.listener.onDeleteInput(this.selection);},_adjustRowSelection:function(){this.selection=this.inputs.datagrid("getSelections");this._adjustButtonsState();},_adjustButtonsState:function(){var index=this.selection.length==1?this.inputs.datagrid("getRowIndex",this.selection[0]):-1;var count=this.inputs.datagrid("getRows").length;this.moveUpButton.linkbutton(index>0&&index<=count-1?"enable":"disable");this.moveDownButton.linkbutton(index>=0&&index<count-1?"enable":"disable");this.editButton.linkbutton(this.selection.length==1?"enable":"disable");this.deleteButton.linkbutton(this.selection.length!=0?"enable":"disable");}});jscape.domain.BaseFormDialog.LISTENER={onInputUp:$.noop,onInputDown:$.noop,onAddInput:$.noop,onEditInput:$.noop,onDeleteInput:$.noop};jscape.domain.AddFormDialog=jscape.domain.BaseFormDialog.extend({initialize:function(){this._super($("#d-uploadforms-add"));this.name=$("input[name=name]",this.fieldset).textbox({required:true,validType:["uploadform_name","uploadform_unique"],missingMessage:window.R.string.UPLOAD_FORMS_ERROR_BAD_NAME,width:"70%"});},getName:function(){return this.name.textbox("getValue");}});jscape.domain.EditFormDialog=jscape.domain.BaseFormDialog.extend({initialize:function(){this._super($("#d-uploadforms-edit"));this.title=this.dialog.dialog("header").text()||"";},setFormName:function(value){this.dialog.dialog("setTitle",this.title.supplant({0:value}));}});jscape.domain.BaseFormInputController=Class.extend({deferred:null,start:function(){this.deferred=$.Deferred();this._setupDialog().show(this);return this.deferred.promise();},onSubmit:function(dialog){var input=this._createFormInput(dialog);dialog.destroy();this.deferred.resolve(input);this.deferred=null;},onCancel:function(dialog){dialog.destroy();this.deferred.reject();this.deferred=null;},_createFormInput:function(dialog){throw"Abstract method";},_setupDialog:function(){}});jscape.domain.AddFormInputController=jscape.domain.BaseFormInputController.extend({_createFormInput:function(dialog){return new jscape.UploadForm.Input(dialog.getType(),dialog.getName(),dialog.getLabel(),dialog.getValue(),dialog.isRequired());},_setupDialog:function(){var dialog=new jscape.domain.AddFormInputDialog();dialog.setType(jscape.UploadForm.Input.TYPE.TEXT);dialog.setRequired(true);return dialog;}});jscape.domain.EditFormInputController=jscape.domain.BaseFormInputController.extend({start:function(input){this.input=input;return this._super();},_createFormInput:function(dialog){return new jscape.UploadForm.Input(dialog.getType(),this.input.name,dialog.getLabel(),dialog.getValue(),dialog.isRequired());},_setupDialog:function(){var dialog=new jscape.domain.EditFormInputDialog();dialog.setName(this.input.name);dialog.setLabel(this.input.label);dialog.setType(this.input.type);dialog.setValue(this.input.value);dialog.setRequired(this.input.required);return dialog;}});jscape.domain.BaseFormInputDialog=jscape.ui.DefaultDialog.extend({initialize:function(dialog){this._super(dialog,{width:"50%"});this.fieldset=$("fieldset[name=uploadforminputfields]",this.dialog);this.label=$("input[name=label]",this.fieldset).textbox({width:"60%"});this.type=$("select[name=type]",this.fieldset).combobox({required:true,editable:false,width:210,panelHeight:"auto"});this.value=$("input[name=value]",this.fieldset).textbox({width:"60%"});this.required=$("input[name=required]:checkbox",this.fieldset);},getLabel:function(){return this.label.textbox("getValue");},setLabel:function(value){this.label.textbox("setValue",value);},getType:function(){return this.type.combobox("getValue");},setType:function(value){this.type.combobox("setValue",value);},getValue:function(){return this.value.textbox("getValue");},setValue:function(value){this.value.textbox("setValue",value);},isRequired:function(){return this.required.is(":checked");},setRequired:function(value){this.required.prop("checked",!!value);},show:function(listener){this._super(listener);return this;}});jscape.domain.AddFormInputDialog=jscape.domain.BaseFormInputDialog.extend({initialize:function(){this._super($("#d-uploadforms-addfield"));this.name=$("input[name=name]",this.fieldset).textbox({required:true,validType:["uploadform_input_name","uploadform_input_unique"],missingMessage:window.R.string.UPLOAD_FORMS_ERROR_BAD_INPUT_NAME,width:"60%"});},getName:function(){return this.name.textbox("getValue");}});jscape.domain.EditFormInputDialog=jscape.domain.BaseFormInputDialog.extend({initialize:function(){this._super($("#d-uploadforms-editfield"));this.title=this.dialog.dialog("header").text()||"";},setName:function(value){this.dialog.dialog("setTitle",this.title.supplant({0:value}));}});