/* Copyright Â© 2009-2024. Redwood Software Inc. All rights reserved. */
jscape.domain=jscape.domain||{};jscape.domain.ServicesModule=jscape.domain.DomainModule.extend({initialize:function(themeUriPattern,currentTheme){this.themeLoader=new jscape.themes.WebThemeLoader(themeUriPattern,currentTheme);},onCreate:function(domainName,app){this._super.apply(this,arguments);var submodules=[];this.servicesController=new jscape.domain.DomainServicesController();submodules.push(app.register("domain-service-list",new jscape.domain.DomainSubmodule(this.servicesController)));submodules.push(app.register("domain-service-ftp",new jscape.domain.DomainSubmodule(new jscape.domain.FtpConfigurationController())));submodules.push(app.register("domain-service-sftp",new jscape.domain.DomainSubmodule(new jscape.domain.SftpConfigurationController())));submodules.push(app.register("domain-service-aftp",new jscape.domain.DomainSubmodule(new jscape.domain.AftpConfigurationController())));submodules.push(app.register("domain-service-oftp",new jscape.domain.DomainSubmodule(new jscape.domain.OftpConfigurationController())));submodules.push(app.register("domain-service-tftp",new jscape.domain.DomainSubmodule(new jscape.domain.TftpConfigurationController())));submodules.push(app.register("domain-service-http",new jscape.domain.DomainSubmodule(new jscape.domain.HttpConfigurationController(this.themeLoader))));$.each(submodules,function(){this.onCreate(domainName,app);});},onStart:function(){this.servicesController.start(this.domainName);},onPause:function(){if(this.servicesController.hasChanged()){this._confirmAndApply(this.servicesController);}}});jscape.domain.DomainServicesController=jscape.ui.DatagridController.extend({view:null,initialize:function(){this.addController=new jscape.domain.AddServiceController();this.editController=new jscape.domain.EditServiceController();this.deleteController=new jscape.domain.DeleteServiceController();},start:function(domainName){this.domainName=domainName;if(this.view==null){this.view=new jscape.domain.DomainServicesView();}
this.view.show(this);},resume:function(){this.view.refresh();},hasChanged:function(){return false;},onLoadData:function(){return jscape.API.getDomainServiceSummaries(this.domainName);},onAddService:function(){return this.addController.start(this.domainName).done($.proxy(this._serviceAdded,this));},onEditService:function(service){return this.editController.start(this.domainName,service.protocol,service.id).done($.proxy(this._serviceEdited,this));},onDeleteService:function(services){return this.deleteController.start(this.domainName,services).done($.proxy(this._serviceDeleted,this,services));},_serviceAdded:function(service){this._recordAdded(service);},_serviceEdited:function(service){this._recordEdited(service);},_serviceDeleted:function(services){this._recordDeleted(services);}});jscape.domain.DomainServicesView=jscape.ui.DatagridView.extend({selection:null,initialize:function(){var initializing=true;this.fieldset=$("#domain-services-fields").layout({fit:true,doSize:false,border:false});this.data=$("table[role=grid][aria-label=services]",this.fieldset);this.data.datagrid({fit:true,fitColumns:true,remoteSort:false,singleSelect:true,idField:"id",sortName:"protocol",columns:[[{field:"protocol",title:$("thead th:nth-child(1)",this.data).text(),sortable:true,width:"12%",formatter:$.proxy(function(_,row){return this._formatProtocol(row);},this)},{field:"host",title:$("thead th:nth-child(2)",this.data).text(),sortable:false,width:"17%",formatter:$.proxy(function(_,row){return this._formatHost(row);},this)},{field:"port",title:$("thead th:nth-child(3)",this.data).text(),sortable:false,width:"7%",align:"right",formatter:$.proxy(function(_,row){return this._formatPort(row);},this)},{field:"keyAlias",title:$("thead th:nth-child(4)",this.data).text(),sortable:false,width:"15%"},{field:"details",title:$("thead th:nth-child(5)",this.data).text(),sortable:false,width:"35%",formatter:$.proxy(function(_,row){return this._formatDetails(row);},this)},{field:"status",title:$("thead th:nth-child(6)",this.data).text(),sortable:false,width:"14%",align:"left",formatter:$.proxy(function(_,row){return this._formatStatus(row);},this),styler:$.proxy(function(_,row){return this._styleStatus(row);},this)}]],onSelect:$.proxy(this._adjustButtonsState,this),onUnselect:$.proxy(this._adjustButtonsState,this),onUnselectAll:$.proxy(this._adjustButtonsState,this),onDblClickRow:$.proxy(function(){this.editButton.click();},this),onRowContextMenu:$.proxy(this._onRow$ContextMenu,this),loader:$.proxy(this._onLoad$Data,this),onBeforeLoad:function(){return!initializing;},onLoadSuccess:$.proxy(this._adjustButtonsState,this)});this.addButton=$("a[role=button][name=add]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$AddButton,this)});this.editButton=$("a[role=button][name=edit]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$EditButton,this)});this.deleteButton=$("a[role=button][name=delete]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$DeleteButton,this)});this.fieldset.layout("panel","south").panel("resize",{height:"auto"});initializing=false;},show:function(listener){this.listener=listener||jscape.domain.DomainServicesView.LISTENER;this.fieldset.layout("resize");this._adjustButtonsState();},_formatProtocol:function(service){return window.R.string[("APPLICATION_PROTOCOL_"+service.protocol).toUpperCase()]+(service.type?" "+service.type:"");},_formatHost:function(service){switch(service.protocol){case jscape.TransportService.Protocol.HTTP:case jscape.TransportService.Protocol.WEBDAV:case jscape.TransportService.Protocol.AS2:var disabledString=window.R.string.SERVICES_TEMPLATE_DISABLED;return window.R.string.SERVICES_TEMPLATE_HTTP_DETAILS.supplant({0:service.plainAddress?this._hostOf(service.plainAddress):disabledString,1:service.secureAddress?this._hostOf(service.secureAddress):disabledString});case jscape.TransportService.Protocol.AGENT:return this._hostOf(service.address);default:return this._hostOf(service.plainAddress)||this._hostOf(service.secureAddress);}},_formatPort:function(service){switch(service.protocol){case jscape.TransportService.Protocol.HTTP:case jscape.TransportService.Protocol.WEBDAV:case jscape.TransportService.Protocol.AS2:var disabledString=window.R.string.SERVICES_TEMPLATE_DISABLED;return window.R.string.SERVICES_TEMPLATE_HTTP_DETAILS.supplant({0:service.plainAddress?this._portOf(service.plainAddress):disabledString,1:service.secureAddress?this._portOf(service.secureAddress):disabledString});case jscape.TransportService.Protocol.AGENT:return this._portOf(service.address);default:return this._portOf(service.plainAddress)||this._hostOf(service.secureAddress);}},_formatDetails:function(service){switch(service.protocol){case jscape.TransportService.Protocol.FTP:return service.serviceType||"";case jscape.TransportService.Protocol.SFTP:return window.R.string.SERVICES_TEMPLATE_SFTP_DETAILS.supplant({0:service.authenticationType});case jscape.TransportService.Protocol.OFTP:return window.R.string.SERVICES_TEMPLATE_OFTP_DETAILS.supplant({0:service.identificationCode});case jscape.TransportService.Protocol.TFTP:return window.R.string.SERVICES_TEMPLATE_TFTP_DETAILS.supplant({0:service.username});default:return"";}},_formatStatus:function(service){switch(service.status){case jscape.TransportServiceSummary.Status.STARTED:return window.R.string.SERVICES_STATE_STARTED;case jscape.TransportServiceSummary.Status.STOPPED:return window.R.string.SERVICES_STATE_STOPPED;case jscape.TransportServiceSummary.Status.ERROR:return service.isBindingError()?window.R.string.SERVICES_ERROR_BAD_ADDRESS||service.errorMessage:window.R.string.SERVICES_STATE_ERROR.supplant({0:String(service.errorMessage||"").escapeXml()});default:return"";}},_styleStatus:function(service){switch(service.status){case jscape.TransportServiceSummary.Status.STARTED:return"color:green;font-weight:normal";case jscape.TransportServiceSummary.Status.ERROR:return"color:red;font-weight:bold";default:return"color:black;font-weight:normal";}},_hostOf:function(address){return address?(""+address.host).escapeXml():"";},_portOf:function(address){return address?(""+address.port).escapeXml():"";},_onLoad$Data:function(params,success,error){this.listener.onLoadData(params).then(success,error);},_onClick$AddButton:function(){this.listener.onAddService();},_onClick$EditButton:function(){this.listener.onEditService(this.selection[0]);},_onClick$DeleteButton:function(){this.deleteButton.linkbutton("disable");this.listener.onDeleteService(this.selection).always($.proxy(this._adjustButtonsState,this));},_showContextMenu:function(e){this._super(e,[this.addButton,this.editButton,this.deleteButton]);},_adjustButtonsState:function(){this.selection=this.data.datagrid("getSelections");this.editButton.linkbutton(this.selection.length==1?"enable":"disable");this.deleteButton.linkbutton(this.selection.length!=0?"enable":"disable");}});jscape.domain.DomainServicesView.LISTENER={onLoadData:$.noop,onAddService:$.noop,onDeleteService:$.noop};jscape.domain.AddServiceController=Class.extend({deferred:null,initialize:function(){this.controllerMap={AFTP:jscape.domain.AftpServiceController,AGENT:jscape.domain.AgentServiceController,AS2:jscape.domain.As2ServiceController,FTP:jscape.domain.FtpServiceController,HTTP:jscape.domain.HttpServiceController,OFTP:jscape.domain.OftpServiceController,SFTP:jscape.domain.SftpServiceController,TFTP:jscape.domain.TftpServiceController,WEBDAV:jscape.domain.WebDavServiceController};},start:function(domainName){this.domainName=domainName;this.deferred=$.Deferred();this._selectProtocol().then($.proxy(function(protocol){var theClass=this.controllerMap[protocol.toUpperCase()];var controller=new theClass();return controller.start(this,this.domainName);},this)).done($.proxy(function(descriptor){this.deferred.resolve(descriptor);this.deferred=null;},this)).fail($.proxy(function(){this.deferred.reject();this.deferred=null;},this));return this.deferred.promise();},onChange:function(descriptor){return jscape.API.addService(this.domainName,descriptor).then(function(){return descriptor;});},_selectProtocol:function(){var deferred=$.Deferred();new jscape.domain.AddServiceProtocolDialog().show({onSubmit:function(d){return deferred.resolve(d.getProtocol());},onCancel:function(d){d.destroy();deferred.reject();deferred=null;}});return deferred.promise();}});jscape.domain.AddServiceProtocolDialog=jscape.ui.DefaultDialog.extend({initialize:function(){this._super($("#d-service-add-protocol"),{minWidth:450,width:"30%",maxWidth:550,minHeight:230,resizable:false});this.protocol=$("select[name=protocol]",this.dialog);this.protocol.combobox({required:true,editable:false,formatter:$.proxy(this._formatProtocol,this),onLoadSuccess:$.proxy(this._onLoad$Success,this),width:150,panelHeight:"auto",panelMaxHeight:"40%"});},getProtocol:function(){return this.protocol.combobox("getValue");},show:function(listener){this._super(listener);this.protocol.combobox("textbox").focus();this._onForm$Change();},_formatProtocol:function(row){var text=row[this.protocol.combobox("options").textField];return!!row.disabled&&row.title?'<span aria-label="{tip}">{text}</span>'.supplant({tip:(row.title||"").escapeXml(),text:text}):text;},_onLoad$Success:function(){this._createTooltips(this.protocol.combobox("panel").find(".combobox-item"),function(el){return $(el).find("span[aria-label]").attr("aria-label")||"";});}});jscape.domain.EditServiceController=Class.extend({initialize:function(){this.controllerMap={AFTP:jscape.domain.AftpServiceController,AGENT:jscape.domain.AgentServiceController,AS2:jscape.domain.As2ServiceController,FTP:jscape.domain.FtpServiceController,HTTP:jscape.domain.HttpServiceController,OFTP:jscape.domain.OftpServiceController,SFTP:jscape.domain.SftpServiceController,TFTP:jscape.domain.TftpServiceController,WEBDAV:jscape.domain.WebDavServiceController};},start:function(domainName,protocol,id){this.domainName=domainName;this.protocol=protocol;this.id=id;this.deferred=$.Deferred();jscape.API.getServiceDescriptor(domainName,protocol,id).then($.proxy(function(descriptor){var theClass=this.controllerMap[this.protocol.toUpperCase()];var controller=new theClass();return controller.start(this,this.domainName,descriptor);},this)).done($.proxy(function(descriptor){this.deferred.resolve(descriptor);this.deferred=null;},this)).fail($.proxy(function(){this.deferred.reject();this.deferred=null;},this));return this.deferred.promise();},onChange:function(descriptor){return jscape.API.updateService(this.domainName,this.protocol,this.id,descriptor).then(function(){return descriptor;});}});jscape.domain.DeleteServiceController=Class.extend({deferred:null,start:function(domainName,services){this.domainName=domainName;this.deferred=$.Deferred();this._confirmDelete(services).done($.proxy(this._deleteConfirmed,this,services)).fail(this.deferred.reject,this.deferred);return this.deferred.promise();},_deleteConfirmed:function(services){$.when.apply(jQuery,$.map(services,$.proxy(function(service){return jscape.API.deleteService(this.domainName,service.protocol,service.id);},this))).done($.proxy(function(){this.deferred.resolve(services);this.deferred=null;},this)).fail($.proxy(function(){this.deferred.reject();this.deferred=null;},this));},_confirmDelete:function(services){var promise=jscape.ConfirmDialog.confirm(window.R.string.SERVICES_CONFIRM_DELETE_TITLE,window.R.string.SERVICES_CONFIRM_DELETE_MESSAGE);var w=$("body").children("div.messager-window");w&&w.length&&w.find(".messager-icon").removeClass("messager-question").addClass("messager-warning");return promise;}});jscape.domain.BaseServiceController=Class.extend({start:function(listener,domainName,descriptor){this.listener=listener;this.domainName=domainName;this.deferred=$.Deferred();this._setupDialog(descriptor).show(this);return this.deferred;},onSubmit:function(dialog){return this.listener.onChange(this._createDescriptor(dialog)).done($.proxy(function(descriptor){this.deferred.resolve(descriptor);this.deferred=null;},this));},onCancel:function(dialog){dialog.destroy();this.deferred.reject();this.deferred=null;},onLoadServerKeys:function(){return jscape.API.getServerKeys(this.domainName);},onLoadServerAddresses:function(){return jscape.API.getServerAddresses().then($.proxy(function(values){return $.map(values,$.proxy(function(value){return{text:this._formatHostname(value),value:value};},this));},this));},_formatHostname:function(value){return jscape.ServerParameters.allHostsIpv4(value)?window.R.string.APPLICATION_HOST_ALL_IPV4:jscape.ServerParameters.allHostsIpv6(value)?window.R.string.APPLICATION_HOST_ALL_IPV6:value;}});jscape.domain.FtpServiceController=jscape.domain.BaseServiceController.extend({DEFAULTS:{"regular":{port:21,keyUsed:false},"explicit SSL":{port:21,keyUsed:true},"forced explicit SSL":{port:21,keyUsed:true},"implicit SSL":{port:990,keyUsed:true}},onChangeType:function(dialog){var type=dialog.getType();if(this.DEFAULTS.hasOwnProperty(type)){dialog.setPort(this.DEFAULTS[type].port);dialog.setKeyUsed(this.DEFAULTS[type].keyUsed);}},_createDescriptor:function(dialog){return jscape.TransportService.ftp(dialog.getHost(),dialog.getPort(),dialog.getType(),dialog.getKeyAlias());},_setupDialog:function(descriptor){var dialog=new jscape.domain.FtpServiceDialog();if(descriptor){dialog.setTitle(window.R.string.SERVICES_EDIT_TITLE.supplant({0:descriptor.type==jscape.TransportService.FTP_TYPE.IMPLICIT_SSL?window.R.string.APPLICATION_PROTOCOL_IMPLICIT_FTPS:descriptor.type==jscape.TransportService.FTP_TYPE.EXPLICIT_SSL||descriptor.type==jscape.TransportService.FTP_TYPE.FORCED_EXPLICIT_SSL?window.R.string.APPLICATION_PROTOCOL_EXPLICIT_FTPS:window.R.string.APPLICATION_PROTOCOL_FTP}));dialog.setType(descriptor.type);dialog.setHost(descriptor.host);dialog.setPort(descriptor.port);dialog.setKeyAlias(descriptor.keyAlias);}else{dialog.setType(jscape.TransportService.FTP_TYPE.EXPLICIT_SSL);this.onChangeType(dialog);}
return dialog;}});jscape.domain.FtpServiceDialog=jscape.ui.DefaultDialog.extend({initialize:function(){var initializing=true;this._super($("#d-services-ftp"),{width:"50%",minWidth:500,maxWidth:750});this.fieldset=$("fieldset[name=ftpservicefields]",this.dialog);this.host=$("select[name=host]",this.fieldset).combobox({required:true,onBeforeLoad:function(){return!initializing;},loader:$.proxy(this._onLoad$Hosts,this),width:"60%",panelMinHeight:80,panelHeight:"auto",panelMaxHeight:"50%",validType:"length[1,500]",missingMessage:window.R.string.SERVICES_ERROR_BAD_HOST,invalidMessage:window.R.string.SERVICES_ERROR_BAD_HOST});this.port=$("input[name=port]",this.fieldset).numberspinner({required:true,min:1,max:65535,width:80});this.type=$("select[name=type]",this.fieldset).combobox({required:true,editable:false,onChange:$.proxy(this._onChange$Type,this),width:170,panelHeight:"auto"});this.keyAlias=$("select[name=privatekey]",this.fieldset).combobox({required:true,editable:false,onBeforeLoad:function(){return!initializing;},loader:$.proxy(this._onLoad$Keys,this),textField:"name",valueField:"name",width:"60%",panelMinHeight:80,panelHeight:"auto",panelMaxHeight:"50%"});initializing=false;},getHost:function(){return this.host.combobox("getValue");},setHost:function(value){this.host.combobox("setValue",value);},getPort:function(){return parseInt(this.port.numberspinner("getValue"));},setPort:function(value){this.port.numberspinner("setValue",parseInt(value)).numberspinner("isValid");},getType:function(){return this.type.combobox("getValue");},setType:function(value){var select=this.type.combobox("getValue");this.type.combobox("setValue",value);if(select===value){this._onChange$Type();}},getKeyAlias:function(){return!this.keyAlias.combobox("options").disabled?this.keyAlias.combobox("getValue"):null;},setKeyAlias:function(value){this.keyAlias.combobox("setValue",value);this.setKeyUsed(value!=null);},setKeyUsed:function(value){this.keyAlias.combobox(!!value?"enable":"disable").combobox(!!value?"enableValidation":"disableValidation");},show:function(listener){this._super(listener||jscape.domain.FtpServiceDialog.LISTENER);this.host.combobox("reload");this.keyAlias.combobox("reload");},_onChange$Type:function(){this.listener&&this.listener.onChangeType(this);},_onLoad$Hosts:function(params,success,error){this.listener.onLoadServerAddresses(params).then(success,error);},_onLoad$Keys:function(params,success,error){this.listener.onLoadServerKeys(params).then(success,error);}});jscape.domain.FtpServiceDialog.LISTENER={onChangeType:$.noop,onLoadServerAddresses:$.noop,onLoadServerKeys:$.noop,onSubmit:$.noop,onCancel:$.noop};jscape.domain.SftpServiceController=jscape.domain.BaseServiceController.extend({DEFAULT_PORT:22,_createDescriptor:function(dialog){return jscape.TransportService.sftp(dialog.getHost(),dialog.getPort(),dialog.getAuthentication(),dialog.getKeyAlias());},_setupDialog:function(descriptor){var dialog=new jscape.domain.SftpServiceDialog();if(descriptor){dialog.setTitle(window.R.string.SERVICES_EDIT_TITLE.supplant({0:window.R.string.APPLICATION_PROTOCOL_SFTP}));dialog.setHost(descriptor.host);dialog.setPort(descriptor.port);dialog.setAuthentication(descriptor.authenticationType);dialog.setKeyAlias(descriptor.keyAlias);}else{dialog.setPort(this.DEFAULT_PORT);}
return dialog;}});jscape.domain.SftpServiceDialog=jscape.ui.DefaultDialog.extend({initialize:function(){var initializing=true;this._super($("#d-services-sftp"),{width:"50%",minWidth:500,maxWidth:750});this.fieldset=$("fieldset[name=sftpservicefields]",this.dialog);this.host=$("select[name=host]",this.fieldset).combobox({required:true,onBeforeLoad:function(){return!initializing;},loader:$.proxy(this._onLoad$Hosts,this),width:"60%",panelMaxWidth:"auto",panelHeight:"auto",panelMinHeight:80,panelMaxHeight:"40%",validType:"length[1,500]",missingMessage:window.R.string.SERVICES_ERROR_BAD_HOST,invalidMessage:window.R.string.SERVICES_ERROR_BAD_HOST});this.port=$("input[name=port]",this.fieldset).numberspinner({required:true,min:1,max:65535,width:80});this.keyAlias=$("select[name=privatekey]",this.fieldset).combobox({required:true,editable:false,onBeforeLoad:function(){return!initializing;},loader:$.proxy(this._onLoad$Keys,this),textField:"name",valueField:"name",width:"60%",panelHeight:"auto",panelMinHeight:80,panelMaxHeight:"40%"});this.auth=$("select[name=auth]",this.fieldset).combobox({required:true,editable:false,width:"30%",panelHeight:"auto"});initializing=false;},getHost:function(){return this.host.combobox("getValue");},setHost:function(value){this.host.combobox("setValue",value);},setHosts:function(values){this.host.combobox("loadData",$.map(values,$.proxy(function(value){return{text:this._formatHostname(value),value:value};},this)));},getPort:function(){return parseInt(this.port.numberspinner("getValue"));},setPort:function(value){this.port.numberspinner("setValue",parseInt(value)).numberspinner("validate");},getAuthentication:function(){return this.auth.combobox("getValue");},setAuthentication:function(value){this.auth.combobox("select",value);},getKeyAlias:function(){return!this.keyAlias.combobox("options").disabled?this.keyAlias.combobox("getValue"):null;},setKeyAlias:function(value){this.keyAlias.combobox("setValue",value);},show:function(listener){this._super(listener);this.host.combobox("reload");this.keyAlias.combobox("reload");},_formatHostname:function(value){return jscape.ServerParameters.allHostsIpv4(value)?window.R.string.APPLICATION_HOST_ALL_IPV4:jscape.ServerParameters.allHostsIpv6(value)?window.R.string.APPLICATION_HOST_ALL_IPV6:value;},_onLoad$Hosts:function(params,success,error){this.listener.onLoadServerAddresses(params).then(success,error);},_onLoad$Keys:function(params,success,error){this.listener.onLoadServerKeys(params).then(success,error);}});jscape.domain.AftpServiceController=jscape.domain.BaseServiceController.extend({DEFAULT_PORT:3000,_createDescriptor:function(dialog){return jscape.TransportService.aftp(dialog.getHost(),dialog.getPort(),dialog.getKeyAlias(),dialog.isProtectionRequired());},_setupDialog:function(descriptor){var dialog=new jscape.domain.AftpServiceDialog();if(descriptor){dialog.setTitle(window.R.string.SERVICES_EDIT_TITLE.supplant({0:window.R.string.APPLICATION_PROTOCOL_AFTP}));dialog.setHost(descriptor.host);dialog.setPort(descriptor.port);dialog.setKeyAlias(descriptor.keyAlias);dialog.setProtectionRequired(descriptor.protectionRequired);}else{dialog.setPort(this.DEFAULT_PORT);dialog.setProtectionRequired(true);}
return dialog;}});jscape.domain.AftpServiceDialog=jscape.ui.DefaultDialog.extend({initialize:function(){var initializing=true;this._super($("#d-services-aftp"),{width:"50%",minWidth:500,maxWidth:750});this.fieldset=$("fieldset[name=aftpservicefields]",this.dialog);this.host=$("select[name=host]",this.fieldset).combobox({required:true,editable:true,limitToList:true,loader:$.proxy(this._onLoad$Hosts,this),onBeforeLoad:function(){return!initializing;},width:"60%",panelMinHeight:50,panelHeight:"auto",panelMaxHeight:"50%",validType:"length[1,500]",missingMessage:window.R.string.SERVICES_ERROR_BAD_HOST,invalidMessage:window.R.string.SERVICES_ERROR_BAD_HOST});this.port=$("input[name=port]",this.fieldset).numberspinner({required:true,min:1,max:65535,width:80});this.keyAlias=$("select[name=privatekey]",this.fieldset).combobox({required:true,editable:false,onBeforeLoad:function(){return!initializing;},loader:$.proxy(this._onLoad$Keys,this),textField:"name",valueField:"name",width:"60%",panelMinHeight:80,panelHeight:"auto",panelMaxHeight:"50%"});this.protectionRequired=$("input[name=requiresecure]:checkbox",this.fieldset);initializing=false;},getHost:function(){return this.host.combobox("getValue");},setHost:function(value){this.host.combobox("setValue",value);},getPort:function(){return parseInt(this.port.numberspinner("getValue"));},setPort:function(value){this.port.numberspinner("setValue",parseInt(value)).numberspinner("validate");},getKeyAlias:function(){return!this.keyAlias.combobox("options").disabled?this.keyAlias.combobox("getValue"):null;},setKeyAlias:function(value){this.keyAlias.combobox("setValue",value);},isProtectionRequired:function(){return this.protectionRequired.is(":checked");},setProtectionRequired:function(value){this.protectionRequired.prop("checked",!!value);},show:function(listener){this._super(listener);this.host.combobox("reload");this.keyAlias.combobox("reload");},_onLoad$Hosts:function(params,success,error){this.listener.onLoadServerAddresses(params).then(success,error);},_onLoad$Keys:function(params,success,error){this.listener.onLoadServerKeys(params).then(success,error);}});jscape.domain.OftpServiceController=jscape.domain.BaseServiceController.extend({DEFAULT_PORT:3305,DEFAULT_SSL_PORT:6619,onLoadAccounts:function(){return jscape.API.getAccountNames(this.domainName).then(function(names){return names.sort();});},_createDescriptor:function(dialog){return jscape.TransportService.oftp(dialog.getHost(),dialog.getPort(),dialog.getIdCode(),dialog.getKeyAlias(),dialog.isUseSsl(),dialog.isFileEncryptionRequired(),dialog.isFileSignatureRequired(),dialog.getBindTransfersUser());},_setupDialog:function(descriptor){var dialog=new jscape.domain.OftpServiceDialog();if(descriptor){dialog.setTitle(window.R.string.SERVICES_EDIT_TITLE.supplant({0:window.R.string.APPLICATION_PROTOCOL_OFTP}));dialog.setHost(descriptor.host);dialog.setPort(descriptor.port);dialog.setUseSsl(descriptor.connectionInitiallySecured);dialog.setIdCode(descriptor.identificationCode);dialog.setKeyAlias(descriptor.keyAlias);dialog.setFileEncryptionRequired(descriptor.fileEncryptionRequired);dialog.setFileSignatureRequired(descriptor.fileSignatureRequired);dialog.setBindTransfersUser(descriptor.unauthenticatedTransferBinding);}else{dialog.setPort(this.DEFAULT_PORT);dialog.setUseSsl(true);dialog.setFileEncryptionRequired(true);dialog.setFileSignatureRequired(true);}
return dialog;}});jscape.domain.OftpServiceDialog=jscape.ui.DefaultDialog.extend({initialize:function(){var initializing=true;this._super($("#d-services-oftp"),{width:"50%",minWidth:500,maxWidth:750});this.fieldset=$("fieldset[name=tftpservicefields]",this.dialog);this.host=$("select[name=host]",this.fieldset).combobox({required:true,editable:true,limitToList:true,loader:$.proxy(this._onLoad$Hosts,this),onBeforeLoad:function(){return!initializing;},width:"60%",panelMinHeight:50,panelHeight:"auto",panelMaxHeight:"50%",validType:"length[1,500]",missingMessage:window.R.string.SERVICES_ERROR_BAD_HOST,invalidMessage:window.R.string.SERVICES_ERROR_BAD_HOST});this.port=$("input[name=port]",this.fieldset).numberspinner({required:true,min:1,max:65535,width:80});this.idCode=$("input[name=idcode]",this.fieldset).textbox({required:true,validType:"length[1,500]",missingMessage:window.R.string.SERVICES_ERROR_BAD_ID_CODE,invalidMessage:window.R.string.SERVICES_BAD_ID_CODE,width:210});this.keyAlias=$("select[name=privatekey]",this.fieldset).combobox({required:true,editable:false,onBeforeLoad:function(){return!initializing;},loader:$.proxy(this._onLoad$Keys,this),textField:"name",valueField:"name",width:"60%",panelMinHeight:80,panelHeight:"auto",panelMaxHeight:"50%"});this.useSsl=$("input[name=usessl]:checkbox",this.fieldset);this.fileEncryption=$("input[name=fileencryption]:checkbox",this.fieldset);this.fileSignature=$("input[name=filesignature]:checkbox",this.fieldset);this.bindTransfers=$("input[name=bindtransfers]:checkbox",this.fieldset);this.bindTransfers.change($.proxy(function(){var enabled=this.bindTransfers.is(":checked:not(:disabled)");this.transferUser.combobox(enabled?"enable":"disable").combobox(enabled?"enableValidation":"disableValidation");},this));this.transferUser=$("select[name=transferuser]",this.fieldset).combobox({required:true,editable:true,limitToList:true,loader:$.proxy(this._onLoad$Accounts,this),onBeforeLoad:function(){return!initializing;},width:"40%",panelMinHeight:50,panelHeight:"auto",panelMaxHeight:"50%",missingMessage:window.R.string.SERVICES_ERROR_BAD_UNAUTH_TRANSFER_USER,invalidMessage:window.R.string.SERVICES_ERROR_BAD_UNAUTH_TRANSFER_USER});initializing=false;},getHost:function(){return this.host.combobox("getValue");},setHost:function(value){this.host.combobox("setValue",value);},getPort:function(){return parseInt(this.port.numberspinner("getValue"));},setPort:function(value){this.port.numberspinner("setValue",value);},getIdCode:function(){return this.idCode.textbox("getValue");},setIdCode:function(value){this.idCode.textbox("setValue",value);},getKeyAlias:function(){return!this.keyAlias.combobox("options").disabled?this.keyAlias.combobox("getValue"):null;},setKeyAlias:function(value){this.keyAlias.combobox("setValue",value);},isUseSsl:function(){return this.useSsl.is(":checked");},setUseSsl:function(value){this.useSsl.prop("checked",!!value);},isFileEncryptionRequired:function(){return this.fileEncryption.is(":checked");},setFileEncryptionRequired:function(value){this.fileEncryption.prop("checked",!!value);},isFileSignatureRequired:function(){return this.fileSignature.is(":checked");},setFileSignatureRequired:function(value){this.fileSignature.prop("checked",!!value);},getBindTransfersUser:function(){return this.bindTransfers.is(":checked:not(:disabled)")?this.transferUser.combobox("getValue"):null;},setBindTransfersUser:function(value){this.bindTransfers.prop("checked",value!=null).change();if(value){this.transferUser.combobox("setValue",value);}},show:function(listener){this._super(listener);this.bindTransfers.change();this.host.combobox("reload");this.keyAlias.combobox("reload");this.transferUser.combobox("reload");},_onLoad$Hosts:function(params,success,error){this.listener.onLoadServerAddresses(params).then(success,error);},_onLoad$Keys:function(params,success,error){this.listener.onLoadServerKeys(params).then(success,error);},_onLoad$Accounts:function(params,success,error){this.listener.onLoadAccounts(params).then($.proxy(function(callback,data){callback(data);this.bindTransfers.prop("disabled",!(data&&data.length!=0)).change();return data;},this,success),error);}});jscape.domain.TftpServiceController=jscape.domain.BaseServiceController.extend({DEFAULT_PORT:69,start:function(listener,domainName,descriptor){this.listener=listener;this.domainName=domainName;this.accounts=[];this.deferred=$.Deferred();jscape.API.getAccountNames(domainName).then($.proxy(function(names){if(names.length==0){this._noAccountsErrorMessage();return $.Deferred().reject().promise();}
return names;},this),$.proxy(this._noAccountsErrorMessage,this)).done($.proxy(function(names){this.accounts=names.sort();this._setupDialog(descriptor).show(this);},this)).fail($.proxy(function(){this.deferred.reject();this.deferred=null;},this));return this.deferred.promise();},onLoadAccounts:function(){return $.Deferred().resolve(this.accounts).promise();},_createDescriptor:function(dialog){return jscape.TransportService.tftp(dialog.getHost(),dialog.getPort(),dialog.getAccount());},_setupDialog:function(descriptor){var dialog=new jscape.domain.TftpServiceDialog();if(descriptor){dialog.setTitle(window.R.string.SERVICES_EDIT_TITLE.supplant({0:window.R.string.APPLICATION_PROTOCOL_TFTP}));dialog.setHost(descriptor.host);dialog.setPort(descriptor.port);dialog.setAccount(descriptor.username);}else{dialog.setPort(this.DEFAULT_PORT);}
return dialog;},_noAccountsErrorMessage:function(){$.messager.alert(window.R.string.APPLICATION_ERROR_TITLE,window.R.string.SERVICES_ERROR_NO_ACCOUNTS,"error");}});jscape.domain.TftpServiceDialog=jscape.ui.DefaultDialog.extend({initialize:function(){var initializing=true;this._super($("#d-services-tftp"),{width:"50%",minWidth:500,maxWidth:750});this.fieldset=$("fieldset[name=tftpservicefields]",this.dialog);this.host=$("select[name=host]",this.fieldset).combobox({required:true,editable:true,limitToList:true,loader:$.proxy(this._onLoad$Hosts,this),onBeforeLoad:function(){return!initializing;},width:"60%",panelMinHeight:50,panelHeight:"auto",panelMaxHeight:"50%",validType:"length[1,500]",missingMessage:window.R.string.SERVICES_ERROR_BAD_HOST,invalidMessage:window.R.string.SERVICES_ERROR_BAD_HOST});this.port=$("input[name=port]",this.fieldset).numberspinner({required:true,min:1,max:65535,width:80});this.account=$("select[name=username]",this.fieldset).combobox({required:true,editable:true,limitToList:true,loader:$.proxy(this._onLoad$Accounts,this),onBeforeLoad:function(){return!initializing;},width:"40%",panelMinHeight:50,panelHeight:"auto",panelMaxHeight:"50%",missingMessage:window.R.string.SERVICES_ERROR_BAD_ACCOUNT,invalidMessage:window.R.string.SERVICES_ERROR_BAD_ACCOUNT});initializing=false;},getHost:function(){return this.host.combobox("getValue");},setHost:function(value){this.host.combobox("setValue",value);},getPort:function(){return parseInt(this.port.numberspinner("getValue"));},setPort:function(value){this.port.numberspinner("setValue",value);},getAccount:function(){return this.account.combobox("getValue");},setAccount:function(value){this.account.combobox("setValue",value);},show:function(listener){this._super(listener);this.host.combobox("reload");this.account.combobox("reload");},_onLoad$Hosts:function(params,success,error){this.listener.onLoadServerAddresses(params).then(success,error);},_onLoad$Accounts:function(params,success,error){this.listener.onLoadAccounts(params).then(success,error);}});jscape.domain.HttpServiceController=jscape.domain.BaseServiceController.extend({_createDescriptor:function(dialog){return jscape.TransportService.http(dialog.isPlain(),dialog.isSecure());},_setupDialog:function(descriptor){var dialog=new jscape.domain.HttpServiceDialog();if(descriptor){dialog.setTitle(window.R.string.SERVICES_EDIT_TITLE.supplant({0:!!descriptor.secure?window.R.string.APPLICATION_PROTOCOL_HTTPS:window.R.string.APPLICATION_PROTOCOL_HTTP}));dialog.setPlain(descriptor.plain);dialog.setSecure(descriptor.secure);}else{dialog.setSecure(true);}
return dialog;}});jscape.domain.WebDavServiceController=jscape.domain.BaseServiceController.extend({_createDescriptor:function(dialog){return jscape.TransportService.webdav(dialog.isPlain(),dialog.isSecure());},_setupDialog:function(descriptor){var dialog=new jscape.domain.WebDavServiceDialog();if(descriptor){dialog.setTitle(window.R.string.SERVICES_EDIT_TITLE.supplant({0:!!descriptor.secure?window.R.string.APPLICATION_PROTOCOL_WEBDAV_SSL:window.R.string.APPLICATION_PROTOCOL_WEBDAV}));dialog.setPlain(descriptor.plain);dialog.setSecure(descriptor.secure);}else{dialog.setSecure(true);}
return dialog;}});jscape.domain.As2ServiceController=jscape.domain.BaseServiceController.extend({_createDescriptor:function(dialog){return jscape.TransportService.as2(dialog.isPlain(),dialog.isSecure());},_setupDialog:function(descriptor){var dialog=new jscape.domain.As2ServiceDialog();if(descriptor){dialog.setTitle(window.R.string.SERVICES_EDIT_TITLE.supplant({0:window.R.string.APPLICATION_PROTOCOL_AS2}));dialog.setPlain(descriptor.plain);dialog.setSecure(descriptor.secure);}else{dialog.setSecure(true);}
return dialog;}});jscape.domain.BaseWebServiceDialog=jscape.ui.DefaultDialog.extend({initialize:function(dialog){this._super(dialog,{width:"50%",minWidth:500,maxWidth:750});this.fieldset=$("fieldset",this.dialog).first();this.plain=$("input[name=plain]:checkbox",this.fieldset);this.secure=$("input[name=secure]:checkbox",this.fieldset);},isPlain:function(){return this.plain.is(":checked");},setPlain:function(value){this.plain.prop("checked",!!value);},isSecure:function(){return this.secure.is(":checked");},setSecure:function(value){this.secure.prop("checked",!!value);}});jscape.domain.HttpServiceDialog=jscape.domain.BaseWebServiceDialog.extend({initialize:function(){this._super($("#d-services-http"));}});jscape.domain.WebDavServiceDialog=jscape.domain.BaseWebServiceDialog.extend({initialize:function(){this._super($("#d-services-webdav"));}});jscape.domain.As2ServiceDialog=jscape.domain.BaseWebServiceDialog.extend({initialize:function(){this._super($("#d-services-as2"));}});jscape.domain.AgentServiceController=jscape.domain.BaseServiceController.extend({DEFAULT_HOST:"::",DEFAULT_PORT:40025,_createDescriptor:function(dialog){return jscape.TransportService.agent(dialog.getHost(),dialog.getPort(),dialog.getKeyAlias());},_setupDialog:function(descriptor){var dialog=new jscape.domain.AgentServiceDialog();if(descriptor){dialog.setTitle(window.R.string.SERVICES_EDIT_TITLE.supplant({0:window.R.string.APPLICATION_PROTOCOL_AGENT}));dialog.setHost(descriptor.host);dialog.setPort(descriptor.port);dialog.setKeyAlias(descriptor.keyAlias);}else{dialog.setHost(this.DEFAULT_HOST);dialog.setPort(this.DEFAULT_PORT);}
return dialog;}});jscape.domain.AgentServiceDialog=jscape.ui.DefaultDialog.extend({initialize:function(){var initializing=true;this._super($("#d-services-agent"),{width:"50%",minWidth:500,maxWidth:750});this.fieldset=$("fieldset[name=agentservicefields]",this.dialog);this.host=$("select[name=host]",this.fieldset).combobox({required:true,editable:true,limitToList:true,loader:$.proxy(this._onLoad$Hosts,this),onBeforeLoad:function(){return!initializing;},width:"60%",panelMinHeight:50,panelHeight:"auto",panelMaxHeight:"50%",validType:"length[1,500]",missingMessage:window.R.string.SERVICES_ERROR_BAD_HOST,invalidMessage:window.R.string.SERVICES_ERROR_BAD_HOST});this.port=$("input[name=port]",this.fieldset).numberspinner({required:true,min:1,max:65535,width:120});this.keyAlias=$("select[name=key]",this.fieldset).combobox({required:true,editable:false,onBeforeLoad:function(){return!initializing;},loader:$.proxy(this._onLoad$Keys,this),textField:"name",valueField:"name",width:"60%",panelMinHeight:80,panelHeight:"auto",panelMaxHeight:"50%"});initializing=false;},getHost:function(){return this.host.combobox("getValue");},setHost:function(value){this.host.combobox("setValue",value);},getPort:function(){return parseInt(this.port.numberspinner("getValue"));},setPort:function(value){this.port.numberspinner("setValue",value);},getKeyAlias:function(){return this.keyAlias.combobox("getValue");},setKeyAlias:function(value){this.keyAlias.combobox("setValue",value);},show:function(listener){this._super(listener);this.host.combobox("reload");this.keyAlias.combobox("reload");this.fieldset.form("validate");},_onLoad$Hosts:function(params,success,error){this.listener.onLoadServerAddresses(params).then(success,error);},_onLoad$Keys:function(params,success,error){this.listener.onLoadServerKeys(params).then(success,error);}});