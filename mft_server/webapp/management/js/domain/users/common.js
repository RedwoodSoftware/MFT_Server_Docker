/* Copyright Â© 2009-2024. Redwood Software Inc. All rights reserved. */
jscape.domain=jscape.domain||{};jscape.Quota=Class.extend({initialize:function(a,b,c){this.bytes=parseInt(a)||0;this.resetPeriod=parseInt(b)||0;this.transferredBytes=parseInt(c)||0;},toJSON:function(){return{bytes:this.bytes,resetPeriod:this.resetPeriod};}});jscape.Quota.fromJSON=function(data){return data?new jscape.Quota(data.bytes,data.resetPeriod,data.transferredBytes):null;};jscape.AccountTransferQuotas=Class.extend({initialize:function(a,b,c,d,e,f){this.uploadsQuota=a||null;this.downloadsQuota=b||null;this.transfersQuota=c||null;this.maxUploadsPerSession=parseInt(d)||null;this.maxDownloadsPerSession=parseInt(e)||null;this.maxTransferRate=parseInt(f)||null;}});jscape.AccountTransferQuotas.fromJSON=function(data){return data?new jscape.AccountTransferQuotas(jscape.Quota.fromJSON(data.uploadsQuota),jscape.Quota.fromJSON(data.downloadsQuota),jscape.Quota.fromJSON(data.transfersQuota),data.maxUploadsPerSession,data.maxDownloadsPerSession,data.maxTransferRate):null;};jscape.IpAccessVerifier=Class.extend({initialize:function(masks){this.masks=masks||[];}});jscape.IpAccessVerifier.fromJSON=function(data){return new jscape.IpAccessVerifier($.map(data.masks||[],jscape.IpAccessVerifier.IPMask.fromJSON));};jscape.IpAccessVerifier.IPMask=Class.extend({initialize:function(a,b,c){this.mask=a||"";this.reason=b||"";this.allowed=c||false;}});jscape.IpAccessVerifier.IPMask.fromJSON=function(data){return $.extend(new jscape.IpAccessVerifier.IPMask(),data);};jscape.DomainAdministration=Class.extend({initialize:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){this.maxOwnedCount=parseInt(a)||null;this.manageNonOwned=b||false;this.userPasswordChangingAllowed=c||false;this.allowGroupAssignment=d||false;this.allowResourceMapping=e||false;this.restrictDir=f||null;this.shareQuotas=g||false;this.allowSetPhoneAuth=h||false;this.allowUrlBranding=i||false;this.maxUrlBrandings=parseInt(j)||null;this.allowDropZone=k||false;this.maxDropZones=parseInt(l)||null;this.allowManagePublicContact=m||false;this.allowSystemPgpKeyAssignment=n||false;this.allowedTemplates=o||[];}});jscape.DomainAdministration.fromJSON=function(data){return data?$.extend(new jscape.DomainAdministration(),data):null;};jscape.WebOptions=Class.extend({initialize:function(a,b,c,d,e,f,g,h,i){this.loginRedirection=a||"storage";this.webAccountLinkAvailable=b!=undefined?!!b:true;this.webPersonalInformationAvailable=c!=undefined?!!c:true;this.webPublicKeyAuthenticationAvailable=d!=undefined?!!d:true;this.webOpenPgpEncryptionAvailable=e!=undefined?!!e:true;this.webQuotasAvailable=f!=undefined?!!f:true;this.webContactsAvailable=g!=undefined?!!g:true;this.webAdHocActivityAvailable=h!=undefined?!!h:true;this.webDropZonesAvailable=i!=undefined?!!i:true;},toJSON:function(){return $.extend({},this,{loginRedirection:{"target":this.loginRedirection}});}});jscape.WebOptions.fromJSON=function(data){return new jscape.WebOptions(data.loginRedirection&&data.loginRedirection.target,data.webAccountLinkAvailable,data.webPersonalInformationAvailable,data.webPublicKeyAuthenticationAvailable,data.webOpenPgpEncryptionAvailable,data.webQuotasAvailable,data.webContactsAvailable,data.webAdHocActivityAvailable,data.webDropZonesAvailable);};jscape.domain.UserInfoView=Class.extend({initialize:function(fieldset){var initializing=true;this.fieldset=fieldset;this.username=$("input[name=username]",this.fieldset).textbox({width:"60%"});this.email=$("input[name=email]",this.fieldset).textbox({validType:{any:["variable","multi_value['email',',']"]},invalidMessage:window.R.string.USERS_ERROR_BAD_EMAIL,width:"40%"});this.company=$("input[name=company]",this.fieldset).textbox({width:"40%"});this.phoneCode=$("input[name=phonecode]",this.fieldset).textbox({validType:"pattern['^[\\\\d]+$']",invalidMessage:window.R.string.USERS_ERROR_BAD_PHONE,width:60});this.phoneNumber=$("input[name=phonenum]",this.fieldset).textbox({validType:"pattern['^[\\\\d- ]+$']",invalidMessage:window.R.string.USERS_ERROR_BAD_PHONE,onChange:$.proxy(this._onChange$Phone,this),width:120});this.phoneExtension=$("input[name=phoneext]",this.fieldset).textbox({validType:"pattern['^[\\\\d- ]+$']",invalidMessage:window.R.string.USERS_ERROR_BAD_PHONE,onChange:$.proxy(this._onChange$Phone,this),width:60});this.notes=$("input[name=notes]",this.fieldset).textbox({width:"60%"});this.groups=$("table[role=grid][aria-label=usergroups]",this.fieldset);this.groups.datagrid({fitColumns:false,autoRowHeight:false,singleSelect:false,collapsible:true,collapsed:true,checkOnSelect:true,selectOnCheck:true,remoteSort:false,sortName:"name",idField:"name",columns:[[{field:"_checkbox",checkbox:true,width:50,fixed:true},{field:"name",title:$("thead th:nth-child(1)",this.groups).text(),sortable:true,width:"90%"}]],loader:$.proxy(this._onLoad$Groups,this),onBeforeLoad:function(){return!initializing;},loadFilter:function(data){return $.map($.isArray(data)?data:data.rows,function(value){return{name:value};});},onLoadSuccess:$.proxy(this._onLoadSuccess$DataGrid,this,this.groups),onExpand:$.proxy(this._onExpand$DataGrid,this,this.groups),onSelect:$.proxy(this._onForm$Change,this),onUnselect:$.proxy(this._onForm$Change,this),view:$.extend({},$.fn.datagrid.defaults.view,{onBeforeRender:$.proxy(this._onBeforeRender$DataGrid,this)}),width:"95%",height:"auto",minHeight:150,maxHeight:350});var gp=this.groups.datagrid("getPanel");gp.panel("header").click(function(){gp.panel(gp.panel("options").collapsed?"expand":"collapse",true);});this.protocols=$("input[name=protocol]:checkbox",this.fieldset);this.restrictProtocols=$("input[name=restrictprotocol]",this.fieldset).switchbutton({onChange:$.proxy(this._onChange$RestrictProtocols,this)});this.enabled=$("input[name=enabled]:checkbox",this.fieldset);this.allowAdHocTransfers=$("input[name=adhocallowed]:checkbox",this.fieldset).change($.proxy(function(){this.adHocSettingsButton.linkbutton(this.getAllowAdHocTransfers()?"enable":"disable");},this));this.adHocSettingsButton=$("a[role=button][name=adhocsettings]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$AdHocPermissionsButton,this)});this.allowAdHocTransfers.change();this.ownedBy=$("input[name=ownedby]:checkbox",this.fieldset);this.ownedBy.on("change",$.proxy(function(){var enabled=this.ownedBy.is(":checked:not(:disabled)");this.owner.combobox(enabled?"enable":"disable").combobox(enabled?"enableValidation":"disableValidation");},this));this.owner=$("select[name=owners]",this.fieldset).combobox({required:true,editable:true,limitToList:true,disabled:true,width:120});this.secured=$("input[name=secured]:checkbox",this.fieldset);this.allowPasswordChange=$("input[name=allowpwdchange]:checkbox",this.fieldset);this.ignorePasswordAging=$("input[name=ignorepwdaging]:checkbox",this.fieldset);this.clientKeys=$("table[role=grid][aria-label=clientkeys]",this.fieldset);this.clientKeys.datagrid({fitColumns:false,autoRowHeight:false,singleSelect:false,checkOnSelect:true,selectOnCheck:true,collapsible:true,collapsed:true,width:"95%",height:"auto",minHeight:150,maxHeight:350,remoteSort:false,sortName:"alias",idField:"alias",columns:[[{field:"_checkbox",checkbox:true,width:50,fixed:true},{field:"alias",title:$("thead th:nth-child(1)",this.clientKeys).text(),sortable:true,width:"90%"}]],loader:$.proxy(this._onLoad$ClientKeys,this),onBeforeLoad:function(){return!initializing;},loadFilter:function(data){return $.map($.isArray(data)?data:data.rows,function(value){return{alias:value}})},onLoadSuccess:$.proxy(this._onLoadSuccess$DataGrid,this,this.clientKeys),onExpand:$.proxy(this._onExpand$DataGrid,this,this.clientKeys),view:$.extend({},$.fn.datagrid.defaults.view,{onBeforeRender:$.proxy(this._onBeforeRender$DataGrid,this)})});var kp=this.clientKeys.datagrid("getPanel");kp.panel("header").click(function(){kp.panel(kp.panel("options").collapsed?"expand":"collapse",true);});this.tags=$("select[name=tags]",this.fieldset).tagbox({limitToList:jscape.acl&&!jscape.acl.tic,hasDownArrow:true,loader:$.proxy(this._onLoad$Tags,this),onBeforeLoad:function(){return!initializing;},onAddTag:$.proxy(this._onClick$AddTagButton,this),tagEditor:$("#d-add-tag-inline"),width:"70%",panelHeight:"auto",panelMinHeight:50});initializing=false;},show:function(listener){this.listener=listener||jscape.domain.UserInfoView.LISTENER;this.fieldset.css({visible:"visible"}).form("validate");this.tags.tagbox("reload");this._onChange$RestrictProtocols();},getUsername:function(){return this.username.textbox("getValue");},setUsername:function(value){this.username.textbox("setValue",value);},getEmail:function(){return this.email.textbox("getValue");},setEmail:function(value){this.email.textbox("setValue",value);},getCompany:function(){return this.company.textbox("getValue");},setCompany:function(value){this.company.textbox("setValue",value);},getPhoneCode:function(){return this.phoneCode.textbox("isValid")?this.phoneCode.textbox("getValue"):null;},setPhoneCode:function(value){if(value!=null){this.phoneCode.textbox("setValue",value);}},getPhoneNumber:function(){return this.phoneNumber.textbox("isValid")?this.phoneNumber.textbox("getValue"):null;},setPhoneNumber:function(value){if(value!=null){this.phoneNumber.textbox("setValue",value);}},getPhoneExtension:function(){return this.phoneExtension.textbox("isValid")?this.phoneExtension.textbox("getValue"):null;},setPhoneExtension:function(value){if(value!=null){this.phoneExtension.textbox("setValue",value);}},getNotes:function(){return this.notes.textbox("getValue");},setNotes:function(value){this.notes.textbox("setValue",value);},getClientKeys:function(){return this._getSelectedDataGridRecords(this.clientKeys);},setClientKeys:function(values){this._selectDataGridRecords(this.clientKeys,values||[]);},getGroups:function(){return this._getSelectedDataGridRecords(this.groups);},setGroups:function(values){this._selectDataGridRecords(this.groups,values||[]);},getProtocols:function(){return!!this.restrictProtocols.switchbutton("options").checked?$.map(this.protocols.filter(":checked"),function(el){return el.value;}):null;},setProtocols:function(values){this.restrictProtocols.switchbutton(values!=null?"check":"uncheck");this.protocols.each(function(_,el){el.checked=!!values&&$.inArray(el.value,values)!=-1;});},setAvailableOwners:function(values){this.owner.combobox("loadData",values);this.ownedBy.prop("disabled",values.length==0).change();},getOwner:function(){return this.ownedBy.is(":checked")?this.owner.combobox("getValue"):null;},setOwner:function(value){if(value){this.owner.combobox("select",value);this.ownedBy.prop("checked",this.owner.combobox("getValue")===value).change();}else{this.ownedBy.prop("checked",false).change();}},getEnabled:function(){return this.enabled.is(":checked");},setEnabled:function(value){this.enabled.prop("checked",!!value);},getSecured:function(){return this.secured.is(":checked");},setSecured:function(value){this.secured.prop("checked",!!value);},getAllowAdHocTransfers:function(){return this.allowAdHocTransfers.is(":checked");},setAllowAdHocTransfers:function(value){this.allowAdHocTransfers.prop("checked",!!value).change();},getAdHocTransferPermissions:function(){return this.adHocPermissions||[];},setAdHocTransferPermissions:function(values){this.adHocPermissions=values||[];},getAllowPasswordChanging:function(){return this.allowPasswordChange.is(":checked");},setAllowPasswordChanging:function(value){this.allowPasswordChange.prop("checked",!!value);},getIgnorePasswordAgingRules:function(){return this.ignorePasswordAging.is(":checked");},setIgnorePasswordAgingRules:function(value){this.ignorePasswordAging.prop("checked",!!value);},getTags:function(){return this.tags.tagbox("getValues");},setTags:function(values){this.tags.tagbox("setValues",values);},_onChange$Phone:function(){this.phoneCode.textbox("textbox").validatebox("options").required=!!this.getPhoneNumber()||!!this.getPhoneExtension();},_onLoad$Groups:function(params,success,error){this.listener.onLoadGroups(params).then(success,error);},_onLoad$ClientKeys:function(params,success,error){this.listener.onLoadClientKeys(params).then(success,error);},_onClick$AddTagButton:function(tag){this.listener.onAddTag(tag).done($.proxy(function(){this.tags.tagbox("reload");},this));},_onClick$AdHocPermissionsButton:function(){this.adHocSettingsButton.linkbutton("disable");this.listener.onAdHocSettings(this).always($.proxy(function(){this.adHocSettingsButton.linkbutton("enable");},this));},_onChange$RestrictProtocols:function(checked){this.protocols.prop("disabled",!checked);},_onLoad$Tags:function(params,success,error){this.listener.onLoadTags(params).done(success).fail(error);},_onLoadSuccess$DataGrid:function(target,data){$(target).datagrid("getPanel").find("div.datagrid-header-check input:checkbox").prop("disabled",data.rows.length==0);},_onExpand$DataGrid:function(target){var opts=target.datagrid("options");if(!opts._dataLoaded){target.datagrid("reload",function(){opts._dataLoaded=true;var indexes=$.map(opts._dataChecked,function(data){return target.datagrid("getRowIndex",data);});delete opts._dataChecked;opts._selectingRecords=true;for(var i=0,len=indexes.length;i<len;++i){target.datagrid("selectRow",indexes[i]);}
opts._selectingRecords=false;});}},_onBeforeRender$DataGrid:function(target,rows){var opts=$(target).datagrid("options");if(!opts._selectingRecords&&/(asc|desc)/i.test(opts.sortOrder)){var ids=$.map($(target).datagrid("getSelections"),function(row){return row[opts.idField];});var pos=0;while(ids.length){var id="asc"==opts.sortOrder?ids.shift():ids.pop();for(var i=0,len=rows.length;i<len;++i){if(rows[i][opts.idField]==id){var items=rows.splice(i,1);items.length&&rows.splice(pos++,0,items[0]);break;}}}}},_getSelectedDataGridRecords:function(grid){var opts=grid.datagrid("options");return!opts._dataLoaded?opts._dataChecked:$.map(grid.datagrid("getChecked"),function(row){return row[opts.idField];});},_selectDataGridRecords:function(grid,selections){grid.datagrid("clearSelections");var opts=grid.datagrid("options");if(!opts._dataLoaded){opts._dataChecked=selections;}else{delete opts._dataChecked;for(var i=0,len=selections.length;i<len;++i){grid.datagrid("selectRecord",selections[i]);}}}});jscape.domain.UserInfoView.LISTENER={onAdHocPermissions:$.noop};jscape.domain.QuotasController=Class.extend({initialize:function(dialog){this.view=new jscape.domain.UserQuotaView(dialog);},start:function(quotas){this.view.show(this);this._setupView(quotas||null);},getQuotas:function(){return new jscape.AccountTransferQuotas(this.view.getUploadsQuota(),this.view.getDownloadsQuota(),this.view.getTransfersQuota(),this.view.getMaxUploadsPerSession(),this.view.getMaxDownloadsPerSession(),this.view.getMaxTransferRate());},_setupView:function(quotas){if(quotas!=null){this.view.setDownloadsQuota(quotas.downloadsQuota);this.view.setUploadsQuota(quotas.uploadsQuota);this.view.setTransfersQuota(quotas.transfersQuota);this.view.setMaxDownloadsPerSession(quotas.maxDownloadsPerSession);this.view.setMaxUploadsPerSession(quotas.maxUploadsPerSession);this.view.setMaxTransferRate(quotas.maxTransferRate);}else{this.view.setDownloadsQuota(null);this.view.setUploadsQuota(null);this.view.setTransfersQuota(null);this.view.setMaxDownloadsPerSession(null);this.view.setMaxUploadsPerSession(null);this.view.setMaxTransferRate(null);}}});jscape.domain.UserQuotaView=Class.extend({PERIOD_FACTOR:24*60*60*1000,initialize:function(dialog){this.fieldset=$("#quotasfields"+dialog.getIdSuffix());this.downloadQuota=new jscape.domain.QuotaPane($("input[name=maxdloadenabled]:checkbox",this.fieldset),$("input[name=maxdload]",this.fieldset).numberspinner({required:true,min:0,max:9999,value:1000,increment:10,disabled:true,width:80,unitbox:$("select[name=maxdloadunit]",this.fieldset).combobox({required:true,editable:false,disabled:true,width:60,panelHeight:"auto"})}),$("input[name=maxdloadresetperiod]",this.fieldset).numberspinner({required:true,min:1,max:1000,value:1,disabled:true,width:80}));this.uploadQuota=new jscape.domain.QuotaPane($("input[name=maxuploadenabled]:checkbox",this.fieldset),$("input[name=maxupload]",this.fieldset).numberspinner({required:true,min:0,max:9999,value:1000,increment:10,disabled:true,width:80,unitbox:$("select[name=maxuploadunit]",this.fieldset).combobox({required:true,editable:false,disabled:true,width:60,panelHeight:"auto"})}),$("input[name=maxuploadresetperiod]",this.fieldset).numberspinner({required:true,min:1,max:1000,value:1,disabled:true,width:80}));this.transferQuota=new jscape.domain.QuotaPane($("input[name=maxtransferenabled]:checkbox",this.fieldset),$("input[name=maxtransfer]",this.fieldset).numberspinner({required:true,min:0,max:9999,value:1000,increment:10,disabled:true,width:80,unitbox:$("select[name=maxtransferunit]",this.fieldset).combobox({required:true,editable:false,disabled:true,width:60,panelHeight:"auto"})}),$("input[name=maxtransferresetperiod]",this.fieldset).numberspinner({required:true,min:1,max:1000,value:1,disabled:true,width:80}));this.maxTransferRate=new jscape.domain.QuotaPane($("input[name=maxtransferrateenabled]:checkbox",this.fieldset),$("input[name=maxtransferrate]",this.fieldset).numberspinner({required:true,min:1,max:9999,value:1000,disabled:true,width:80,unitbox:$("select[name=maxtransferrateunit]",this.fieldset).combobox({required:true,editable:false,disabled:true,width:70,panelHeight:"auto"})}));this.downloadPerSessionEnabled=$("input[name=maxdloadsessionenabled]:checkbox",this.fieldset).click($.proxy(this._adjustDownloadPerSession,this));this.downloadPerSession=$("input[name=maxdloadsession]",this.fieldset).numberspinner({required:true,disabled:true,min:1,max:1000,value:1,width:80});this.uploadPerSessionEnabled=$("input[name=maxuploadsessionenabled]:checkbox",this.fieldset).click($.proxy(this._adjustUploadPerSession,this));this.uploadPerSession=$("input[name=maxuploadsession]",this.fieldset).numberspinner({required:true,disabled:true,min:1,max:1000,value:1,width:80});},show:function(listener){this.listener=listener||jscape.domain.UserQuotaView.LISTENER;this.downloadQuota.show(this);this.uploadQuota.show(this);this.transferQuota.show(this);this.maxTransferRate.show(this);},onStateChanged:function(view){if(view.isEnabled()){if(view==this.transferQuota){this.downloadQuota.setEnabled(false);this.uploadQuota.setEnabled(false);}else if(view==this.downloadQuota||view==this.uploadQuota){this.transferQuota.setEnabled(false);}}},getDownloadsQuota:function(){return this._getQuota(this.downloadQuota);},setDownloadsQuota:function(value){this._setQuota(this.downloadQuota,value);},getUploadsQuota:function(){return this._getQuota(this.uploadQuota);},setUploadsQuota:function(value){this._setQuota(this.uploadQuota,value);},getTransfersQuota:function(){return this._getQuota(this.transferQuota);},setTransfersQuota:function(value){this._setQuota(this.transferQuota,value);},getMaxTransferRate:function(){return this.maxTransferRate.val();},setMaxTransferRate:function(value){this.maxTransferRate.val(value);},getMaxDownloadsPerSession:function(){return this.downloadPerSessionEnabled.is(":checked")?parseInt(this.downloadPerSession.numberspinner("getValue")):null;},setMaxDownloadsPerSession:function(value){value=parseInt(value);if(!isNaN(value)){this.downloadPerSessionEnabled.prop("checked",true);this.downloadPerSession.numberspinner("setValue",value);}else{this.downloadPerSessionEnabled.prop("checked",false);this.downloadPerSession.numberspinner("reset");}
this._adjustDownloadPerSession();},getMaxUploadsPerSession:function(){return this.uploadPerSessionEnabled.is(":checked")?parseInt(this.uploadPerSession.numberspinner("getValue")):null;},setMaxUploadsPerSession:function(value){value=parseInt(value);if(!isNaN(value)){this.uploadPerSessionEnabled.prop("checked",true);this.uploadPerSession.numberspinner("setValue",value);}else{this.uploadPerSessionEnabled.prop("checked",false);this.uploadPerSession.numberspinner("reset");}
this._adjustUploadPerSession();},_getQuota:function(view){var quota=view.val();return quota!=null?new jscape.Quota(quota,view.getResetPeriod()*this.PERIOD_FACTOR):null;},_setQuota:function(view,quota){if(quota!=null){view.val(quota.bytes);view.setResetPeriod(quota.resetPeriod/this.PERIOD_FACTOR);}else{view.val(null);}},_adjustDownloadPerSession:function(){var enabled=this.downloadPerSessionEnabled.is(":checked");this.downloadPerSession.numberspinner(enabled?"enable":"disable").numberspinner(enabled?"enableValidation":"disableValidation");},_adjustUploadPerSession:function(){var enabled=this.uploadPerSessionEnabled.is(":checked");this.uploadPerSession.numberspinner(enabled?"enable":"disable").numberspinner(enabled?"enableValidation":"disableValidation");}});jscape.domain.UserQuotaView.LISTENER={};jscape.domain.QuotaPane=Class.extend({initialize:function(checkbox,count,resetPeriod){this.enabled=checkbox.click($.proxy(this._onClick$Enable,this)).change($.proxy(this._onChange$Enable,this));this.input=count;this.period=resetPeriod;},show:function(listener){this.listener=listener||jscape.domain.QuotaPane.LISTENER;},isEnabled:function(){return this.enabled.is(":checked");},setEnabled:function(value){this.enabled.prop("checked",!!value).change();},getResetPeriod:function(){return this.period&&this.period.length?parseInt(this.period.numberspinner("getValue")):null;},setResetPeriod:function(value){if(this.period&&this.period.length){value=parseInt(value);if(!isNaN(value)){this.period.numberspinner("setValue",value);}}},val:function(value){if(!arguments.length){return this.isEnabled()?parseInt(this.input.numberspinner("getValue")):null;}else{value=parseInt(value);if(isNaN(value)){this.setEnabled(false);}else{this.setEnabled(true);this.input.numberspinner("setValue",value);}}},_onChange$Enable:function(){var unitbox=this.input.numberspinner("options").unitbox;if(this.isEnabled()){this.input.numberspinner("enable").numberspinner("enableValidation");if(this.period&&this.period.length){this.period.numberspinner("enable").numberspinner("enableValidation");}
if(unitbox&&unitbox.length){unitbox.combobox("enable").combobox("enableValidation");}}else{this.input.numberspinner("disable").numberspinner("disableValidation");if(this.period&&this.period.length){this.period.numberspinner("disable").numberspinner("disableValidation");}
if(unitbox&&unitbox.length){unitbox.combobox("disable").combobox("disableValidation");}}},_onClick$Enable:function(){this.listener.onStateChanged(this);}});jscape.domain.QuotaPane.LISTENER={onStateChanged:$.noop};jscape.domain.UserIpAccessController=Class.extend({rules:null,initialize:function(dialog){this.view=new jscape.domain.UserIpAccessView(dialog);this.addController=new jscape.domain.AddUserIpAccessController();this.editController=new jscape.domain.EditUserIpAccessController();this.deleteController=new jscape.domain.DeleteUserIpAccessController();this._initValidators();},start:function(ipAccessVerifier){this.rules=ipAccessVerifier?[].concat(ipAccessVerifier.masks):[];this.view.setRules(this.rules);this.view.show(this);},getIpAccess:function(){return new jscape.IpAccessVerifier(this.rules);},onAddRule:function(){this.addController.start().done($.proxy(this._ruleAdded,this));},onEditRule:function(rule){var index=$.inArray(rule,this.rules);if(index!=-1){this.editController.start(rule).done($.proxy(this._ruleEdited,this,index));}},onDeleteRule:function(rules){this.deleteController.start(rules).done($.proxy(this._ruleDeleted,this,rules));},onRuleUp:function(rule){var index=$.inArray(rule,this.rules);if(index>0){this.rules.splice(index-1,2,this.rules[index],this.rules[index-1]);this.view.setRules(this.rules);this.view.selectRule(rule);}},onRuleDown:function(rule){var index=$.inArray(rule,this.rules);if(index!=-1&&index<this.rules.length-1){this.rules.splice(index,2,this.rules[index+1],this.rules[index]);this.view.setRules(this.rules);this.view.selectRule(rule);}},_ruleAdded:function(rule){this.rules.push(rule);this.view.setRules(this.rules);this.view.selectRule(rule);},_ruleEdited:function(index,rule){this.rules[index]=rule;this.view.setRules(this.rules);this.view.selectRule(rule);},_ruleDeleted:function(rules){var index=-1;while(rules.length){index=$.inArray(rules.pop(),this.rules);this.rules.splice(index,1);}
this.view.setRules(this.rules);if(this.rules.length){index=Math.max(0,Math.min(index,this.rules.length-1));this.view.selectRule(this.rules[index]);}},_initValidators:function(){var v=new jscape.Validator();v.nonEmptyRule("user_ipaccess_mask_nonempty",window.R.string.USERS_IP_ACCESS_ERROR_BAD_MASK);v.rule("user_ipaccess_unique",$.proxy(this._ruleNotExists,this),window.R.string.USERS_IP_ACCESS_ERROR_ALREADY_EXIST);},_ruleNotExists:function(value,excludes){return $.grep(this.rules,function(rule){return rule.mask==value&&(excludes==undefined||$.inArray(rule.mask,excludes)==-1);}).length==0;}});jscape.domain.UserIpAccessView=Class.extend({selection:null,initialize:function(dialog){this.fieldset=$("#useripaccessfields"+dialog.getIdSuffix()).layout({fit:true,doSize:false,border:false});this.data=$("table[role=grid][aria-label=rules]",this.fieldset);this.data.datagrid({fit:true,fitColumns:true,singleSelect:true,columns:[[{field:"mask",title:$("thead th:nth-child(1)",this.data).text(),width:60},{field:"allowed",title:$("thead th:nth-child(2)",this.data).text(),width:15,formatter:$.proxy(this._formatAccess,this),styler:$.proxy(this._styleAccess,this)},{field:"reason",title:$("thead th:nth-child(3)",this.data).text(),width:25}]],onDblClickRow:$.proxy(this._onClick$EditButton,this),onSelect:$.proxy(this._adjustRowSelection,this),onUnselect:$.proxy(this._adjustRowSelection,this),onLoadSuccess:$.proxy(this._adjustRowSelection,this)});this.moveUpButton=$("a[role=button][name=moveup]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$MoveUpButton,this)});this.moveDownButton=$("a[role=button][name=movedown]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$MoveDownButton,this)});this.addButton=$("a[role=button][name=add]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$AddButton,this)});this.editButton=$("a[role=button][name=edit]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$EditButton,this)});this.deleteButton=$("a[role=button][name=delete]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$DeleteButton,this)});},show:function(listener){this.listener=listener||jscape.domain.UserIpAccessView.LISTENER;this._adjustRowSelection();},setRules:function(values){this.selection=[];this.data.datagrid("loading").datagrid("loadData",values).datagrid("loaded");this.data.closest("form").trigger("change");},selectRule:function(rule){this.data.datagrid("selectRow",this.data.datagrid("getRowIndex",rule));},_formatAccess:function(value){return!!value?window.R.string.USERS_IP_ACCESS_RULE_ALLOWED:window.R.string.USERS_IP_ACCESS_RULE_DENIED;},_styleAccess:function(value){return!!value?"color:green":"color:red";},_onClick$MoveUpButton:function(){this.listener.onRuleUp(this.selection[0]);},_onClick$MoveDownButton:function(){this.listener.onRuleDown(this.selection[0]);},_onClick$AddButton:function(){this.listener.onAddRule();},_onClick$EditButton:function(){this.listener.onEditRule(this.selection[0]);},_onClick$DeleteButton:function(){this.listener.onDeleteRule(this.selection);},_adjustRowSelection:function(){this.selection=this.data.datagrid("getSelections");this._adjustButtonsState();},_adjustButtonsState:function(){var index=this.selection.length==1?this.data.datagrid("getRowIndex",this.selection[0]):-1;var count=this.data.datagrid("getRows").length;this.moveUpButton.linkbutton(index>0&&index<=count-1?"enable":"disable");this.moveDownButton.linkbutton(index>=0&&index<count-1?"enable":"disable");this.editButton.linkbutton(this.selection.length==1?"enable":"disable");this.deleteButton.linkbutton(this.selection.length!=0?"enable":"disable");}});jscape.domain.UserIpAccessView.LISTENER={onAddRule:$.noop,onEditRule:$.noop,onDeleteRule:$.noop,onRuleUp:$.noop,onRuleDown:$.noop};jscape.domain.AddUserIpAccessController=Class.extend({deferred:null,start:function(){this.deferred=$.Deferred();this._setupDialog().show(this);return this.deferred.promise();},onSubmit:function(dialog){var rule=this._createRule(dialog);dialog.hide();this.deferred.resolve(rule);this.deferred=null;},onCancel:function(dialog){dialog.hide();this.deferred.reject();this.deferred=null;},_createRule:function(dialog){return new jscape.IpAccessVerifier.IPMask(dialog.getMask(),dialog.getReason(),dialog.getAllowed());},_setupDialog:function(){var dialog=new jscape.domain.UserIpAccessRuleDialog();dialog.setTitle(window.R.string.USERS_IP_ACCESS_DIALOG_ADD_TITLE);dialog.setAllowed(true);return dialog;}});jscape.domain.EditUserIpAccessController=Class.extend({deferred:null,start:function(rule){this.deferred=$.Deferred();this._setupDialog(rule).show(this);return this.deferred.promise();},onSubmit:function(dialog){var rule=this._createRule(dialog);dialog.hide();this.deferred.resolve(rule);this.deferred=null;},onCancel:function(dialog){dialog.hide();this.deferred.reject();this.deferred=null;},_createRule:function(dialog){return new jscape.IpAccessVerifier.IPMask(dialog.getMask(),dialog.getReason(),dialog.getAllowed());},_setupDialog:function(rule){var dialog=new jscape.domain.UserIpAccessRuleDialog();dialog.setTitle(window.R.string.USERS_IP_ACCESS_DIALOG_EDIT_TITLE);dialog.setMask(rule.mask);dialog.setReason(rule.reason);dialog.setAllowed(rule.allowed);return dialog;}});jscape.domain.DeleteUserIpAccessController=Class.extend({start:function(rules){var text=$.map(rules,function(rule){return rule.mask;}).join(", ");return jscape.ConfirmDialog.confirm(window.R.string.USERS_IP_ACCESS_CONFIRM_DELETE_TITLE,window.R.string.USERS_IP_ACCESS_CONFIRM_DELETE_MESSAGE.supplant({0:text.escapeXml()}),false);}});jscape.domain.UserIpAccessRuleDialog=jscape.ui.DefaultDialog.extend({initialize:function(){this._super($("#d-user-ipaccess-rule"),{width:"40%",minWidth:530,minHeight:320});this.mask=$("input[name=mask]",this.fieldset).textbox({required:true,validType:["user_ipaccess_mask_nonempty","user_ipaccess_unique"],missingMessage:window.R.string.USERS_IP_ACCESS_ERROR_BAD_MASK,width:"60%"});this.reason=$("input[name=reason]",this.fieldset).textbox({width:"60%"});this.allowed=$("input[name=allowed]:radio",this.fieldset);},getMask:function(){return this.mask.textbox("getValue");},setMask:function(value){this.mask.textbox("setValue",value);if(value&&value.trim().length){this.mask.textbox("textbox").validatebox("options").validType=["user_ipaccess_mask_nonempty","user_ipaccess_unique['"+value+"']"];}},getReason:function(){return this.reason.textbox("getValue");},setReason:function(value){this.reason.textbox("setValue",value);},getAllowed:function(){return(/^true$/i).test(this.allowed.filter(":checked").val());},setAllowed:function(value){this.allowed.filter("[value="+Boolean(value)+"]").prop("checked",true);}});jscape.domain.DomainAdministrationController=Class.extend({initialize:function(dialog,vfsController){this.view=new jscape.domain.DomainAdministrationView(dialog);this.vfsController=vfsController;},start:function(domainName,administration){this.domainName=domainName;this.view.show(this);this._setupView(administration);},getDomainAdministration:function(){if(!this.view.isDomainAdministrationAllowed()){return null;}
return new jscape.DomainAdministration(this.view.getMaxOwnedUsers(),this.view.getManageNonOwnedUsersAllowed(),this.view.isPasswordChangingAllowed(),this.view.getGroupAssignmentAllowed(),this.view.getProxyMappingAllowed(),this.view.getRestrictionPath(),this.view.getShareQuotas(),this.view.getMultiFactorAuthSettingsAllowed(),this.view.getUrlBrandingAllowed(),this.view.getMaxUrlBranding(),this.view.getDropZoneAllowed(),this.view.getMaxDropZones(),this.view.getManagePublicContacts(),this.view.getSystemPgpKeysAvailable(),this.view.getTemplates());},onInitDefaults:function(dialog){dialog.setPasswordChangingAllowed(true);var descriptors=this.vfsController.getDescriptors();for(var i=0;i<descriptors.length;++i){var descriptor=descriptors[i];if(descriptor.path==="/"&&descriptor.realPath){dialog.setRestrictionPath(descriptor.realPath);break;}}},onSelectPath:function(dialog){return new SelectPathController($.proxy(jscape.API.listUsersRestrictPath,jscape.API),$.proxy(jscape.API.createUsersRestrictPath,jscape.API)).selectDirectory().then(function(entry){return entry.path;});},onLoadAccountTemplates:function(){return jscape.API.getAccountTemplateNames(this.domainName);},_setupView:function(administration){if(administration){this.view.setDomainAdministrationAllowed(true);this.view.setMaxOwnedUsers(administration.maxOwnedCount);this.view.setManageNonOwnedUsersAllowed(administration.manageNonOwned);this.view.setPasswordChangingAllowed(administration.userPasswordChangingAllowed);this.view.setGroupAssignmentAllowed(administration.allowGroupAssignment);this.view.setProxyMappingAllowed(administration.allowResourceMapping);this.view.setRestrictionPath(administration.restrictDir);this.view.setShareQuotas(administration.shareQuotas);this.view.setMultiFactorAuthSettingsAllowed(administration.allowSetPhoneAuth);this.view.setUrlBrandingAllowed(administration.allowUrlBranding);this.view.setMaxUrlBranding(administration.maxUrlBrandings);this.view.setDropZoneAllowed(administration.allowDropZone);this.view.setMaxDropZones(administration.maxDropZones);this.view.setManagePublicContacts(administration.allowManagePublicContact);this.view.setSystemPgpKeysAvailable(administration.allowSystemPgpKeyAssignment);this.view.setTemplates(administration.allowedTemplates||[]);}else{this.view.setDomainAdministrationAllowed(false);this.view.setTemplates([]);}}});jscape.domain.DomainAdministrationView=Class.extend({initialize:function(dialog){var initializing=true;this.fieldset=$("#administrationfields"+dialog.getIdSuffix()).layout({fit:true,doSize:false,border:false});this.allowed=$("input[name=domainadminallowed]:checkbox",this.fieldset);this.allowed.change($.proxy(this._onChange$Allowed,this));this.manageNonOwned=$("input[name=managenonowned]",this.fieldset);this.maxOwnedEnabled=$("input[name=maxowned]:checkbox",this.fieldset);this.maxOwnedEnabled.change($.proxy(function(){var enabled=this.maxOwnedEnabled.is(":checked");this.maxOwned.numberspinner(enabled?"enable":"disable").numberspinner(enabled?"enableValidation":"disableValidation");},this));this.maxOwned=$("input[name=maxownedcount]",this.fieldset).numberspinner({required:true,editable:false,min:1,max:1000,value:1,width:80});this.systemPgpKeysAvailable=$("input[name=systempgpkeysavailable]",this.fieldset);this.managePublicContacts=$("input[name=managepubliccontacts]",this.fieldset);this.shareQuotas=$("input[name=shareqoutas]",this.fieldset);this.templates=$("table[role=grid][aria-label=templates]",this.fieldset);this.templates.datagrid({fitColumns:true,singleSelect:false,checkOnSelect:true,selectOnCheck:true,collapsible:true,collapsed:true,width:"95%",height:"auto",minHeight:150,maxHeight:350,remoteSort:false,sortOrder:"asc",idField:"template",columns:[[{field:"allowed",checkbox:true},{field:"template",title:$("thead th:nth-child(1)",this.templates).text(),sortable:true,width:100}]],loader:$.proxy(this._onLoad$AccountTemplate,this),loadFilter:$.proxy(this._onLoadFilter$AccountTemplate,this),onBeforeLoad:function(){return!initializing;},onLoadSuccess:$.proxy(this._adjustTemplatesFieldState,this),onClickRow:$.proxy(function(index,row){if(!this.isDomainAdministrationAllowed()){var selected=$.inArray(row,this.templates.datagrid("getSelections"))!=-1;this.templates.datagrid(selected?"unselectRow":"selectRow",index);}},this),onBeforeCheck:$.proxy(function(){return this.isDomainAdministrationAllowed();},this),onBeforeUncheck:$.proxy(function(){return this.isDomainAdministrationAllowed();},this)});var tp=this.templates.datagrid("getPanel");tp.panel("header").click(function(){tp.panel(tp.panel("options").collapsed?"expand":"collapse",true);});this.restrictPathEnabled=$("input[name=restrictpath]:checkbox",this.fieldset);this.restrictPathEnabled.change($.proxy(function(){var enabled=this.restrictPathEnabled.is(":checked");this.restrictPath.textbox(enabled?"enable":"disable").textbox(enabled?"enableValidation":"disableValidation").textbox("validate");this.browsePathButton.linkbutton(enabled?"enable":"disable");},this));this.restrictPath=$("input[name=restrictpathto]",this.fieldset).textbox({required:true,disabled:true,tipPosition:"bottom",width:"65%"});this.browsePathButton=$("a[role=button][name=browse]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$BrowsePathButton,this)});this.passwordChangingAllowed=$("input[name=passwordchangingallowed]",this.fieldset);this.groupAssignmentAllowed=$("input[name=groupassignmentallowed]",this.fieldset);this.proxyMappingAllowed=$("input[name=proxymappingallowed]",this.fieldset);this.setMultiFactorAuthAllowed=$("input[name=setmultifactorauthallowed]",this.fieldset);this.dropZoneAllowed=$("input[name=dropzoneallowed]",this.fieldset);this.urlBrandingAllowed=$("input[name=urlbrandingallowed]",this.fieldset);this.maxDropZonesEnabled=$("input[name=maxdropzones]:checkbox",this.fieldset);this.maxDropZonesEnabled.change($.proxy(function(){var enabled=this.maxDropZonesEnabled.is(":checked");this.maxDropZones.numberspinner(enabled?"enable":"disable").numberspinner(enabled?"enableValidation":"disableValidation");},this));this.maxDropZones=$("input[name=maxdropzonescount]",this.fieldset).numberspinner({required:true,min:1,max:1000,value:1,width:80});this.maxUrlBrandingsEnabled=$("input[name=maxurlbrandings]:checkbox",this.fieldset);this.maxUrlBrandingsEnabled.change($.proxy(function(){var enabled=this.maxUrlBrandingsEnabled.is(":checked");this.maxUrlBrandings.numberspinner(enabled?"enable":"disable").numberspinner(enabled?"enableValidation":"disableValidation");},this));this.maxUrlBrandings=$("input[name=maxurlbrandingscount]",this.fieldset).numberspinner({required:true,editable:false,min:1,max:1000,value:1,width:80});initializing=false;},show:function(listener){this.listener=listener||jscape.domain.DomainAdministrationView.LISTENER;this.templates.datagrid("fitColumns");this._adjustFieldState();},isDomainAdministrationAllowed:function(){return this.allowed.is(":checked");},setDomainAdministrationAllowed:function(value){this.allowed.prop("checked",!!value).change();},getMaxOwnedUsers:function(){return this.maxOwnedEnabled.is(":checked")?this.maxOwned.numberspinner("getValue"):null;},setMaxOwnedUsers:function(value){this.maxOwnedEnabled.prop("checked",value!=null).change();if(value!=null){this.maxOwned.numberspinner("setValue",value);}else{this.maxOwned.numberspinner("reset");}},getManageNonOwnedUsersAllowed:function(){return this.manageNonOwned.is(":checked");},setManageNonOwnedUsersAllowed:function(value){this.manageNonOwned.prop("checked",!!value);},isPasswordChangingAllowed:function(){return this.passwordChangingAllowed.is(":checked");},setPasswordChangingAllowed:function(value){this.passwordChangingAllowed.prop("checked",!!value);},getGroupAssignmentAllowed:function(){return this.groupAssignmentAllowed.is(":checked");},setGroupAssignmentAllowed:function(value){this.groupAssignmentAllowed.prop("checked",!!value);},getProxyMappingAllowed:function(){return this.proxyMappingAllowed.is(":checked");},setProxyMappingAllowed:function(value){this.proxyMappingAllowed.prop("checked",!!value);},getRestrictionPath:function(){return this.restrictPathEnabled.is(":checked:not(:disabled)")?this.restrictPath.textbox("getValue"):null;},setRestrictionPath:function(value){if(value!=null){this.restrictPathEnabled.prop("checked",true).change();this.restrictPath.textbox("setValue",value).textbox("textbox").focus();}else{this.restrictPathEnabled.prop("checked",false).change();this.restrictPath.textbox("reset");}},getShareQuotas:function(){return this.shareQuotas.is(":checked");},setShareQuotas:function(value){this.shareQuotas.prop("checked",!!value);},getMultiFactorAuthSettingsAllowed:function(){return this.setMultiFactorAuthAllowed.is(":checked");},setMultiFactorAuthSettingsAllowed:function(value){this.setMultiFactorAuthAllowed.prop("checked",!!value);},getUrlBrandingAllowed:function(){return this.urlBrandingAllowed.is(":checked");},setUrlBrandingAllowed:function(value){this.urlBrandingAllowed.prop("checked",!!value);},getMaxUrlBranding:function(){return this.maxUrlBrandingsEnabled.is(":checked")?this.maxUrlBrandings.numberspinner("getValue"):null;},setMaxUrlBranding:function(value){this.maxUrlBrandingsEnabled.prop("checked",value!=null).change();if(value!=null){this.maxUrlBrandings.numberspinner("setValue",value);}else{this.maxUrlBrandings.numberspinner("reset");}},getDropZoneAllowed:function(){return this.dropZoneAllowed.is(":checked");},setDropZoneAllowed:function(value){this.dropZoneAllowed.prop("checked",!!value);},getMaxDropZones:function(){return this.maxDropZonesEnabled.is(":checked")?this.maxDropZones.numberspinner("getValue"):null;},setMaxDropZones:function(value){this.maxDropZonesEnabled.prop("checked",value!=null).change();if(value!=null){this.maxDropZones.numberspinner("setValue",value);}else{this.maxDropZones.numberspinner("reset");}},getManagePublicContacts:function(){return this.managePublicContacts.is(":checked")},setManagePublicContacts:function(value){this.managePublicContacts.prop("checked",!!value);},getSystemPgpKeysAvailable:function(){return this.systemPgpKeysAvailable.is(":checked")},setSystemPgpKeysAvailable:function(value){this.systemPgpKeysAvailable.prop("checked",!!value);},getTemplates:function(){var idField=this.templates.datagrid("options").idField;return $.map(this.templates.datagrid("getChecked"),function(row){return row[idField];});},setTemplates:function(values){values=values||[];this.templates.datagrid("clearChecked").datagrid("reload",$.proxy(function(){for(var i=0;i<values.length;++i){var index=this.templates.datagrid("getRowIndex",values[i]);if(index!=-1){this.templates.datagrid("checkRow",index);}}},this));},_onLoad$AccountTemplate:function(params,success,error){this.listener.onLoadAccountTemplates(params).then(success,error);},_onLoadFilter$AccountTemplate:function(data){return $.map($.isArray(data)?data:data.rows,function(value){return{template:value};});},_onClick$BrowsePathButton:function(){this.browsePathButton.linkbutton("disable");this.listener.onSelectPath(this).done($.proxy(function(path){this.setRestrictionPath(path);},this)).always($.proxy(function(){this.browsePathButton.linkbutton("enable");},this));},_onChange$Allowed:function(){if(this.allowed.is(":checked")&&this.allowed.data("_initValue")!==true){this.allowed.data("_initValue",true);this._initDefaults();}
this._adjustFieldState();},_adjustFieldState:function(){var allowed=this.isDomainAdministrationAllowed();this.fieldset.find("input:checkbox").not(this.allowed).prop("disabled",!allowed);var ownedEnabled=allowed&&this.maxOwnedEnabled.is(":checked");var pathEnabled=allowed&&this.restrictPathEnabled.is(":checked");var brandingEnabled=allowed&&this.maxUrlBrandingsEnabled.is(":checked");var zoneEnabled=allowed&&this.maxDropZonesEnabled.is(":checked");this.maxOwned.numberspinner(ownedEnabled?"enable":"disable").numberspinner(ownedEnabled?"enableValidation":"disableValidation");this.restrictPath.textbox(pathEnabled?"enable":"disable").textbox(pathEnabled?"enableValidation":"disableValidation");this.browsePathButton.linkbutton(pathEnabled?"enable":"disable");this.maxDropZones.numberspinner(zoneEnabled?"enable":"disable").numberspinner(allowed?"enableValidation":"disableValidation");this.maxUrlBrandings.numberspinner(brandingEnabled?"enable":"disable").numberspinner(allowed?"enableValidation":"disableValidation");this._adjustTemplatesFieldState();this.fieldset.form("validate");},_adjustTemplatesFieldState:function(){var allowed=this.isDomainAdministrationAllowed();var rows=this.templates.datagrid("getRows");var opts=this.templates.datagrid("options");var enabled=rows.length!=0&&allowed;for(var i=0;i<rows.length;i++){var tr=opts.finder.getTr(this.templates[0],i);tr.find("input:checkbox").prop("disabled",!enabled);}
this.templates.datagrid("getPanel").find("div.datagrid-header-check input:checkbox").prop("disabled",!enabled);},_initDefaults:function(){if(this.restrictPath.textbox("getValue").trim().length==0){this.listener.onInitDefaults(this);}}});jscape.domain.DomainAdministrationView.LISTENER={onLoadAccountTemplates:$.noop,onSelectPath:$.noop};jscape.domain.WebOptionsController=Class.extend({options:null,initialize:function(dialog){this.view=new jscape.domain.WebOptionsView(dialog);},start:function(webOptions){this.options=webOptions||new jscape.WebOptions();this.view.show(this);this._setupView();},getWebOptions:function(){return new jscape.WebOptions(this.view.getLoginRedirection(),this.view.getShowAccountLink(),this.view.getShowPersonalInfo(),this.view.getShowPublicKeyAuthentication(),this.view.getShowPgpEncryption(),this.view.getShowQuotas(),this.view.getShowContacts(),this.view.getShowAdHocActivity(),this.view.getShowDropZones());},_setupView:function(){this.view.setLoginRedirection(this.options.loginRedirection);this.view.setShowAccountLink(this.options.webAccountLinkAvailable);this.view.setShowPersonalInfo(this.options.webPersonalInformationAvailable);this.view.setShowPublicKeyAuthentication(this.options.webPublicKeyAuthenticationAvailable);this.view.setShowPgpEncryption(this.options.webOpenPgpEncryptionAvailable);this.view.setShowQuotas(this.options.webQuotasAvailable);this.view.setShowContacts(this.options.webContactsAvailable);this.view.setShowAdHocActivity(this.options.webAdHocActivityAvailable);this.view.setShowDropZones(this.options.webDropZonesAvailable);}});jscape.domain.WebOptionsView=Class.extend({initialize:function(dialog){this.fieldset=$("#weboptionsfields"+dialog.getIdSuffix());this.loginRedirection=$("select[name=loginredirect]",this.fieldset).combobox({required:true,editable:false,width:130,panelHeight:"auto"});this.showAccountLink=$("input[name=showaccountlink]",this.fieldset);this.showPersonalInfo=$("input[name=showpersonalinfo]",this.fieldset);this.showPublicKeyAuth=$("input[name=showpubkeyauth]",this.fieldset);this.showPgpEncryption=$("input[name=showpgpencrypt]",this.fieldset);this.showQuotas=$("input[name=showquotas]",this.fieldset);this.showContacts=$("input[name=showcontacts]",this.fieldset);this.showAdHocActivity=$("input[name=showadhoc]",this.fieldset);this.showDropZones=$("input[name=showdropzones]",this.fieldset);},show:function(listener){this.listener=listener||jscape.domain.WebOptionsView.LISTENER;},reset:function(){this.loginRedirection.combobox("reset");},getLoginRedirection:function(){return this.loginRedirection.combobox("getValue");},setLoginRedirection:function(value){this.loginRedirection.combobox("setValue",value);},getShowAccountLink:function(){return this.showAccountLink.is(":checked");},setShowAccountLink:function(value){this.showAccountLink.prop("checked",!!value);},getShowPersonalInfo:function(){return this.showPersonalInfo.is(":checked");},setShowPersonalInfo:function(value){this.showPersonalInfo.prop("checked",!!value);},getShowPublicKeyAuthentication:function(){return this.showPublicKeyAuth.is(":checked");},setShowPublicKeyAuthentication:function(value){this.showPublicKeyAuth.prop("checked",!!value);},getShowPgpEncryption:function(){return this.showPgpEncryption.is(":checked");},setShowPgpEncryption:function(value){this.showPgpEncryption.prop("checked",!!value);},getShowQuotas:function(){return this.showQuotas.is(":checked");},setShowQuotas:function(value){this.showQuotas.prop("checked",!!value);},getShowContacts:function(){return this.showContacts.is(":checked");},setShowContacts:function(value){this.showContacts.prop("checked",!!value);},getShowAdHocActivity:function(){return this.showAdHocActivity.is(":checked");},setShowAdHocActivity:function(value){this.showAdHocActivity.prop("checked",!!value);},getShowDropZones:function(){return this.showDropZones.is(":checked");},setShowDropZones:function(value){this.showDropZones.prop("checked",!!value);}});jscape.domain.WebOptionsView.LISTENER={};jscape.domain.AdHocTransferPermissionsController=Class.extend({start:function(data){this.deferred=$.Deferred();this._setupDialog(data).show(this);return this.deferred.promise();},onSubmit:function(dialog){var data=dialog.getPermissions();dialog.destroy();this.deferred.resolve(data);this.deferred=null;},onCancel:function(dialog){dialog.destroy();this.deferred.reject();this.deferred=null;},_setupDialog:function(data){var d=new jscape.domain.AdHocTransferPermissionsDialog();d.setPermissions(data);return d;}});jscape.domain.AdHocTransferPermissionsDialog=jscape.ui.DefaultDialog.extend({initialize:function(){this._super($("#d-adhoc-settings"),{width:530,minHeight:270});this.permissions=$("input[name=permissions]",this.dialog);},getPermissions:function(){var data=[];this.permissions.each(function(){if($(this).is(":checked")){data.push($(this).val());}});return data;},setPermissions:function(values){this.permissions.each(function(){var found=$.inArray($(this).val(),values||[])!=-1;$(this).prop("checked",found);});}});