/* Copyright Â© 2009-2024. Redwood Software Inc. All rights reserved. */
jscape.domain=jscape.domain||{};jscape.ConnectionStatistics=Class.extend({initialize:function(a,b,c,d,e,f,g,h,i){this.type=a||"";this.creationTime=parseInt(b)||0;this.upTimeMillis=parseInt(c)||0;this.localAddress=d||"";this.localPort=parseInt(e)||0;this.remoteAddress=f||"";this.remotePort=parseInt(g)||0;this.username=h||"";this.path=i||"";}});jscape.ConnectionStatistics.fromJSON=function(data){return $.extend(new jscape.ConnectionStatistics(),data);};jscape.DomainUsageSummary=Class.extend({initialize:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){this.applicationId=a||"";this.domainName=b||"";this.startDate=parseInt(c)||0;this.endDate=parseInt(d)||0;this.domainStartDate=parseInt(e)||0;this.domainStopDate=parseInt(f)||0;this.users=jscape.DomainUsageSummary.Users.fromJSON(g);this.transfers=jscape.DomainUsageSummary.Transfers.fromJSON(h);this.tradingPartners=jscape.DomainUsageSummary.TradingPartners.fromJSON(i);this.triggers=jscape.DomainUsageSummary.Triggers.fromJSON(j);this.directoryMonitors=jscape.DomainUsageSummary.DirectoryMonitors.fromJSON(k);this.adHocTransfers=jscape.DomainUsageSummary.AdHocTransfers.fromJSON(l);this.networkStorages=jscape.DomainUsageSummary.NetworkStorages.fromJSON(m);this.as2Messages=jscape.DomainUsageSummary.As2Messages.fromJSON(n);this.oftpMessages=jscape.DomainUsageSummary.OftpMessages.fromJSON(o);}});jscape.DomainUsageSummary.fromJSON=function(data){return data?$.extend(new jscape.DomainUsageSummary(),data):null;};jscape.DomainUsageSummary.Users=Class.extend({initialize:function(a,b,c,d,e){this.count=parseInt(a)||0;this.failedLogins=parseInt(b)||0;this.successfulLogins=parseInt(c)||0;this.currentConnections=parseInt(d)||0;this.totalConnectionsSinceStart=parseInt(e)||0;}});jscape.DomainUsageSummary.Users.fromJSON=function(data){return data?new jscape.DomainUsageSummary.Users(data.count,data.failedLogins,data.successfulLogins,data.currentConnections,data.totalConnectionsSinceStart):new jscape.DomainUsageSummary.Users();};jscape.DomainUsageSummary.Transfers=Class.extend({initialize:function(a,b,c,d,e){this.count=parseInt(a)||0;this.failedLogins=parseInt(b)||0;this.successfulLogins=parseInt(c)||0;this.currentConnections=parseInt(d)||0;this.totalConnectionsSinceStart=parseInt(e)||0;this.fileUploadCount=parseInt(a)||0;this.fileUploadBytes=parseInt(a)||0;this.fileDownloadCount=parseInt(a)||0;this.fileDownloadBytes=parseInt(a)||0;this.failedUploads=parseInt(a)||0;this.failedDownloads=parseInt(a)||0;this.currentTransfers=parseInt(a)||0;this.totalUploadsSinceStart=parseInt(a)||0;this.totalUploadBytesSinceStart=parseInt(a)||0;this.totalDownloadsSinceStart=parseInt(a)||0;this.totalDownloadBytesSinceStart=parseInt(a)||0;this.uploadsQuota=parseInt(a)||null;this.currentUploadedBytes=parseInt(a)||null;this.downloadsQuota=parseInt(a)||null;this.currentDownloadedBytes=parseInt(a)||null;this.transfersQuota=parseInt(a)||null;this.currentTransferredBytes=parseInt(a)||null;}});jscape.DomainUsageSummary.Transfers.fromJSON=function(data){return data?new jscape.DomainUsageSummary.Transfers(data.fileUploadCount,data.fileUploadBytes,data.fileDownloadCount,data.fileDownloadBytes,data.failedUploads,data.failedDownloads,data.currentTransfers,data.totalUploadsSinceStart,data.totalUploadBytesSinceStart,data.totalDownloadsSinceStart,data.totalDownloadBytesSinceStart,data.uploadsQuota,data.currentUploadedBytes,data.downloadsQuota,data.currentDownloadedBytes,data.transfersQuota,data.currentTransferredBytes):new jscape.DomainUsageSummary.Transfers();};jscape.DomainUsageSummary.TradingPartners=Class.extend({initialize:function(a){this.count=parseInt(a)||0;}});jscape.DomainUsageSummary.TradingPartners.fromJSON=function(data){return new jscape.DomainUsageSummary.TradingPartners(data?data.count:undefined);};jscape.DomainUsageSummary.Triggers=Class.extend({initialize:function(a,b,c,d){this.count=parseInt(a)||0;this.actionsCount=parseInt(b)||0;this.successfulExecutions=parseInt(c)||0;this.failedExecutions=parseInt(d)||0;}});jscape.DomainUsageSummary.Triggers.fromJSON=function(data){return data?new jscape.DomainUsageSummary.Triggers(data.count,data.actionsCount,data.successfulExecutions,data.failedExecutions):new jscape.DomainUsageSummary.Triggers();};jscape.DomainUsageSummary.DirectoryMonitors=Class.extend({initialize:function(a){this.count=parseInt(a)||0;}});jscape.DomainUsageSummary.DirectoryMonitors.fromJSON=function(data){return new jscape.DomainUsageSummary.DirectoryMonitors(data?data.count:undefined);};jscape.DomainUsageSummary.AdHocTransfers=Class.extend({initialize:function(a,b){this.count=parseInt(a)||0;this.fileCount=parseInt(b)||0;}});jscape.DomainUsageSummary.AdHocTransfers.fromJSON=function(data){return new jscape.DomainUsageSummary.AdHocTransfers(data?data.count:undefined,data?data.fileCount:undefined);};jscape.DomainUsageSummary.NetworkStorages=Class.extend({initialize:function(a){this.count=parseInt(a)||0;}});jscape.DomainUsageSummary.NetworkStorages.fromJSON=function(data){return new jscape.DomainUsageSummary.NetworkStorages(data?data.count:undefined);};jscape.DomainUsageSummary.As2Messages=Class.extend({initialize:function(a,b){this.inboundMessageCount=parseInt(a)||0;this.outboundMessageCount=parseInt(b)||0;}});jscape.DomainUsageSummary.As2Messages.fromJSON=function(data){return data?new jscape.DomainUsageSummary.As2Messages(data.inboundMessageCount,data.outboundMessageCount):new jscape.DomainUsageSummary.As2Messages();};jscape.DomainUsageSummary.OftpMessages=Class.extend({initialize:function(a,b){this.inboundMessageCount=parseInt(a)||0;this.outboundMessageCount=parseInt(b)||0;}});jscape.DomainUsageSummary.OftpMessages.fromJSON=function(data){return data?new jscape.DomainUsageSummary.OftpMessages(data.inboundMessageCount,data.outboundMessageCount):new jscape.DomainUsageSummary.OftpMessages();};jscape.domain.StatisticsModule=jscape.domain.DomainModule.extend({DEFAULT_DELAY:10*1000,DATE_RANGE:7*24*60*60*1000,view:null,timerId:null,delay:0,initialize:function(dsa){this.dsa=!!dsa;},onCreate:function(){this._super.apply(this,arguments);this._initValidators();},onStart:function(){if(this.view==null){this.view=new jscape.domain.DomainUsageView(this.dsa);}
this.view.show(this);$(document).on("domainstatechange",$.proxy(this.onChangeDomainState,this));},onStop:function(){$(document).off("domainstatechange");this._stopPoll();this.view.hide();},onResume:function(){this.delay=this.DEFAULT_DELAY;if(this.view.valid()){this._poll();}},onPause:function(){this._stopPoll();},onChangeDomainState:function(){this.view.refresh();},onChangeRange:function(){if(this.view.valid()){this.view.refresh();}else{this._stopPoll();}},onLoadData:function(startTime,endTime){return jscape.API.getDomainUsage(this.domainName,startTime,endTime).done($.proxy(function(){this.delay=this.DEFAULT_DELAY;},this)).fail($.proxy(function(){this.delay*=2;},this));},onExport:function(startTime,endTime){return new jscape.domain.ExportDomainUsageController().start(this.domainName,startTime,endTime);},_poll:function(delay){this._stopPoll();this.timerId=setTimeout($.proxy(function(){this.timerId=null;this.view.refresh();this._poll(this.delay);},this),delay||0);},_stopPoll:function(){if(this.timerId){clearTimeout(this.timerId);}},_initValidators:function(){var v=new jscape.Validator();v.rule("date_range",$.proxy(this._validDateRange,this),window.R.string.DOMAIN_STATS_ERROR_DATE_RANGE);},_validDateRange:function(_){if(!this.view){return true;}
var s=this.view.getStartTime();var e=this.view.getEndTime();return(s!=null&&e!=null&&s<=e)||!e;}});jscape.domain.DomainUsageView=jscape.ui.DatagridView.extend({DATE_RANGE:7*24*60*60*1000,initialize:function(suffix){var initializing=true;this.sizeFormat=new jscape.SizeFormat();this.fieldset=$("#domain-usage-fields"+(suffix||"")).layout({fit:true,doSize:false,border:false});this.status=$("#domain-status-info"+(suffix||""));this.data=$("table[role=grid][aria-label=metrics]",this.fieldset);this.data.datagrid({fit:true,fitColumns:true,singleSelect:true,remoteSort:false,sortName:"category",idField:"__id",columns:[[{field:"category",title:$("thead th:nth-child(1)",this.data).text(),sortable:true,width:"25%"},{field:"metric",title:$("thead th:nth-child(2)",this.data).text(),sortable:true,width:"45%",formatter:$.proxy(this._formatMetric,this)},{field:"value",title:$("thead th:nth-child(3)",this.data).text(),sortable:true,width:"30%",formatter:$.proxy(this._formatValue,this)}]],onRowContextMenu:$.proxy(this._onRow$ContextMenu,this),loader:$.proxy(this._onLoad$Data,this),loadFilter:$.proxy(this._onFilter$Data,this),onBeforeLoad:$.proxy(function(t){return t&&t.length&&!initializing;},this,this.data),onLoadSuccess:$.proxy(this._adjustButtonsState,this),onLoadError:$.proxy(this._adjustButtonsState,this)});var tb=$("#domain-statistics-filter"+(suffix||""));this.startDate=tb.find("[name=startdate]").datebox({validType:"date_range",novalidate:true,onChange:$.proxy(this._onChange$DateRange,this)});this.endDate=tb.find("[name=enddate]").datebox({validType:"date_range",novalidate:true,onChange:$.proxy(this._onChange$DateRange,this)});this.exportButton=$("a[role=button][name=export]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$ExportButton,this)});initializing=false;},show:function(listener){this.listener=listener||jscape.domain.DomainUsageView.LISTENER;this.fieldset.layout("resize");this._adjustButtonsState();this.startDate.datebox("setDate",new Date(new Date().getTime()-this.DATE_RANGE));this.endDate.datebox("setDate",new Date());this.startDate.datebox("options").novalidate=false;this.endDate.datebox("options").novalidate=false;},hide:function(){this.listener=null;},refresh:function(){if(this.data.length){this._super.apply(this,arguments);}},valid:function(){return!(!this.startDate.datebox("isValid")||!this.endDate.datebox("isValid"));},getStartTime:function(){var date=this.startDate.datebox("getDate");return date?date.getTime():null;},getEndTime:function(){var date=this.endDate.datebox("getDate");return date?new Date(date.getFullYear(),date.getMonth(),date.getDate(),23,59,59).getTime():null;},_formatDate:function(value){return value?new Date(value).toLocaleString():"";},_formatSize:function(value){return!isNaN(value)?this.sizeFormat.format(value):"";},_formatDomainStatus:function(data){if(data.domainStartDate!=null&&data.domainStopDate==null){return window.R.string.DOMAIN_STATS_STATUS_STARTED.supplant({0:this._formatDate(data.domainStartDate)});}else if(data.domainStopDate!=null){return window.R.string.DOMAIN_STATS_STATUS_STOPPED.supplant({0:this._formatDate(data.domainStopDate)});}else{return"";}},_formatMetric:function(_,row){return row.displayMetric;},_formatValue:function(_,row){return row.displayValue;},_formatCategoryMetrics:function(data,category){return $.map(data,$.proxy(function(value,key){var metric="DOMAIN_STATS_METRIC_"+key.replace(/([a-z])([A-Z0-9])/g,"$1_$2").toUpperCase();return{category:category,metric:metric,value:value,displayMetric:window.R.string[metric]||metric,displayValue:/^.+(quota)$/i.test(metric)?this._formatSize(value):value};},this));},_onChange$DateRange:function(){if(this.listener){this.listener.onChangeRange(this.getStartTime(),this.getEndTime());this._adjustButtonsState();}},_onClick$ExportButton:function(){this.exportButton.linkbutton("disable");this.listener.onExport(this.getStartTime(),this.getEndTime()).always($.proxy(function(){this.exportButton.linkbutton("enable");},this));},_onLoad$Data:function(params,success,error){this.listener.onLoadData(this.getStartTime(),this.getEndTime()).then($.proxy(function(data){this.status.text(this._formatDomainStatus(data));return data;},this)).then(success,error);},_onFilter$Data:function(data){var rows=[];rows=rows.concat(this._formatCategoryMetrics(data.users,window.R.string.DOMAIN_STATS_CATEGORY_USERS));rows=rows.concat(this._formatCategoryMetrics(data.transfers,window.R.string.DOMAIN_STATS_CATEGORY_TRANSFERS));rows=rows.concat(this._formatCategoryMetrics(data.tradingPartners,window.R.string.DOMAIN_STATS_CATEGORY_PARTNERS));rows=rows.concat(this._formatCategoryMetrics(data.triggers,window.R.string.DOMAIN_STATS_CATEGORY_TRIGGERS));rows=rows.concat(this._formatCategoryMetrics(data.directoryMonitors,window.R.string.DOMAIN_STATS_CATEGORY_DIR_MONITORS));rows=rows.concat(this._formatCategoryMetrics(data.adHocTransfers,window.R.string.DOMAIN_STATS_CATEGORY_ADHOC));rows=rows.concat(this._formatCategoryMetrics(data.networkStorages,window.R.string.DOMAIN_STATS_CATEGORY_NETWORK_STORAGE));rows=rows.concat(this._formatCategoryMetrics(data.as2Messages,window.R.string.DOMAIN_STATS_CATEGORY_AS2));rows=rows.concat(this._formatCategoryMetrics(data.oftpMessages,window.R.string.DOMAIN_STATS_CATEGORY_OFTP));$.each(rows,function(row){row.__id=btoa(""+row.category+row.metric);});return{rows:rows,total:rows.length};},_adjustButtonsState:function(){var rows=this.data.datagrid("getRows");this.exportButton.linkbutton(rows&&rows.length&&this.valid()?"enable":"disable");},_showContextMenu:function(e){this._super(e,[this.exportButton]);}});jscape.domain.DomainUsageView.LISTENER={onChangeRange:$.noop,onLoadData:$.noop,onExport:$.noop};jscape.domain.ExportDomainUsageController=Class.extend({deferred:null,start:function(domainName,startTime,endTime){this.domainName=domainName;this.startTime=startTime;this.endTime=endTime;this.deferred=$.Deferred();this._setupDialog().show(this);return this.deferred.promise();},onSubmit:function(dialog){return jscape.API.exportDomainUsage(this.domainName,dialog.getFilename(),this.startTime,this.endTime).done($.proxy(function(){this.deferred.resolve();this.deferred=null;},this));},onCancel:function(dialog){dialog.destroy();this.deferred.reject();this.deferred=null;},_setupDialog:function(){var dialog=new jscape.domain.ExportDomainUsageDialog();dialog.setFilename("statistics.json");return dialog;}});jscape.domain.ExportDomainUsageDialog=jscape.ui.DefaultDialog.extend({initialize:function(){this._super($("#d-statistics-export"),{width:530});this.fieldset=$("fieldset[name=exportstatsfields]",this.dialog);this.filename=$("input[name=filename]",this.fieldset).textbox({required:true,width:"55%"});},getFilename:function(){return this.filename.textbox("getValue");},setFilename:function(value){this.filename.textbox("setValue",value);},show:function(listener){this._super(listener);this.filename.textbox("textbox").focus();}});jscape.domain.SessionsModule=jscape.domain.DomainModule.extend({DEFAULT_DELAY:5*1000,view:null,timerId:null,delay:0,onStart:function(){if(this.view==null){this.view=new jscape.domain.SessionsView();}
this.view.show(this);},onStop:function(){this._stopPoll();},onResume:function(){this.delay=this.DEFAULT_DELAY;this._poll();},onPause:function(){this._stopPoll();},onLoadData:function(){return jscape.API.getDomainConnections(this.domainName).done($.proxy(function(){this.delay=this.DEFAULT_DELAY;},this)).fail($.proxy(function(){this.delay*=2;},this));},onCloseConnection:function(session){return new jscape.domain.CloseSessionController().start(this.domainName,session).done($.proxy(this._poll,this));},onUpdateAgent:function(session){return new jscape.domain.UpdateAgentAppController().start(this.domainName,session).done($.proxy(this._poll,this));},_poll:function(delay){this._stopPoll();this.timerId=setTimeout($.proxy(function(){this.timerId=null;this.view.refresh();this._poll(this.delay);},this),delay||0);},_stopPoll:function(){if(this.timerId){clearTimeout(this.timerId);}}});jscape.domain.SessionsView=jscape.ui.DatagridView.extend({initialize:function(suffix){var initializing=true;this.timeFormat=new jscape.DateFormat("{hh}:{mm}:{ss}");this.fieldset=$("#sessions-fields"+(suffix||"")).layout({fit:true,doSize:false,border:false});this.data=$("table[role=grid][aria-label=sessions]",this.fieldset);this.data.datagrid({fit:true,fitColumns:true,singleSelect:true,remoteSort:false,sortName:"type",idField:"__id",columns:[[{field:"type",title:$("thead th:nth-child(1)",this.data).text(),sortable:true,width:"10%"},{field:"localAddress",title:$("thead th:nth-child(2)",this.data).text(),sortable:true,width:"13%",formatter:$.proxy(function(_,row){return this._formatServerAddress(row);},this)},{field:"remoteAddress",title:$("thead th:nth-child(3)",this.data).text(),sortable:true,width:"13%",formatter:$.proxy(function(_,row){return this._formatClientAddress(row);},this)},{field:"username",title:$("thead th:nth-child(4)",this.data).text(),sortable:true,width:"10%"},{field:"creationTime",title:$("thead th:nth-child(5)",this.data).text(),sortable:true,width:"14%",align:"right",formatter:$.proxy(function(_,row){return this._formatCreationTime(row);},this),sorter:$.proxy(this._compareDateTime,this)},{field:"uptime",title:$("thead th:nth-child(6)",this.data).text(),sortable:false,width:"10%",align:"right",formatter:$.proxy(function(_,row){return this._formatUptime(row);},this)},{field:"path",title:$("thead th:nth-child(7)",this.data).text(),sortable:false,width:"16%"},{field:"agentApplicationVersion",title:$("thead th:nth-child(8)",this.data).text(),sortable:false,width:"14%",align:"right"}]],onSelect:$.proxy(this._adjustButtonsState,this),onSelectAll:$.proxy(this._adjustButtonsState,this),onUnselect:$.proxy(this._adjustButtonsState,this),onUnselectAll:$.proxy(this._adjustButtonsState,this),onRowContextMenu:$.proxy(this._onRow$ContextMenu,this),loader:$.proxy(this._onLoad$Data,this),loadFilter:$.proxy(this._onFilter$Data,this),onBeforeLoad:$.proxy(function(){return this.data.length&&!initializing;},this),onLoadSuccess:$.proxy(function(data){if(data.rows&&data.rows.length==0){this.data.datagrid("clearSelections");}
this._adjustButtonsState();},this),onLoadError:$.proxy(this._adjustButtonsState,this)});this.closeButton=$("a[role=button][name=close]",this.fieldset).linkbutton({onClick:$.proxy(this._onClick$CloseButton,this)});this.updateAgentButton=$("a[role=button][name=updateagent]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$UpdateAgentButton,this)});initializing=false;},show:function(listener){this.listener=listener||jscape.domain.SessionsView.LISTENER;this.fieldset.layout("resize");this._adjustButtonsState();},hide:function(){this.listener=null;},refresh:function(){if(this.data.length){this._super.apply(this,arguments);}},_formatCreationTime:function(stats){return new Date(stats.creationTime).toLocaleString();},_formatUptime:function(stats){return this.timeFormat.format(new Date(0,0,1,0,0,stats.upTimeMillis/1000));},_formatServerAddress:function(stats){return(stats.localAddress+":"+stats.localPort).escapeXml();},_formatClientAddress:function(stats){return(stats.remoteAddress+":"+stats.remotePort).escapeXml();},_compareDateTime:function(o1,o2){o1=parseInt(o1);o2=parseInt(o2);return isNaN(o1)?(isNaN(o2)?0:1):(isNaN(o2)?1:(o1==o2?0:o1>o2?1:-1));},_onLoad$Data:function(params,success,error){this.listener.onLoadData(params).then(success,error);},_onFilter$Data:function(data){$.each($.isArray(data.rows)?data.rows:data,function(_,row){row.__id=btoa(""+row.type+row.localAddress+row.localPort+row.remoteAddress+row.remotePort);});return data;},_onClick$CloseButton:function(){var row=this.data.datagrid("getSelected");if(row==null){return;}
var opts=this.data.datagrid("options");this.closingConnectionId=row[opts.idField];this.closeButton.linkbutton("disable");this.listener.onCloseConnection(row).done($.proxy(function(){this.deleteRecord(row);},this)).always($.proxy(function(){this.closingConnectionId=null;this._adjustButtonsState();},this));},_onClick$UpdateAgentButton:function(){var row=this.data.datagrid("getSelected");if(row==null){return;}
var opts=this.data.datagrid("options");this.updatingAgentId=row[opts.idField];this.updateAgentButton.linkbutton("disable");this.listener.onUpdateAgent(row).done($.proxy(function(){this.deleteRecord(row);},this)).always($.proxy(function(){this.updatingAgentId=null;this._adjustButtonsState();},this));},_showContextMenu:function(e){this._super(e,[this.closeButton,this.updateAgentButton]);},_adjustButtonsState:function(){this.closeButton.linkbutton("disable");this.updateAgentButton.linkbutton("disable");var row=this.data.datagrid("getSelected");if(row!=null){var opts=this.data.datagrid("options");if(this.closingConnectionId!==row[opts.idField]){this.closeButton.linkbutton("enable");}
if(/agent/ig.test(row.type)&&this.updatingAgentId!==row[opts.idField]){this.updateAgentButton.linkbutton("enable");}}}});jscape.domain.SessionsView.LISTENER={onLoadData:$.noop,onCloseConnection:$.noop,onUpdateAgent:$.noop};jscape.domain.CloseSessionController=Class.extend({deferred:null,start:function(domainName,stats){this.domainName=domainName;this.stats=stats;this.deferred=$.Deferred();this._setupDialog(stats).show(this);return this.deferred.promise();},onSubmit:function(dialog){var scope=dialog.getScope();return jscape.API.closeConnection(this.domainName,this.stats,scope).done($.proxy(function(){this.deferred.resolve();this.deferred=null;},this));},onCancel:function(dialog){dialog.destroy();this.deferred.reject();this.deferred=null;},_setupDialog:function(stats){var dialog=new jscape.domain.CloseSessionDialog();dialog.setStatistics(stats);return dialog;}});jscape.domain.CloseSessionDialog=jscape.ui.DefaultDialog.extend({initialize:function(){this._super($("#d-sessions-close"),{width:530,resizable:false});this.fieldset=$("fieldset[name=closesessionfields]",this.dialog);this.scope=$("input[name=scope]:radio",this.fieldset);},getScope:function(){return this.scope.filter(":checked").val();},setStatistics:function(stats){this._adjustLabel(this.scope.filter("[value=CURRENT_SESSION]"),{0:stats.remoteAddress,1:stats.remotePort,2:stats.localAddress,3:stats.localPort});this._adjustLabel(this.scope.filter("[value=ALL_USER_SESSIONS]"),{0:stats.username}).prop("disabled",stats.username.trim().length==0);this._adjustLabel(this.scope.filter("[value=ALL_CLIENT_IP_SESSIONS]"),{0:stats.remoteAddress});this._adjustLabel(this.scope.filter("[value=ALL_SERVICE_SESSIONS]"),{0:stats.localAddress,1:stats.localPort});this.scope.first().prop("checked",true);},_adjustLabel:function(radio,args){var node=$(radio[0].nextSibling);node.replaceWith(node.text().supplant(args));return radio;}});jscape.domain.UpdateAgentAppController=Class.extend({start:function(domainName,session){if(!(session&&/agent/ig.test(session.type))){return $.Deferred().reject().promise();}
var agentName=session.username;return this._confirmUpdateApp(session).then(function(){return jscape.API.updateAgent(domainName,agentName);}).then($.proxy(function(){this._fireMessage(window.R.string.AGENT_INSTALLER_SUCCESS_UPDATE);return this._confirmStartApp(session).then(function(){return jscape.API.startAgent(domainName,agentName);}).done($.proxy(this._fireMessage,this,window.R.string.AGENT_INSTALLER_SUCCESS_START));},this));},_confirmUpdateApp:function(session){return jscape.ConfirmDialog.confirm(window.R.string.AGENT_CONFIRM_UPDATE_TITLE,window.R.string.AGENT_CONFIRM_UPDATE_MESSAGE.supplant({0:session.username}));},_confirmStartApp:function(session){return jscape.ConfirmDialog.confirm(window.R.string.AGENT_CONFIRM_START_TITLE,window.R.string.AGENT_CONFIRM_START_MESSAGE.supplant({0:session.username}));},_fireMessage:function(message){$(document).triggerHandler("broadcast",[message]);}});