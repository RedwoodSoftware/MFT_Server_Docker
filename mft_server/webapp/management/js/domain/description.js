/* Copyright Â© 2009-2024. Redwood Software Inc. All rights reserved. */
jscape.domain=jscape.domain||{};jscape.domain.DescriptionModule=jscape.domain.DomainModule.extend({view:null,description:null,initialize:function(dca){this.allowed=!!dca;},onCreate:function(){this._super.apply(this,arguments);this._initValidators();},onStart:function(){if(this.view==null){this.view=new jscape.domain.DescriptionView();}
this.view.show(this);},onResume:function(){this.view.refresh();},onPause:function(){if(this.hasChanged()){this._confirmAndApply(this);}},onRefresh:function(){return jscape.API.getDomainDescription(this.domainName).done($.proxy(function(value){this.description=value;},this)).done($.proxy(this._setupView,this));},onApply:function(){if(!this.allowed||!this.view.valid()){return $.Deferred().reject().promise();}
var description=this.view.getDescription();return jscape.API.setDomainDescription(this.domainName,description).done($.proxy(function(){this.description=description;this._fireApplySuccess();},this));},onDiscard:function(){this.description=null;this.view.refresh();},onChange:function(){return $.Deferred().resolve(this.hasChanged()).promise();},hasChanged:function(){return this.description!=null&&this.description!=this.view.getDescription();},_setupView:function(desc){this.view.setDescription(desc||"");},_initValidators:function(){var v=new jscape.Validator();v.rule("domain_description",$.proxy(this._validateDescription,this),window.R.string.DOMAIN_ERROR_DESCRIPTION_TOO_LONG);},_validateDescription:function(value){return typeof value!=="string"||value.length<1024;}});jscape.domain.DescriptionView=Class.extend({initialize:function(){this.fieldset=$("#domain-description-fields").layout({fit:true,doSize:false,border:false});this.description=$("textarea[name=description]",this.fieldset).textbox({required:false,validType:"domain_description",multiline:true,onChange:$.proxy(this._onChange,this),height:270});this.description.textbox("textbox").on("input",$.proxy(function(){var text=this.description.textbox("textbox").val();this._adjustButtonsState(text!=this.description.textbox("getValue"));},this));this.applyButton=$("a[role=button][name=apply]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$ApplyButton,this)});this.discardButton=$("a[role=button][name=discard]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$DiscardButton,this)});},getDescription:function(){return this.description.textbox("getValue");},setDescription:function(value){this.description.textbox("setValue",value).textbox("validate");},show:function(listener){this.listener=listener||jscape.DescriptionView.LISTENER;},refresh:function(){this.listener.onRefresh();},valid:function(){return this.fieldset.form("validate");},_onClick$ApplyButton:function(){this.applyButton.linkbutton("disable");this.listener.onApply();},_onClick$DiscardButton:function(){this.discardButton.linkbutton("disable");this.listener.onDiscard();},_onChange:function(){this.listener.onChange().done($.proxy(this._adjustButtonsState,this));},_adjustButtonsState:function(modified){var enable=!!modified;this.applyButton.linkbutton(enable?"enable":"disable");this.discardButton.linkbutton(enable?"enable":"disable");}});jscape.domain.DescriptionView.LISTENER={onChange:$.noop,onApply:$.noop,onDiscard:$.noop};