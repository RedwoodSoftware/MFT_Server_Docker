/* Copyright Â© 2009-2024. Redwood Software Inc. All rights reserved. */
jscape.domain=jscape.domain||{};jscape.domain.DomainModule=jscape.ApplicationModule.extend({domainName:null,onCreate:function(domainName,app){this.domainName=domainName;this.app=app;this._super(app);},_fireApplySuccess:function(){$(document).triggerHandler("broadcast",[window.R.string.APPLICATION_SUCCESS_APPLY]);}});jscape.domain.DomainSubmodule=jscape.domain.DomainModule.extend({controller:null,initialize:function(controller){this.controller=controller;},onStart:function(){this.controller.start(this.domainName);},onStop:function(){(this.controller.stop||$.noop).apply(this.controller);},onPause:function(){if(typeof this.controller.hasChanged==="function"){if(this.controller.hasChanged()){this._confirmAndApply(this.controller);(this.controller.pause||$.noop).apply(this.controller);}}},onResume:function(){(this.controller.resume||$.noop).apply(this.controller);},onRefresh:function(){(this.controller.refresh||$.noop).apply(this.controller);}});jscape.DomainSettingsApplication=jscape.Application.extend({start:function(domain){var _super=this._super;var args=$.makeArray(arguments).concat(this);$.when(jscape.API.getTriggerActions(domain),jscape.API.getTriggerFunctions(domain)).catch(function(){return[];}).then($.proxy(function(actions,functions){args.push(actions);args.push(functions);_super.apply(this,args);_super=args=null;},this));},onReady:function(){this._super();this.view.show(this);},navigateTo:function(id){if(this.modules.hasOwnProperty(id)){this.view.selectTab(id);return true;}
return false;},_createView:function(){this._super();this.view=new jscape.domain.DomainSettingsView();}});jscape.domain.DomainSettingsView=jscape.DashboardView.extend({initialize:function(){this._super($("#modules").children("[role=tablist]"));this.sidemenu=$("#domain-sidemenu");this.expandCollapseButton=$("#domain-sidemenu-tools-ec-btn").linkbutton({plain:true,selected:false,iconCls:"accordion-collapse accordion-expand",iconAlign:"right",onClick:$.proxy(this._onClick$ExpandCollapseButton,this)});},show:function(_,domainName){this._super.apply(this,arguments);this.domainName=domainName||"";this.modules.hide();this._initSidemenu(this.sidemenu);this._selectSidemenuItem(this.sidemenu,0);},navigateTo:function(id){this._selectTab(this.modules,id);},_onClick$ExpandCollapseButton:function(){var opts=this.expandCollapseButton.linkbutton("options");opts.selected=!opts.selected;if(opts.selected){this._onClick$ExpandAllButton();}else{this._onClick$CollapseAllButton();}},_onClick$ExpandAllButton:function(){var txt=this.expandCollapseButton.find(".l-btn-text");var content=txt.text();txt.text(this.expandCollapseButton.data("toggle-text"));this.expandCollapseButton.data("toggle-text",content);this.expandCollapseButton.find(".accordion-collapse").removeClass("accordion-expand");$.each(this.sidemenu.find(".accordion").accordion("panels"),function(_,p){p.panel("expand");});this.sidemenu.sidemenu("resize",{width:"100%"});},_onClick$CollapseAllButton:function(){var txt=this.expandCollapseButton.find(".l-btn-text");var content=txt.text();txt.text(this.expandCollapseButton.data("toggle-text"));this.expandCollapseButton.data("toggle-text",content);this.expandCollapseButton.find(".accordion-collapse").addClass("accordion-expand");$.each(this.sidemenu.find(".accordion").accordion("panels"),function(_,p){p.panel("collapse");});this.sidemenu.sidemenu("resize",{width:"100%"});},_onSelect$SideMenu:function(item){if(!item){return;}
var module=this.modules.filter(function(_,el){return el.id===item.id;});if(module.length){this.modules.not(module).hide();this._initSubtabs(module.show());if(this._onSelect$Module(item.id,module)){if(module.data("tabs")){module.tabs("resize");}}}},_onSelect$Module:function(id){if(!this.listener){return false;}
if(this.listener.onBeforeSelectModule(id)===false){return false;}
return this.listener.onSelectModule(id);},_subtabs:function(parent){return parent&&parent.length?parent.filter(function(){return $(this).parents("div.dialog").length==0;}):parent;}});jscape.domain.DomainStateModule=jscape.domain.DomainModule.extend({onStart:function(){$(document).on("domainstatechange",$.proxy(this.onChangeDomainState,this));if(this.view==null){this.view=new jscape.domain.DomainStateView(this.domainName);}
this.view.show(this);},onStop:function(){$(document).off("domainstatechange");},onResume:function(){this.view.refresh();},onLoadData:function(){return jscape.API.getDomainStatistics(this.domainName).then(function(stats){return stats?{status:jscape.DomainStatus.valueOf(stats),fipsMode:!!stats.fipsModeEnabled}:{};});},onStartDomain:function(){return jscape.API.startDomain(this.domainName).done($.proxy(this._raiseDomainStateChanged,this));},onStopDomain:function(){return this._confirmStopDomain(this.domainName).then($.proxy(function(){return jscape.API.stopDomain(this.domainName);},this)).done($.proxy(this._raiseDomainStateChanged,this));},onPauseDomain:function(){return this._confirmPauseDomain(this.domainName).then($.proxy(function(){return jscape.API.pauseDomain(this.domainName);},this)).done($.proxy(this._raiseDomainStateChanged,this));},onResumeDomain:function(){return jscape.API.resumeDomain(this.domainName).done($.proxy(this._raiseDomainStateChanged,this));},onChangeDomainState:function(){this.view.refresh();},_confirmStopDomain:function(name){return jscape.ConfirmDialog.confirm(window.R.string.DOMAIN_CONFIRM_STOP_TITLE,window.R.string.DOMAIN_CONFIRM_STOP_MESSAGE.supplant({0:name}));},_confirmPauseDomain:function(name){return jscape.ConfirmDialog.confirm(window.R.string.DOMAIN_CONFIRM_PAUSE_TITLE,window.R.string.DOMAIN_CONFIRM_PAUSE_MESSAGE.supplant({0:name}));},_raiseDomainStateChanged:function(){$(document).triggerHandler("domainstatechange");}});jscape.domain.DomainStateView=Class.extend({initialize:function(domainName){this.domainName=domainName||"";this.panel=$("#viewpane");this.state=$("#domain-state");this.startButton=$("a[role=button][name=startdomain]",this.panel).linkbutton({disabled:true,onClick:$.proxy(this._onClick$StartButton,this)});this.stopButton=$("a[role=button][name=stopdomain]",this.panel).linkbutton({disabled:true,onClick:$.proxy(this._onClick$StopButton,this)});this.pauseButton=$("a[role=button][name=pausedomain]",this.panel).linkbutton({disabled:true,onClick:$.proxy(this._onClick$PauseButton,this)});this.resumeButton=$("a[role=button][name=resumedomain]",this.panel).linkbutton({disabled:true,onClick:$.proxy(this._onClick$ResumeButton,this)});},show:function(listener){this.listener=listener||jscape.domain.DomainStateView.LISTENER;this.setTitle("");this._adjustButtonsState();},refresh:function(){this.setTitle(window.R.string.DOMAIN_MESSAGE_LOADING);this.listener.onLoadData().done($.proxy(function(state){var domainStatus=state.status?window.R.string["DOMAIN_STATUS_"+(state.status).toUpperCase()]:"";var fipsModeState=state.fipsMode?window.R.string["DOMAIN_FIPS_MODE"]:"";this.setTitle(domainStatus+" "+fipsModeState);this._adjustButtonsState(state.status);},this)).fail($.proxy(function(){this.setTitle("");},this));},setTitle:function(title){var text=window.R.string.DOMAIN_TITLE.supplant({0:this.domainName,1:title||""});this.state.text(text);document.title=text;},_onClick$StartButton:function(){this.startButton.linkbutton("disable");this.listener.onStartDomain().always($.proxy(function(){this.startButton.linkbutton("enable");},this));},_onClick$StopButton:function(){this.stopButton.linkbutton("disable");this.listener.onStopDomain().always($.proxy(function(){this.stopButton.linkbutton("enable");},this));},_onClick$PauseButton:function(){this.pauseButton.linkbutton("disable");this.listener.onPauseDomain().always($.proxy(function(){this.pauseButton.linkbutton("enable");},this));},_onClick$ResumeButton:function(){this.resumeButton.linkbutton("disable");this.listener.onResumeDomain().always($.proxy(function(){this.resumeButton.linkbutton("enable");},this));},_adjustButtonsState:function(status){this.startButton.linkbutton(jscape.DomainStatus.STOPPED==status?"enable":"disable");this.stopButton.linkbutton(jscape.DomainStatus.STOPPED!=status?"enable":"disable");this.pauseButton.linkbutton(jscape.DomainStatus.RUNNING==status?"enable":"disable");this.resumeButton.linkbutton(jscape.DomainStatus.PAUSED==status?"enable":"disable");}});jscape.domain.DomainStateView.LISTENER={onLoadData:$.noop,onStartDomain:$.noop,onStopDomain:$.noop,onPauseDomain:$.noop,onResumeDomain:$.noop};