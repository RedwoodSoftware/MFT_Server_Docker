/* Copyright Â© 2009-2024. Redwood Software Inc. All rights reserved. */
jscape.domain=jscape.domain||{};jscape.DomainLimits=Class.extend({initialize:function(a,b){this.maxTradingPartners=parseInt(a)||null;this.maxUsers=parseInt(b)||null;}});jscape.DomainLimits.fromJSON=function(data){return data?new jscape.DomainLimits(data.maxTradingPartners,data.maxUsers):null;};jscape.domain.DomainLimitsModule=jscape.domain.DomainModule.extend({view:null,limits:null,initialize:function(lca){this.allowed=!!lca;},onStart:function(){if(this.view==null){this.view=new jscape.domain.DomainLimitsView();}
this.view.show(this);},onResume:function(){this.view.refresh();},onPause:function(){if(this.hasChanged()){this._confirmAndApply(this);}},onRefresh:function(){return jscape.API.getDomainLimits(this.domainName).done($.proxy(function(value){this.limits=value;},this)).done($.proxy(this._setupView,this));},onChange:function(){return $.Deferred().resolve(this.hasChanged()).promise();},onApply:function(){if(!this.allowed||!this.view.valid()){return $.Deferred().reject().promise();}
var data=this._createLimits(this.view);return jscape.API.setDomainLimits(this.domainName,data).done($.proxy(function(){this.limits=data;this._fireApplySuccess();},this));},onDiscard:function(){this.limits=null;this.view.refresh();},hasChanged:function(){return this.limits!=null&&!Object._equals(this.limits,this._createLimits(this.view));},_setupView:function(limits){if(limits){this.view.setMaxTradingPartners(limits.maxTradingPartners);this.view.setMaxUsers(limits.maxUsers);}},_createLimits:function(view){return new jscape.DomainLimits(view.getMaxTradingPartners(),view.getMaxUsers());}});jscape.domain.DomainLimitsView=Class.extend({initialize:function(){this.fieldset=$("#domain-limits-fields").layout({fit:true,doSize:false,border:false});this.maxPartnersEnable=$("input[name=maxpartnersenable]:checkbox",this.fieldset).change($.proxy(function(){this.maxPartners.numberspinner(this.maxPartnersEnable.is(":checked")?"enable":"disable");this._onChange();},this));this.maxPartners=$("input[name=maxpartners]",this.fieldset).numberspinner({disabled:true,required:true,min:1,max:99999,value:10,onChange:$.proxy(this._onChange,this),width:120});this.maxUsersEnable=$("input[name=maxusersenable]:checkbox",this.fieldset).change($.proxy(function(){this.maxUsers.numberspinner(this.maxUsersEnable.is(":checked")?"enable":"disable");this._onChange();},this));this.maxUsers=$("input[name=maxusers]",this.fieldset).numberspinner({disabled:true,required:true,min:1,max:99999,value:10,onChange:$.proxy(this._onChange,this),width:120});this.applyButton=$("a[role=button][name=apply]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$ApplyButton,this)});this.discardButton=$("a[role=button][name=discard]",this.fieldset).linkbutton({disabled:true,onClick:$.proxy(this._onClick$DiscardButton,this)});},getMaxTradingPartners:function(){return this.maxPartnersEnable.is(":checked")?this.maxPartners.numberspinner("getValue"):null;},setMaxTradingPartners:function(value){value=parseInt(value);if(!isNaN(value)){this.maxPartners.numberspinner("setValue",value);this.maxPartnersEnable.prop("checked",true).change();}else{this.maxPartnersEnable.prop("checked",false).change();}},getMaxUsers:function(){return this.maxUsersEnable.is(":checked")?this.maxUsers.numberspinner("getValue"):null;},setMaxUsers:function(value){value=parseInt(value);if(!isNaN(value)){this.maxUsers.numberspinner("setValue",value);this.maxUsersEnable.prop("checked",true).change();}else{this.maxUsersEnable.prop("checked",false).change();}},show:function(listener){this.listener=listener||jscape.DomainLimitsView.LISTENER;},refresh:function(){this.listener.onRefresh();},valid:function(){return this.fieldset.form("validate");},_onClick$ApplyButton:function(){this.applyButton.linkbutton("disable");this.listener.onApply().done($.proxy(this._onChange,this));},_onClick$DiscardButton:function(){this.discardButton.linkbutton("disable");this.listener.onDiscard();},_onChange:function(){this.listener.onChange().done($.proxy(this._adjustButtonsState,this));},_adjustButtonsState:function(modified){var enable=!!modified;this.applyButton.linkbutton(enable?"enable":"disable");this.discardButton.linkbutton(enable?"enable":"disable");}});jscape.domain.DomainLimitsView.LISTENER={onChange:$.noop,onApply:$.noop,onDiscard:$.noop};