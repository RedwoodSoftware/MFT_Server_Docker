/* Copyright Â© 2009-2024. Redwood Software Inc. All rights reserved. */
jscape.account=jscape.account||{};jscape.account.DropZonesInfoModule=jscape.ApplicationModule.extend({onCreate:function(){this._super.apply(this,arguments);this.view=new jscape.account.DropZonesInfoView();},onStart:function(){this.view.show(this);},onResume:function(){this.view.refresh();},onRefresh:function(params){params=jscape.Page.requestParameters(params);return jscape.API.listDropZones(params.startIndex,params.count,params.query).then(jscape.Page.datagridFormatter());},onCopyLink:function(zone,target){return jscape.API.getDropZoneLink(zone.name).then(function(data){if(data&&data.uri){return new jscape.CopyToClipboardController().start(data.uri,target,window.R.string.APPLICATION_MESSAGE_COPIED);}
return data;});}});jscape.account.DropZonesInfoView=jscape.ui.DatagridView.extend({selection:null,initialize:function(){var initializing=true;this.layout=$("#account-dropzones-fields").layout({fit:true,doSize:false,border:false});this.data=$("table[role=grid][aria-label=dropzonesinfo]",this.layout);this.data.datagrid({fit:true,fitColumns:true,singleSelect:false,ctrlSelect:true,pagination:true,search:true,remoteSearch:true,sortName:"name",idField:"name",columns:[[{field:"name",title:$("thead th:nth-child(1)",this.data).text(),width:80,sortable:true},{field:"path",title:$("thead th:nth-child(2)",this.data).text(),width:120,sortable:true},{field:"uri",title:$("thead th:nth-child(3)",this.data).text(),width:120,sortable:false,searchable:false}]],onSelect:$.proxy(this._adjustButtonsState,this),onUnselect:$.proxy(this._adjustButtonsState,this),onUnselectAll:$.proxy(this._adjustButtonsState,this),onRowContextMenu:$.proxy(this._onRow$ContextMenu,this),loader:$.proxy(this._onLoad$Data,this),onLoadSuccess:$.proxy(this._onLoad$Success,this),onBeforeLoad:function(){return!initializing;}});this.copyLinkButton=$("a[role=button][name=copylink]",this.layout).linkbutton({disabled:true,onClick:$.proxy(this._onClick$CopyLinkButton,this)});initializing=false;},show:function(listener){this.listener=listener||jscape.account.DropZonesInfoView.LISTENER;this.layout.layout("resize");this._adjustButtonsState();},_onLoad$Data:function(params,success,error){this.listener.onRefresh(params).done(success).fail(error);},_onLoad$Success:function(){this._adjustButtonsState();},_onClick$CopyLinkButton:function(){var item=this.selection[0];var tr=this.data.datagrid("options").finder.getTr(this.data[0],this.data.datagrid("getRowIndex",item));var cell=tr.find("td[field=uri] .datagrid-cell");this.listener.onCopyLink(item,cell.length?cell:this.copyLinkButton);},_showContextMenu:function(e){this._super(e,[this.copyLinkButton]);},_adjustButtonsState:function(){this.selection=this.data.datagrid("getSelections");this.copyLinkButton.linkbutton(this.selection.length==1?"enable":"disable");}});jscape.account.DropZonesInfoView.LISTENER={onRefresh:$.noop,onCopyLink:$.noop};