/* Copyright Â© 2009-2024. Redwood Software Inc. All rights reserved. */
jscape.StorageManagementService=jscape.ManagementService.extend({listFiles:function(startIndex,count,query){return this._request("GET","/v2/files").matrix({start:startIndex}).send($.extend({count:parseInt(count)||undefined},query)).then(function(data){return jscape.Page.fromJSON(data,jscape.FileInfo.fromJSON);});},pathInfo:function(path){return this._request("POST","/v2/files/info").options({global:false}).send(path).then(function(data){return jscape.FileInfo.fromJSON(data);});},changeDir:function(path){return this._request("POST","/v2/files/cwd").send(path).then(function(data){return jscape.FileInfo.fromJSON(data);});},makeDir:function(path){return this._request("POST","/v2/files/mkdir").send(path);},openUploadSession:function(){return this._request("POST","/v2/files/upload").send();},uploadFile:function(sid,file,mode,metadata,options){return this._request("POST","/v2/files/upload/{id}").uri({id:sid}).options($.extend({timeout:0},options||{})).headers({"x-js-file":file.name,"x-js-mode":mode,"x-js-metadata":JSON.stringify(metadata)}).sendFormMultipart({file:file},true);},uploadFilePart:function(sid,file,mode,metadata,offset,options){offset=parseInt(offset)||0;var chunk=file.slice(offset);var headers={"Content-Range":"bytes {begin}-{end}/{size}".supplant({begin:offset,end:offset+chunk.size,size:file.size}),"x-js-file":file.name,"x-js-mode":mode,"x-js-metadata":JSON.stringify(metadata)};try{chunk.name=file.name;}catch(ignored){}
return this._request("PUT","/v2/files/upload/{id}").uri({id:sid}).options($.extend({timeout:0},options||{})).headers(headers).sendFormMultipart({file:chunk},true);},getUploadProgress:function(sid){return this._request("GET","/v2/files/upload/{id}").uri({id:sid}).options({global:false}).send().then(function(data){return jscape.UploadSessionInfo.fromJSON(data);});},uploadStatus:function(sids){return this._request("POST","/v2/files/upload-status").options({global:false}).send(sids).then(function(data){return $.map(data,jscape.UploadSessionInfo.fromJSON);});},cancelUpload:function(sid){return this._request("POST","/v2/files/upload/{id}/cancel").uri({id:sid}).send();},renameFile:function(source,target){return this._request("POST","/v2/files/rename").qs({path:source}).send(target).then(function(data){return jscape.FileInfo.fromJSON(data);});},moveFile:function(sources,target){return this._request("POST","/v2/files/move").qs({target:target}).send(sources);},deleteFile:function(paths){return this._request("DELETE","/v2/files").send(paths);},downloadFile:function(path){return this._request("GET","/v2/files/dload").sendDownloadAndCheck({path:path},this._request("GET","/v2/files/dload/state"));},zipDownload:function(paths,selectAll){return this._request("POST","/v2/files/zip").sendDownloadAndCheck({path:paths,all:!!selectAll||undefined},this._request("GET","/v2/files/zip/state"));},testPasswordCompliance:function(username,password){return this._request("POST","/compliance/test-pwd").sendSync({account:username,password:password});},listFileShares:function(startIndex,count,query){return this._request("GET","/v2/files/shares").matrix({start:startIndex,count:count}).send(query).then(function(data){return jscape.Page.fromJSON(data,jscape.FileShareInfo.fromJSON);});},shareFiles:function(data){return this._request("POST","/v2/files/shares").send(data);},composeShareFiles:function(paths,type){return this._request("POST","/v2/files/shares/compose").matrix({type:type}).send(paths).then(function(data){return jscape.AdHocTransferData.fromJSON(data);});},receiveFileShare:function(id){return this._request("POST","/v2/files/shares/receive").sendDownloadAndCheck({id:id},this._request("GET","/v2/files/shares/receive/state"));},getFileShareInfo:function(id){return this._request("POST","/v2/files/shares/info").send(id);},listFileShareRecipients:function(query){return this._request("GET","/v2/files/shares/contacts").options({global:false}).send(query);},addFileShareRecipientContact:function(data){return this._request("POST","/v2/files/shares/contacts").send(data);},tagsFor:function(path){return this._request("GET","/v2/files/tags").send({path:path}).then(function(data){return typeof data=="object"&&data.hasOwnProperty("tags")?data.tags:[]});},tagFile:function(path,tags){return this._request("POST","/v2/files/tags").send({path:path,tags:tags});},tagCloud:function(){return this._request("GET","/v2/files/tags/cloud").send().then(function(data){return jscape.TagCloudInfo.fromJSON(data);});},listUploadForms:function(){return this._request("GET","/v2/files/upload-forms").send().then(function(data){return $.map(data||[],jscape.UploadForm.fromJSON);});},getUploadForm:function(name){return this._request("GET","/v2/files/upload-forms/{name}").uri({name:name}).send().then(function(data){return jscape.UploadForm.fromJSON(data);});}});